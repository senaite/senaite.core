(()=>{"use strict";var e={609:e=>{e.exports=jQuery}},t={};function n(i){if(t[i])return t[i].exports;var a=t[i]={exports:{}};return e[i](a,a.exports,n),a.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e=n(609),t=n.n(e);const i=function(){var e=this;e.baseUrl=t()("body").attr("data-i18ncatalogurl"),e.currentLanguage=t()("html").attr("lang")||"en",e.currentLanguage.split("-").length>1&&(e.currentLanguage=e.currentLanguage.split("-")[0]+"_"+e.currentLanguage.split("-")[1].toUpperCase()),e.storage=null,e.catalogs={},e.ttl=864e5,Date.now||(Date.now=function(){return(new Date).valueOf()});try{"localStorage"in window&&null!==window.localStorage&&"JSON"in window&&null!==window.JSON&&(e.storage=window.localStorage)}catch(e){}e.configure=function(t){for(var n in t)e[n]=t[n]},e._setCatalog=function(t,n,i){t in e.catalogs||(e.catalogs[t]={}),e.catalogs[t][n]=i},e._storeCatalog=function(t,n,i){var a=t+"-"+n;null!==e.storage&&null!==i&&(e.storage.setItem(a,JSON.stringify(i)),e.storage.setItem(a+"-updated",Date.now()))},e.getUrl=function(t,n){return e.baseUrl+"?domain="+t+"&language="+n},e.loadCatalog=function(n,i){if(void 0===i&&(i=e.currentLanguage),null!==e.storage){var a=n+"-"+i;if(a in e.storage&&Date.now()-parseInt(e.storage.getItem(a+"-updated"),10)<e.ttl){var o=JSON.parse(e.storage.getItem(a));return void e._setCatalog(n,i,o)}}e.baseUrl&&t().getJSON(e.getUrl(n,i),(function(t){null!==t&&(e._setCatalog(n,i,t),e._storeCatalog(n,i,t))}))},e.MessageFactory=function(t,n){return n=n||e.currentLanguage,function(i,a){var o,r,s;if(o=t in e.catalogs&&n in e.catalogs[t]&&i in e.catalogs[t][n]?e.catalogs[t][n][i]:i,a)for(s in a)a.hasOwnProperty(s)&&(r=new RegExp("\\$\\{"+s+"\\}","g"),o=o.replace(r,a[s]));return o}}};var a=null,o=function(e,t){if(null===a){var n=new i;n.loadCatalog("senaite.core"),a=n.MessageFactory("senaite.core")}return a(e,t)},r=null,s=function(e,t){if(null===r){var n=new i;n.loadCatalog("plone"),r=n.MessageFactory("plone")}return r(e,t)};function l(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function u(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=c(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,r=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return r=e.done,e},e:function(e){s=!0,o=e},f:function(){try{r||null==n.return||n.return()}finally{if(s)throw o}}}}function c(e,t){if(e){if("string"==typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(e,t):void 0}}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function f(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}const h=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=Object.assign({form_selectors:[],field_selectors:[]},t),this.hooked_fields=[],this.on_mutated=this.on_mutated.bind(this),this.on_modified=this.on_modified.bind(this),this.on_blur=this.on_blur.bind(this),this.on_click=this.on_click.bind(this),this.on_change=this.on_change.bind(this),this.init_forms()}var n,i;return n=e,(i=[{key:"init_forms",value:function(){var e,t=u(this.config.form_selectors);try{for(t.s();!(e=t.n()).done;){var n=e.value,i=document.querySelector(n);i&&"FORM"===i.tagName&&(this.setup_form(i),this.watch_form(i))}}catch(e){t.e(e)}finally{t.f()}}},{key:"setup_form",value:function(e){this.ajax_send(e,{},"initialized")}},{key:"watch_form",value:function(e){var t,n=u(this.get_form_fields(e));try{for(n.s();!(t=n.n()).done;){var i=t.value;this.hook_field(i)}}catch(e){n.e(e)}finally{n.f()}this.observe_mutations(e),e.addEventListener("modified",this.on_modified),e.addEventListener("mutated",this.on_mutated)}},{key:"hook_field",value:function(e){-1===this.hooked_fields.indexOf(e)&&(this.is_button(e)||this.is_input_button(e)?e.addEventListener("click",this.on_click):this.is_text(e)||this.is_textarea(e)||this.is_select(e)?e.addEventListener("change",this.on_change):this.is_radio(e)||this.is_checkbox(e)?e.addEventListener("click",this.on_click):e.addEventListener("blur",this.on_blur),this.hooked_fields=this.hooked_fields.concat(e))}},{key:"observe_mutations",value:function(e){new MutationObserver((function(t){var n=new CustomEvent("mutated",{detail:{form:e,mutations:t}});e.dispatchEvent(n)})).observe(e,{childList:!0,subtree:!0})}},{key:"handle_mutation",value:function(e,t){var n=t.target,i=(n.closest(".field"),t.addedNodes),a=(t.removedNodes,this.config.field_selectors);if(this.is_multiple_select(n))return this.notify(e,n,"modified");if(i&&n.ELEMENT_NODE){var o,r=u(n.querySelectorAll(a));try{for(r.s();!(o=r.n()).done;){var s=o.value;this.hook_field(s)}}catch(e){r.e(e)}finally{r.f()}}}},{key:"toggle_submit",value:function(e,t){e.querySelector("input[type='submit']").disabled=!t}},{key:"toggle_field_visibility",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=e.closest(".field"),i="d-none";!1===t?n.classList.add(i):n.classList.remove(i)}},{key:"has_field_errors",value:function(e){return e.querySelectorAll(".is-invalid").length>0}},{key:"set_field_readonly",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e.setAttribute("readonly","");var n=e.parentElement.querySelector("div.readonly-message");if(n)n.innerHTML=_t(t);else{var i=document.createElement("div");i.className="readonly-message text-info small",i.innerHTML=_t(t),e.parentElement.appendChild(i)}}},{key:"set_field_error",value:function(e,t){e.classList.add("is-invalid");var n=e.parentElement.querySelector("div.invalid-feedback");if(n)n.innerHTML=_t(t);else{var i=document.createElement("div");i.className="invalid-feedback",i.innerHTML=_t(t),e.parentElement.appendChild(i)}}},{key:"remove_field_error",value:function(e){e.classList.remove("is-invalid");var t=e.parentElement.querySelector(".invalid-feedback");t&&t.remove()}},{key:"add_statusmessage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",n=document.createElement("div");n.innerHTML='\n      <div class="alert alert-'.concat(t,' alert-dismissible fade show" role="alert">\n        <strong>').concat(t.charAt(0).toUpperCase()+t.slice(1),"</strong>\n        ").concat(_t(e),'\n        <button type="button" class="close" data-dismiss="alert" aria-label="Close">\n          <span aria-hidden="true">&times;</span>\n        </button>\n      </div>\n    '),n=n.firstElementChild;var i=document.getElementById("viewlet-above-content");return i.appendChild(n),n}},{key:"add_notification",value:function(e,t,n){n=n||{},n=Object.assign({animation:!0,autohide:!0,delay:5e3},n);var i=document.createElement("div");i.innerHTML='\n      <div class="toast" style="width:300px" role="alert"\n           data-animation="'.concat(n.animation,'"\n           data-autohide="').concat(n.autohide,'"\n           data-delay="').concat(n.delay,'">\n        <div class="toast-header">\n          <strong class="mr-auto">').concat(e.charAt(0).toUpperCase()+e.slice(1),'</strong>\n          <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">\n            <span aria-hidden="true">&times;</span>\n          </button>\n        </div>\n        <div class="toast-body">\n          ').concat(_t(t),"\n        </div>\n      </div>\n    "),i=i.firstElementChild;var a=document.querySelector(".toast-container");return a||((a=document.createElement("div")).innerHTML='\n        <div style="position: fixed; top: 0px; right: 0px; width=100%;">\n          <div class="toast-container" style="position: absolute; top: 10px; right: 10px;">\n          </div>\n        </div>\n      ',document.querySelector(".container-fluid").appendChild(a),a=a.querySelector(".toast-container")),a.appendChild(i),i}},{key:"update_form",value:function(e,n){var i,a=n.hide||[],o=n.show||[],r=n.readonly||[],s=n.errors||[],c=n.messages||[],d=n.notifications||[],f=n.updates||[],h=u(s);try{for(h.s();!(i=h.n()).done;){var v,m,_=i.value,g=void 0,y=_;v=y.name,m=y.error,g=l(y,["name","error"]);var p=this.get_form_field_by_name(e,v);p&&(m?this.set_field_error(p,m):this.remove_field_error(p))}}catch(e){h.e(e)}finally{h.f()}var b,k=u(c);try{for(k.s();!(b=k.n()).done;){var w=b.value,x=(g=void 0,w);L=x.message,E=x.level,g=l(x,["message","level"]);var E=E||"info",L=L||"";this.add_statusmessage(L,E)}}catch(e){k.e(e)}finally{k.f()}var O,S=u(d);try{for(S.s();!(O=S.n()).done;){var T,C,A=O.value,j=(g=void 0,A);T=j.title,C=j.message,g=l(j,["title","message"]);var N=this.add_notification(T,C,g);t()(N).toast("show")}}catch(e){S.e(e)}finally{S.f()}var I,M=u(a);try{for(M.s();!(I=M.n()).done;){var q,U=I.value,z=(g=void 0,U);q=z.name,g=l(z,["name"]);var P=this.get_form_field_by_name(e,q);P&&this.toggle_field_visibility(P,!1)}}catch(e){M.e(e)}finally{M.f()}var D,H=u(o);try{for(H.s();!(D=H.n()).done;){var R,F=D.value,J=(g=void 0,F);R=J.name,g=l(J,["name"]);var B=this.get_form_field_by_name(e,R);B&&this.toggle_field_visibility(B,!0)}}catch(e){H.e(e)}finally{H.f()}var W,X=u(r);try{for(X.s();!(W=X.n()).done;){var $,K,Q=W.value,G=(g=void 0,Q);$=G.name,K=G.message,g=l(G,["name","message"]);var V=this.get_form_field_by_name(e,$);V&&this.set_field_readonly(V,K)}}catch(e){X.e(e)}finally{X.f()}var Y,Z=u(f);try{for(Z.s();!(Y=Z.n()).done;){var ee,te,ne=Y.value,ie=(g=void 0,ne);ee=ie.name,te=ie.value,g=l(ie,["name","value"]);var ae=this.get_form_field_by_name(e,ee);ae&&this.set_field_value(ae,te)}}catch(e){Z.e(e)}finally{Z.f()}this.has_field_errors(e)?this.toggle_submit(e,!1):this.toggle_submit(e,!0)}},{key:"get_form_field_by_name",value:function(e,t){var n=e.querySelector("[name='".concat(t,"']")),i=e.querySelector("[name^='".concat(t,"']")),a=n||i||null;return null===a?null:a}},{key:"get_form_data",value:function(e){var t={};return new FormData(e).forEach((function(e,n){t[n]=e})),t}},{key:"get_form_fields",value:function(e){var t,n,i=[],a=u(this.config.field_selectors);try{for(a.s();!(t=a.n()).done;){var o,r=t.value,s=e.querySelectorAll(r);i=(o=i).concat.apply(o,function(e){if(Array.isArray(e))return d(e)}(n=s.values())||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(n)||c(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())}}catch(e){a.e(e)}finally{a.f()}return i}},{key:"get_field_name",value:function(e){return e.name.split(":")[0]}},{key:"get_field_value",value:function(e){if(this.is_checkbox(e))return e.checked;if(this.is_select(e)){var t=e.selectedOptions;return Array.prototype.map.call(t,(function(e){return e.value}))}if(this.is_single_reference(e))return e.getAttribute("uid");if(this.is_multi_reference(e)){var n=e.getAttribute("uid");return 0==n.length?[]:n.split(",")}return e.value}},{key:"set_field_value",value:function(e,t){var n=t.selected||[],i=t.options||[];if(this.is_single_reference(e)){var a,o=u(n);try{for(o.s();!(a=o.n()).done;){var r=a.value;e.setAttribute("uid",r.value),e.value=r.title}}catch(e){o.e(e)}finally{o.f()}}else if(this.is_select(e)){if(0==n.length){var s=e.options[e.selected];s&&(n=[s.value])}e.options.length=0,i.sort((function(e,t){var n=e.title.toLowerCase(),i=t.title.toLowerCase();return null===e.value&&(n=""),null===t.value&&(i=""),n<i?-1:n>i?1:void 0}));var l,c=u(i);try{for(c.s();!(l=c.n()).done;){var d=l.value,f=document.createElement("option");f.value=d.value,f.innerHTML=d.title,-1!==n.indexOf(d.value)&&(f.selected=!0),e.appendChild(f)}}catch(e){c.e(e)}finally{c.f()}0==n.length&&(e.selectedIndex=0)}else this.is_checkbox(e)?e.checked=t:e.value=t}},{key:"modified",value:function(e){var t=new CustomEvent("modified",{detail:{field:e,form:e.form}});e.form.dispatchEvent(t)}},{key:"notify",value:function(e,t,n){var i={name:this.get_field_name(t),value:this.get_field_value(t)};this.ajax_send(e,i,n)}},{key:"ajax_send",value:function(e,t,n){var i=this,a=document.body.dataset.viewUrl,o="".concat(a,"/ajax_form/").concat(n),r=Object.assign({form:this.get_form_data(e)},t),s={method:"POST",credentials:"include",body:JSON.stringify(r),headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector("#protect-script").dataset.token}},l=new Request(o,s);fetch(l).then((function(e){return e.ok?e.json():Promise.reject(e)})).then((function(t){i.update_form(e,t)})).catch((function(e){}))}},{key:"is_textarea",value:function(e){return"TEXTAREA"==e.tagName}},{key:"is_select",value:function(e){return"SELECT"==e.tagName}},{key:"is_multiple_select",value:function(e){return this.is_select(e)&&e.hasAttribute("multiple")}},{key:"is_input",value:function(e){return"INPUT"===e.tagName}},{key:"is_text",value:function(e){return this.is_input(e)&&"text"===e.type}},{key:"is_button",value:function(e){return"BUTTON"===e.tagName}},{key:"is_input_button",value:function(e){return this.is_input(e)&&"button"===e.type}},{key:"is_checkbox",value:function(e){return this.is_input(e)&&"checkbox"===e.type}},{key:"is_radio",value:function(e){return this.is_input(e)&&"radio"===e.type}},{key:"is_reference",value:function(e){return e.classList.contains("referencewidget")}},{key:"is_single_reference",value:function(e){return this.is_reference(e)&&"0"==e.getAttribute("multivalued")}},{key:"is_multi_reference",value:function(e){return this.is_reference(e)&&"1"==e.getAttribute("multivalued")}},{key:"on_mutated",value:function(e){var t,n=e.detail.form,i=[],a=u(e.detail.mutations);try{for(a.s();!(t=a.n()).done;){var o=t.value;i.indexOf(o.target)>-1||(i=i.concat(o.target),this.handle_mutation(n,o))}}catch(e){a.e(e)}finally{a.f()}}},{key:"on_modified",value:function(e){var t=e.detail.form,n=e.detail.field;this.notify(t,n,"modified")}},{key:"on_blur",value:function(e){var t=e.currentTarget;this.modified(t)}},{key:"on_click",value:function(e){var t=e.currentTarget;this.modified(t)}},{key:"on_change",value:function(e){var t=e.currentTarget;this.modified(t)}}])&&f(n.prototype,i),e}();var v=n(609),m=function(e,t){return function(){return e.apply(t,arguments)}};const _=function(){function e(){this.set_cookie=m(this.set_cookie,this),this.read_cookie=m(this.read_cookie,this),this.authenticator=m(this.authenticator,this)}return e.prototype.authenticator=function(){var e;return(e=v("input[name='_authenticator']").val())||(e=new URLSearchParams(window.location.search).get("_authenticator")),e},e.prototype.read_cookie=function(e){var t,n,i;for(e+="=",n=document.cookie.split(";"),i=0;i<n.length;){for(t=n[i];" "===t.charAt(0);)t=t.substring(1);if(0===t.indexOf(e))return t.substring(e.length,t.length);i++}return null},e.prototype.set_cookie=function(e,t){var n,i;(n=new Date).setTime(n.getTime()+864e5),i="expires="+n.toUTCString(),document.cookie=e+"="+t+";"+i+";path=/"},e}();function g(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}const y=function(){function e(t){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=Object.assign({el:"sidebar",toggle_el:"sidebar-header",cookie_key:"sidebar-toggle",timeout:1e3},t),this.tid=null,this.maximize=this.maximize.bind(this),this.minimize=this.minimize.bind(this),this.on_click=this.on_click.bind(this),this.on_mouseenter=this.on_mouseenter.bind(this),this.on_mouseleave=this.on_mouseleave.bind(this),this.toggle_el=document.getElementById(this.config.toggle_el),this.toggle_el&&this.toggle_el.addEventListener("click",this.on_click),this.el=document.getElementById(this.config.el),this.el&&(this.el.addEventListener("mouseenter",this.on_mouseenter),this.el.addEventListener("mouseleave",this.on_mouseleave),this.is_toggled()&&(this.el.classList.remove("minimized"),this.el.classList.add("toggled"))),this}var t,n;return t=e,(n=[{key:"is_toggled",value:function(){return"true"==window.site.read_cookie(this.config.cookie_key)}},{key:"toggle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];window.site.set_cookie(this.config.cookie_key,e),e?(this.el.classList.add("toggled"),this.maximize()):(this.el.classList.remove("toggled"),this.minimize())}},{key:"minimize",value:function(){this.el.classList.add("minimized")}},{key:"maximize",value:function(){this.el.classList.remove("minimized")}},{key:"on_click",value:function(e){clearTimeout(this.tid),this.toggle(!this.is_toggled())}},{key:"on_mouseenter",value:function(e){clearTimeout(this.tid),this.is_toggled()||(this.tid=setTimeout(this.maximize,this.config.timeout))}},{key:"on_mouseleave",value:function(e){clearTimeout(this.tid),this.is_toggled()||this.minimize()}}])&&g(t.prototype,n),e}();document.addEventListener("DOMContentLoaded",(function(){window.i18n=new i,window._t=o,window._p=s,window.portal_url=document.body.dataset.portalUrl,tinymce.init({height:300,paste_data_images:!0,selector:"textarea.mce_editable,div.ArchetypesRichWidget textarea,textarea[name='form.widgets.IRichTextBehavior.text'],textarea.richTextWidget",plugins:["paste","link","fullscreen","table","code"],content_css:"/++plone++senaite.core.static/bundles/main.css"}),window.site=new _,window.sidebar=new y({el:"sidebar"}),new h({form_selectors:["form[name='edit_form']"],field_selectors:["input[type='text']","input[type='number']","input[type='checkbox']","input[type='radio']","select:not([multiple])","textarea"]}),t()((function(){t()("[data-toggle='tooltip']").tooltip()}))}))})()})();
//# sourceMappingURL=main.js.map