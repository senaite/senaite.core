(()=>{"use strict";var e={311:e=>{e.exports=jQuery}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e=n(311),t=n.n(e);const r=function(){var e=this;e.baseUrl=t()("body").attr("data-i18ncatalogurl"),e.currentLanguage=t()("html").attr("lang")||"en",e.currentLanguage.split("-").length>1&&(e.currentLanguage=e.currentLanguage.split("-")[0]+"_"+e.currentLanguage.split("-")[1].toUpperCase()),e.storage=null,e.catalogs={},e.ttl=864e5,Date.now||(Date.now=function(){return(new Date).valueOf()});try{"localStorage"in window&&null!==window.localStorage&&"JSON"in window&&null!==window.JSON&&(e.storage=window.localStorage)}catch(e){}e.configure=function(t){for(var n in t)e[n]=t[n]},e._setCatalog=function(t,n,r){t in e.catalogs||(e.catalogs[t]={}),e.catalogs[t][n]=r},e._storeCatalog=function(t,n,r){var o=t+"-"+n;null!==e.storage&&null!==r&&(e.storage.setItem(o,JSON.stringify(r)),e.storage.setItem(o+"-updated",Date.now()))},e.getUrl=function(t,n){return e.baseUrl+"?domain="+t+"&language="+n},e.loadCatalog=function(n,r){if(void 0===r&&(r=e.currentLanguage),null!==e.storage){var o=n+"-"+r;if(o in e.storage&&Date.now()-parseInt(e.storage.getItem(o+"-updated"),10)<e.ttl){var i=JSON.parse(e.storage.getItem(o));return void e._setCatalog(n,r,i)}}e.baseUrl&&t().getJSON(e.getUrl(n,r),(function(t){null!==t&&(e._setCatalog(n,r,t),e._storeCatalog(n,r,t))}))},e.MessageFactory=function(t,n){return n=n||e.currentLanguage,function(r,o){var i,a,s;if(i=t in e.catalogs&&n in e.catalogs[t]&&r in e.catalogs[t][n]?e.catalogs[t][n][r]:r,o)for(s in o)o.hasOwnProperty(s)&&(a=new RegExp("\\$\\{"+s+"\\}","g"),i=i.replace(a,o[s]));return i}}};var o=null,i=function(e,t){if(null===o){var n=new r;n.loadCatalog("senaite.core"),o=n.MessageFactory("senaite.core")}return o(e,t)},a=null,s=function(e,t){if(null===a){var n=new r;n.loadCatalog("plone"),a=n.MessageFactory("plone")}return a(e,t)},l=["name","error"],u=["message","level"],c=["title","message"],f=["name"],d=["name"],h=["name","message"],p=["name","message"],v=["name","value"],y=["selector","html"],m=["selector","name","value"];function _(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function g(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=b(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function b(e,t){if(e){if("string"==typeof e)return k(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?k(e,t):void 0}}function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function w(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}const E=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=Object.assign({form_selectors:[],field_selectors:[]},t),this.hooked_fields=[],this.on_mutated=this.on_mutated.bind(this),this.on_modified=this.on_modified.bind(this),this.on_submit=this.on_submit.bind(this),this.on_blur=this.on_blur.bind(this),this.on_click=this.on_click.bind(this),this.on_change=this.on_change.bind(this),this.init_forms()}var n,r;return n=e,r=[{key:"init_forms",value:function(){var e,t=g(this.config.form_selectors);try{for(t.s();!(e=t.n()).done;){var n=e.value,r=document.querySelector(n);r&&"FORM"===r.tagName&&(this.setup_form(r),this.watch_form(r))}}catch(e){t.e(e)}finally{t.f()}}},{key:"setup_form",value:function(e){this.ajax_send(e,{},"initialized")}},{key:"watch_form",value:function(e){var t,n=g(this.get_form_fields(e));try{for(n.s();!(t=n.n()).done;){var r=t.value;this.hook_field(r)}}catch(e){n.e(e)}finally{n.f()}this.observe_mutations(e),e.addEventListener("modified",this.on_modified),e.addEventListener("mutated",this.on_mutated),e.hasAttribute("ajax-submit")&&e.addEventListener("submit",this.on_submit)}},{key:"hook_field",value:function(e){-1===this.hooked_fields.indexOf(e)&&(this.is_button(e)||this.is_input_button(e)?e.addEventListener("click",this.on_click):this.is_text(e)||this.is_textarea(e)||this.is_select(e)?e.addEventListener("change",this.on_change):this.is_radio(e)||this.is_checkbox(e)?e.addEventListener("click",this.on_click):e.addEventListener("blur",this.on_blur),this.hooked_fields=this.hooked_fields.concat(e))}},{key:"observe_mutations",value:function(e){new MutationObserver((function(t){var n=new CustomEvent("mutated",{detail:{form:e,mutations:t}});e.dispatchEvent(n)})).observe(e,{childList:!0,subtree:!0})}},{key:"handle_mutation",value:function(e,t){var n=t.target,r=(n.closest(".field"),t.addedNodes),o=(t.removedNodes,this.config.field_selectors);if(this.is_multiple_select(n))return this.notify(e,n,"modified");if(r&&n.ELEMENT_NODE){var i,a=g(n.querySelectorAll(o));try{for(a.s();!(i=a.n()).done;){var s=i.value;this.hook_field(s)}}catch(e){a.e(e)}finally{a.f()}}}},{key:"toggle_submit",value:function(e,t){e.querySelector("input[type='submit']").disabled=!t}},{key:"toggle_field_visibility",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=e.closest(".field"),r="d-none";!1===t?n.classList.add(r):n.classList.remove(r)}},{key:"has_field_errors",value:function(e){return e.querySelectorAll(".is-invalid").length>0}},{key:"set_field_readonly",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e.setAttribute("readonly","");var n=e.parentElement.querySelector("div.message");if(n)n.innerHTML=_t(t);else{var r=document.createElement("div");r.className="message text-secondary small",r.innerHTML=_t(t),e.parentElement.appendChild(r)}}},{key:"set_field_editable",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e.removeAttribute("readonly");var n=e.parentElement.querySelector("div.message");if(n)n.innerHTML=_t(t);else{var r=document.createElement("div");r.className="message text-secondary small",r.innerHTML=_t(t),e.parentElement.appendChild(r)}}},{key:"set_field_error",value:function(e,t){e.classList.add("is-invalid");var n=e.parentElement.querySelector("div.invalid-feedback");if(n)n.innerHTML=_t(t);else{var r=document.createElement("div");r.className="invalid-feedback",r.innerHTML=_t(t),e.parentElement.appendChild(r)}}},{key:"remove_field_error",value:function(e){e.classList.remove("is-invalid");var t=e.parentElement.querySelector(".invalid-feedback");t&&t.remove()}},{key:"add_statusmessage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",n=arguments.length>2?arguments[2]:void 0;n=n||{};var r=document.createElement("div"),o=n.title||"".concat(t.charAt(0).toUpperCase()+t.slice(1));r.innerHTML='\n      <div class="alert alert-'.concat(t,' alert-dismissible fade show" role="alert">\n        <strong>').concat(o,"</strong>\n        ").concat(_t(e),'\n        <button type="button" class="close" data-dismiss="alert" aria-label="Close">\n          <span aria-hidden="true">&times;</span>\n        </button>\n      </div>\n    '),r=r.firstElementChild;var i=document.getElementById("viewlet-above-content");if(n.flush){var a,s=g(i.querySelectorAll(".alert"));try{for(s.s();!(a=s.n()).done;){var l=a.value;l.remove()}}catch(e){s.e(e)}finally{s.f()}}return i.appendChild(r),r}},{key:"add_notification",value:function(e,t,n){n=n||{},n=Object.assign({animation:!0,autohide:!0,delay:5e3},n);var r=document.createElement("div");r.innerHTML='\n      <div class="toast" style="width:300px" role="alert"\n           data-animation="'.concat(n.animation,'"\n           data-autohide="').concat(n.autohide,'"\n           data-delay="').concat(n.delay,'">\n        <div class="toast-header">\n          <strong class="mr-auto">').concat(e.charAt(0).toUpperCase()+e.slice(1),'</strong>\n          <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">\n            <span aria-hidden="true">&times;</span>\n          </button>\n        </div>\n        <div class="toast-body">\n          ').concat(_t(t),"\n        </div>\n      </div>\n    "),r=r.firstElementChild;var o=document.querySelector(".toast-container");return o||((o=document.createElement("div")).innerHTML='\n        <div style="position: fixed; top: 0px; right: 0px; width=100%;">\n          <div class="toast-container" style="position: absolute; top: 10px; right: 10px;">\n          </div>\n        </div>\n      ',document.querySelector(".container-fluid").appendChild(o),o=o.querySelector(".toast-container")),o.appendChild(r),r}},{key:"update_form",value:function(e,n){var r,o=n.hide||[],i=n.show||[],a=n.readonly||[],s=n.editable||[],b=n.errors||[],k=n.messages||[],w=n.notifications||[],E=n.updates||[],O=n.html||[],S=n.attributes||[],x=g(b);try{for(x.s();!(r=x.n()).done;){var j,T,A=r.value,C=void 0,N=A;j=N.name,T=N.error,C=_(N,l);var L=this.get_form_field_by_name(e,j);L&&(T?this.set_field_error(L,T):this.remove_field_error(L))}}catch(e){x.e(e)}finally{x.f()}var P,I=g(k);try{for(I.s();!(P=I.n()).done;){var R=P.value,M=(C=void 0,R);D=M.message,q=M.level,C=_(M,u);var q=q||"info",D=D||"";this.add_statusmessage(D,q,C)}}catch(e){I.e(e)}finally{I.f()}var U,z=g(w);try{for(z.s();!(U=z.n()).done;){var B,H,F=U.value,J=(C=void 0,F);B=J.title,H=J.message,C=_(J,c);var $=this.add_notification(B,H,C);t()($).toast("show")}}catch(e){z.e(e)}finally{z.f()}var W,K=g(o);try{for(K.s();!(W=K.n()).done;){var X,G=W.value,Q=(C=void 0,G);X=Q.name,C=_(Q,f);var V=this.get_form_field_by_name(e,X);V&&this.toggle_field_visibility(V,!1)}}catch(e){K.e(e)}finally{K.f()}var Y,Z=g(i);try{for(Z.s();!(Y=Z.n()).done;){var ee,te=Y.value,ne=(C=void 0,te);ee=ne.name,C=_(ne,d);var re=this.get_form_field_by_name(e,ee);re&&this.toggle_field_visibility(re,!0)}}catch(e){Z.e(e)}finally{Z.f()}var oe,ie=g(a);try{for(ie.s();!(oe=ie.n()).done;){var ae,se,le=oe.value,ue=(C=void 0,le);ae=ue.name,se=ue.message,C=_(ue,h);var ce=this.get_form_field_by_name(e,ae);ce&&this.set_field_readonly(ce,se)}}catch(e){ie.e(e)}finally{ie.f()}var fe,de=g(s);try{for(de.s();!(fe=de.n()).done;){var he,pe,ve=fe.value,ye=(C=void 0,ve);he=ye.name,pe=ye.message,C=_(ye,p);var me=this.get_form_field_by_name(e,he);me&&this.set_field_editable(me,pe)}}catch(e){de.e(e)}finally{de.f()}var _e,ge=g(E);try{for(ge.s();!(_e=ge.n()).done;){var be,ke,we=_e.value,Ee=(C=void 0,we);be=Ee.name,ke=Ee.value,C=_(Ee,v);var Oe=this.get_form_field_by_name(e,be);Oe&&this.set_field_value(Oe,ke)}}catch(e){ge.e(e)}finally{ge.f()}var Se,xe=g(O);try{for(xe.s();!(Se=xe.n()).done;){var je,Te,Ae=Se.value,Ce=(C=void 0,Ae);je=Ce.selector,Te=Ce.html,C=_(Ce,y);var Ne=e.querySelector(je);Ne&&(C.append?Ne.innerHTML=Ne.innerHTML+Te:Ne.innerHTML=Te)}}catch(e){xe.e(e)}finally{xe.f()}var Le,Pe=g(S);try{for(Pe.s();!(Le=Pe.n()).done;){var Ie,Re,Me,qe=Le.value,De=(C=void 0,qe);Ie=De.selector,Re=De.name,Me=De.value,C=_(De,m);var Ue=e.querySelector(Ie);Ue&&(null===Me?Ue.removeAttribute(Re):Ue.addAttribute(Re,Me))}}catch(e){Pe.e(e)}finally{Pe.f()}this.has_field_errors(e)?this.toggle_submit(e,!1):this.toggle_submit(e,!0)}},{key:"get_form_field_by_name",value:function(e,t){var n=e.querySelector("[name='".concat(t,"']")),r=e.querySelector("[name^='".concat(t,"']")),o=n||r||null;return null===o?null:o}},{key:"get_form_data",value:function(e){var t={};return new FormData(e).forEach((function(e,n){t[n]=e})),t}},{key:"get_form_fields",value:function(e){var t,n,r=[],o=g(this.config.field_selectors);try{for(o.s();!(t=o.n()).done;){var i,a=t.value,s=e.querySelectorAll(a);r=(i=r).concat.apply(i,function(e){if(Array.isArray(e))return k(e)}(n=s.values())||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(n)||b(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())}}catch(e){o.e(e)}finally{o.f()}return r}},{key:"get_field_name",value:function(e){return e.name.split(":")[0]}},{key:"get_field_value",value:function(e){if(this.is_checkbox(e))return e.checked;if(this.is_select(e)){var t=e.selectedOptions;return Array.prototype.map.call(t,(function(e){return e.value}))}if(this.is_single_reference(e))return e.getAttribute("uid");if(this.is_multi_reference(e)){var n=e.getAttribute("uid");return 0==n.length?[]:n.split(",")}return e.value}},{key:"set_field_value",value:function(e,t){var n=t.selected||[],r=t.options||[];if(this.is_single_reference(e)){var o,i=g(n);try{for(i.s();!(o=i.n()).done;){var a=o.value;e.setAttribute("uid",a.value),e.value=a.title}}catch(e){i.e(e)}finally{i.f()}}else if(this.is_select(e)){if(0==n.length){var s=e.options[e.selected];s&&(n=[s.value])}e.options.length=0,r.sort((function(e,t){var n=e.title.toLowerCase(),r=t.title.toLowerCase();return null===e.value&&(n=""),null===t.value&&(r=""),n<r?-1:n>r?1:void 0}));var l,u=g(r);try{for(u.s();!(l=u.n()).done;){var c=l.value,f=document.createElement("option");f.value=c.value,f.innerHTML=c.title,-1!==n.indexOf(c.value)&&(f.selected=!0),e.appendChild(f)}}catch(e){u.e(e)}finally{u.f()}0==n.length&&(e.selectedIndex=0)}else this.is_checkbox(e)?e.checked=t:e.value=t}},{key:"modified",value:function(e){var t=new CustomEvent("modified",{detail:{field:e,form:e.form}});e.form.dispatchEvent(t)}},{key:"loading",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=e?"ajaxStart":"ajaxStop",n=new CustomEvent(t);document.dispatchEvent(n)}},{key:"notify",value:function(e,t,n){var r={name:this.get_field_name(t),value:this.get_field_value(t)};this.ajax_send(e,r,n)}},{key:"ajax_send",value:function(e,t,n){var r=document.body.dataset.viewUrl,o="".concat(r,"/ajax_form/").concat(n),i=Object.assign({form:this.get_form_data(e)},t),a={method:"POST",credentials:"include",body:JSON.stringify(i),headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector("#protect-script").dataset.token}};return this.ajax_request(e,o,a)}},{key:"ajax_submit",value:function(e,t,n){for(var r=document.body.dataset.viewUrl,o="".concat(r,"/ajax_form/").concat(n),i=new FormData(e),a=0,s=Object.entries(t);a<s.length;a++){var l=(f=s[a],d=2,function(e){if(Array.isArray(e))return e}(f)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){s=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(s)throw o}}return i}}(f,d)||b(f,d)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),u=l[0],c=l[1];i.set(u,c)}var f,d,h={method:"POST",body:i};return this.ajax_request(e,o,h)}},{key:"ajax_request",value:function(e,t,n){var r=this;this.loading(!0);var o=new Request(t,n);return fetch(o).then((function(e){return e.ok?e.json():Promise.reject(e)})).then((function(t){r.update_form(e,t),r.loading(!1)})).catch((function(e){r.loading(!1)}))}},{key:"toggle_disable",value:function(e,t){e&&(e.disabled=t)}},{key:"is_textarea",value:function(e){return"TEXTAREA"==e.tagName}},{key:"is_select",value:function(e){return"SELECT"==e.tagName}},{key:"is_multiple_select",value:function(e){return this.is_select(e)&&e.hasAttribute("multiple")}},{key:"is_input",value:function(e){return"INPUT"===e.tagName}},{key:"is_text",value:function(e){return this.is_input(e)&&"text"===e.type}},{key:"is_button",value:function(e){return"BUTTON"===e.tagName}},{key:"is_input_button",value:function(e){return this.is_input(e)&&"button"===e.type}},{key:"is_checkbox",value:function(e){return this.is_input(e)&&"checkbox"===e.type}},{key:"is_radio",value:function(e){return this.is_input(e)&&"radio"===e.type}},{key:"is_reference",value:function(e){return e.classList.contains("referencewidget")}},{key:"is_single_reference",value:function(e){return this.is_reference(e)&&"0"==e.getAttribute("multivalued")}},{key:"is_multi_reference",value:function(e){return this.is_reference(e)&&"1"==e.getAttribute("multivalued")}},{key:"on_mutated",value:function(e){var t,n=e.detail.form,r=[],o=g(e.detail.mutations);try{for(o.s();!(t=o.n()).done;){var i=t.value;r.indexOf(i.target)>-1||(r=r.concat(i.target),this.handle_mutation(n,i))}}catch(e){o.e(e)}finally{o.f()}}},{key:"on_modified",value:function(e){var t=e.detail.form,n=e.detail.field;this.notify(t,n,"modified")}},{key:"on_submit",value:function(e){var t=this;e.preventDefault();var n={},r=e.currentTarget.closest("form"),o=e.submitter;o&&(n[o.name]=o.value,this.toggle_disable(o,!0)),this.ajax_submit(r,n,"submit").then((function(e){return t.toggle_disable(o,!1)}))}},{key:"on_blur",value:function(e){var t=e.currentTarget;this.modified(t)}},{key:"on_click",value:function(e){var t=e.currentTarget;this.modified(t)}},{key:"on_change",value:function(e){var t=e.currentTarget;this.modified(t)}}],r&&w(n.prototype,r),e}();var O=n(311),S=function(e,t){return function(){return e.apply(t,arguments)}};const x=function(){function e(){this.set_cookie=S(this.set_cookie,this),this.read_cookie=S(this.read_cookie,this),this.authenticator=S(this.authenticator,this)}return e.prototype.authenticator=function(){var e;return(e=O("input[name='_authenticator']").val())||(e=new URLSearchParams(window.location.search).get("_authenticator")),e},e.prototype.read_cookie=function(e){var t,n,r;for(e+="=",n=document.cookie.split(";"),r=0;r<n.length;){for(t=n[r];" "===t.charAt(0);)t=t.substring(1);if(0===t.indexOf(e))return t.substring(e.length,t.length);r++}return null},e.prototype.set_cookie=function(e,t){var n,r;(n=new Date).setTime(n.getTime()+864e5),r="expires="+n.toUTCString(),document.cookie=e+"="+t+";"+r+";path=/"},e}();function j(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}const T=function(){function e(t){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=Object.assign({el:"sidebar",toggle_el:"sidebar-header",cookie_key:"sidebar-toggle",timeout:1e3},t),this.tid=null,this.maximize=this.maximize.bind(this),this.minimize=this.minimize.bind(this),this.on_click=this.on_click.bind(this),this.on_mouseenter=this.on_mouseenter.bind(this),this.on_mouseleave=this.on_mouseleave.bind(this),this.toggle_el=document.getElementById(this.config.toggle_el),this.toggle_el&&this.toggle_el.addEventListener("click",this.on_click),this.el=document.getElementById(this.config.el),this.el&&(this.el.addEventListener("mouseenter",this.on_mouseenter),this.el.addEventListener("mouseleave",this.on_mouseleave),this.is_toggled()&&(this.el.classList.remove("minimized"),this.el.classList.add("toggled"))),this}var t,n;return t=e,n=[{key:"is_toggled",value:function(){return"true"==window.site.read_cookie(this.config.cookie_key)}},{key:"toggle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];window.site.set_cookie(this.config.cookie_key,e),e?(this.el.classList.add("toggled"),this.maximize()):(this.el.classList.remove("toggled"),this.minimize())}},{key:"minimize",value:function(){this.el.classList.add("minimized")}},{key:"maximize",value:function(){this.el.classList.remove("minimized")}},{key:"on_click",value:function(e){clearTimeout(this.tid),this.toggle(!this.is_toggled())}},{key:"on_mouseenter",value:function(e){clearTimeout(this.tid),this.is_toggled()||(this.tid=setTimeout(this.maximize,this.config.timeout))}},{key:"on_mouseleave",value:function(e){clearTimeout(this.tid),this.is_toggled()||this.minimize()}}],n&&j(t.prototype,n),e}(),A=React;var C=n.n(A);function N(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){s=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(s)throw o}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return L(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?L(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function L(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function P(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}ReactDOM;const I=function(){function e(t){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.api_url=t.api_url,this.on_api_error=t.on_api_error||function(e){},this}var t,n;return t=e,(n=[{key:"get_api_url",value:function(e){return"".concat(this.api_url,"/").concat(e,"#").concat(location.search)}},{key:"get_json",value:function(e,t){var n,r,o,i,a,s;return null==t&&(t={}),o=t.method||"POST",n=JSON.stringify(t.data)||"{}",i=this.on_api_error,s=this.get_api_url(e),r={method:o,headers:{"Content-Type":"application/json","X-CSRF-TOKEN":this.get_csrf_token()},body:"POST"===o?n:null,credentials:"include"},a=new Request(s,r),fetch(a).then((function(e){return e.ok?e:Promise.reject(e)})).then((function(e){return e.json()})).catch((function(e){return i(e),e}))}},{key:"search",value:function(e,t,n){n=n||{};for(var r="search?catalog=".concat(e),o=0,i=Object.entries(t);o<i.length;o++){var a=N(i[o],2),s=a[0],l=a[1];"path"==s&&null!==(l=l.query||null).depth&&(r+="&depth=".concat(l.depth)),l&&(r+="&".concat(s,"=").concat(l))}for(var u=0,c=Object.entries(n);u<c.length;u++){var f=N(c[u],2),d=f[0],h=f[1];r+="&".concat(d,"=").concat(h)}return this.get_json(r,{method:"GET"})}},{key:"get_csrf_token",value:function(){return document.querySelector("#protect-script").dataset.token}}])&&P(t.prototype,n),e}();function R(e){return R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},R(e)}function M(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function q(e,t){return q=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},q(e,t)}function D(e,t){if(t&&("object"===R(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return U(e)}function U(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function z(e){return z=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},z(e)}const B=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&q(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=z(r);if(o){var n=z(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return D(this,e)});function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this,e)).state={},t.input_field_ref=C().createRef(),t.on_focus=t.on_focus.bind(U(t)),t.on_blur=t.on_blur.bind(U(t)),t.on_change=t.on_change.bind(U(t)),t.on_keypress=t.on_keypress.bind(U(t)),t.on_clear_click=t.on_clear_click.bind(U(t)),t.on_search_click=t.on_search_click.bind(U(t)),t}return t=a,(n=[{key:"get_search_value",value:function(){return this.input_field_ref.current.value}},{key:"on_focus",value:function(e){if(this.props.on_focus){var t=this.get_search_value()||null;this.props.on_focus(t)}}},{key:"on_blur",value:function(e){if(this.props.on_blur){var t=this.get_search_value();this.props.on_blur(t)}}},{key:"on_change",value:function(e){e.preventDefault();var t=this.get_search_value();this.props.on_search&&this.props.on_search(t)}},{key:"on_keypress",value:function(e){13==e.which&&e.preventDefault()}},{key:"on_clear_click",value:function(e){if(e.preventDefault(),this.props.on_clear){var t=this.get_search_value();this.props.on_clear(t),this.input_field_ref.current.value=""}}},{key:"on_search_click",value:function(e){if(e.preventDefault(),this.props.on_search){var t=this.get_search_value();this.props.on_search(t)}}},{key:"render",value:function(){return C().createElement("div",{className:"uidreferencewidget-search-field"},C().createElement("div",{className:"input-group"},C().createElement("input",(e={type:"text",name:this.props.name,className:this.props.className,ref:this.input_field_ref,disabled:this.props.disabled,onKeyPress:this.on_keypress,onChange:this.on_change,onFocus:this.on_focus,onBlur:this.on_blur,placeholder:this.props.placeholder,style:{maxWidth:"160px"}},t="disabled",n=this.props.disabled,t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e)),C().createElement("div",{class:"input-group-append"},C().createElement("button",{className:"btn btn-sm btn-outline-secondary",disabled:this.props.disabled,onClick:this.on_clear_click},C().createElement("i",{class:"fas fa-times"})),C().createElement("button",{className:"btn btn-sm btn-outline-primary",disabled:this.props.disabled,onClick:this.on_search_click},C().createElement("i",{class:"fas fa-search"})))));var e,t,n}}])&&M(t.prototype,n),a}(C().Component);function H(e){return H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},H(e)}function F(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return J(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?J(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function J(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function $(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function W(e,t){return W=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},W(e,t)}function K(e,t){if(t&&("object"===H(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return X(e)}function X(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function G(e){return G=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},G(e)}const Q=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&W(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=G(r);if(o){var n=G(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return K(this,e)});function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this,e)).on_select=t.on_select.bind(X(t)),t.on_page=t.on_page.bind(X(t)),t.on_prev_page=t.on_prev_page.bind(X(t)),t.on_next_page=t.on_next_page.bind(X(t)),t.on_close=t.on_close.bind(X(t)),t}return t=a,(n=[{key:"get_columns",value:function(){return this.props.columns||[]}},{key:"get_column_names",value:function(){return this.get_columns().map((function(e){return e.name}))}},{key:"get_column_labels",value:function(){return this.get_columns().map((function(e){return e.label}))}},{key:"get_results",value:function(){return this.props.results||[]}},{key:"has_results",value:function(){return this.get_results().length>0}},{key:"get_style",value:function(){return{minWidth:this.props.width||"400px",backgroundColor:"white",zIndex:999999}}},{key:"get_result_uid",value:function(e){return e.uid||"NO UID FOUND!"}},{key:"is_uid_selected",value:function(e){return this.props.uids.indexOf(e)>-1}},{key:"build_header_columns",value:function(){var e,t=[],n=F(this.get_columns());try{for(n.s();!(e=n.n()).done;){var r=e.value,o=r.label||r.title,i=r.width||"auto",a=r.align||"left";t.push(C().createElement("th",{className:"border-top-0",width:i,align:a},_t(o)))}}catch(e){n.e(e)}finally{n.f()}return t.push(C().createElement("th",{className:"border-top-0",width:"1"})),t}},{key:"build_rows",value:function(){var e,t=[],n=F(this.get_results());try{for(n.s();!(e=n.n()).done;){var r=e.value,o=this.get_result_uid(r);t.push(C().createElement("tr",{uid:o,onClick:this.on_select},this.build_columns(r)))}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"build_columns",value:function(e){var t,n=[],r=this.props.searchterm||"",o=F(this.get_column_names());try{for(o.s();!(t=o.n()).done;){var i=e[t.value],a=this.highlight(i,r);n.push(C().createElement("td",{dangerouslySetInnerHTML:{__html:a}}))}}catch(e){o.e(e)}finally{o.f()}var s=e.uid,l=this.props.uids.indexOf(s)>-1;return n.push(C().createElement("td",null,l&&C().createElement("i",{class:"fas fa-link text-success"}))),n}},{key:"highlight",value:function(e,t){var n=new RegExp(t,"gi"),r=e.match(n);return r&&(e=e.replace(r,"<span class='font-weight-bold text-info'>"+r+"</span>")),e}},{key:"build_pages",value:function(){for(var e=[],t=1;t<=this.props.pages;t++){var n=["page-item"];this.props.page==t&&n.push("active"),e.push(C().createElement("li",{className:n.join(" ")},C().createElement("button",{className:"page-link",page:t,onClick:this.on_page},t)))}return e}},{key:"build_next_button",value:function(){var e=["page-item"];return this.props.next_url||e.push("disabled"),C().createElement("li",{className:e.join(" ")},C().createElement("button",{className:"page-link",onClick:this.on_next_page},"Next"))}},{key:"build_prev_button",value:function(){var e=["page-item"];return this.props.prev_url||e.push("disabled"),C().createElement("li",{className:e.join(" ")},C().createElement("button",{className:"page-link",onClick:this.on_prev_page},"Previous"))}},{key:"build_close_button",value:function(){return C().createElement("button",{className:"btn btn-sm btn-link",onClick:this.on_close},C().createElement("i",{class:"fas fa-window-close"}))}},{key:"on_select",value:function(e){e.preventDefault();var t=e.currentTarget.getAttribute("uid");this.props.on_select&&this.props.on_select(t)}},{key:"on_page",value:function(e){e.preventDefault();var t=e.currentTarget.getAttribute("page");t!=this.props.page&&this.props.on_page&&this.props.on_page(t)}},{key:"on_prev_page",value:function(e){e.preventDefault();var t=this.props.page;t<2||this.props.on_page&&this.props.on_page(t-1)}},{key:"on_next_page",value:function(e){e.preventDefault();var t=this.props.page;t+1>this.props.pages||this.props.on_page&&this.props.on_page(t+1)}},{key:"on_close",value:function(e){e.preventDefault(),this.props.on_clear&&this.props.on_clear()}},{key:"render",value:function(){return this.has_results()?C().createElement("div",{className:this.props.className,style:this.get_style()},C().createElement("div",{style:{position:"absolute",top:0,right:0}},this.build_close_button()),C().createElement("table",{className:"table table-sm table-hover small"},C().createElement("thead",null,C().createElement("tr",null,this.build_header_columns())),C().createElement("tbody",null,this.build_rows())),this.props.pages>1&&C().createElement("nav",null,C().createElement("ul",{className:"pagination pagination-sm justify-content-center"},this.build_prev_button(),this.build_pages(),this.build_next_button()))):null}}])&&$(t.prototype,n),a}(C().Component);function V(e){return V="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},V(e)}function Y(e,t){if(e){if("string"==typeof e)return Z(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Z(e,t):void 0}}function Z(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ee(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function te(e,t){return te=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},te(e,t)}function ne(e,t){if(t&&("object"===V(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return re(e)}function re(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function oe(e){return oe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},oe(e)}const ie=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&te(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=oe(r);if(o){var n=oe(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return ne(this,e)});function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this,e)).on_deselect=t.on_deselect.bind(re(t)),t}return t=a,(n=[{key:"get_selected_uids",value:function(){return this.props.uids||[]}},{key:"interpolate",value:function(e,t){for(var n=0,r=Object.entries(t);n<r.length;n++){var o=(s=r[n],l=2,function(e){if(Array.isArray(e))return e}(s)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){s=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(s)throw o}}return i}}(s,l)||Y(s,l)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=o[0],a=o[1];e=e.replace(new RegExp("\\$\\{"+i+"\\}","g"),a)}var s,l;return e}},{key:"render_display_template",value:function(e){var t=this.props.display_template,n=this.props.records[e];return n?this.interpolate(t,n):e}},{key:"build_selected_items",value:function(){var e,t=[],n=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=Y(e))){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}(this.get_selected_uids());try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push(C().createElement("li",{uid:r},C().createElement("div",{className:"p-1 mb-1 mr-1 bg-light border rounded d-inline-block"},C().createElement("span",{dangerouslySetInnerHTML:{__html:this.render_display_template(r)}}),C().createElement("button",{uid:r,className:"btn btn-sm btn-link-danger",onClick:this.on_deselect},C().createElement("i",{className:"fas fa-times-circle"})))))}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"on_deselect",value:function(e){e.preventDefault();var t=e.currentTarget.getAttribute("uid");this.props.on_deselect&&this.props.on_deselect(t)}},{key:"render",value:function(){return C().createElement("div",{className:"uidreferencewidget-references"},C().createElement("ul",{className:"list-unstyled list-group list-group-horizontal"},this.build_selected_items()),C().createElement("textarea",{className:"d-none",name:this.props.name,value:this.props.uids.join("\n")}))}}])&&ee(t.prototype,n),a}(C().Component);function ae(e){return ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ae(e)}function se(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function le(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ue(e,t){return ue=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},ue(e,t)}function ce(e,t){if(t&&("object"===ae(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return fe(e)}function fe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function de(e){return de=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},de(e)}const he=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ue(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=de(r);if(o){var n=de(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return ce(this,e)});function a(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this,e)).state={results:[],searchterm:"",loading:!1,count:0,page:1,pages:1,next_url:null,prev_url:null,b_start:1};for(var n=e.root_el,r=0,o=["id","name","uids","api_url","records","catalog","query","columns","display_template","limit","multi_valued","disabled","readonly"];r<o.length;r++){var s=o[r],l=n.dataset[s];t.state[s]=t.parse_json(l)}return t.api=new I({api_url:t.state.api_url}),t.search=t.search.bind(fe(t)),t.goto_page=t.goto_page.bind(fe(t)),t.clear_results=t.clear_results.bind(fe(t)),t.select=t.select.bind(fe(t)),t.deselect=t.deselect.bind(fe(t)),t.on_keydown=t.on_keydown.bind(fe(t)),t.on_click=t.on_click.bind(fe(t)),window.widget=fe(t),ce(t,fe(t))}return t=a,(n=[{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.on_keydown,!1),document.addEventListener("click",this.on_click,!1)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.on_keydown,!1),document.removeEventListener("click",this.on_click,!1)}},{key:"parse_json",value:function(e){try{return JSON.parse(e)}catch(e){}}},{key:"is_disabled",value:function(){return!!this.state.disabled||!!this.state.readonly||!this.state.multi_valued&&this.state.uids.length>0}},{key:"make_query",value:function(e){return e=e||{},Object.assign({q:this.state.searchterm,limit:this.state.limit,complete:1},e,this.state.query)}},{key:"fetch_results",value:function(e){e=e||{};var t=this,n=this.make_query();this.toggle_loading(!0);var r=this.api.search(this.state.catalog,n,e);return r.then((function(e){t.set_results_data(e),t.toggle_loading(!1)})),r}},{key:"search",value:function(e){if(e||!(this.state.results.length>0))return this.state.searchterm=e||"",this.fetch_results()}},{key:"goto_page",value:function(e){e=parseInt(e);var t=parseInt(this.state.limit),n=e*t-t;return this.fetch_results({b_start:n})}},{key:"select",value:function(e){var t=[].concat(this.state.uids);return-1==t.indexOf(e)&&t.push(e),this.setState({uids:t}),t.length>0&&!this.state.multi_valued&&this.clear_results(),t}},{key:"deselect",value:function(e){var t=[].concat(this.state.uids),n=t.indexOf(e);return n>-1&&t.splice(n,1),this.setState({uids:t}),t}},{key:"toggle_loading",value:function(e){return null==e&&(e=!1),this.setState({loading:e}),e}},{key:"set_results_data",value:function(e){var t,n=(e=e||{}).items||[],r=Object.assign(this.state.records,{}),o=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return se(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?se(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}(n);try{for(o.s();!(t=o.n()).done;){var i=t.value;r[i.uid]=i}}catch(e){o.e(e)}finally{o.f()}this.setState({records:r,results:n,count:e.count||0,page:e.page||1,pages:e.pages||1,next_url:e.next||null,prev_url:e.previous||null})}},{key:"clear_results",value:function(){this.setState({results:[],count:0,page:1,pages:1,next_url:null,prev_url:null})}},{key:"on_keydown",value:function(e){27===e.keyCode&&this.clear_results()}},{key:"on_click",value:function(e){var t=this.props.root_el,n=e.target;t.contains(n)||this.clear_results()}},{key:"render",value:function(){return C().createElement("div",{className:"uidreferencewidget"},C().createElement(ie,{uids:this.state.uids,records:this.state.records,display_template:this.state.display_template,name:this.state.name,on_deselect:this.deselect}),C().createElement(B,{className:"form-control",name:"uidreference-search",disabled:this.is_disabled(),on_search:this.search,on_clear:this.clear_results,on_focus:this.search}),C().createElement(Q,{className:"position-absolute shadow border rounded bg-white mt-1 p-1",columns:this.state.columns,uids:this.state.uids,searchterm:this.state.searchterm,results:this.state.results,count:this.state.count,page:this.state.page,pages:this.state.pages,next_url:this.state.next_url,prev_url:this.state.prev_url,on_select:this.select,on_page:this.goto_page,on_clear:this.clear_results}))}}])&&le(t.prototype,n),a}(C().Component);function pe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}document.addEventListener("DOMContentLoaded",(function(){window.i18n=new r,window._t=i,window._p=s,window.portal_url=document.body.dataset.portalUrl,tinymce.init({height:300,paste_data_images:!0,selector:"textarea.mce_editable,div.ArchetypesRichWidget textarea,textarea[name='form.widgets.IRichTextBehavior.text'],textarea.richTextWidget",plugins:["paste","link","fullscreen","table","code"],content_css:"/++plone++senaite.core.static/bundles/main.css"}),window.site=new x,window.sidebar=new T({el:"sidebar"}),new E({form_selectors:["form[name='edit_form']","form.senaite-ajax-form"],field_selectors:["input[type='text']","input[type='number']","input[type='checkbox']","input[type='radio']","input[type='file']","select","textarea"]}),t()((function(){t()("[data-toggle='tooltip']").tooltip()})),window.widgets={};var e,n=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return pe(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?pe(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}(document.getElementsByClassName("senaite-uidreference-widget-input"));try{for(n.s();!(e=n.n()).done;){var o=e.value,a=o.dataset.id,l=ReactDOM.render(React.createElement(he,{root_el:o}),o);window.widgets[a]=l}}catch(e){n.e(e)}finally{n.f()}}))})()})();
//# sourceMappingURL=main.js.map