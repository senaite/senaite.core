(()=>{"use strict";var e={609:e=>{e.exports=jQuery}},t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={exports:{}};return e[i](o,o.exports,n),o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e=n(609),t=n.n(e);const i=function(){var e=this;e.baseUrl=t()("body").attr("data-i18ncatalogurl"),e.currentLanguage=t()("html").attr("lang")||"en",e.currentLanguage.split("-").length>1&&(e.currentLanguage=e.currentLanguage.split("-")[0]+"_"+e.currentLanguage.split("-")[1].toUpperCase()),e.storage=null,e.catalogs={},e.ttl=864e5,Date.now||(Date.now=function(){return(new Date).valueOf()});try{"localStorage"in window&&null!==window.localStorage&&"JSON"in window&&null!==window.JSON&&(e.storage=window.localStorage)}catch(e){}e.configure=function(t){for(var n in t)e[n]=t[n]},e._setCatalog=function(t,n,i){t in e.catalogs||(e.catalogs[t]={}),e.catalogs[t][n]=i},e._storeCatalog=function(t,n,i){var o=t+"-"+n;null!==e.storage&&null!==i&&(e.storage.setItem(o,JSON.stringify(i)),e.storage.setItem(o+"-updated",Date.now()))},e.getUrl=function(t,n){return e.baseUrl+"?domain="+t+"&language="+n},e.loadCatalog=function(n,i){if(void 0===i&&(i=e.currentLanguage),null!==e.storage){var o=n+"-"+i;if(o in e.storage&&Date.now()-parseInt(e.storage.getItem(o+"-updated"),10)<e.ttl){var r=JSON.parse(e.storage.getItem(o));return void e._setCatalog(n,i,r)}}e.baseUrl&&t().getJSON(e.getUrl(n,i),(function(t){null!==t&&(e._setCatalog(n,i,t),e._storeCatalog(n,i,t))}))},e.MessageFactory=function(t,n){return n=n||e.currentLanguage,function(i,o){var r,a,s;if(r=t in e.catalogs&&n in e.catalogs[t]&&i in e.catalogs[t][n]?e.catalogs[t][n][i]:i,o)for(s in o)o.hasOwnProperty(s)&&(a=new RegExp("\\$\\{"+s+"\\}","g"),r=r.replace(a,o[s]));return r}}};var o=null,r=function(e,t){if(null===o){var n=new i;n.loadCatalog("senaite.core"),o=n.MessageFactory("senaite.core")}return o(e,t)},a=null,s=function(e,t){if(null===a){var n=new i;n.loadCatalog("plone"),a=n.MessageFactory("plone")}return a(e,t)};function l(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=u(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,r=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw r}}}}function u(e,t){if(e){if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(e,t):void 0}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function f(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}const d=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=Object.assign({form_selectors:[],field_selectors:[]},t),this.on_modified=this.on_modified.bind(this),this.on_input=this.on_input.bind(this),this.on_blur=this.on_blur.bind(this),this.init_forms(),this.changed={}}var t,n;return t=e,(n=[{key:"init_forms",value:function(){var e,t=l(this.config.form_selectors);try{for(t.s();!(e=t.n()).done;){var n=e.value,i=document.querySelector(n);i&&"FORM"===i.tagName&&(this.setup_form(i),this.watch_form(i))}}catch(e){t.e(e)}finally{t.f()}}},{key:"setup_form",value:function(e){this.submit(e,{},"initialized")}},{key:"watch_form",value:function(e){var t,n=l(this.get_form_fields(e));try{for(n.s();!(t=n.n()).done;){var i=t.value;i.addEventListener("input",this.on_input),i.addEventListener("blur",this.on_blur)}}catch(e){n.e(e)}finally{n.f()}e.addEventListener("modified",this.on_modified)}},{key:"get_form_fields",value:function(e){var t,n,i=[],o=l(this.config.field_selectors);try{for(o.s();!(t=o.n()).done;){var r,a=t.value,s=e.querySelectorAll(a);i=(r=i).concat.apply(r,function(e){if(Array.isArray(e))return c(e)}(n=s.values())||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(n)||u(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())}}catch(e){o.e(e)}finally{o.f()}return i}},{key:"set_change_flag",value:function(e,t){var n=e.name;this.changed[n]=t}},{key:"toggle_field_visibility",value:function(e,t){var n=e.closest(".field"),i="d-none";!1===t?n.classList.add(i):n.classList.remove(i)}},{key:"update_form",value:function(e,t){var n,i=t.hide||[],o=t.show||[],r=t.update||{},a=l(i);try{for(a.s();!(n=a.n()).done;){var s=n.value,c=e.querySelector("[data-fieldname='".concat(s,"']"));c&&this.toggle_field_visibility(c,!1)}}catch(e){a.e(e)}finally{a.f()}var f,d,h,g=l(o);try{for(g.s();!(f=g.n()).done;){var m=f.value,v=e.querySelector("[data-fieldname='".concat(m,"']"));v&&this.toggle_field_visibility(v,!0)}}catch(e){g.e(e)}finally{g.f()}for(var y=0,_=Object.entries(r);y<_.length;y++){var p=(d=_[y],h=2,function(e){if(Array.isArray(e))return e}(d)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],i=!0,o=!1,r=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(e){o=!0,r=e}finally{try{i||null==s.return||s.return()}finally{if(o)throw r}}return n}}(d,h)||u(d,h)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),b=p[0],w=p[1],k=e.querySelector("[data-fieldname='".concat(b,"']"));if(k){var S=k.querySelector("[name='".concat(b,"']"));S&&(S.value=w)}}}},{key:"notify_change",value:function(e,t){var n={name:t.name,value:t.value};this.submit(e,n,"modified")}},{key:"get_form_data",value:function(e){var t={};return new FormData(e).forEach((function(e,n){t[n]=e})),t}},{key:"submit",value:function(e,t,n){var i=this,o=document.body.dataset.viewUrl,r="".concat(o,"/ajax_form/").concat(n),a=Object.assign({form:this.get_form_data(e)},t),s={method:"POST",credentials:"include",body:JSON.stringify(a),headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector("#protect-script").dataset.token}},l=new Request(r,s);fetch(l).then((function(e){return e.ok?e.json():Promise.reject(e)})).then((function(t){i.update_form(e,t)})).catch((function(e){}))}},{key:"on_modified",value:function(e){var t=e.detail.form,n=e.detail.field;this.notify_change(t,n)}},{key:"on_input",value:function(e){var t=e.currentTarget;this.set_change_flag(t,!0)}},{key:"on_blur",value:function(e){var t=e.currentTarget,n=t.name,i=t.value;if(this.changed[n]){var o=new CustomEvent("modified",{detail:{field:t,name:n,value:i,form:t.form}});t.form.dispatchEvent(o),this.set_change_flag(t,!1)}}}])&&f(t.prototype,n),e}();var h=n(609),g=function(e,t){return function(){return e.apply(t,arguments)}};const m=function(){function e(){this.set_cookie=g(this.set_cookie,this),this.read_cookie=g(this.read_cookie,this),this.authenticator=g(this.authenticator,this)}return e.prototype.authenticator=function(){var e;return(e=h("input[name='_authenticator']").val())||(e=new URLSearchParams(window.location.search).get("_authenticator")),e},e.prototype.read_cookie=function(e){var t,n,i;for(e+="=",n=document.cookie.split(";"),i=0;i<n.length;){for(t=n[i];" "===t.charAt(0);)t=t.substring(1);if(0===t.indexOf(e))return t.substring(e.length,t.length);i++}return null},e.prototype.set_cookie=function(e,t){var n,i;(n=new Date).setTime(n.getTime()+864e5),i="expires="+n.toUTCString(),document.cookie=e+"="+t+";"+i+";path=/"},e}();function v(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}const y=function(){function e(t){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=Object.assign({el:"sidebar",toggle_el:"sidebar-header",cookie_key:"sidebar-toggle",timeout:1e3},t),this.tid=null,this.maximize=this.maximize.bind(this),this.minimize=this.minimize.bind(this),this.on_click=this.on_click.bind(this),this.on_mouseenter=this.on_mouseenter.bind(this),this.on_mouseleave=this.on_mouseleave.bind(this),this.toggle_el=document.getElementById(this.config.toggle_el),this.toggle_el&&this.toggle_el.addEventListener("click",this.on_click),this.el=document.getElementById(this.config.el),this.el&&(this.el.addEventListener("mouseenter",this.on_mouseenter),this.el.addEventListener("mouseleave",this.on_mouseleave),this.is_toggled()&&(this.el.classList.remove("minimized"),this.el.classList.add("toggled"))),this}var t,n;return t=e,(n=[{key:"is_toggled",value:function(){return"true"==window.site.read_cookie(this.config.cookie_key)}},{key:"toggle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];window.site.set_cookie(this.config.cookie_key,e),e?(this.el.classList.add("toggled"),this.maximize()):(this.el.classList.remove("toggled"),this.minimize())}},{key:"minimize",value:function(){this.el.classList.add("minimized")}},{key:"maximize",value:function(){this.el.classList.remove("minimized")}},{key:"on_click",value:function(e){clearTimeout(this.tid),this.toggle(!this.is_toggled())}},{key:"on_mouseenter",value:function(e){clearTimeout(this.tid),this.is_toggled()||(this.tid=setTimeout(this.maximize,this.config.timeout))}},{key:"on_mouseleave",value:function(e){clearTimeout(this.tid),this.is_toggled()||this.minimize()}}])&&v(t.prototype,n),e}();document.addEventListener("DOMContentLoaded",(function(){window.i18n=new i,window._t=r,window._p=s,window.portal_url=document.body.dataset.portalUrl,tinymce.init({height:300,selector:"textarea.mce_editable,div.ArchetypesRichWidget textarea,textarea[name='form.widgets.IRichTextBehavior.text'],textarea.richTextWidget",plugins:["paste","link","fullscreen","table","code"],content_css:"/++plone++senaite.core.static/bundles/main.css"}),window.site=new m,window.sidebar=new y({el:"sidebar"}),t()((function(){t()("[data-toggle='tooltip']").tooltip()}));var e=document.body.dataset.autoLogoff||0,n=document.body.classList.contains("userrole-authenticated"),o=Math.pow(2,31)-1;if(e>0&&n){var a=60*e*1e3;a>o&&(a=o),setTimeout((function(){location.href=window.portal_url+"/logout"}),a)}new d({form_selectors:["form[name='edit_form']"],field_selectors:["input[type='text']","input[type='number']","input[type='checkbox']","input[type='radio']","textarea","select"]})}))})()})();
//# sourceMappingURL=main.js.map