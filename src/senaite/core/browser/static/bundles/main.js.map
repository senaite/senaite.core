{"version":3,"sources":["webpack:///external \"jQuery\"","webpack:///webpack/bootstrap","webpack:///webpack/runtime/compat get default export","webpack:///webpack/runtime/define property getters","webpack:///webpack/runtime/hasOwnProperty shorthand","webpack:///./components/i18n.js","webpack:///./i18n-wrapper.js","webpack:///./components/editform.js","webpack:///./components/site.js","webpack:///./components/sidebar.js","webpack:///./senaite.core.js"],"names":["module","exports","jQuery","__webpack_module_cache__","__webpack_require__","moduleId","__webpack_modules__","n","getter","__esModule","d","a","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","self","this","baseUrl","$","attr","currentLanguage","split","length","toUpperCase","storage","catalogs","ttl","Date","now","valueOf","window","localStorage","JSON","e","configure","config","_setCatalog","domain","language","catalog","_storeCatalog","setItem","stringify","getUrl","loadCatalog","undefined","parseInt","getItem","parse","MessageFactory","msgid","keywords","msgstr","regexp","keyword","RegExp","replace","t","_t","i18n","I18N","p","_p","assign","on_modified","bind","on_input","on_blur","init_forms","changed","form_selectors","selector","form","document","querySelector","tagName","setup_form","watch_form","submit","get_form_fields","field","addEventListener","fields","field_selectors","nodes","querySelectorAll","concat","values","el","flag","name","toggle","parent","closest","css_class","classList","add","remove","data","hide","show","update","toggle_field_visibility","entries","value","input","FormData","forEach","endpoint","view_url","body","dataset","viewUrl","ajax_url","payload","get_form_data","init","method","credentials","headers","token","request","Request","fetch","then","response","ok","json","Promise","reject","update_form","error","event","detail","notify_change","currentTarget","set_change_flag","CustomEvent","dispatchEvent","fn","me","apply","arguments","Site","set_cookie","read_cookie","authenticator","auth","val","URLSearchParams","location","search","c","ca","i","cookie","charAt","substring","indexOf","expires","setTime","getTime","toUTCString","tid","maximize","minimize","on_click","on_mouseenter","on_mouseleave","toggle_el","getElementById","is_toggled","site","cookie_key","clearTimeout","setTimeout","timeout","portal_url","portalUrl","tinymce","height","plugins","content_css","sidebar","Sidebar","tooltip","logoff","autoLogoff","logged","contains","max_timeout","logoff_ms","href","EditForm"],"mappings":"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","file":"main.js","sourcesContent":["module.exports = jQuery;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => module['default'] :\n\t\t() => module;\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => Object.prototype.hasOwnProperty.call(obj, prop)","/* i18n integration. This is forked from jarn.jsi18n\n *\n * This is a singleton.\n * Configuration is done on the body tag data-i18ncatalogurl attribute\n *     <body data-i18ncatalogurl=\"/plonejsi18n\">\n *\n *  Or, it'll default to \"/plonejsi18n\"\n */\n\nimport $ from \"jquery\";\n\n\nvar I18N = function() {\n  var self = this;\n  self.baseUrl = $('body').attr('data-i18ncatalogurl');\n  self.currentLanguage = $('html').attr('lang') || 'en';\n\n  // Fix for country specific languages\n  if (self.currentLanguage.split('-').length > 1) {\n    self.currentLanguage = self.currentLanguage.split('-')[0] + '_' + self.currentLanguage.split('-')[1].toUpperCase();\n  }\n\n  self.storage = null;\n  self.catalogs = {};\n  self.ttl = 24 * 3600 * 1000;\n\n  // Internet Explorer 8 does not know Date.now() which is used in e.g. loadCatalog, so we \"define\" it\n  if (!Date.now) {\n    Date.now = function() {\n      return new Date().valueOf();\n    };\n  }\n\n  try {\n    if ('localStorage' in window && window.localStorage !== null && 'JSON' in window && window.JSON !== null) {\n      self.storage = window.localStorage;\n    }\n  } catch (e) {}\n\n  self.configure = function(config) {\n    for (var key in config){\n      self[key] = config[key];\n    }\n  };\n\n  self._setCatalog = function (domain, language, catalog) {\n    if (domain in self.catalogs) {\n      self.catalogs[domain][language] = catalog;\n    } else {\n      self.catalogs[domain] = {};\n      self.catalogs[domain][language] = catalog;\n    }\n  };\n\n  self._storeCatalog = function (domain, language, catalog) {\n    var key = domain + '-' + language;\n    if (self.storage !== null && catalog !== null) {\n      self.storage.setItem(key, JSON.stringify(catalog));\n      self.storage.setItem(key + '-updated', Date.now());\n    }\n  };\n\n  self.getUrl = function(domain, language) {\n    return self.baseUrl + '?domain=' + domain + '&language=' + language;\n  };\n\n  self.loadCatalog = function (domain, language) {\n    if (language === undefined) {\n      language = self.currentLanguage;\n    }\n    if (self.storage !== null) {\n      var key = domain + '-' + language;\n      if (key in self.storage) {\n        if ((Date.now() - parseInt(self.storage.getItem(key + '-updated'), 10)) < self.ttl) {\n          var catalog = JSON.parse(self.storage.getItem(key));\n          self._setCatalog(domain, language, catalog);\n          return;\n        }\n      }\n    }\n    if (!self.baseUrl) {\n      return;\n    }\n    $.getJSON(self.getUrl(domain, language), function (catalog) {\n      if (catalog === null) {\n        return;\n      }\n      self._setCatalog(domain, language, catalog);\n      self._storeCatalog(domain, language, catalog);\n    });\n  };\n\n  self.MessageFactory = function (domain, language) {\n    language = language || self.currentLanguage;\n    return function translate (msgid, keywords) {\n      var msgstr;\n      if ((domain in self.catalogs) && (language in self.catalogs[domain]) && (msgid in self.catalogs[domain][language])) {\n        msgstr = self.catalogs[domain][language][msgid];\n      } else {\n        msgstr = msgid;\n      }\n      if (keywords) {\n        var regexp, keyword;\n        for (keyword in keywords) {\n          if (keywords.hasOwnProperty(keyword)) {\n            regexp = new RegExp('\\\\$\\\\{' + keyword + '\\\\}', 'g');\n            msgstr = msgstr.replace(regexp, keywords[keyword]);\n          }\n        }\n      }\n      return msgstr;\n    };\n  };\n};\n\nexport default I18N;\n","import I18N from \"./components/i18n.js\";\n\n// SENAITE message factory\nvar t = null;\nexport var _t = (msgid, keywords) => {\n  if (t === null) {\n    let i18n = new I18N();\n    console.debug(\"*** Loading `senaite.core` i18n MessageFactory ***\");\n    i18n.loadCatalog(\"senaite.core\")\n    t = i18n.MessageFactory(\"senaite.core\")\n  }\n  return t(msgid, keywords);\n}\n\n// Plone message factory\nvar p = null;\nexport var _p = (msgid, keywords) => {\n  if (p === null) {\n    let i18n = new I18N();\n    console.debug(\"*** Loading `plone` i18n MessageFactory ***\");\n    i18n.loadCatalog(\"plone\")\n    p = i18n.MessageFactory(\"plone\")\n  }\n  return p(msgid, keywords);\n}\n","/* SENAITE Edit Form Handler\n *\n * This code handles field changes in edit forms and updates others according to\n * the changes with the help of adapters.\n *\n */\n\nclass EditForm{\n\n  constructor(config) {\n    this.config = Object.assign({\n      \"form_selectors\": [],\n      \"field_selectors\": []\n    }, config);\n    // bind event handlers\n    this.on_modified = this.on_modified.bind(this);\n    this.on_input = this.on_input.bind(this);\n    this.on_blur = this.on_blur.bind(this);\n    // init form\n    this.init_forms();\n    this.changed = {};\n  }\n\n  /**\n   * Initialize all form elements\n   */\n  init_forms() {\n    let selectors = this.config.form_selectors;\n    for (const selector of selectors) {\n      let form = document.querySelector(selector);\n      if (form && form.tagName === \"FORM\") {\n        this.setup_form(form);\n        this.watch_form(form);\n      }\n    }\n  }\n\n  setup_form(form) {\n    console.debug(`EditForm::setup_form(${form})`);\n    this.submit(form, {}, \"initialized\");\n  }\n\n  watch_form(form) {\n    console.debug(`EditForm::watch_form(${form})`);\n    let fields = this.get_form_fields(form);\n    for (const field of fields) {\n        console.debug(`[Watching field ${field.name}]`);\n        field.addEventListener(\"input\", this.on_input);\n        field.addEventListener(\"blur\", this.on_blur);\n    }\n    form.addEventListener(\"modified\", this.on_modified);\n  }\n\n  get_form_fields(form) {\n    console.debug(`EditForm::get_form_fields(${form})`);\n    let fields = [];\n    let selectors = this.config.field_selectors;\n    for (const selector of selectors) {\n      let nodes = form.querySelectorAll(selector);\n      fields = fields.concat(...nodes.values())\n    }\n    return fields\n  }\n\n  set_change_flag(el, flag) {\n    let name = el.name;\n    this.changed[name] = flag;\n  }\n\n  toggle_field_visibility(field, toggle) {\n    let parent = field.closest(\".field\");\n    let css_class = \"d-none\";\n    if (toggle === false) {\n      parent.classList.add(css_class);\n    } else {\n      parent.classList.remove(css_class);\n    }\n  }\n\n  update_form(form, data) {\n    console.info(\"*** UPDATE FORM ***\", data)\n    let hide = data.hide || [];\n    let show = data.show || [];\n    let update = data.update || {}\n\n    for (const selector of hide) {\n      let el = form.querySelector(`[data-fieldname='${selector}']`);\n      if (!el) continue;\n      this.toggle_field_visibility(el, false);\n    }\n\n    for (const selector of show) {\n      let el = form.querySelector(`[data-fieldname='${selector}']`);\n      if (!el) continue;\n      this.toggle_field_visibility(el, true);\n    }\n\n    for (const [key, value] of Object.entries(update)) {\n      console.log(`Update ${key} -> ${value}`);\n      let el = form.querySelector(`[data-fieldname='${key}']`);\n      if (!el) continue;\n      let input = el.querySelector(`[name='${key}']`);\n      if (!input) continue;\n      input.value = value;\n    }\n  }\n\n  notify_change(form, field) {\n    let data = {\n      name: field.name,\n      value: field.value,\n    }\n    this.submit(form, data, \"modified\");\n  }\n\n  get_form_data(form) {\n    let data = {};\n    let form_data = new FormData(form);\n    form_data.forEach(function(value, key) {\n      data[key] = value;\n    });\n    return data;\n  }\n\n  submit(form, data, endpoint) {\n    let view_url = document.body.dataset.viewUrl;\n    let ajax_url = `${view_url}/ajax_form/${endpoint}`;\n\n    let payload = Object.assign({\n      \"form\": this.get_form_data(form)\n    }, data)\n\n    let init = {\n      method: \"POST\",\n      credentials: \"include\",\n      body: JSON.stringify(payload),\n      headers: {\n        \"Content-Type\": \"application/json\",\n        \"X-CSRF-TOKEN\": document.querySelector(\"#protect-script\").dataset.token\n      },\n    }\n\n    let request = new Request(ajax_url, init);\n\n    fetch(request)\n      .then((response) => {\n        if (!response.ok) {\n          return Promise.reject(response);\n        }\n        return response.json();\n      })\n      .then((data) => {\n        this.update_form(form, data);\n      })\n      .catch((error) => {\n        console.error(error);\n      });\n  }\n\n  on_modified(event) {\n    console.info(`Field '${event.detail.name}' changed value to '${event.detail.value}'`);\n    let form = event.detail.form;\n    let field = event.detail.field;\n    this.notify_change(form, field);\n  }\n\n  on_input(event) {\n    let el = event.currentTarget;\n    this.set_change_flag(el, true);\n  }\n\n  on_blur(event) {\n    let el = event.currentTarget;\n    let name = el.name;\n    let value = el.value;\n    if (this.changed[name]) {\n      let event = new CustomEvent(\"modified\", {\n        detail: {\n          field: el,\n          name: name,\n          value: value,\n          form: el.form\n        }\n      });\n      // dispatch the event on the element\n      el.form.dispatchEvent(event);\n      // set back the change flag\n      this.set_change_flag(el, false)\n    }\n  }\n\n}\n\nexport default EditForm;\n","\n/* Please use this command to compile this file into the parent `js` directory:\n    coffee --no-header -w -o ../ -c site.coffee\n */\nvar Site,\n  bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\nSite = (function() {\n\n  /**\n   * Creates a new instance of Site\n   */\n  function Site() {\n    this.set_cookie = bind(this.set_cookie, this);\n    this.read_cookie = bind(this.read_cookie, this);\n    this.authenticator = bind(this.authenticator, this);\n    // console.debug(\"Site::init\");\n  }\n\n\n  /**\n   * Returns the authenticator value\n   */\n\n  Site.prototype.authenticator = function() {\n    var auth, url_params;\n    auth = $(\"input[name='_authenticator']\").val();\n    if (!auth) {\n      url_params = new URLSearchParams(window.location.search);\n      auth = url_params.get(\"_authenticator\");\n    }\n    return auth;\n  };\n\n\n  /**\n   * Reads a cookie value\n   * @param {name} the name of the cookie\n   */\n\n  Site.prototype.read_cookie = function(name) {\n    var c, ca, i;\n    // console.debug(\"Site::read_cookie:\" + name);\n    name = name + '=';\n    ca = document.cookie.split(';');\n    i = 0;\n    while (i < ca.length) {\n      c = ca[i];\n      while (c.charAt(0) === ' ') {\n        c = c.substring(1);\n      }\n      if (c.indexOf(name) === 0) {\n        return c.substring(name.length, c.length);\n      }\n      i++;\n    }\n    return null;\n  };\n\n\n  /**\n   * Sets a cookie value\n   * @param {name} the name of the cookie\n   * @param {value} the value of the cookie\n   */\n\n  Site.prototype.set_cookie = function(name, value) {\n    var d, expires;\n    // console.debug(\"Site::set_cookie:name=\" + name + \", value=\" + value);\n    d = new Date;\n    d.setTime(d.getTime() + 1 * 24 * 60 * 60 * 1000);\n    expires = 'expires=' + d.toUTCString();\n    document.cookie = name + '=' + value + ';' + expires + ';path=/';\n  };\n\n  return Site;\n\n})();\n\nexport default Site;\n","/* SENAITE Sidebar\n *\n * The sidebar shows when the mouse enters and hides when the mouse leaves the\n * HTML element.\n *\n * It keeps open when the toggle button was clicked.\n */\n\nclass Sidebar{\n\n  constructor(config) {\n\n    this.config = Object.assign({\n      \"el\": \"sidebar\",\n      \"toggle_el\": \"sidebar-header\",\n      \"cookie_key\": \"sidebar-toggle\",\n      \"timeout\": 1000,\n    }, config);\n\n    // Timer ID\n    this.tid = null;\n\n    // Bind \"this\" context when called\n    this.maximize = this.maximize.bind(this);\n    this.minimize = this.minimize.bind(this);\n    this.on_click = this.on_click.bind(this);\n    this.on_mouseenter = this.on_mouseenter.bind(this)\n    this.on_mouseleave = this.on_mouseleave.bind(this);\n\n    // toggle button handler\n    this.toggle_el = document.getElementById(this.config.toggle_el);\n    if (this.toggle_el) {\n      this.toggle_el.addEventListener(\"click\", this.on_click);\n    }\n\n    // sidebar view/hide handler\n    this.el = document.getElementById(this.config.el);\n    if (this.el) {\n      this.el.addEventListener(\"mouseenter\", this.on_mouseenter);\n      this.el.addEventListener(\"mouseleave\", this.on_mouseleave);\n\n      if (this.is_toggled()) {\n        this.el.classList.remove(\"minimized\");\n        this.el.classList.add(\"toggled\");\n      }\n    }\n\n    return this;\n  }\n\n  is_toggled() {\n    return window.site.read_cookie(this.config.cookie_key) == \"true\";\n  }\n\n  toggle(toggle=false) {\n    window.site.set_cookie(this.config.cookie_key, toggle)\n    if (toggle) {\n      this.el.classList.add(\"toggled\")\n      this.maximize();\n    } else {\n      this.el.classList.remove(\"toggled\")\n      this.minimize();\n    }\n  }\n\n  minimize() {\n    this.el.classList.add(\"minimized\");\n  }\n\n  maximize() {\n    this.el.classList.remove(\"minimized\");\n  }\n\n  on_click(event) {\n    // console.debug(\"Sidebar::on_click:event=\", event)\n    clearTimeout(this.tid);\n    this.toggle(!this.is_toggled());\n  }\n\n  on_mouseenter(event) {\n    // console.debug(\"Sidebar::on_mouseenter:event=\", event)\n    clearTimeout(this.tid);\n    if (this.is_toggled()) return\n    this.tid = setTimeout(this.maximize, this.config.timeout);\n  }\n\n  on_mouseleave(event) {\n    // console.debug(\"Sidebar::on_mouseleave:event=\", event)\n    clearTimeout(this.tid);\n    if (this.is_toggled()) return\n    this.minimize();\n    // console.debug(\"Clearing sidebar timeout\", this.tid);\n  }\n}\n\nexport default Sidebar;\n","import $ from \"jquery\";\nimport I18N from \"./components/i18n.js\";\nimport {i18n, _t, _p} from \"./i18n-wrapper.js\"\nimport EditForm from \"./components/editform.js\"\nimport Site from \"./components/site.js\"\nimport Sidebar from \"./components/sidebar.js\"\n\n\ndocument.addEventListener(\"DOMContentLoaded\", () => {\n  console.debug(\"*** SENAITE CORE JS LOADED ***\");\n\n  // Initialize i18n message factories\n  window.i18n = new I18N();\n  window._t = _t;\n  window._p = _p;\n\n  // BBB: set global `portal_url` variable\n  window.portal_url = document.body.dataset.portalUrl\n\n  // TinyMCE\n  tinymce.init({\n    height: 300,\n    selector: \"textarea.mce_editable,div.ArchetypesRichWidget textarea,textarea[name='form.widgets.IRichTextBehavior.text'],textarea.richTextWidget\",\n    plugins: [\"paste\", \"link\", \"fullscreen\", \"table\", \"code\"],\n    content_css : \"/++plone++senaite.core.static/bundles/main.css\",\n  })\n  // /TinyMCE\n\n  // Initialize Site\n  window.site = new Site();\n\n  // Initialize Sidebar\n  window.sidebar = new Sidebar({\n    \"el\": \"sidebar\",\n  });\n\n\n  // Tooltips\n  $(function () {\n    $(\"[data-toggle='tooltip']\").tooltip()\n  })\n  // /Tooltips\n\n  // Auto LogOff\n  var logoff = document.body.dataset.autoLogoff || 0;\n  var logged = document.body.classList.contains(\"userrole-authenticated\");\n  // Max value for setTimeout is a 32 bit integer\n  const max_timeout = 2**31 - 1;\n  if (logoff > 0 && logged) {\n    var logoff_ms = logoff * 60 * 1000;\n    if (logoff_ms > max_timeout) {\n      console.warn(`Setting logoff_ms to max value ${max_timeout}ms`);\n      logoff_ms = max_timeout;\n    }\n    setTimeout(function() {\n      location.href = window.portal_url + \"/logout\";\n    }, logoff_ms);\n  }\n  // /Auto LogOff\n\n\n  // Ajax Edit Form Handler\n  var form = new EditForm({\n    form_selectors: [\"form[name='edit_form']\"],\n    field_selectors: [\n      \"input[type='text']\",\n      \"input[type='number']\",\n      \"input[type='checkbox']\",\n      \"input[type='radio']\",\n      \"textarea\",\n      \"select\",\n    ]\n  })\n\n});\n"],"sourceRoot":""}