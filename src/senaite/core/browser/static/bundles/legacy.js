function BatchFolderView(){this.load=function(){$(".portaltype-batchfolder").append("<div id='batch-cancel-dialog' title='"+_t("Cancel batch/es?")+"'>    <p style='padding:10px'>        <span class='ui-icon ui-icon-alert' style=''float: left; margin: 0 7px 30px 0;'><br/></span>        "+_t("All linked Samples will be cancelled too.")+"    </p>    <p style='padding:0px 10px'>       "+_t("Are you sure?")+"    </p></div><input id='batch-cancel-resp' type='hidden' value='false'/>"),$("#batch-cancel-dialog").dialog({autoOpen:!1,resizable:!1,height:200,width:400,modal:!0,buttons:{"Cancel selected batches":function(){$(this).dialog("close"),$("#batch-cancel-resp").val("true"),$(".portaltype-batchfolder #cancel_transition").click()},Cancel:function(){$("#batch-cancel-resp").val("false"),$(this).dialog("close")}}}),$("#cancel_transition").click((function(t){return!(!$(".bika-listing-table input[type='checkbox']:checked").length||"true"!=$("#batch-cancel-resp").val()&&(t.preventDefault(),$("#batch-cancel-dialog").dialog("open"),1))}))}}function BikaSetupEditView(){var t=$("#archetypes-fieldname-RestrictWorksheetUsersAccess #RestrictWorksheetUsersAccess"),e=$("#archetypes-fieldname-RestrictWorksheetManagement #RestrictWorksheetManagement");this.load=function(){$('input[id^="Prefixes-separator-"]').each((function(){var t=this,e=t.value,i=t.id,n=["","-","_"],a='<select id="'+i+'"></select>';$(t).after(a),$(t).hide();for(var r=0;r<n.length;r++){var o="selected";o="<option "+(o=n[r]!=e?"":o)+" value="+n[r]+">"+n[r]+"</option>",$("select#"+i).append(o)}})),$('select[id^="Prefixes-separator-"]').bind("select change",(function(){var t=$(this).val(),e=$(this).attr("id");$("input#"+e).val(t)})),$(t).change((function(){$(this).is(":checked")?($(e).prop("checked",!0),$(e).click((function(t){t.preventDefault()}))):$(e).unbind("click")})),1==$("select[name=NumberOfRequiredVerifications] option:selected").val()&&(document.getElementById("archetypes-fieldname-TypeOfmultiVerification").style.display="none"),$("#NumberOfRequiredVerifications").change((function(){1<$(this).val()?document.getElementById("archetypes-fieldname-TypeOfmultiVerification").style.display="block":document.getElementById("archetypes-fieldname-TypeOfmultiVerification").style.display="none"})),$(t).change()}}function CalculationEditView(){this.load=function(){$("#TestParameters_more").hide(),$("#Formula").live("change",(function(t){var e=[];$.each($("[id^=TestParameters-keyword]"),(function(t,i){e.push($(i).val())}));var i=$("#Formula").val().match(/\[[^\]]*\]/gi);$.each(i,(function(t,i){var n,a,r;i=i.replace("[","").replace("]",""),-1==e.indexOf(i)&&(a=$(".records_row_TestParameters"),n=$(a[a.length-1]),a=a.length.toString(),r=$(n).clone(!0),$(r).find("[id^=TestParameters-keyword]").val(i),$(r).find("[id^=TestParameters-keyword]").attr("id","TestParameters-keyword-"+a),$(r).find("[id^=TestParameters-value]").attr("id","TestParameters-value-"+a),$(r).insertBefore(n))}))}))}}function ClientEditView(){var t="#archetypes-fieldname-DecimalMark",e="#DefaultDecimalMark";this.load=function(){function i(e){e.is(":checked")?$(t).fadeOut().hide():$(t).fadeIn()}i($(e)),$(e).click((function(){i($(this))}))}}function ClientOverlayHandler(){this.load=function(){},this.onLoad=function(t){$.ajax({url:"bika_widgets/addresswidget.js",dataType:"script",async:!1})}}function CommonUtils(){this.load=function(){window.bika=window.bika||{lims:{}},window.bika.lims.AnalysisService=window.bika.lims.AnalysisService||{Dependants:function(t){t={catalog_name:"senaite_catalog_setup",UID:t,include_methods:"getServiceDependantsUIDs"};var e={};return $.ajaxSetup({async:!1}),window.bika.lims.jsonapi_read(t,(function(t){e=null!=t.objects&&0<t.objects.length?t.objects[0].getServiceDependantsUIDs:[]})),$.ajaxSetup({async:!0}),e},Dependencies:function(t){t={catalog_name:"senaite_catalog_setup",UID:t,include_methods:"getServiceDependenciesUIDs"};var e={};return $.ajaxSetup({async:!1}),window.bika.lims.jsonapi_read(t,(function(t){e=null!=t.objects&&0<t.objects.length?t.objects[0].getServiceDependenciesUIDs:[]})),$.ajaxSetup({async:!0}),e}},window.bika.lims.portalMessage=function(t){t="<dl class='portalMessage error alert alert-danger'><dt>"+_t("Error")+"</dt><dd><ul>"+t+"</ul></dd></dl>",$(".portalMessage").remove(),$(t).appendTo("#viewlet-above-content")},window.bika.lims.log=function(t){null!=window.location.url&&null!=window.location.url&&(t="("+window.location.url+"): "+t,$.ajax({type:"POST",url:"js_log",data:{message:t,_authenticator:$("input[name='_authenticator']").val()}}))},window.bika.lims.warning=function(t){t="("+window.location.href+"): "+t,$.ajax({type:"POST",url:"js_warn",data:{message:t,_authenticator:$("input[name='_authenticator']").val()}})},window.bika.lims.error=function(t){t="("+window.location.href+"): "+t,$.ajax({type:"POST",url:"js_err",data:{message:t,_authenticator:$("input[name='_authenticator']").val()}})},window.bika.lims.jsonapi_cache={},window.bika.lims.jsonapi_read=function(t,e){window.bika.lims.jsonapi_cache=window.bika.lims.jsonapi_cache||{},null==t.page_size&&(t.page_size=0);var i=$.param(t),n=e;void 0===window.bika.lims.jsonapi_cache[i]?$.ajax({type:"POST",dataType:"json",url:window.portal_url+"/@@API/read",data:t,success:function(t){window.bika.lims.jsonapi_cache[i]=t,n(t)}}):n(window.bika.lims.jsonapi_cache[i])},window.bika.lims.update_combogrid_query=function(t,e,i,n){var a,r;$(t).is(":visible")&&(n=n||"base_query",a=jQuery.parseJSON($(t).attr(n)),i&&(a[e]=i),""===i&&a[e]&&delete a[e],$(t).attr(n,JSON.stringify(a)),(i=jQuery.parseJSON($(t).attr("combogrid_options"))).url=window.portal_url+"/"+i.url,i.url=i.url+"?_authenticator="+$("input[name='_authenticator']").val(),i.url=i.url+"&catalog_name="+$(t).attr("catalog_name"),i.url=i.url+"&base_query="+encodeURIComponent($(t).attr("base_query")),i.url=i.url+"&search_query="+encodeURIComponent($.toJSON(a)),e=i.colModel,n=i.search_fields,a=i.discard_empty,r=i.minLength,i.url=i.url+"&colModel="+$.toJSON(e),i.url=i.url+"&search_fields="+$.toJSON(n),i.url=i.url+"&discard_empty="+$.toJSON(a),i.url=i.url+"&minLength="+$.toJSON(r),i.force_all="false",$(t).combogrid(i))},$(".ArchetypesPrioritySelectionWidget select").change((function(t){var e=$(this).find("option:selected").val();$(this).attr("value",e)})),$(".ArchetypesPrioritySelectionWidget select").change()},this.svgToImage=function(t){return'<img src="data:image/svg+xml;base64,'+btoa(t)+'"/>'}}function ControlChart(){var t=this;this.setData=function(e){t.datasource=e},this.setXColumn=function(e){t.xcolumnkey=e},this.setYColumn=function(e){t.ycolumnkey=e},this.setYLabel=function(e){t.ylabel=e},this.setXLabel=function(e){t.xlabel=e},this.setUpperLimit=function(e){t.upperlimit=e},this.setLowerLimit=function(e){t.lowerlimit=e},this.setCenterLimit=function(e){t.centerlimit=e},this.setUpperLimitText=function(e){t.upperlimit_text=e},this.setLowerLimitText=function(e){t.lowerlimit_text=e},this.setCenterLimitText=function(e){t.centerlimit_text=e},this.setInterpolation=function(e){t.interpolation=e},this.setPointId=function(e){t.pointid=e},this.draw=function(e){var i=20,n=$(e).innerWidth()-20-30-i,a=$(e).innerHeight()-20-20-30,r=d3.time.scale().range([0,n]),s=d3.scale.linear().range([a,0]),l=d3.svg.axis().scale(r).orient("bottom").tickSize(0),c=d3.svg.axis().scale(s).orient("left").tickSize(0),d=d3.svg.line().interpolate(t.interpolation).x((function(t){return r(t.x_axis)})).y((function(t){return s(t.y_axis)})),u=d3.select(e).append("svg").attr("xmlns","http://www.w3.org/2000/svg").attr("width",n+30+i).attr("height",a+20+30).append("g").attr("transform","translate(30,20)");x_data_parse=d3.time.format("%Y-%m-%d %I:%M %p").parse,t.datasource.forEach((function(e){var i;e.x_axis=x_data_parse(e[t.xcolumnkey]),e.y_axis=(i=e[t.ycolumnkey])&&"string"==typeof o?+i:i,e.point_id=e[t.pointid]})),t.datasource.sort((function(t,e){return t.x_axis-e.x_axis})),r.domain(d3.extent(t.datasource,(function(t){return t.x_axis}))),(e=d3.min(t.datasource,(function(t){return t.y_axis})))>t.lowerlimit&&(e=t.lowerlimit),i=d3.max(t.datasource,(function(t){return t.y_axis})),i<t.upperlimit&&(i=t.upperlimit),s.domain([e,i]),u.append("g").attr("class","x axis").attr("transform","translate(0,"+a+")").call(l).style("font-size","11px").append("text").attr("x",n).attr("dy","-0.71em").attr("text-anchor","end").text(t.xlabel),u.append("g").attr("class","y axis").call(c).style("font-size","11px").append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text(t.ylabel),u.append("path").datum(t.datasource).attr("stroke","#4682b4").attr("stroke-width","1.5px").attr("fill","none").attr("class","line").attr("d",d),t.datasource.forEach((function(e){u.append("g").attr("fill","#2f2f2f").append("circle").attr("id",e.point_id).attr("r",3).attr("cx",r(e.x_axis)).attr("cy",s(e.y_axis)).on("mouseout",(function(){d3.select(this).attr("fill","#2f2f2f").attr("r",3),d3.select(this.parentNode.children[1]).remove()})).on("mouseover",(function(){d3.select(this).attr("fill","#4682b4").attr("r",6),d3.select(this.parentNode).append("text").attr("fill","#000000").style("font-size","10px").attr("x",r(e.x_axis)-10).attr("y",s(e.y_axis)-10).text(e.y_axis+t.ylabel)})).on("click",(function(){d3.select(this).attr("fill","#4682b4").attr("r",6),d3.select(this.parentNode).append("text").attr("fill","#000000").style("font-size","10px").attr("x",r(e.x_axis)-10).attr("y",s(e.y_axis)-10).text(e.y_axis+t.ylabel)}))})),u.append("line").attr("stroke","#8e0000").attr("stroke-width","1px").attr("stroke-dasharray","5, 5").attr({x1:0,y1:s(t.upperlimit),x2:n,y2:s(t.upperlimit)}),u.append("text").attr({x:30,y:s(t.upperlimit)-5}).style("font-size","11px").text(t.upperlimit_text),u.append("line").attr("stroke","#8e0000").attr("stroke-width","1px").attr("stroke-dasharray","5, 5").attr({x1:0,y1:s(t.lowerlimit),x2:n,y2:s(t.lowerlimit)}),u.append("text").attr({x:30,y:s(t.lowerlimit)-5}).style("font-size","11px").text(t.lowerlimit_text),u.append("line").attr("stroke","#598859").attr("stroke-width","1px").attr({x1:0,y1:s(t.centerlimit),x2:n,y2:s(t.centerlimit)}),u.append("text").attr({x:30,y:s(t.centerlimit)-5}).style("font-size","11px").text(t.centerlimit_text)}}function RangeGraph(){this.load=function(){$(".range-chart").each((function(t){var e,i,n,a,r,o,s,l,c,d,u,h,p,m,f,_,y=Number($(this).css("width").replace(/[^\d\.\-]/g,""));e=$(this).get(0),(_=function(t,e){if(!$.isNumeric(e))return null;if(e=parseFloat(e),!("min"in t)||!("max"in t))return null;var i=$.isNumeric(t.min)?parseFloat(t.min):e,n=$.isNumeric(t.max)?parseFloat(t.max):e;if(i==n)return null;var a=i,r=n;return"warn_min"in t&&$.isNumeric(t.warn_min)&&(a=(a=parseFloat(t.warn_min))<i?a:i),"warn_max"in t&&$.isNumeric(t.warn_max)&&(r=n<(r=parseFloat(t.warn_max))?r:n),{result:e,min:i,max:n,warn_min:a,warn_max:r}}(i=$.parseJSON($(this).attr("data-range")),n=$.parseJSON($(this).attr("data-result"))))&&(y-=r=2*(a=.03*y),o=_.min,s=_.max,l=_.warn_min,u=((c=_.warn_max)-l)/3,d=(n=_.result)<l?n:l-u,u=c<n?n:c+u,h="gt"==(_="min_operator"in i?i.min_operator:"geq")?o<n:o<=n,p=!1,(h="lt"==(i="max_operator"in i?i.max_operator:"leq")?h&&n<s:h&&n<=s)||(i=(i="lt"==i?s<=n:s<n)&&n<=c,p=("gt"==_?n<=o:n<o)&&l<=n||i),_=h||p?"#a8d6cf":"#cdcdcd",i=h?"#279989":p?"#ffae00":"#ff0000",h=h||p?"#d9e9e6":"#dcdcdc",p=d3.scale.linear().domain([d,u]).range([0,y]),e=d3.select(e).append("svg").attr("xmlns","http://www.w3.org/2000/svg").attr("width",y+2*a).attr("height",r).append("g").attr("transform","translate("+a+",0)"),m=r/2-(y=2*a*.8)/2,f=.9*a,e.append("rect").attr("x",p(d)).attr("y",m).attr("width",p(l)-p(d)+f).attr("height",y).attr("rx",f).attr("ry",f).style("fill","#e9e9e9"),e.append("rect").attr("x",p(l)).attr("y",m).attr("width",p(o)-p(l)).attr("height",y).style("fill",h),e.append("rect").attr("x",p(s)).attr("y",m).attr("width",p(c)-p(s)).attr("height",y).style("fill",h),e.append("rect").attr("x",p(c)-f).attr("y",m).attr("width",p(u)-p(c)+f).attr("height",y).attr("rx",f).attr("ry",f).style("fill","#e9e9e9"),e.append("rect").attr("x",p(o)).attr("y",m).attr("width",p(s)-p(o)).attr("height",y).style("fill",_),e.append("circle").attr("cx",p(n)).attr("cy",r/2).attr("r",a).style("fill","white"),e.append("circle").attr("cx",p(n)).attr("cy",r/2).attr("r",a-1).style("fill",i)),$(this).removeClass("range-chart")}))}}function InstrumentCertificationEditView(){function t(){$("#Internal").is(":checked")?$("#archetypes-fieldname-Agency").hide():$("#archetypes-fieldname-Agency").fadeIn("slow")}this.load=function(){$("#Internal").live("change",(function(){t()})),t()}}function InstrumentEditView(){this.load=function(){$("#ResultFilesFolder_more").remove();var t=$(".records_row_ResultFilesFolder");for(i=0;i<t.length;i++)(0<i&&i==t.length-1?t[i]:t[i].children[2]).remove()},$("#ImportDataInterface").change((function(){var t,e=$("#ResultFilesFolder_table"),n=$(".records_row_ResultFilesFolder"),a=$("#ImportDataInterface").val();if(n.remove(),null==a||1==a.length&&""==a[0]){var r=$(n[n.length-1]).clone();for(i=0;i<$(r).children().length;i++){var o=$(r).children()[i];o=$(o).children()[0],$(o).val("")}$(r).appendTo($(e))}else{for(i=0;i<a.length;i++)""!=a[i]&&(r=$(n[n.length-1]).clone(),t=$(r).children()[0],t=$(t).children()[0],$(t).val(a[i]),t=$(r).children()[1],t=$(t).children()[0],$(t).val(""),$(r).appendTo($(e)));!function(){$("#ResultFilesFolder_table");var t=$(".records_row_ResultFilesFolder");for(i=0;i<t.length;i++){var e=$(t[i]).find("input[id^='ResultFilesFolder']");for(j=0;j<e.length;j++){var n=(n=e[j].id).split("-")[0]+"-"+n.split("-")[1];$(e[j]).attr("id",n+"-"+i)}}}()}}))}function InstrumentReferenceAnalysesView(){function t(t){var e=$("#selqcsample").val();$("#selqcsample option").remove(),$.map(t,(function(t,i){var n=i==e?" selected":"";$("#selqcsample").append('<option value="'+i+'"'+n+">"+i+"</option>")}))}function e(){var t=(t=$("#selanalyses").val().split("("))[t.length-1].slice(0,-1).trim(),e=$("#selqcsample").val(),i=0;$("div.results-info").remove(),$(".item-listing-tbody tr").each((function(n){$(this).attr("keyword")!=t||$(this).find("td.Partition a").html()!=e?$(this).hide():($(this).fadeIn(),i+=1)})),$(".bika-listing-table").closest("div").before('<div class="results-info">'+i+" results found</div>")}function i(t,e){var i,n,a,r,o=$("#selanalyses").val(),s=$("#selqcsample").val(),l=$("#interpolation").val();null==t&&$("#chart").innerWidth(),null==e&&$("#chart").innerHeight(),$("#chart").css("width",t),$("#chart").css("height",e),$("#chart").html(""),$("#chart").show(),s in(t=$.parseJSON($("#graphdata").val())[o])&&0!=t[s].length?(e=(t=t[s])[t.length-1].unit,o=t[t.length-1].upper,s=t[t.length-1].lower,i=t[t.length-1].target,n="Result",""==e||void 0===e?e="":n=e,a=$.trim("UCL ("+o+e+")"),r=$.trim("LCL ("+s+e+")"),e=$.trim("CL ("+i+e+")"),(chart=new ControlChart).setData(t),chart.setInterpolation(l),chart.setXColumn("date"),chart.setYColumn("result"),chart.setPointId("id"),chart.setYLabel(n),chart.setXLabel("Date"),chart.setUpperLimitText(a),chart.setLowerLimitText(r),chart.setCenterLimitText(e),chart.setCenterLimit(i),chart.setUpperLimit(o),chart.setLowerLimit(s),chart.draw("#chart")):$("#chart").hide()}this.load=function(){var n=$.parseJSON($("#graphdata").val());$.map(n,(function(t,e){$("#selanalyses").append('<option value="'+e+'">'+e+"</option>")})),$("#selanalyses").val()&&(t(n[$("#selanalyses").val()]),e(),i(null,null)),$("#selanalyses").change((function(a){t(n[$("#selanalyses").val()]),i(null,null),e()})),$("#selqcsample").change((function(t){i(null,null),e()})),$("#interpolation").change((function(t){i(null,null)})),$(".item-listing-tbody tr").mouseover((function(t){var e;""!=$(this).attr("uid")&&($(this).addClass("selected"),e=$(this).attr("uid"),$("#chart svg g circle#"+e).trigger("__onmouseover"))})),$(".item-listing-tbody tr").mouseout((function(t){var e;$(this).removeClass("selected"),""!=$(this).attr("uid")&&(e=$(this).attr("uid"),$("#chart svg g circle#"+e).trigger("__onmouseout"))})),$("#printgraph").click((function(t){t.preventDefault(),i(670,$("#chart").attr("height")),t=window.open("","","left=0,top=0,width=800,height=900,toolbar=0,scrollbars=0,status=0");var e='<link href="'+window.portal_url+'/++resource++bika.lims.css/print-graph.css" type="text/css" rel="stylesheet">',n=$("span.documentFirstHeading").closest("h1").clone(),a=$("#content-core").clone();$(a).prepend(n),$(a).find("#selanalyses").after("<span class='bold'>"+$("#selanalyses").val()+"</span>"),$(a).find("#interpolation").after("<span class='bold'>"+$("#interpolation").val()+"</span>"),$(a).find("#selqcsample").after("<span class='bold'>"+$("#selqcsample").val()+"</span>"),$(a).find("#selanalyses").hide(),$(a).find("#interpolation").hide(),$(a).find("#selqcsample").hide(),t.document.write("<html><head>"+e+"</head><body>"+$(a).html()+"</body></html>"),t.document.close(),t.focus(),t.print(),$("#chart").css("width","100%"),$("#chart").removeAttr("height"),i(null,null),t.close()})),$("div.bika-listing-table-container").fadeIn()}}function ReferenceSampleAnalysesView(){function t(){var t=(t=$("#selanalyses").val().split("("))[t.length-1].slice(0,-1).trim(),e=0;$("div.results-info").remove(),$(".item-listing-tbody tr").each((function(i){$(this).attr("keyword")!=t?$(this).hide():($(this).fadeIn(),e+=1)})),$(".bika-listing-table").closest("div").before('<div class="results-info">'+e+" results found</div>")}function e(t,e){var i,n,a,r,o=$("#selanalyses").val(),s=$("#selqcsample").val(),l=$("#interpolation").val();null==t&&$("#chart").innerWidth(),null==e&&$("#chart").innerHeight(),$("#chart").css("width",t),$("#chart").css("height",e),$("#chart").html(""),$("#chart").show(),s in(t=$.parseJSON($("#graphdata").val())[o])&&0!=t[s].length?(e=(t=t[s])[t.length-1].unit,o=t[t.length-1].upper,s=t[t.length-1].lower,i=t[t.length-1].target,n="Result",""==e||void 0===e?e="":n=e,a=$.trim("UCL ("+o+e+")"),r=$.trim("LCL ("+s+e+")"),e=$.trim("CL ("+i+e+")"),(chart=new ControlChart).setData(t),chart.setInterpolation(l),chart.setXColumn("date"),chart.setYColumn("result"),chart.setPointId("id"),chart.setYLabel(n),chart.setXLabel("Date"),chart.setUpperLimitText(a),chart.setLowerLimitText(r),chart.setCenterLimitText(e),chart.setCenterLimit(i),chart.setUpperLimit(o),chart.setLowerLimit(s),chart.draw("#chart")):$("#chart").hide()}this.load=function(){var i=$.parseJSON($("#graphdata").val()),n=!1;$.map(i,(function(t,e){$("#selanalyses").append('<option value="'+e+'">'+e+"</option>"),0==n&&($.map(t,(function(t,e){$("#selqcsample").val(e)})),n=!0)})),$("#selanalyses").val()&&(t(),e(null,null)),$("#selanalyses").change((function(i){e(null,null),t()})),$("#interpolation").change((function(t){e(null,null)})),$(".item-listing-tbody tr").mouseover((function(t){var e;""!=$(this).attr("uid")&&($(this).addClass("selected"),e=$(this).attr("uid"),$("#chart svg g circle#"+e).trigger("__onmouseover"))})),$(".item-listing-tbody tr").mouseout((function(t){var e;$(this).removeClass("selected"),""!=$(this).attr("uid")&&(e=$(this).attr("uid"),$("#chart svg g circle#"+e).trigger("__onmouseout"))})),$("#printgraph").click((function(t){t.preventDefault(),$("#selanalyses").find("option[selected]").remove(),$("#selanalyses").find('option[value="'+$(selanalyses).val()+'"]').prop("selected",!0),e(670,$("#chart").attr("height")),t=window.open("","","left=0,top=0,width=800,height=900,toolbar=0,scrollbars=0,status=0");var i='<link href="'+window.portal_url+'/++resource++bika.lims.css/print-graph.css" type="text/css" rel="stylesheet">',n=$("span.documentFirstHeading").closest("h1").clone(),a=$("#content-core").clone();$(a).prepend(n),$(a).find("#selanalyses").after("<span class='bold'>"+$("#selanalyses").val()+"</span>"),$(a).find("#interpolation").after("<span class='bold'>"+$("#interpolation").val()+"</span>"),$(a).find("#selanalyses").hide(),$(a).find("#interpolation").hide(),t.document.write("<html><head>"+i+"</head><body>"+$(a).html()+"</body></html>"),t.document.close(),t.focus(),t.print(),t.close(),$("#chart").css("width","100%"),$("#chart").removeAttr("height"),e(null,null)})),$("div.bika-listing-table-container").fadeIn()}}function RejectionKickOff(){this.load=function(){window.bika.lims.jsonapi_read({catalog_name:"portal_catalog",portal_type:"BikaSetup",include_fields:["RejectionReasons"]},(function(t){var e;t.success&&0<t.total_objects&&(void 0!==(e=0<(t=t.objects[0].RejectionReasons).length?t[0].checkbox:e)&&"on"==e||$("a#workflow-transition-reject").closest("li").hide())})),function(){"use strict";var t,e;0<$("div#archetypes-fieldname-RejectionWidget").length&&($("a#workflow-transition-reject").unbind(),$("a#workflow-transition-reject").bind("click",(function(t){t.preventDefault(),$("#semioverlay").show(),$('input[id="RejectionReasons.checkbox"]').click().prop("disabled",!0)})),t=$("#archetypes-fieldname-RejectionWidget").parent("td"),e="<div class='semioverlay-head'>"+$(t).prev("td").html().trim()+"</div>",$("#content").prepend("<div id='semioverlay' style='display:none'> <div class='semioverlay-back'> </div> <div class='semioverlay-panel'> <div class='semioverlay-content'></div> <div class='semioverlay-buttons'> <input type='button' name='semioverlay.reject' value='reject'/> <input type='button' name='semioverlay.cancel' value='cancel'/></div></div></div>"),$("#archetypes-fieldname-RejectionWidget").detach().prependTo("#semioverlay .semioverlay-content"),$(t).hide(),$(e).detach().insertBefore(".semioverlay-content"),$("div#semioverlay input[name='semioverlay.cancel']").bind("click",(function(){$("#semioverlay").hide(),$('input[id="RejectionReasons.checkbox"]').prop("checked",!1).prop("disabled",!1),$('input[id="RejectionReasons.checkbox.other"]').prop("checked",!1),$('input[id="RejectionReasons.textfield.other"]').val("");for(var t=$(".rejectionwidget-multiselect").find("option"),e=0;t.length>e;e++)$(t[e]).attr("selected",!1)})),$("div#semioverlay input[name='semioverlay.reject']").bind("click",(function(){var t,e,i,n;$("div#semioverlay .semioverlay-panel").fadeOut(),t={},e=window.location.href.replace("/base_view","").replace("/analyses","").replace("/manage_results","").replace("/not_requested","").replace("/log","").replace(window.portal_url,""),i=$("a#workflow-transition-reject").attr("href"),t.obj_path=e,e=function(){var t,e=0,i=[],n=0,a="";if(e=$(".rejectionwidget-checkbox").prop("checked")){e=1;for(var r=$(".rejectionwidget-multiselect").find("option"),o=0;r.length>o;o++)(t=r[o]).selected&&i.push($(t).val());(n=$(".rejectionwidget-checkbox-other").prop("checked"))?(n=1,a=$(".rejectionwidget-input-other").val()):n=0}else e=0;return e={checkbox:e,selected:i,checkbox_other:n,other:a},$.toJSON(e)}(),t.RejectionReasons=e,n="",$.ajax({type:"POST",url:window.portal_url+"/@@API/update",data:t}).done((function(t){var e;null!==t&&!0===t.success?(bika.lims.SiteView.notificationPanel("Rejecting","succeed"),$("body").hasClass("portaltype-sample")?(e=$('input[name="_authenticator"]').val(),$.ajax({url:window.location.href+"/doActionForSample?workflow_action=reject&_authenticator="+e,type:"POST",dataType:"json"}).done((function(t){null!==t&&"true"==t.success?window.location.href=window.location.href:(bika.lims.SiteView.notificationPanel("Error while updating object state","error"),t="[bika.lims.analysisrequest.js] Error while updating object state",window.bika.lims.error(t),$('#semioverlay input[name="semioverlay.cancel"]').click())}))):(bika.lims.SiteView.notificationPanel("Rejecting","succeed"),window.location.href=i)):(n=!1===t.success?(bika.lims.SiteView.notificationPanel("Error while rejecting the analysis request. Unsuccesful AJAX call.","error"),"[bika.lims.analysisrequest.js] Error while rejecting the analysis request. Unsuccesful AJAX call."):(bika.lims.SiteView.notificationPanel("Error while rejecting the analysis request. No data returned.","error"),"[bika.lims.analysisrequest.js] Error while rejecting the analysis request. No data returned."),window.bika.lims.error(n),$('#semioverlay input[name="semioverlay.cancel"]').click())})).fail((function(){bika.lims.SiteView.notificationPanel("Error while rejection the analysis request. AJAX POST failed.","error"),window.bika.lims.error("[bika.lims.analysisrequest.js] Error while rejection the analysis request. AJAX POST failed."),$('#semioverlay input[name="semioverlay.cancel"]').click()}))})))}()}}function BarcodeUtils(){this.load=function(){$(".qrcode").each((function(){var t=$(this).data("render")||"div",e=$(this).data("size"),i=$(this).data("code"),n=$(this).data("quiet")||0,a=$(this).data("text")||"no text";$(this).qrcode({render:t,size:e,code:i,quiet:n,text:a.toString()})})),$(".barcode").each((function(){var t=$(this).data("id")||"deadbeef",e=$(this).data("code")||"code128",i=$(this).data("barheight")||10,n=$(this).data("addquietzone")||!1,a=$(this).data("showhri")||!1,r=$(this).data("output")||"svg",o=$(this).data("color")||"#000000";$(this).barcode(t.toString(),e,{barHeight:i,addQuietZone:n,showHRI:a,output:r,color:o})}))}}function WorksheetPrintView(){function t(){$(".barcode").each((function(){var t=$(this).attr("data-id"),e=$(this).attr("data-code"),i=$(this).attr("data-barHeight"),n=$(this).attr("data-addQuietZone"),a=$(this).attr("data-showHRI");$(this).barcode(t,e,{barHeight:parseInt(i),addQuietZone:Boolean(n),showHRI:Boolean(a)})}))}this.load=function(){var e=document.referrer;e?bika.lims.SiteView.setCookie("ws.print.urlback",e):e=(e=bika.lims.SiteView.readCookie("ws.print.urlback"))||portal_url,t(),$("#print_button").click((function(t){t.preventDefault(),window.print()})),$("#cancel_button").click((function(t){t.preventDefault(),location.href=e})),$("#template").change((function(e){var i=window.location.href,n=$(this).val(),a=$("#numcols").val();$("#worksheet-printview").animate({opacity:.2},"slow"),$.ajax({url:i,type:"POST",data:{template:n,numcols:a}}).always((function(e){var i=$(e).find("#report-style").html();$("#report-style").html(i),e=$(e).find("#worksheet-printview").html(),$("#worksheet-printview").html(e),$("#worksheet-printview").animate({opacity:1},"slow"),t()}))})),$("#numcols").change((function(e){var i=window.location.href,n=$(this).val(),a=$("#template").val();$("#worksheet-printview").animate({opacity:.2},"slow"),$.ajax({url:i,type:"POST",data:{template:a,numcols:n}}).always((function(e){var i=$(e).find("#report-style").html();$("#report-style").html(i),e=$(e).find("#worksheet-printview").html(),$("#worksheet-printview").html(e),$("#worksheet-printview").animate({opacity:1},"slow"),t()}))}))}}(function(){window.AnalysisRequestView=function(){var t=function(t){var e;t.preventDefault(),t=t.currentTarget.href,0<(e=$("#PublicationSpecification_uid")).length&&(t=t+"&PublicationSpecification="+$(e).val()),window.location.href=t};this.load=function(){var e;$("a[id^='workflow-transition']").not("#workflow-transition-schedule_sampling").not("#workflow-transition-sample").click(t),(e=$("#workflow-transition-schedule_sampling").attr("href"))&&$("#workflow-transition-schedule_sampling").click((function(){var t,i=$("#SamplingDate").val(),n=$("#ScheduledSamplingSampler").val();""!==i&&null!=i&&""!==n&&null!=n?window.location.href=e:((t="")!==i&&null!=i||(t+=PMF("${name} is required for this action, please correct.",{name:_("Sampling Date")})),""!==n&&null!=n||(""!==t&&(t+="<br/>"),t+=PMF("${name} is required, please correct.",{name:_("'Define the Sampler for the shceduled'")})),""!==t&&window.bika.lims.portalMessage(t))})),$("#interpretationtemplate-insert").click((function(t){var e,i;t.preventDefault(),(t=$("#interpretationtemplate").val())&&1===(e=$('div[id^="ResultsInterpretationDepts-"].active  textarea[id^="ResultsInterpretationDepts-richtext-"]')).length&&(i=e.attr("id"),window.bika.lims.jsonapi_read({catalog_name:"uid_catalog",UID:t,include_fields:["text"]},(function(t){if(1===t.objects.length)return t=t.objects[0].text,tinymce.get(i).insertContent(t)})))}))}},window.AnalysisRequestViewView=function(){this.load=function(){}},window.AnalysisRequestAnalysesView=function(){this.load=function(){}}}).call(this),function(){function t(t,e){return function(){return t.apply(e,arguments)}}function e(){this.on_overlay_panel_click=t(this.on_overlay_panel_click,this),this.on_reference_definition_list_change=t(this.on_reference_definition_list_change,this),this.on_numeric_field_keypress=t(this.on_numeric_field_keypress,this),this.on_numeric_field_paste=t(this.on_numeric_field_paste,this),this.on_at_float_field_keyup=t(this.on_at_float_field_keyup,this),this.on_at_integer_field_keyup=t(this.on_at_integer_field_keyup,this),this.notify_in_panel=t(this.notify_in_panel,this),this.notificationPanel=t(this.notificationPanel,this),this.set_cookie=t(this.set_cookie,this),this.setCookie=t(this.setCookie,this),this.read_cookie=t(this.read_cookie,this),this.readCookie=t(this.readCookie,this),this.log=t(this.log,this),this.portal_alert=t(this.portal_alert,this),this.portalAlert=t(this.portalAlert,this),this.get_authenticator=t(this.get_authenticator,this),this.get_portal_url=t(this.get_portal_url,this),this.init_referencedefinition=t(this.init_referencedefinition,this),this.bind_eventhandler=t(this.bind_eventhandler,this),this.load=t(this.load,this)}window.SiteView=(e.prototype.load=function(){return this.bind_eventhandler(),this.allowed_keys=[8,9,13,35,36,37,39,46,44,60,62,45,69,101,61]},e.prototype.bind_eventhandler=function(){return $("body").on("change","#ReferenceDefinition\\:list",this.on_reference_definition_list_change),$("body").on("keypress",".numeric",this.on_numeric_field_keypress),$("body").on("paste",".numeric",this.on_numeric_field_paste),$("body").on("keyup","input[name*='\\:int'], .ArchetypesIntegerWidget input",this.on_at_integer_field_keyup),$("body").on("keyup","input[name*='\\:float'], .ArchetypesDecimalWidget input",this.on_at_float_field_keyup),$("body").on("click","a.overlay_panel",this.on_overlay_panel_click),$(document).on({ajaxStart:function(){$("body").addClass("loading")},ajaxStop:function(){$("body").removeClass("loading")},ajaxError:function(){$("body").removeClass("loading")}})},e.prototype.init_referencedefinition=function(){if(""!==$("#ReferenceDefinition:list").val())return $("#ReferenceDefinition:list").change()},e.prototype.get_portal_url=function(){return window.portal_url},e.prototype.get_authenticator=function(){return window.site.authenticator()},e.prototype.portalAlert=function(t){return this.portal_alert(t)},e.prototype.portal_alert=function(t){var e=$("#portal-alert");0===e.length?$("#portal-header").append("<div id='portal-alert' style='display:none'><div class='portal-alert-item'>"+t+"</div></div>"):e.append("<div class='portal-alert-item'>"+t+"</div>"),e.fadeIn()},e.prototype.log=function(t){return window.bika.lims.log(t)},e.prototype.readCookie=function(t){return window.site.read_cookie(t)},e.prototype.read_cookie=function(t){return window.site.read_cookie(t)},e.prototype.setCookie=function(t,e){return window.site.set_cookie(t,e)},e.prototype.set_cookie=function(t,e){window.site.set_cookie(t,e)},e.prototype.notificationPanel=function(t,e){return this.notify_in_panel(t,e)},e.prototype.notify_in_panel=function(t,e){$("#panel-notification").remove(),e="<div id='panel-notification' style='display:none'><div class='"+e+"-notification-item'>"+t+"</div></div>",$("div#viewlet-above-content-title").append(e),$("#panel-notification").fadeIn("slow","linear",(function(){setTimeout((function(){$("#panel-notification").fadeOut("slow","linear")}),3e3)}))},e.prototype.on_at_integer_field_keyup=function(t){t=t.currentTarget,t=$(t),/\D/g.test(t.val())&&t.val(t.val().replace(/\D/g,""))},e.prototype.on_at_float_field_keyup=function(t){t=t.currentTarget,t=$(t),/[^-.\d]/g.test(t.val())&&t.val(t.val().replace(/[^.\d]/g,""))},e.prototype.on_numeric_field_paste=function(t){t=t.currentTarget;var e=$(t);window.setTimeout((function(){e.val(e.val().replace(",","."))}),0)},e.prototype.on_numeric_field_keypress=function(t){var e=t.currentTarget,i=$(e),n=(e=t.which,this.allowed_keys.join(",").match(new RegExp(e)));!e||48<=e&&e<=57||n?window.setTimeout((function(){i.val(i.val().replace(",","."))}),0):t.preventDefault()},e.prototype.on_reference_definition_list_change=function(t){t=t.currentTarget,t=$(t);var e=this.get_authenticator(),i=t.val();t=t.children(":selected").html(),""===i?($("#Blank").prop("checked",!1),$("#Hazardous").prop("checked",!1),$(".bika-listing-table").load("referenceresults",{_authenticator:e})):(-1<t.search(_t("(Blank)"))||-1<t.search("(Blank)")?$("#Blank").prop("checked",!0):$("#Blank").prop("checked",!1),-1<t.search(_t("(Hazardous)"))||-1<t.search("(Hazardous)")?$("#Hazardous").prop("checked",!0):$("#Hazardous").prop("checked",!1),$(".bika-listing-table").load("referenceresults",{_authenticator:e,uid:i}))},e.prototype.on_overlay_panel_click=function(t){return t.preventDefault(),t=t.currentTarget,$(t).prepOverlay({subtype:"ajax",width:"80%",filter:"#content>*:not(div#portal-column-content)",config:{closeOnClick:!0,closeOnEsc:!0,onBeforeLoad:function(t){return this.getOverlay().draggable()},onLoad:function(t){return t=new Event("DOMContentLoaded",{}),window.document.dispatchEvent(t)}}}),$(t).click()},e)}.call(this),function(){window.AttachmentsUtils=function(){this.load=function(){$("#AttachFile,#Service,#Analysis").change((function(t){var e,i,n=$("#AttachFile").val();void 0===n&&(n=""),void 0===(i=$("#Service").val())&&(i=""),void 0===(e=$("#Analysis").val())&&(e=""),"Service"===this.id&&$("#Analysis").val(""),"Analysis"===this.id&&$("#Service").val(""),""===n||""===i&&""===e?$("#addButton").prop("disabled",!0):$("#addButton").removeAttr("disabled")}))}}}.call(this),function(){function t(t,e){return function(){return t.apply(e,arguments)}}function e(){this.on_instrument_change=t(this.on_instrument_change,this),this.on_template_change=t(this.on_template_change,this),this.select_instrument=t(this.select_instrument,this),this.get_template_instrument=t(this.get_template_instrument,this),this.bind_eventhandler=t(this.bind_eventhandler,this),this.load=t(this.load,this)}function i(){this.on_wideinterims_apply_click=t(this.on_wideinterims_apply_click,this),this.on_slot_remarks_click=t(this.on_slot_remarks_click,this),this.on_wideiterims_interims_change=t(this.on_wideiterims_interims_change,this),this.on_wideiterims_analyses_change=t(this.on_wideiterims_analyses_change,this),this.on_instrument_change=t(this.on_instrument_change,this),this.on_layout_change=t(this.on_layout_change,this),this.on_analyst_change=t(this.on_analyst_change,this),this.reload_analyses_listing=t(this.reload_analyses_listing,this),this.get_analyses_listing=t(this.get_analyses_listing,this),this.get_authenticator=t(this.get_authenticator,this),this.get_base_url=t(this.get_base_url,this),this.get_portal_url=t(this.get_portal_url,this),this.ajax_submit=t(this.ajax_submit,this),this.bind_eventhandler=t(this.bind_eventhandler,this),this.load=t(this.load,this)}window.WorksheetFolderView=(e.prototype.load=function(){return this.bind_eventhandler()},e.prototype.bind_eventhandler=function(){return $("body").on("change","select.template",this.on_template_change),$("body").on("change","select.instrument",this.on_instrument_change)},e.prototype.get_template_instrument=function(){var t=$("input.templateinstruments").val();return JSON.parse(t)},e.prototype.select_instrument=function(t){if(t=$(".instrument").find("option[value='"+t+"']"))return t.prop("selected",!0)},e.prototype.on_template_change=function(t){return t=$(t.currentTarget).val(),t=this.get_template_instrument()[t],this.select_instrument(t)},e.prototype.on_instrument_change=function(t){if($(t.currentTarget).val())return t=_t("Only the analyses for which the selected instrument is allowed will be added automatically."),bika.lims.SiteView.notify_in_panel(t,"error")},e),window.WorksheetManageResultsView=(i.prototype.load=function(){return this.bind_eventhandler()},i.prototype.bind_eventhandler=function(){return $("body").on("change",".manage_results_header .analyst",this.on_analyst_change),$("body").on("change","#resultslayout_form #resultslayout",this.on_layout_change),$("body").on("change",".manage_results_header .instrument",this.on_instrument_change),$("body").on("change","#wideinterims_analyses",this.on_wideiterims_analyses_change),$("body").on("change","#wideinterims_interims",this.on_wideiterims_interims_change),$("body").on("click","#wideinterims_apply",this.on_wideinterims_apply_click),$("body").on("click","img.slot-remarks",this.on_slot_remarks_click)},i.prototype.ajax_submit=function(t){var e,i;return null==(t=null==t?{}:t).type&&(t.type="POST"),null==t.url&&(t.url=this.get_base_url()),null==t.context&&(t.context=this),$(this).trigger("ajax:submit:start"),i=this,e=function(){return $(i).trigger("ajax:submit:end")},$.ajax(t).done(e)},i.prototype.get_portal_url=function(){return $("input[name=portal_url]").val()||window.portal_url},i.prototype.get_base_url=function(){var t=window.location.href;return(t=t.split("?")[0]).replace("#","")},i.prototype.get_authenticator=function(){return $("input[name='_authenticator']").val()},i.prototype.get_analyses_listing=function(){return document.querySelector("#analyses_form div.ajax-contents-table")},i.prototype.reload_analyses_listing=function(){var t=this.get_analyses_listing(),e=new Event("reload");return t.dispatchEvent(e)},i.prototype.on_analyst_change=function(t){var e;return""!==(t=$(t.currentTarget).val())&&(e=this.get_base_url().replace("/manage_results","")+"/set_analyst",this.ajax_submit({url:e,data:{value:t,_authenticator:this.get_authenticator()},dataType:"json"}).done((function(t){return bika.lims.SiteView.notify_in_panel(_p("Changes saved."),"succeed")})).fail((function(){return bika.lims.SiteView.notify_in_panel(_t("Could not set the selected analyst"),"error")})))},i.prototype.on_layout_change=function(t){return $(t.currentTarget)},i.prototype.on_instrument_change=function(t){var e;return""!==(t=$(t.currentTarget).val())&&(e=this.get_base_url().replace("/manage_results","")+"/set_instrument",this.ajax_submit({url:e,data:{value:t,_authenticator:this.get_authenticator()},dataType:"json"}).done((function(t){return this.reload_analyses_listing()})).fail((function(){return bika.lims.SiteView.notify_in_panel(_t("Unable to apply the selected instrument"),"error")})))},i.prototype.on_wideiterims_analyses_change=function(t){return t=$(t.currentTarget),$("#wideinterims_interims").html(""),t=t.val(),$("input[id^='wideinterim_"+t+"']").each((function(t,e){var i=$(e).attr("name");return e="<option value='"+$(e).attr("keyword")+"'>"+i+"</option>",$("#wideinterims_interims").append(e)}))},i.prototype.on_wideiterims_interims_change=function(t){return t=$(t.currentTarget),t="#wideinterim_"+$("#wideinterims_analyses").val()+"_"+t.val(),$("#wideinterims_value").val($(t).val())},i.prototype.on_slot_remarks_click=function(t){return t=t.currentTarget,$(t).prepOverlay({subtype:"ajax",filter:"h1,div.remarks-widget",config:{closeOnClick:!0,closeOnEsc:!0,onBeforeLoad:function(t){var e=this.getOverlay();return $("div.pb-ajax>div",e).addClass("container-fluid"),$("h3",e).remove(),$("textarea",e).remove(),$("input",e).remove(),e.draggable()},onLoad:function(t){return $.mask.close()}}}),$(t).click()},i.prototype.on_wideinterims_apply_click=function(t){var e,i,n;return t.preventDefault(),$(t.currentTarget),$("#wideinterims_analyses").val(),t=$("#wideinterims_interims").val(),e=$("#wideinterims_empty").is(":checked"),n=$("#wideinterims_value").val(),i=function(t,e){return Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"value").set.call(t,e),e=new Event("input",{bubbles:!0}),t.dispatchEvent(e)},$("tr td input[column_key='"+t+"']").each((function(t,a){return e&&""!==$(this).val()&&"0"!==$(this).val().match(/\d+/)||i(a,n),!0}))},i)}.call(this),window.bika=window.bika||{lims:{}},window.bika.lims.controllers={html:["CommonUtils"],".barcode, .qrcode":["BarcodeUtils"],".range-chart":["RangeGraph"],".attachments":["AttachmentsUtils"],body:["SiteView"],".portaltype-instrument.template-referenceanalyses":["InstrumentReferenceAnalysesView"],".portaltype-instrumentcertification.template-base_edit":["InstrumentCertificationEditView"],".portaltype-instrument.template-base_edit":["InstrumentEditView"],".portaltype-calculation":["CalculationEditView"],".portaltype-bikasetup.template-base_edit":["BikaSetupEditView"],".portaltype-client.template-base_edit":["ClientEditView"],"div.overlay #client-base-edit":["ClientOverlayHandler"],".portaltype-referencesample.template-analyses":["ReferenceSampleAnalysesView"],".portaltype-analysisrequest":["AnalysisRequestView"],".portaltype-analysisrequest:not(.template-ar_add)":["RejectionKickOff"],".portaltype-analysisrequest.template-base_view":["WorksheetManageResultsView","AnalysisRequestViewView","RejectionKickOff"],".portaltype-analysisrequest.template-analyses":["AnalysisRequestAnalysesView"],".portaltype-analysisrequest.template-ar_add":["AnalysisRequestAddView"],"#analysisrequest_add_form":["AnalysisRequestAdd"],".portaltype-batchfolder":["BatchFolderView"],".portaltype-worksheetfolder":["WorksheetFolderView"],".portaltype-worksheet.template-manage_results":["WorksheetManageResultsView"],"#worksheet-printview-wrapper":["WorksheetPrintView"],".ArchetypesRemarksWidget":["RemarksWidgetView"]},window.bika.lims.loadControllers=function(t,e){var i,n=window.bika.lims.controllers,a=new Array,r=a.length;for(i in n)($(i).length||0<=$.inArray(i,e))&&n[i].forEach((function(n){(1==t||0<=$.inArray(i,e)||$.inArray(n,a)<0)&&((obj=new window[n]).load(),window.bika.lims[n]=obj,a.push(n))}));return a.length-r},document.addEventListener("DOMContentLoaded",(function(t){window.bika.lims.loadControllers(!1,[])}));