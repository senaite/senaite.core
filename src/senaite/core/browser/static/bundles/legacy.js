function AnalysisProfileEditView(){var t=$("#archetypes-fieldname-AnalysisProfilePrice"),e=$("#archetypes-fieldname-AnalysisProfilePrice #AnalysisProfilePrice"),i=$("#archetypes-fieldname-AnalysisProfileVAT"),n=$("#archetypes-fieldname-AnalysisProfileVAT #AnalysisProfileVAT"),a=$("#archetypes-fieldname-UseAnalysisProfilePrice #UseAnalysisProfilePrice");this.load=function(){$(a).change(function(){$(this).is(":checked")?($(t).show(),$(i).show()):($(t).hide(),$(i).hide(),$(e).val("0"),$(n).val("0"))}),$(a).change()}}function ARTemplateEditView(){var e=$("#archetypes-fieldname-SamplePoint #SamplePoint"),i=$("#archetypes-fieldname-SampleType #SampleType");function n(t){if($('[name^="uids\\:list"]').filter(":checked").length<1)return window.bika.lims.portalMessage("No analyses have been selected"),window.scroll(0,0),!1}this.load=function(){var t;$(".portaltype-artemplate input[name$='save']").addClass("allowMultiSubmit"),$(".portaltype-artemplate input[name$='save']").click(n),t={},t=0<document.location.href.search("/clients/")?{portal_type:"Client",id:document.location.href.split("clients")[1].split("/")[1],include_fields:["UID"]}:{portal_type:"BikaSetup",include_fields:["UID"]},window.bika.lims.jsonapi_read(t,function(t){t.objects&&t.objects.length<1||((t=t.objects[0]).UID,$(e).attr("search_query",JSON.stringify({getClientUID:t.UID})),referencewidget_lookups([$(e)]))}),$(e).bind("selected blur change",function(){var t=$(e).val()?$(e).attr("uid"):"";$(i).attr("search_query",JSON.stringify({getRawSamplePoints:t})),referencewidget_lookups([$(i)])}),$(i).bind("selected blur change",function(){var t=$(i).val()?$(i).attr("uid"):"";$(e).attr("search_query",JSON.stringify({getRawSampleTypes:t})),referencewidget_lookups([$(e)])})}}function BatchFolderView(){this.load=function(){$(".portaltype-batchfolder").append("<div id='batch-cancel-dialog' title='"+_t("Cancel batch/es?")+"'>    <p style='padding:10px'>        <span class='ui-icon ui-icon-alert' style=''float: left; margin: 0 7px 30px 0;'><br/></span>        "+_t("All linked Samples will be cancelled too.")+"    </p>    <p style='padding:0px 10px'>       "+_t("Are you sure?")+"    </p></div><input id='batch-cancel-resp' type='hidden' value='false'/>"),$("#batch-cancel-dialog").dialog({autoOpen:!1,resizable:!1,height:200,width:400,modal:!0,buttons:{"Cancel selected batches":function(){$(this).dialog("close"),$("#batch-cancel-resp").val("true"),$(".portaltype-batchfolder #cancel_transition").click()},Cancel:function(){$("#batch-cancel-resp").val("false"),$(this).dialog("close")}}}),$("#cancel_transition").click(function(t){return!!$(".bika-listing-table input[type='checkbox']:checked").length&&("true"==$("#batch-cancel-resp").val()||(t.preventDefault(),$("#batch-cancel-dialog").dialog("open"),!1))})}}function BikaSetupEditView(){var t=$("#archetypes-fieldname-RestrictWorksheetUsersAccess #RestrictWorksheetUsersAccess"),e=$("#archetypes-fieldname-RestrictWorksheetManagement #RestrictWorksheetManagement");this.load=function(){$('input[id^="Prefixes-separator-"]').each(function(){!function(t){var e=t.value,i=t.id,n=["","-","_"],a='<select id="'+i+'"></select>';$(t).after(a),$(t).hide();for(var s=0;s<n.length;s++){var r="selected";n[s]!=e&&(r="");r="<option "+r+" value="+n[s]+">"+n[s]+"</option>";$("select#"+i).append(r)}}(this)}),$('select[id^="Prefixes-separator-"]').bind("select change",function(){var t=$(this).val(),e=$(this).attr("id");$("input#"+e).val(t)}),$(t).change(function(){$(this).is(":checked")?($(e).prop("checked",!0),$(e).click(function(t){t.preventDefault()})):$(e).unbind("click")}),1==$("select[name=NumberOfRequiredVerifications] option:selected").val()&&(document.getElementById("archetypes-fieldname-TypeOfmultiVerification").style.display="none"),$("#NumberOfRequiredVerifications").change(function(){1<$(this).val()?document.getElementById("archetypes-fieldname-TypeOfmultiVerification").style.display="block":document.getElementById("archetypes-fieldname-TypeOfmultiVerification").style.display="none"}),$(t).change()}}function CalculationEditView(){this.load=function(){$("#TestParameters_more").hide(),$("#Formula").live("change",function(t){var s=[];$.each($("[id^=TestParameters-keyword]"),function(t,e){s.push($(e).val())});var e=$("#Formula").val().match(/\[[^\]]*\]/gi);$.each(e,function(t,e){var i,n,a;e=e.replace("[","").replace("]",""),-1==s.indexOf(e)&&(a=$(".records_row_TestParameters"),i=$(a[a.length-1]),n=a.length.toString(),a=$(i).clone(!0),$(a).find("[id^=TestParameters-keyword]").val(e),$(a).find("[id^=TestParameters-keyword]").attr("id","TestParameters-keyword-"+n),$(a).find("[id^=TestParameters-value]").attr("id","TestParameters-value-"+n),$(a).insertBefore(i))})})}}function ClientEditView(){var e="#archetypes-fieldname-DecimalMark",i="#DefaultDecimalMark";this.load=function(){function t(t){t.is(":checked")?$(e).fadeOut().hide():$(e).fadeIn()}t($(i)),$(i).click(function(){t($(this))})}}function ClientOverlayHandler(){this.load=function(){},this.onLoad=function(t){$.ajax({url:"bika_widgets/addresswidget.js",dataType:"script",async:!1})}}function CommonUtils(){this.load=function(){window.bika=window.bika||{lims:{}},window.bika.lims.AnalysisService=window.bika.lims.AnalysisService||{Dependants:function(t){var t={catalog_name:"bika_setup_catalog",UID:t,include_methods:"getServiceDependantsUIDs"},e={};return $.ajaxSetup({async:!1}),window.bika.lims.jsonapi_read(t,function(t){e=null!=t.objects&&0<t.objects.length?t.objects[0].getServiceDependantsUIDs:[]}),$.ajaxSetup({async:!0}),e},Dependencies:function(t){var t={catalog_name:"bika_setup_catalog",UID:t,include_methods:"getServiceDependenciesUIDs"},e={};return $.ajaxSetup({async:!1}),window.bika.lims.jsonapi_read(t,function(t){e=null!=t.objects&&0<t.objects.length?t.objects[0].getServiceDependenciesUIDs:[]}),$.ajaxSetup({async:!0}),e}},window.bika.lims.portalMessage=function(t){t="<dl class='portalMessage error alert alert-danger'><dt>"+_t("Error")+"</dt><dd><ul>"+t+"</ul></dd></dl>";$(".portalMessage").remove(),$(t).appendTo("#viewlet-above-content")},window.bika.lims.log=function(t){null!=window.location.url&&null!=window.location.url&&(t="("+window.location.url+"): "+t,$.ajax({type:"POST",url:"js_log",data:{message:t,_authenticator:$("input[name='_authenticator']").val()}}))},window.bika.lims.warning=function(t){t="("+window.location.href+"): "+t;$.ajax({type:"POST",url:"js_warn",data:{message:t,_authenticator:$("input[name='_authenticator']").val()}})},window.bika.lims.error=function(t){t="("+window.location.href+"): "+t;$.ajax({type:"POST",url:"js_err",data:{message:t,_authenticator:$("input[name='_authenticator']").val()}})},window.bika.lims.jsonapi_cache={},window.bika.lims.jsonapi_read=function(t,e){window.bika.lims.jsonapi_cache=window.bika.lims.jsonapi_cache||{},null==t.page_size&&(t.page_size=0);var i=$.param(t),n=e;void 0===window.bika.lims.jsonapi_cache[i]?$.ajax({type:"POST",dataType:"json",url:window.portal_url+"/@@API/read",data:t,success:function(t){window.bika.lims.jsonapi_cache[i]=t,n(t)}}):n(window.bika.lims.jsonapi_cache[i])},window.bika.lims.update_combogrid_query=function(t,e,i,n){var a,s;$(t).is(":visible")&&(n=n||"base_query",s=jQuery.parseJSON($(t).attr(n)),i&&(s[e]=i),""===i&&s[e]&&delete s[e],$(t).attr(n,JSON.stringify(s)),(a=jQuery.parseJSON($(t).attr("combogrid_options"))).url=window.portal_url+"/"+a.url,a.url=a.url+"?_authenticator="+$("input[name='_authenticator']").val(),a.url=a.url+"&catalog_name="+$(t).attr("catalog_name"),a.url=a.url+"&base_query="+encodeURIComponent($(t).attr("base_query")),a.url=a.url+"&search_query="+encodeURIComponent($.toJSON(s)),i=a.colModel,e=a.search_fields,n=a.discard_empty,s=a.minLength,a.url=a.url+"&colModel="+$.toJSON(i),a.url=a.url+"&search_fields="+$.toJSON(e),a.url=a.url+"&discard_empty="+$.toJSON(n),a.url=a.url+"&minLength="+$.toJSON(s),a.force_all="false",$(t).combogrid(a))},$(".ArchetypesPrioritySelectionWidget select").change(function(t){var e=$(this).find("option:selected").val();$(this).attr("value",e)}),$(".ArchetypesPrioritySelectionWidget select").change()},this.svgToImage=function(t){return'<img src="'+("data:image/svg+xml;base64,"+btoa(t))+'"/>'}}function DepartmentLabContactsView(){this.load=function(){$("table.bika-listing-table td input[type='checkbox']").not('[type="hidden"]').each(function(t){$(this).change(function(){var t,e,i,n;t=this,n={},e=$(t).prop("checked"),i=$(t).val(),url=window.location.href.replace("/labcontacts",""),t=url.replace(window.portal_url,""),n.contact_uid=i,n.checkbox_value=e,n.department=t,function(t){var e=$('tr[uid="'+t.contact_uid+'"] td.Fullname a').attr("href"),i=$('tr[uid="'+t.contact_uid+'"] td.Fullname a').text(),n="<a href='"+e+"'>"+i+"</a>";$.ajax({type:"POST",dataType:"json",url:window.location.href.replace("/labcontacts","")+"/labcontactupdate",data:{data:JSON.stringify(t)}}).done(function(t){null!==t&&!0===t.success?bika.lims.SiteView.notificationPanel(n+" updated successfully","succeed"):(bika.lims.SiteView.notificationPanel("Failure while updating "+n,"error"),t="[bika.lims.department.js in DepartmentLabContactsView] Failure while updating "+i+"in "+window.location.href,window.bika.lims.error(t))}).fail(function(){bika.lims.SiteView.notificationPanel("Error while updating "+n,"error");var t="[bika.lims.department.js in DepartmentLabContactsView] Error while updating "+i+"in "+window.location.href;window.bika.lims.error(t)})}(n)})})}}function ControlChart(){var p=this;this.setData=function(t){p.datasource=t},this.setXColumn=function(t){p.xcolumnkey=t},this.setYColumn=function(t){p.ycolumnkey=t},this.setYLabel=function(t){p.ylabel=t},this.setXLabel=function(t){p.xlabel=t},this.setUpperLimit=function(t){p.upperlimit=t},this.setLowerLimit=function(t){p.lowerlimit=t},this.setCenterLimit=function(t){p.centerlimit=t},this.setUpperLimitText=function(t){p.upperlimit_text=t},this.setLowerLimitText=function(t){p.lowerlimit_text=t},this.setCenterLimitText=function(t){p.centerlimit_text=t},this.setInterpolation=function(t){p.interpolation=t},this.setPointId=function(t){p.pointid=t},this.draw=function(t){var e=20,i=20,n=30,a=30,s=(s=$(t).innerWidth()-20)-a-i,r=(r=$(t).innerHeight()-20)-e-n,l=d3.time.scale().range([0,s]),c=d3.scale.linear().range([r,0]),u=d3.svg.axis().scale(l).orient("bottom").tickSize(0),d=d3.svg.axis().scale(c).orient("left").tickSize(0),h=d3.svg.line().interpolate(p.interpolation).x(function(t){return l(t.x_axis)}).y(function(t){return c(t.y_axis)}),_=d3.select(t).append("svg").attr("xmlns","http://www.w3.org/2000/svg").attr("width",s+a+i).attr("height",r+e+n).append("g").attr("transform","translate("+a+","+e+")");x_data_parse=d3.time.format("%Y-%m-%d %I:%M %p").parse,p.datasource.forEach(function(t){var e;t.x_axis=x_data_parse(t[p.xcolumnkey]),t.y_axis=(e=t[p.ycolumnkey])&&"string"==typeof o?+e:e,t.point_id=t[p.pointid]}),p.datasource.sort(function(t,e){return t.x_axis-e.x_axis}),l.domain(d3.extent(p.datasource,function(t){return t.x_axis}));a=d3.min(p.datasource,function(t){return t.y_axis});a>p.lowerlimit&&(a=p.lowerlimit);e=d3.max(p.datasource,function(t){return t.y_axis});e<p.upperlimit&&(e=p.upperlimit),c.domain([a,e]),_.append("g").attr("class","x axis").attr("transform","translate(0,"+r+")").call(u).style("font-size","11px").append("text").attr("x",s).attr("dy","-0.71em").attr("text-anchor","end").text(p.xlabel),_.append("g").attr("class","y axis").call(d).style("font-size","11px").append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text(p.ylabel),_.append("path").datum(p.datasource).attr("stroke","#4682b4").attr("stroke-width","1.5px").attr("fill","none").attr("class","line").attr("d",h),p.datasource.forEach(function(t){_.append("g").attr("fill","#2f2f2f").append("circle").attr("id",t.point_id).attr("r",3).attr("cx",l(t.x_axis)).attr("cy",c(t.y_axis)).on("mouseout",function(){d3.select(this).attr("fill","#2f2f2f").attr("r",3),d3.select(this.parentNode.children[1]).remove()}).on("mouseover",function(){d3.select(this).attr("fill","#4682b4").attr("r",6),d3.select(this.parentNode).append("text").attr("fill","#000000").style("font-size","10px").attr("x",l(t.x_axis)-10).attr("y",c(t.y_axis)-10).text(t.y_axis+p.ylabel)}).on("click",function(){d3.select(this).attr("fill","#4682b4").attr("r",6),d3.select(this.parentNode).append("text").attr("fill","#000000").style("font-size","10px").attr("x",l(t.x_axis)-10).attr("y",c(t.y_axis)-10).text(t.y_axis+p.ylabel)})}),_.append("line").attr("stroke","#8e0000").attr("stroke-width","1px").attr("stroke-dasharray","5, 5").attr({x1:0,y1:c(p.upperlimit),x2:s,y2:c(p.upperlimit)}),_.append("text").attr({x:30,y:c(p.upperlimit)-5}).style("font-size","11px").text(p.upperlimit_text),_.append("line").attr("stroke","#8e0000").attr("stroke-width","1px").attr("stroke-dasharray","5, 5").attr({x1:0,y1:c(p.lowerlimit),x2:s,y2:c(p.lowerlimit)}),_.append("text").attr({x:30,y:c(p.lowerlimit)-5}).style("font-size","11px").text(p.lowerlimit_text),_.append("line").attr("stroke","#598859").attr("stroke-width","1px").attr({x1:0,y1:c(p.centerlimit),x2:s,y2:c(p.centerlimit)}),_.append("text").attr({x:30,y:c(p.centerlimit)-5}).style("font-size","11px").text(p.centerlimit_text)}}function RangeGraph(){this.load=function(){$(".range-chart").each(function(t){var e,i,n,a,s,r,o,l,c,u,d,h,_,p,m,f,y=Number($(this).css("width").replace(/[^\d\.\-]/g,""));e=$(this).get(0),i=y,n=$.parseJSON($(this).attr("data-range")),a=$.parseJSON($(this).attr("data-result")),(f=function(t,e){if(!$.isNumeric(e))return null;e=parseFloat(e);if(!("min"in t&&"max"in t))return null;var i=$.isNumeric(t.min)?parseFloat(t.min):e,n=$.isNumeric(t.max)?parseFloat(t.max):e;if(i==n)return null;var a=i,s=n;"warn_min"in t&&$.isNumeric(t.warn_min)&&(a=(a=parseFloat(t.warn_min))<i?a:i);"warn_max"in t&&$.isNumeric(t.warn_max)&&(s=parseFloat(t.warn_max),s=n<s?s:n);return{result:e,min:i,max:n,warn_min:a,warn_max:s}}(n,a))&&(i-=r=2*(s=.03*i),o=f.min,l=f.max,c=f.warn_min,u=f.warn_max,a=f.result,p="min_operator"in n?n.min_operator:"geq",_="max_operator"in n?n.max_operator:"leq",h=(u-c)/3,d=a<c?a:c-h,y=u<a?a:u+h,f="gt"==p?o<a:o<=a,n=!1,(f="lt"==_?f&&a<l:f&&a<=l)||(m=(m="lt"==_?l<=a:l<a)&&a<=u,n=("gt"==p?a<=o:a<o)&&c<=a||m),h=f||n?"#a8d6cf":"#cdcdcd",_=f?"#279989":n?"#ffae00":"#ff0000",p=f||n?"#d9e9e6":"#dcdcdc",m=d3.scale.linear().domain([d,y]).range([0,i]),f=d3.select(e).append("svg").attr("xmlns","http://www.w3.org/2000/svg").attr("width",i+2*s).attr("height",r).append("g").attr("transform","translate("+s+",0)"),e=r/2-(n=2*s*.8)/2,i=.9*s,f.append("rect").attr("x",m(d)).attr("y",e).attr("width",m(c)-m(d)+i).attr("height",n).attr("rx",i).attr("ry",i).style("fill","#e9e9e9"),f.append("rect").attr("x",m(c)).attr("y",e).attr("width",m(o)-m(c)).attr("height",n).style("fill",p),f.append("rect").attr("x",m(l)).attr("y",e).attr("width",m(u)-m(l)).attr("height",n).style("fill",p),f.append("rect").attr("x",m(u)-i).attr("y",e).attr("width",m(y)-m(u)+i).attr("height",n).attr("rx",i).attr("ry",i).style("fill","#e9e9e9"),f.append("rect").attr("x",m(o)).attr("y",e).attr("width",m(l)-m(o)).attr("height",n).style("fill",h),f.append("circle").attr("cx",m(a)).attr("cy",r/2).attr("r",s).style("fill","white"),f.append("circle").attr("cx",m(a)).attr("cy",r/2).attr("r",s-1).style("fill",_)),$(this).removeClass("range-chart")})}}function InstrumentImportView(){this.load=function(){$("#instrument_select").change(function(){$(".portalMessage").remove(),$("#import_form").empty(),$("#intermediate").toggle(!1),""==$(this).val()?$("#exim").empty():$.ajax({type:"POST",dataType:"json",url:window.location.href.replace("/import","/getImportInterfaces"),data:{_authenticator:$('input[name="_authenticator"]').val(),instrument_uid:$(this).val()},success:function(t){$("#exim").empty(),$("#exim").append($("<option>").text("Choose an Interface...").attr("value","").attr("selected","selected")),$("#exim").append($("<option>").text("Default").attr("value","default")),$.each(t,function(t,e){$("#exim").append($("<option>").text(e.title).attr("value",e.id))})}})}),$("#exim").change(function(){$(".portalMessage").remove(),$("#intermediate").toggle(!1),""==$(this).val()?$("#import_form").empty():$("#import_form").load(window.location.href.replace("/import","/getImportTemplate"),{_authenticator:$('input[name="_authenticator"]').val(),exim:$(this).val()})}),$("select#exim").change(function(){setTimeout(function(){$("select#analysis_service").bind("select change",function(){""!=$("select#analysis_service").val()?$("div#default_result").fadeIn():$("div#default_result").fadeOut()})},800)}),$("[name='firstsubmit']").live("click",function(t){return t.preventDefault(),$(".portalMessage").remove(),0==$("#intermediate").length&&$("#import_form").after("<div id='intermediate'></div>"),$("#intermediate").toggle(!1),form=$(this).parents("form"),options={target:$("#intermediate"),data:JSON.stringify(form.formToArray()),dataType:"json",processData:!1,success:function(t,e,i,n){$("#intermediate").empty(),0<t.log.length&&(str="<div class='alert alert-info'>",str+="<h3>"+_t("Log trace")+"</h3><ul>",$.each(t.log,function(t,e){str+="<li>"+e+"</li>"}),str+="</ul></div>",$("#intermediate").append(str).toggle(!0)),0<t.errors.length&&(str="<div class='alert alert-danger'>",str+="<h3>"+_t("Errors")+"</h3><ul>",$.each(t.errors,function(t,e){str+="<li><code>"+e+"</code></li>"}),str+="</ul></div>",$("#intermediate").append(str).toggle(!0)),0<t.warns.length&&(str="<div class='alert alert-warning'>",str+="<h3>"+_t("Warnings")+"</h3><ul>",$.each(t.warns,function(t,e){str+="<li>"+e+"</li>"}),str+="</ul></div>",$("#intermediate").append(str).toggle(!0))},error:function(t,e,i){$("#intermediate").empty(),str="<div class='alert alert-danger'>",str+="<h3>"+_t("Errors found")+"</h3><ul>",str+="<li>"+e,str+="<pre>"+i+"</pre></li></ul></div>",$("#intermediate").append(str).toggle(!0)}},form.ajaxSubmit(options),!1})}}function InstrumentCertificationEditView(){function t(){$("#Internal").is(":checked")?$("#archetypes-fieldname-Agency").hide():$("#archetypes-fieldname-Agency").fadeIn("slow")}this.load=function(){$("#Internal").live("change",function(){t()}),t()}}function InstrumentEditView(){this.load=function(){$("#ResultFilesFolder_more").remove();var t=$(".records_row_ResultFilesFolder");for(i=0;i<t.length;i++)(0<i&&i==t.length-1?t[i]:t[i].children[2]).remove()},$("#ImportDataInterface").change(function(){!function(){var t,e=$("#ResultFilesFolder_table"),n=$(".records_row_ResultFilesFolder"),a=$("#ImportDataInterface").val();if(n.remove(),null==a||1==a.length&&""==a[0]){var s=$(n[n.length-1]).clone();for(i=0;i<$(s).children().length;i++){var r=$(s).children()[i],r=$(r).children()[0];$(r).val("")}$(s).appendTo($(e))}else{for(i=0;i<a.length;i++)""!=a[i]&&(s=$(n[n.length-1]).clone(),t=$(s).children()[0],t=$(t).children()[0],$(t).val(a[i]),t=$(s).children()[1],t=$(t).children()[0],$(t).val(""),$(s).appendTo($(e)));!function(){$("#ResultFilesFolder_table");var t=$(".records_row_ResultFilesFolder");for(i=0;i<t.length;i++){var e=$(t[i]).find("input[id^='ResultFilesFolder']");for(j=0;j<e.length;j++){var n=e[j].id,n=n.split("-")[0]+"-"+n.split("-")[1];$(e[j]).attr("id",n+"-"+i)}}}()}}()})}function InstrumentReferenceAnalysesView(){function i(t){var n=$("#selqcsample").val();$("#selqcsample option").remove(),$.map(t,function(t,e){var i=e==n?" selected":"";$("#selqcsample").append('<option value="'+e+'"'+i+">"+e+"</option>")})}function n(){var e=(e=$("#selanalyses").val().split("("))[e.length-1].slice(0,-1).trim(),i=$("#selqcsample").val(),n=0;$("div.results-info").remove(),$(".item-listing-tbody tr").each(function(t){$(this).attr("keyword")!=e||$(this).find("td.Partition a").html()!=i?$(this).hide():($(this).fadeIn(),n+=1)}),$(".bika-listing-table").closest("div").before('<div class="results-info">'+n+" results found</div>")}function a(t,e){var i=$("#selanalyses").val(),n=$("#selqcsample").val(),a=$("#interpolation").val();null==t&&$("#chart").innerWidth(),null==e&&$("#chart").innerHeight();$("#chart").css("width",t),$("#chart").css("height",e),$("#chart").html(""),$("#chart").show();var s,r,o,l=(l=$.parseJSON($("#graphdata").val()))[i];n in l&&0!=l[n].length?(o=(l=l[n])[l.length-1].unit,s=l[l.length-1].upper,r=l[l.length-1].lower,t=l[l.length-1].target,e="Result",""==o||void 0===o?o="":e=o,i=$.trim("UCL ("+s+o+")"),n=$.trim("LCL ("+r+o+")"),o=$.trim("CL ("+t+o+")"),chart=new ControlChart,chart.setData(l),chart.setInterpolation(a),chart.setXColumn("date"),chart.setYColumn("result"),chart.setPointId("id"),chart.setYLabel(e),chart.setXLabel("Date"),chart.setUpperLimitText(i),chart.setLowerLimitText(n),chart.setCenterLimitText(o),chart.setCenterLimit(t),chart.setUpperLimit(s),chart.setLowerLimit(r),chart.draw("#chart")):$("#chart").hide()}this.load=function(){var e=$.parseJSON($("#graphdata").val());$.map(e,function(t,e){$("#selanalyses").append('<option value="'+e+'">'+e+"</option>")}),$("#selanalyses").val()&&(i(e[$("#selanalyses").val()]),n(),a(null,null)),$("#selanalyses").change(function(t){i(e[$("#selanalyses").val()]),a(null,null),n()}),$("#selqcsample").change(function(t){a(null,null),n()}),$("#interpolation").change(function(t){a(null,null)}),$(".item-listing-tbody tr").mouseover(function(t){var e;""!=$(this).attr("uid")&&($(this).addClass("selected"),e=$(this).attr("uid"),$("#chart svg g circle#"+e).trigger("__onmouseover"))}),$(".item-listing-tbody tr").mouseout(function(t){var e;$(this).removeClass("selected"),""!=$(this).attr("uid")&&(e=$(this).attr("uid"),$("#chart svg g circle#"+e).trigger("__onmouseout"))}),$("#printgraph").click(function(t){t.preventDefault();a(670,$("#chart").attr("height"));var e=window.open("","","left=0,top=0,width=800,height=900,toolbar=0,scrollbars=0,status=0"),i='<link href="'+window.portal_url+'/++resource++bika.lims.css/print-graph.css" type="text/css" rel="stylesheet">',n=$("span.documentFirstHeading").closest("h1").clone(),t=$("#content-core").clone();$(t).prepend(n),$(t).find("#selanalyses").after("<span class='bold'>"+$("#selanalyses").val()+"</span>"),$(t).find("#interpolation").after("<span class='bold'>"+$("#interpolation").val()+"</span>"),$(t).find("#selqcsample").after("<span class='bold'>"+$("#selqcsample").val()+"</span>"),$(t).find("#selanalyses").hide(),$(t).find("#interpolation").hide(),$(t).find("#selqcsample").hide(),e.document.write("<html><head>"+i+"</head><body>"+$(t).html()+"</body></html>"),e.document.close(),e.focus(),e.print(),$("#chart").css("width","100%"),$("#chart").removeAttr("height"),a(null,null),e.close()}),$("div.bika-listing-table-container").fadeIn()}}function MethodEditView(){this.load=function(){}}function ReferenceSampleAnalysesView(){function e(){var e=(e=$("#selanalyses").val().split("("))[e.length-1].slice(0,-1).trim(),i=0;$("div.results-info").remove(),$(".item-listing-tbody tr").each(function(t){$(this).attr("keyword")!=e?$(this).hide():($(this).fadeIn(),i+=1)}),$(".bika-listing-table").closest("div").before('<div class="results-info">'+i+" results found</div>")}function a(t,e){var i=$("#selanalyses").val(),n=$("#selqcsample").val(),a=$("#interpolation").val();null==t&&$("#chart").innerWidth(),null==e&&$("#chart").innerHeight();$("#chart").css("width",t),$("#chart").css("height",e),$("#chart").html(""),$("#chart").show();var s,r,o,l=(l=$.parseJSON($("#graphdata").val()))[i];n in l&&0!=l[n].length?(o=(l=l[n])[l.length-1].unit,s=l[l.length-1].upper,r=l[l.length-1].lower,t=l[l.length-1].target,e="Result",""==o||void 0===o?o="":e=o,i=$.trim("UCL ("+s+o+")"),n=$.trim("LCL ("+r+o+")"),o=$.trim("CL ("+t+o+")"),chart=new ControlChart,chart.setData(l),chart.setInterpolation(a),chart.setXColumn("date"),chart.setYColumn("result"),chart.setPointId("id"),chart.setYLabel(e),chart.setXLabel("Date"),chart.setUpperLimitText(i),chart.setLowerLimitText(n),chart.setCenterLimitText(o),chart.setCenterLimit(t),chart.setUpperLimit(s),chart.setLowerLimit(r),chart.draw("#chart")):$("#chart").hide()}this.load=function(){var t=$.parseJSON($("#graphdata").val()),i=!1;$.map(t,function(t,e){$("#selanalyses").append('<option value="'+e+'">'+e+"</option>"),0==i&&($.map(t,function(t,e){$("#selqcsample").val(e)}),i=!0)}),$("#selanalyses").val()&&(e(),a(null,null)),$("#selanalyses").change(function(t){a(null,null),e()}),$("#interpolation").change(function(t){a(null,null)}),$(".item-listing-tbody tr").mouseover(function(t){var e;""!=$(this).attr("uid")&&($(this).addClass("selected"),e=$(this).attr("uid"),$("#chart svg g circle#"+e).trigger("__onmouseover"))}),$(".item-listing-tbody tr").mouseout(function(t){var e;$(this).removeClass("selected"),""!=$(this).attr("uid")&&(e=$(this).attr("uid"),$("#chart svg g circle#"+e).trigger("__onmouseout"))}),$("#printgraph").click(function(t){t.preventDefault(),$("#selanalyses").find("option[selected]").remove(),$("#selanalyses").find('option[value="'+$(selanalyses).val()+'"]').prop("selected",!0);a(670,$("#chart").attr("height"));var e=window.open("","","left=0,top=0,width=800,height=900,toolbar=0,scrollbars=0,status=0"),i='<link href="'+window.portal_url+'/++resource++bika.lims.css/print-graph.css" type="text/css" rel="stylesheet">',n=$("span.documentFirstHeading").closest("h1").clone(),t=$("#content-core").clone();$(t).prepend(n),$(t).find("#selanalyses").after("<span class='bold'>"+$("#selanalyses").val()+"</span>"),$(t).find("#interpolation").after("<span class='bold'>"+$("#interpolation").val()+"</span>"),$(t).find("#selanalyses").hide(),$(t).find("#interpolation").hide(),e.document.write("<html><head>"+i+"</head><body>"+$(t).html()+"</body></html>"),e.document.close(),e.focus(),e.print(),e.close(),$("#chart").css("width","100%"),$("#chart").removeAttr("height"),a(null,null)}),$("div.bika-listing-table-container").fadeIn()}}function ReflexRuleEditView(){this.load=function(){}}function RejectionKickOff(){this.load=function(){window.bika.lims.jsonapi_read({catalog_name:"portal_catalog",portal_type:"BikaSetup",include_fields:["RejectionReasons"]},function(t){var e;t.success&&0<t.total_objects&&(0<(t=t.objects[0].RejectionReasons).length&&(e=t[0].checkbox),void 0!==e&&"on"==e||$("a#workflow-transition-reject").closest("li").hide())}),function(){"use strict";var t,e;0<$("div#archetypes-fieldname-RejectionWidget").length&&($("a#workflow-transition-reject").unbind(),$("a#workflow-transition-reject").bind("click",function(t){t.preventDefault(),$("#semioverlay").show(),$('input[id="RejectionReasons.checkbox"]').click().prop("disabled",!0)}),t=$("#archetypes-fieldname-RejectionWidget").parent("td"),e="<div class='semioverlay-head'>"+$(t).prev("td").html().trim()+"</div>",$("#content").prepend("<div id='semioverlay' style='display:none'> <div class='semioverlay-back'> </div> <div class='semioverlay-panel'> <div class='semioverlay-content'></div> <div class='semioverlay-buttons'> <input type='button' name='semioverlay.reject' value='reject'/> <input type='button' name='semioverlay.cancel' value='cancel'/></div></div></div>"),$("#archetypes-fieldname-RejectionWidget").detach().prependTo("#semioverlay .semioverlay-content"),$(t).hide(),$(e).detach().insertBefore(".semioverlay-content"),$("div#semioverlay input[name='semioverlay.cancel']").bind("click",function(){$("#semioverlay").hide(),$('input[id="RejectionReasons.checkbox"]').prop("checked",!1).prop("disabled",!1),$('input[id="RejectionReasons.checkbox.other"]').prop("checked",!1),$('input[id="RejectionReasons.textfield.other"]').val("");for(var t=$(".rejectionwidget-multiselect").find("option"),e=0;t.length>e;e++)$(t[e]).attr("selected",!1)}),$("div#semioverlay input[name='semioverlay.reject']").bind("click",function(){$("div#semioverlay .semioverlay-panel").fadeOut(),function(){var t={},e=window.location.href.replace("/base_view","").replace("/analyses","").replace("/manage_results","").replace("/not_requested","").replace("/log","").replace(window.portal_url,""),i=$("a#workflow-transition-reject").attr("href");t.obj_path=e,e=function(){var t,e=0,i=[],n=0,a="";if(e=$(".rejectionwidget-checkbox").prop("checked")){e=1;for(var s=$(".rejectionwidget-multiselect").find("option"),r=0;s.length>r;r++)(t=s[r]).selected&&i.push($(t).val());(n=$(".rejectionwidget-checkbox-other").prop("checked"))?(n=1,a=$(".rejectionwidget-input-other").val()):n=0}else e=0;a={checkbox:e,selected:i,checkbox_other:n,other:a};return $.toJSON(a)}(),t.RejectionReasons=e;var n="";$.ajax({type:"POST",url:window.portal_url+"/@@API/update",data:t}).done(function(t){var e;null!==t&&!0===t.success?(bika.lims.SiteView.notificationPanel("Rejecting","succeed"),$("body").hasClass("portaltype-sample")?(e=$('input[name="_authenticator"]').val(),$.ajax({url:window.location.href+"/doActionForSample?workflow_action=reject&_authenticator="+e,type:"POST",dataType:"json"}).done(function(t){null!==t&&"true"==t.success?window.location.href=window.location.href:(bika.lims.SiteView.notificationPanel("Error while updating object state","error"),t="[bika.lims.analysisrequest.js] Error while updating object state",window.bika.lims.error(t),$('#semioverlay input[name="semioverlay.cancel"]').click())})):(bika.lims.SiteView.notificationPanel("Rejecting","succeed"),window.location.href=i)):(n=!1===t.success?(bika.lims.SiteView.notificationPanel("Error while rejecting the analysis request. Unsuccesful AJAX call.","error"),"[bika.lims.analysisrequest.js] Error while rejecting the analysis request. Unsuccesful AJAX call."):(bika.lims.SiteView.notificationPanel("Error while rejecting the analysis request. No data returned.","error"),"[bika.lims.analysisrequest.js] Error while rejecting the analysis request. No data returned."),window.bika.lims.error(n),$('#semioverlay input[name="semioverlay.cancel"]').click())}).fail(function(){bika.lims.SiteView.notificationPanel("Error while rejection the analysis request. AJAX POST failed.","error");var t="[bika.lims.analysisrequest.js] Error while rejection the analysis request. AJAX POST failed.";window.bika.lims.error(t),$('#semioverlay input[name="semioverlay.cancel"]').click()})}()}))}()}}function BarcodeUtils(){this.load=function(){$(".qrcode").each(function(t){var e=$(this).attr("data-code"),i=$(this).attr("data-size");$(this).qrcode({render:"image",size:i,color:"#3a3",text:e})}),$(".barcode").each(function(){var t=$(this).attr("data-id"),e=$(this).attr("data-code"),i=$(this).attr("data-barHeight"),n=$(this).attr("data-addQuietZone"),a=$(this).attr("data-showHRI");$(this).barcode(t,e,{barHeight:parseInt(i),addQuietZone:"true"==n,showHRI:"true"==a,output:"bmp"}),"true"==a&&($(this).find(".barcode-hri").remove(),t='<div class="barcode-hri">'+t+"</div>",$(this).append(t))})}}function WorksheetPrintView(){function a(){$(".barcode").each(function(){var t=$(this).attr("data-id"),e=$(this).attr("data-code"),i=$(this).attr("data-barHeight"),n=$(this).attr("data-addQuietZone"),a=$(this).attr("data-showHRI");$(this).barcode(t,e,{barHeight:parseInt(i),addQuietZone:Boolean(n),showHRI:Boolean(a)})})}this.load=function(){var e=document.referrer;e?bika.lims.SiteView.setCookie("ws.print.urlback",e):e=(e=bika.lims.SiteView.readCookie("ws.print.urlback"))||portal_url,a(),$("#print_button").click(function(t){t.preventDefault(),window.print()}),$("#cancel_button").click(function(t){t.preventDefault(),location.href=e}),$("#template").change(function(t){var e=window.location.href,i=$(this).val(),n=$("#numcols").val();$("#worksheet-printview").animate({opacity:.2},"slow"),$.ajax({url:e,type:"POST",data:{template:i,numcols:n}}).always(function(t){var e=t,t=$(e).find("#report-style").html();$("#report-style").html(t),e=$(e).find("#worksheet-printview").html(),$("#worksheet-printview").html(e),$("#worksheet-printview").animate({opacity:1},"slow"),a()})}),$("#numcols").change(function(t){var e=window.location.href,i=$(this).val(),n=$("#template").val();$("#worksheet-printview").animate({opacity:.2},"slow"),$.ajax({url:e,type:"POST",data:{template:n,numcols:i}}).always(function(t){var e=t,t=$(e).find("#report-style").html();$("#report-style").html(t),e=$(e).find("#worksheet-printview").html(),$("#worksheet-printview").html(e),$("#worksheet-printview").animate({opacity:1},"slow"),a()})})}}function WorksheetTemplateEdit(){this.load=function(){var t=$("#archetypes-fieldname-RestrictToMethod").find("select");$(t).bind("change",function(t,e){var i;i=this,i=$(i).val(),$.ajax({url:window.portal_url+"/ajaxgetworksheettemplateinstruments",type:"POST",data:{_authenticator:$('input[name="_authenticator"]').val(),method_uid:JSON.stringify(i)},dataType:"json"}).done(function(t){var e,i;if(null!==t&&$.isArray(t))for(e=$("#archetypes-fieldname-Instrument").find("select"),$(e).find("option").remove(),i=0;t.length>i;i++)$(e).append('<option value="'+t[i].uid+'">'+t[i].m_title+"</option>")}).fail(function(){window.bika.lims.log("bika.lims.worksheettemplate: Something went wrong while retrieving instrument list")})})}}(function(){window.AnalysisRequestView=function(){var t=function(t){var e;t.preventDefault(),e=t.currentTarget.href.replace("content_status_modify","workflow_action"),0<(t=$("#PublicationSpecification_uid")).length&&(e=e+"&PublicationSpecification="+$(t).val()),window.location.href=e},e=function(){var n,t=$("#workflow-transition-schedule_sampling").attr("href");t&&(n=t.replace("content_status_modify","workflow_action"),$("#workflow-transition-schedule_sampling").attr("href",n),$("#workflow-transition-schedule_sampling").click(function(){var t,e=$("#SamplingDate").val(),i=$("#ScheduledSamplingSampler").val();""!==e&&null!=e&&""!==i&&null!=i?window.location.href=n:((t="")!==e&&null!=e||(t+=PMF("${name} is required for this action, please correct.",{name:_("Sampling Date")})),""!==i&&null!=i||(""!==t&&(t+="<br/>"),t+=PMF("${name} is required, please correct.",{name:_("'Define the Sampler for the shceduled'")})),""!==t&&window.bika.lims.portalMessage(t))}))},i=function(){$("#interpretationtemplate-insert").click(function(t){var e,i;t.preventDefault(),(t=$("#interpretationtemplate").val())&&1===(e=$('div[id^="ResultsInterpretationDepts-"].active  textarea[id^="ResultsInterpretationDepts-richtext-"]')).length&&(i=e.attr("id"),t={catalog_name:"uid_catalog",UID:t,include_fields:["text"]},window.bika.lims.jsonapi_read(t,function(t){if(1===t.objects.length)return t=t.objects[0].text,tinymce.get(i).insertContent(t)}))})};this.load=function(){$("a[id^='workflow-transition']").not("#workflow-transition-schedule_sampling").not("#workflow-transition-sample").click(t),e(),i()}},window.AnalysisRequestViewView=function(){this.load=function(){}},window.AnalysisRequestAnalysesView=function(){this.load=function(){}}}).call(this),function(){function t(t,e){return function(){return t.apply(e,arguments)}}var r=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1};function e(){this.on_partition_required_volume_change=t(this.on_partition_required_volume_change,this),this.on_partition_container_change=t(this.on_partition_container_change,this),this.on_partition_separate_container_change=t(this.on_partition_separate_container_change,this),this.on_partition_sampletype_change=t(this.on_partition_sampletype_change,this),this.on_default_container_change=t(this.on_default_container_change,this),this.on_default_preservation_change=t(this.on_default_preservation_change,this),this.on_separate_container_change=t(this.on_separate_container_change,this),this.on_calculation_change=t(this.on_calculation_change,this),this.on_use_default_calculation_change=t(this.on_use_default_calculation_change,this),this.on_default_method_change=t(this.on_default_method_change,this),this.on_default_instrument_change=t(this.on_default_instrument_change,this),this.on_instruments_change=t(this.on_instruments_change,this),this.on_instrument_assignment_allowed_change=t(this.on_instrument_assignment_allowed_change,this),this.on_methods_change=t(this.on_methods_change,this),this.on_manual_entry_of_results_change=t(this.on_manual_entry_of_results_change,this),this.toggle_checkbox=t(this.toggle_checkbox,this),this.select_options=t(this.select_options,this),this.parse_select_option=t(this.parse_select_option,this),this.parse_select_options=t(this.parse_select_options,this),this.add_select_option=t(this.add_select_option,this),this.is_uid=t(this.is_uid,this),this.get_portal_url=t(this.get_portal_url,this),this.get_url=t(this.get_url,this),this.ajax_submit=t(this.ajax_submit,this),this.load_object_by_uid=t(this.load_object_by_uid,this),this.load_manual_interims=t(this.load_manual_interims,this),this.load_calculation=t(this.load_calculation,this),this.load_method_calculation=t(this.load_method_calculation,this),this.load_instrument_methods=t(this.load_instrument_methods,this),this.load_available_instruments=t(this.load_available_instruments,this),this.show_alert=t(this.show_alert,this),this.set_instrument_methods=t(this.set_instrument_methods,this),this.set_method_calculation=t(this.set_method_calculation,this),this.flush_interims=t(this.flush_interims,this),this.set_interims=t(this.set_interims,this),this.get_interims=t(this.get_interims,this),this.select_calculation=t(this.select_calculation,this),this.set_calculation=t(this.set_calculation,this),this.get_calculation=t(this.get_calculation,this),this.toggle_use_default_calculation_of_method=t(this.toggle_use_default_calculation_of_method,this),this.use_default_calculation_of_method=t(this.use_default_calculation_of_method,this),this.select_default_instrument=t(this.select_default_instrument,this),this.set_default_instrument=t(this.set_default_instrument,this),this.get_default_instrument=t(this.get_default_instrument,this),this.select_default_method=t(this.select_default_method,this),this.set_default_method=t(this.set_default_method,this),this.get_default_method=t(this.get_default_method,this),this.select_instruments=t(this.select_instruments,this),this.set_instruments=t(this.set_instruments,this),this.get_instruments=t(this.get_instruments,this),this.toggle_instrument_assignment_allowed=t(this.toggle_instrument_assignment_allowed,this),this.is_instrument_assignment_allowed=t(this.is_instrument_assignment_allowed,this),this.select_methods=t(this.select_methods,this),this.set_methods=t(this.set_methods,this),this.get_methods=t(this.get_methods,this),this.toggle_manual_entry_of_results_allowed=t(this.toggle_manual_entry_of_results_allowed,this),this.is_manual_entry_of_results_allowed=t(this.is_manual_entry_of_results_allowed,this),this.init=t(this.init,this),this.bind_eventhandler=t(this.bind_eventhandler,this),this.load=t(this.load,this)}window.AnalysisServiceEditView=(e.prototype.load=function(){var t,e;return this.all_instruments={},this.invalid_instruments={},t=this.load_available_instruments().done(function(t){var n=this;return $.each(t,function(t,e){var i=e.UID;if("1"!==(n.all_instruments[i]=e).Valid)return n.invalid_instruments[i]=e})}),this.manual_interims=[],e=this.load_manual_interims().done(function(t){return this.manual_interims=t}),this.selected_methods=this.get_methods(),this.selected_instruments=this.get_instruments(),this.selected_calculation=this.get_calculation(),this.selected_default_instrument=this.get_default_instrument(),this.selected_default_method=this.get_default_method(),this.methods=this.parse_select_options($("#archetypes-fieldname-Methods #Methods")),this.instruments=this.parse_select_options($("#archetypes-fieldname-Instruments #Instruments")),this.calculations=this.parse_select_options($("#archetypes-fieldname-Calculation #Calculation")),this.bind_eventhandler(),$.when(t,e).then(this.init),window.asv=this},e.prototype.bind_eventhandler=function(){return $("body").on("change","#archetypes-fieldname-ManualEntryOfResults #ManualEntryOfResults",this.on_manual_entry_of_results_change),$("body").on("change","#archetypes-fieldname-Methods #Methods",this.on_methods_change),$("body").on("change","#archetypes-fieldname-InstrumentEntryOfResults #InstrumentEntryOfResults",this.on_instrument_assignment_allowed_change),$("body").on("change","#archetypes-fieldname-Instruments #Instruments",this.on_instruments_change),$("body").on("change","#archetypes-fieldname-Instrument #Instrument",this.on_default_instrument_change),$("body").on("change","#archetypes-fieldname-Method #Method",this.on_default_method_change),$("body").on("change","#archetypes-fieldname-UseDefaultCalculation #UseDefaultCalculation",this.on_use_default_calculation_change),$("body").on("change","#archetypes-fieldname-Calculation #Calculation",this.on_calculation_change),$("body").on("change","#archetypes-fieldname-Separate #Separate",this.on_separate_container_change),$("body").on("change","#archetypes-fieldname-Preservation #Preservation",this.on_default_preservation_change),$("body").on("selected","#archetypes-fieldname-Container #Container",this.on_default_container_change),$("body").on("change","#archetypes-fieldname-PartitionSetup [name^='PartitionSetup.sampletype']",this.on_partition_sampletype_change),$("body").on("change","#archetypes-fieldname-PartitionSetup [name^='PartitionSetup.separate']",this.on_partition_separate_container_change),$("body").on("change","#archetypes-fieldname-PartitionSetup [name^='PartitionSetup.container']",this.on_partition_container_change),$("body").on("change","#archetypes-fieldname-PartitionSetup [name^='PartitionSetup.vol']",this.on_partition_required_volume_change)},e.prototype.init=function(){this.is_manual_entry_of_results_allowed()?this.set_methods(this.methods):this.set_methods(null),this.is_instrument_assignment_allowed()?this.set_instruments(this.instruments):this.set_instruments(null),this.use_default_calculation_of_method()},e.prototype.is_manual_entry_of_results_allowed=function(){return $("#archetypes-fieldname-ManualEntryOfResults #ManualEntryOfResults").is(":checked")},e.prototype.toggle_manual_entry_of_results_allowed=function(t,e){var i;return null==e&&(e=!0),i=$("#archetypes-fieldname-ManualEntryOfResults #ManualEntryOfResults"),this.toggle_checkbox(i,t,e)},e.prototype.get_methods=function(){var t=$("#archetypes-fieldname-Methods #Methods");return $.extend([],t.val())},e.prototype.set_methods=function(t,e){var n,a;return null==e&&(e=!0),n=$("#archetypes-fieldname-Methods #Methods"),t=$.extend([],t),e&&n.empty(),0===t.length?this.add_select_option(n,null):(a=this,$.each(t,function(t,e){var i;if(!1!==e.ManualEntryOfResults)return i=e.title||e.Title,e=e.uid||e.UID,a.add_select_option(n,i,e)})),this.select_methods(this.selected_methods)},e.prototype.select_methods=function(t){var i,n;if(this.is_manual_entry_of_results_allowed())return i=$("#archetypes-fieldname-Methods #Methods"),this.select_options(i,t),n=this,$.each(t,function(t,e){var t=0===t,e=i.find("option[value="+e+"]"),e={uid:e.val(),title:e.text()};return n.set_default_method(e,t)}),this.select_default_method(this.selected_default_method),this.use_default_calculation_of_method()?this.set_method_calculation(this.get_default_method()):void 0},e.prototype.is_instrument_assignment_allowed=function(){return $("#archetypes-fieldname-InstrumentEntryOfResults #InstrumentEntryOfResults").is(":checked")},e.prototype.toggle_instrument_assignment_allowed=function(t,e){var i;return null==e&&(e=!0),i=$("#archetypes-fieldname-InstrumentEntryOfResults #InstrumentEntryOfResults"),this.toggle_checkbox(i,t,e)},e.prototype.get_instruments=function(){var t=$("#archetypes-fieldname-Instruments #Instruments");return $.extend([],t.val())},e.prototype.set_instruments=function(t,e){var n,a;return null==e&&(e=!0),n=$("#archetypes-fieldname-Instruments #Instruments"),t=$.extend([],t),e&&n.empty(),0===t.length?this.add_select_option(n,null):(a=this,$.each(t,function(t,e){var i=e.uid||e.UID,e=e.title||e.Title;return a.add_select_option(n,e,i)})),this.select_instruments(this.selected_instruments)},e.prototype.select_instruments=function(t){var e,n,a,i;if(this.is_instrument_assignment_allowed())return e=$("#archetypes-fieldname-Instruments #Instruments"),this.select_options(e,t),n=[],a=this,$.each(t,function(t,e){var i=0===t,t=a.all_instruments[e];return e in a.invalid_instruments&&n.push(t),a.set_default_instrument(t,i)}),0<n.length?(i=$("<dl/>"),$.each(n,function(t,e){return i.append("<dd>⚠ "+e.Title+"</dd>")}),t=_t("Some of the selected instruments are out-of-date, with failed calibration tests or under maintenance"),this.show_alert({title:t,message:i[0].outerHTML})):this.show_alert({message:""}),this.select_default_instrument(this.selected_default_instrument),this.set_instrument_methods(this.get_default_instrument());this.set_default_instrument(null)},e.prototype.get_default_method=function(){return $("#archetypes-fieldname-Method #Method").val()},e.prototype.set_default_method=function(t,e){var i;return null==e&&(e=!0),i=$("#archetypes-fieldname-Method #Method"),t=$.extend({},t),e&&i.empty(),e=t.title||t.Title,t=t.uid||t.UID,e&&t?this.add_select_option(i,e,t):this.add_select_option(i,null)},e.prototype.select_default_method=function(t){var e=$("#archetypes-fieldname-Method #Method");return this.select_options(e,[t])},e.prototype.get_default_instrument=function(){return $("#archetypes-fieldname-Instrument #Instrument").val()},e.prototype.set_default_instrument=function(t,e){var i;return null==e&&(e=!0),i=$("#archetypes-fieldname-Instrument #Instrument"),t=$.extend({},t),e&&i.empty(),e=t.title||t.Title,t=t.uid||t.UID,e&&t?this.add_select_option(i,e,t):this.add_select_option(i,null)},e.prototype.select_default_instrument=function(t){var e=$("#archetypes-fieldname-Instrument #Instrument");return this.select_options(e,[t])},e.prototype.use_default_calculation_of_method=function(){return $("#archetypes-fieldname-UseDefaultCalculation #UseDefaultCalculation").is(":checked")},e.prototype.toggle_use_default_calculation_of_method=function(t,e){var i;return null==e&&(e=!0),i=$("#archetypes-fieldname-UseDefaultCalculation #UseDefaultCalculation"),this.toggle_checkbox(i,t,e)},e.prototype.get_calculation=function(){return $("#archetypes-fieldname-Calculation #Calculation").val()},e.prototype.set_calculation=function(t,e){var i;return null==e&&(e=!0),i=$("#archetypes-fieldname-Calculation #Calculation"),t=$.extend({},t),e&&i.empty(),e=t.title||t.Title,t=t.uid||t.UID,e&&t?this.add_select_option(i,e,t):this.add_select_option(i,null)},e.prototype.select_calculation=function(t){var e=$("#archetypes-fieldname-Calculation #Calculation");return this.select_options(e,[t]),this.load_calculation(t).done(function(t){return this.set_interims(t.InterimFields)})},e.prototype.get_interims=function(){var t=$("#archetypes-fieldname-InterimFields").find("tr.records_row_InterimFields"),i=[];return $.each(t,function(t,e){var a={},e=e.querySelectorAll("td input");return $.each(e,function(t,e){var i=this.name.split(":")[0].split(".")[1],n=e.value;return"checkbox"===e.type&&(n=e.checked),a[i]=n,!0}),""!==a.keyword&&i.push(a),!0}),i},e.prototype.set_interims=function(n,t){var i,a,s;return null==t&&(t=!0),n=$.extend([],n),i=$("#archetypes-fieldname-InterimFields"),s=i.find("#InterimFields_more"),t&&this.flush_interims(),a=n.map(function(t){return t.keyword}),$.each(this.manual_interims,function(t,e){var i=a.indexOf(e.keyword);return 0<=i?n[i]=e:n.push(e)}),$.each(n,function(t,n){var e=i.find("tr.records_row_InterimFields").last();return s.click(),e=e.find("input"),$.each(e,function(t,e){var i=this.name.split(":")[0].split(".")[1],i=n[i];return"checkbox"===e.type?(e.checked=i,e.value="on"):(i=i||"",e.value=i),!0})})},e.prototype.flush_interims=function(){var t=$("#archetypes-fieldname-InterimFields");return t.find("#InterimFields_more").click(),t.find("tr.records_row_InterimFields").not(":last").remove()},e.prototype.set_method_calculation=function(t){return this.is_uid(t)?this.load_method_calculation(t).done(function(t){return this.set_calculation(t),this.set_interims(t.InterimFields)}):(this.set_interims(null),this.set_calculation(null))},e.prototype.set_instrument_methods=function(t,i){var n;if(null==i&&(i=!0),(n=this).is_uid(t))return this.load_instrument_methods(t).done(function(t){if(t=$.extend([],t),$.each(t,function(t,e){return i=0===t,n.set_default_method(e,i)}),this.select_default_method(this.selected_default_method),this.use_default_calculation_of_method())return this.set_method_calculation(this.get_default_method())})},e.prototype.show_alert=function(t){var e=t.title||"",i=t.message||"",n=t.level||"warning",a=t.flush||!0,t=$("#viewlet-above-content #alerts");return 0===t.length&&$("#viewlet-above-content").append("<div id='alerts'></div>"),t=$("#viewlet-above-content #alerts"),a&&t.empty(),""===i&&t.remove(),i='<div class="alert alert-'+n+' errorbox" role="alert">\n  <h3>'+e+"</h3>\n  <div>"+i+"</div>\n</div>",t.append(i)},e.prototype.load_available_instruments=function(){var e=$.Deferred(),t={url:this.get_portal_url()+"/@@API/read",data:{catalog_name:"bika_setup_catalog",page_size:0,portal_type:"Instrument"}};return this.ajax_submit(t).done(function(t){return t.objects?e.resolveWith(this,[t.objects]):e.resolveWith(this,[[]])}),e.promise()},e.prototype.load_instrument_methods=function(t){var e=$.Deferred();return this.is_uid(t)?(t={url:this.get_portal_url()+"/get_instrument_methods",data:{uid:t}},this.ajax_submit(t).done(function(t){return t.methods||e.resolveWith(this,[[]]),e.resolveWith(this,[t.methods])})):e.resolveWith(this,[[]]),e.promise()},e.prototype.load_method_calculation=function(t){var e=$.Deferred();return this.is_uid(t)?(t={url:this.get_portal_url()+"/get_method_calculation",data:{uid:t}},this.ajax_submit(t).done(function(t){return this.is_uid(t.uid)?this.load_calculation(t.uid).done(function(t){return e.resolveWith(this,[t])}):e.resolveWith(this,[{}])})):e.resolveWith(this,[{}]),e.promise()},e.prototype.load_calculation=function(t){var i=$.Deferred();return this.is_uid(t)?(t={url:this.get_portal_url()+"/@@API/read",data:{catalog_name:"bika_setup_catalog",page_size:0,UID:t,is_active:!0,sort_on:"sortable_title"}},this.ajax_submit(t).done(function(t){var e={};return 1===t.objects.length&&(e=t.objects[0]),i.resolveWith(this,[e])})):i.resolveWith(this,[{}]),i.promise()},e.prototype.load_manual_interims=function(){var e=$.Deferred();return this.load_calculation(this.get_calculation()).done(function(t){var n=$.extend([],t.InterimFields),a=n.map(function(t){return t.keyword}),s=[];return $.each(this.get_interims(),function(t,i){var e=i.keyword;return r.call(a,e)<0?s.push(i):(e=a.indexOf(i.keyword),e=n[e],$.each(e,function(t,e){if(e!==i[t])return s.push(i),!1}))}),e.resolveWith(this,[s])}),e.promise()},e.prototype.load_object_by_uid=function(t){var i=$.Deferred(),t={url:this.get_portal_url()+"/@@API/read",data:{catalog_name:"uid_catalog",page_size:0,UID:t}};return this.ajax_submit(t).done(function(t){var e={};return 1===t.objects.length&&(e=t.objects[0]),i.resolveWith(this,[e])}),i.promise()},e.prototype.ajax_submit=function(t){var e;return null==t&&(t={}),null==t.type&&(t.type="POST"),null==t.url&&(t.url=this.get_portal_url()),null==t.context&&(t.context=this),null==t.dataType&&(t.dataType="json"),null==t.data&&(t.data={}),null==(e=t.data)._authenticator&&(e._authenticator=$("input[name='_authenticator']").val()),$(this).trigger("ajax:submit:start"),e=function(){return $(this).trigger("ajax:submit:end")},$.ajax(t).done(e)},e.prototype.get_url=function(){var t=window.location;return t.protocol+"//"+t.host+t.pathname},e.prototype.get_portal_url=function(){return window.portal_url},e.prototype.is_uid=function(t){return"string"==typeof t&&null!==t.match(/[a-z0-9]{32}/)},e.prototype.add_select_option=function(t,e,i){e=i?"<option value='"+i+"'>"+_t(e)+"</option>":"<option selected='selected' value=''>"+_t("None")+"</option>";return $(t).append(e)},e.prototype.parse_select_options=function(t){var n=[];return $.each($(t).children(),function(t,e){var i=e.value,e=e.innerText;if(i)return n.push({uid:i,title:e})}),n},e.prototype.parse_select_option=function(t,e){var i=field.find("option[value="+uid+"]");return{uid:i.val()||"",title:i.text()||""}},e.prototype.select_options=function(t,n){return $.each($(t).children(),function(t,e){var i=e.value;if(!(r.call(n,i)<0))return e.selected="selected"})},e.prototype.toggle_checkbox=function(t,e,i){if(null==i&&(i=!0),t=$(t),void 0===e&&(e=!t.is(":checked")),t.prop("checked",e),!i)return t.trigger("change")},e.prototype.on_manual_entry_of_results_change=function(t){return this.is_manual_entry_of_results_allowed()?this.set_methods(this.methods):this.set_methods(null)},e.prototype.on_methods_change=function(t){var e=this.get_methods();return e.length,this.select_methods(e)},e.prototype.on_instrument_assignment_allowed_change=function(t){return this.is_instrument_assignment_allowed()?this.set_instruments(this.instruments):this.set_instruments(null)},e.prototype.on_instruments_change=function(t){var e=this.get_instruments();return e.length,this.select_instruments(e)},e.prototype.on_default_instrument_change=function(t){return this.set_instrument_methods(this.get_default_instrument())},e.prototype.on_default_method_change=function(t){if(this.use_default_calculation_of_method())return this.set_method_calculation(this.get_default_method())},e.prototype.on_use_default_calculation_change=function(t){var i;return this.use_default_calculation_of_method()?this.set_method_calculation(this.get_default_method()):(i=this,$.each(this.calculations,function(t,e){t=0===t;return i.set_calculation(e,t)}),this.selected_calculation?this.select_calculation(this.selected_calculation):this.select_calculation(this.get_calculation()))},e.prototype.on_calculation_change=function(t){return this.select_calculation(this.get_calculation())},e.prototype.on_separate_container_change=function(t){return t.currentTarget.checked},e.prototype.on_default_preservation_change=function(t){},e.prototype.on_default_container_change=function(t){var t=t.currentTarget.getAttribute("uid"),e=$("#archetypes-fieldname-Preservation #Preservation");return this.load_object_by_uid(t).done(function(t){return t?(e.val(t.Preservation),e.prop("disabled",!0)):(e.val(""),e.prop("disabled",!1))})},e.prototype.on_partition_sampletype_change=function(t){var e=t.currentTarget,t=e.value;return this.load_object_by_uid(t).done(function(t){t=t.MinimumVolume||"";return $(e).parents("tr").find("[name^='PartitionSetup.vol']").val(t)})},e.prototype.on_partition_separate_container_change=function(t){},e.prototype.on_partition_container_change=function(t){var e=t.currentTarget,t=e.value,i=$(e).parents("tr").find("[name^='PartitionSetup.preservation']");return this.load_object_by_uid(t).done(function(t){return $.isEmptyObject(t)?$(i).prop("disabled",!1):($(e).val(t.UID),$(i).val(t.Preservation),$(i).prop("disabled",!0))})},e.prototype.on_partition_required_volume_change=function(t){},e)}.call(this),function(){function t(t,e){return function(){return t.apply(e,arguments)}}function e(){this.on_toggle_change=t(this.on_toggle_change,this),this.bind_eventhandler=t(this.bind_eventhandler,this),this.load=t(this.load,this)}window.ReportFolderView=(e.prototype.load=function(){return this.bind_eventhandler()},e.prototype.bind_eventhandler=function(){return $("body").on("click","a[id$='_selector']",this.on_toggle_change)},e.prototype.on_toggle_change=function(t){return t.preventDefault(),$(".criteria").toggle(!1),t=t.currentTarget.id.split("_selector")[0],$("[id='"+t+"']").toggle(!0)},e)}.call(this),function(){function t(t,e){return function(){return t.apply(e,arguments)}}function e(){this.on_service_info_click=t(this.on_service_info_click,this),this.on_reference_definition_list_change=t(this.on_reference_definition_list_change,this),this.on_numeric_field_keypress=t(this.on_numeric_field_keypress,this),this.on_numeric_field_paste=t(this.on_numeric_field_paste,this),this.on_at_float_field_keyup=t(this.on_at_float_field_keyup,this),this.on_at_integer_field_keyup=t(this.on_at_integer_field_keyup,this),this.notify_in_panel=t(this.notify_in_panel,this),this.notificationPanel=t(this.notificationPanel,this),this.set_cookie=t(this.set_cookie,this),this.setCookie=t(this.setCookie,this),this.read_cookie=t(this.read_cookie,this),this.readCookie=t(this.readCookie,this),this.log=t(this.log,this),this.portal_alert=t(this.portal_alert,this),this.portalAlert=t(this.portalAlert,this),this.get_authenticator=t(this.get_authenticator,this),this.get_portal_url=t(this.get_portal_url,this),this.init_referencedefinition=t(this.init_referencedefinition,this),this.init_datepickers=t(this.init_datepickers,this),this.bind_eventhandler=t(this.bind_eventhandler,this),this.load=t(this.load,this)}window.SiteView=(e.prototype.load=function(){return this.init_datepickers(),this.bind_eventhandler(),this.allowed_keys=[8,9,13,35,36,37,39,46,44,60,62,45,69,101,61]},e.prototype.bind_eventhandler=function(){return $("body").on("change","#ReferenceDefinition\\:list",this.on_reference_definition_list_change),$("body").on("keypress",".numeric",this.on_numeric_field_keypress),$("body").on("paste",".numeric",this.on_numeric_field_paste),$("body").on("keyup","input[name*='\\:int'], .ArchetypesIntegerWidget input",this.on_at_integer_field_keyup),$("body").on("keyup","input[name*='\\:float'], .ArchetypesDecimalWidget input",this.on_at_float_field_keyup),$("body").on("click","a.service_info",this.on_service_info_click),$(document).on({ajaxStart:function(){$("body").addClass("loading")},ajaxStop:function(){$("body").removeClass("loading")},ajaxError:function(){$("body").removeClass("loading")}})},e.prototype.init_datepickers=function(){var i,t=new Date,e="1900:"+t.getFullYear(),n=("undefined"!=typeof i18n&&null!==i18n?i18n.currentLanguage:void 0)||"en",a=$.datepicker.regional[n]||$.datepicker.regional[""],n=_t("date_format_short_datepicker");return"date_format_short_datepicker"===n&&(n="yy-mm-dd"),i=Object.assign(a,{dateFormat:n,timeFormat:"HH:mm",showOn:"focus",showAnim:"fadeIn",changeMonth:!0,changeYear:!0,showWeek:!0,yearRange:e,numberOfMonths:1}),e=function(t){var e;return void 0===t&&(t={}),e=Object.assign({},i),Object.assign(e,t)},$("input.datepicker_nofuture").datepicker(e({maxDate:t})),$("input.datepicker").datepicker(e()),$("input.datepicker_2months").datepicker(e({maxDate:t,numberOfMonths:2})),$("input.datetimepicker_nofuture").datetimepicker(e({maxDate:t}))},e.prototype.init_referencedefinition=function(){if(""!==$("#ReferenceDefinition:list").val())return $("#ReferenceDefinition:list").change()},e.prototype.get_portal_url=function(){return window.portal_url},e.prototype.get_authenticator=function(){return window.site.authenticator()},e.prototype.portalAlert=function(t){return this.portal_alert(t)},e.prototype.portal_alert=function(t){var e=$("#portal-alert");0===e.length?$("#portal-header").append("<div id='portal-alert' style='display:none'><div class='portal-alert-item'>"+t+"</div></div>"):e.append("<div class='portal-alert-item'>"+t+"</div>"),e.fadeIn()},e.prototype.log=function(t){return window.bika.lims.log(t)},e.prototype.readCookie=function(t){return window.site.read_cookie(t)},e.prototype.read_cookie=function(t){return window.site.read_cookie(t)},e.prototype.setCookie=function(t,e){return window.site.set_cookie(t,e)},e.prototype.set_cookie=function(t,e){window.site.set_cookie(t,e)},e.prototype.notificationPanel=function(t,e){return this.notify_in_panel(t,e)},e.prototype.notify_in_panel=function(t,e){$("#panel-notification").remove(),t="<div id='panel-notification' style='display:none'><div class='"+e+"-notification-item'>"+t+"</div></div>",$("div#viewlet-above-content-title").append(t),$("#panel-notification").fadeIn("slow","linear",function(){setTimeout(function(){$("#panel-notification").fadeOut("slow","linear")},3e3)})},e.prototype.on_at_integer_field_keyup=function(t){var t=t.currentTarget,t=$(t);/\D/g.test(t.val())&&t.val(t.val().replace(/\D/g,""))},e.prototype.on_at_float_field_keyup=function(t){var t=t.currentTarget,t=$(t);/[^-.\d]/g.test(t.val())&&t.val(t.val().replace(/[^.\d]/g,""))},e.prototype.on_numeric_field_paste=function(t){var t=t.currentTarget,e=$(t);window.setTimeout(function(){e.val(e.val().replace(",","."))},0)},e.prototype.on_numeric_field_keypress=function(t){var e=t.currentTarget,i=$(e),n=t.which,e=this.allowed_keys.join(",").match(new RegExp(n));!n||48<=n&&n<=57||e?window.setTimeout(function(){i.val(i.val().replace(",","."))},0):t.preventDefault()},e.prototype.on_reference_definition_list_change=function(t){var e=t.currentTarget,i=$(e),t=this.get_authenticator(),e=i.val(),i=i.children(":selected").html();if(""===e)return $("#Blank").prop("checked",!1),$("#Hazardous").prop("checked",!1),void $(".bika-listing-table").load("referenceresults",{_authenticator:t});-1<i.search(_t("(Blank)"))||-1<i.search("(Blank)")?$("#Blank").prop("checked",!0):$("#Blank").prop("checked",!1),-1<i.search(_t("(Hazardous)"))||-1<i.search("(Hazardous)")?$("#Hazardous").prop("checked",!0):$("#Hazardous").prop("checked",!1),$(".bika-listing-table").load("referenceresults",{_authenticator:t,uid:e})},e.prototype.on_service_info_click=function(t){return t.preventDefault(),t=t.currentTarget,$(t).prepOverlay({subtype:"ajax",width:"80%",filter:"#content>*:not(div#portal-column-content)",config:{closeOnClick:!0,closeOnEsc:!0,onBeforeLoad:function(t){return this.getOverlay().draggable()},onLoad:function(t){return t=new Event("DOMContentLoaded",{}),window.document.dispatchEvent(t)}}}),$(t).click()},e)}.call(this),function(){window.AttachmentsUtils=function(){this.load=function(){$("#AttachFile,#Service,#Analysis").change(function(t){var e,i,n=$("#AttachFile").val();void 0===n&&(n=""),void 0===(i=$("#Service").val())&&(i=""),void 0===(e=$("#Analysis").val())&&(e=""),"Service"===this.id&&$("#Analysis").val(""),"Analysis"===this.id&&$("#Service").val(""),""===n||""===i&&""===e?$("#addButton").prop("disabled",!0):$("#addButton").removeAttr("disabled")}),$("#Analysis").combogrid({colModel:[{columnName:"analysis_uid",hidden:!0},{columnName:"slot",width:"10",label:_t("Slot")},{columnName:"service",width:"35",label:_t("Service")},{columnName:"parent",width:"35",label:_t("Parent")},{columnName:"type",width:"20",label:_t("Type")}],url:window.location.href.replace("/manage_results","")+"/attachAnalyses?_authenticator="+$('input[name="_authenticator"]').val(),showOn:!0,width:"650px",select:function(t,e){return $("#Analysis").val(e.item.service+(" (slot "+e.item.slot)+")"),$("#analysis_uid").val(e.item.analysis_uid),$(this).change(),!1}})}}}.call(this),$(document).ready(function(){window.bika=window.bika||{lims:{}},window.bika.lims.barcode_listener=new function(){this.load=function(){var e=!1,i="";$(window).keypress(function(t){"BODY"==t.target.tagName&&(e?i+=String.fromCharCode(t.which):(e=!0,i=String.fromCharCode(t.which),setTimeout(function(){var t;e=!1,2<i.length&&(t=i,authenticator=$('input[name="_authenticator"]').val(),$.ajax({type:"POST",url:"barcode_entry",data:{entry:t,_authenticator:authenticator},success:function(t,e,i,n){t.success&&(window.location.href=t.url)}}))},500)))})}},window.bika.lims.barcode_listener.load()}),function(){function t(t,e){return function(){return t.apply(e,arguments)}}function e(){this.on_instrument_change=t(this.on_instrument_change,this),this.on_template_change=t(this.on_template_change,this),this.select_instrument=t(this.select_instrument,this),this.get_template_instrument=t(this.get_template_instrument,this),this.bind_eventhandler=t(this.bind_eventhandler,this),this.load=t(this.load,this)}function i(){this.on_referencesample_row_click=t(this.on_referencesample_row_click,this),this.on_service_click=t(this.on_service_click,this),this.load_controls=t(this.load_controls,this),this.get_postion=t(this.get_postion,this),this.get_control_type=t(this.get_control_type,this),this.get_selected_services=t(this.get_selected_services,this),this.get_authenticator=t(this.get_authenticator,this),this.get_base_url=t(this.get_base_url,this),this.ajax_submit=t(this.ajax_submit,this),this.bind_eventhandler=t(this.bind_eventhandler,this),this.load=t(this.load,this)}function n(){this.on_duplicate_row_click=t(this.on_duplicate_row_click,this),this.get_postion=t(this.get_postion,this),this.bind_eventhandler=t(this.bind_eventhandler,this),this.load=t(this.load,this)}function a(){this.on_wideinterims_apply_click=t(this.on_wideinterims_apply_click,this),this.on_slot_remarks_click=t(this.on_slot_remarks_click,this),this.on_wideiterims_interims_change=t(this.on_wideiterims_interims_change,this),this.on_wideiterims_analyses_change=t(this.on_wideiterims_analyses_change,this),this.on_remarks_balloon_clicked=t(this.on_remarks_balloon_clicked,this),this.on_analysis_instrument_change=t(this.on_analysis_instrument_change,this),this.on_analysis_instrument_focus=t(this.on_analysis_instrument_focus,this),this.on_method_change=t(this.on_method_change,this),this.on_instrument_change=t(this.on_instrument_change,this),this.on_layout_change=t(this.on_layout_change,this),this.on_analyst_change=t(this.on_analyst_change,this),this.on_constraints_loaded=t(this.on_constraints_loaded,this),this.load_analysis_method_constraint=t(this.load_analysis_method_constraint,this),this.is_instrument_allowed=t(this.is_instrument_allowed,this),this.get_method_by_analysis_uid=t(this.get_method_by_analysis_uid,this),this.get_analysis_uids=t(this.get_analysis_uids,this),this.get_authenticator=t(this.get_authenticator,this),this.get_base_url=t(this.get_base_url,this),this.get_portal_url=t(this.get_portal_url,this),this.ajax_submit=t(this.ajax_submit,this),this.init_instruments_and_methods=t(this.init_instruments_and_methods,this),this.bind_eventhandler=t(this.bind_eventhandler,this),this.load=t(this.load,this)}window.WorksheetFolderView=(e.prototype.load=function(){return this.bind_eventhandler()},e.prototype.bind_eventhandler=function(){return $("body").on("change","select.template",this.on_template_change),$("body").on("change","select.instrument",this.on_instrument_change)},e.prototype.get_template_instrument=function(){var t=$("input.templateinstruments").val();return JSON.parse(t)},e.prototype.select_instrument=function(t){t=$(".instrument").find("option[value='"+t+"']");if(t)return t.prop("selected",!0)},e.prototype.on_template_change=function(t){var t=$(t.currentTarget).val(),t=this.get_template_instrument()[t];return this.select_instrument(t)},e.prototype.on_instrument_change=function(t){if($(t.currentTarget).val())return t=_t("Only the analyses for which the selected instrument is allowed will be added automatically."),bika.lims.SiteView.notify_in_panel(t,"error")},e),window.WorksheetAddQCAnalysesView=(i.prototype.load=function(){return this.bind_eventhandler(),this.load_controls()},i.prototype.bind_eventhandler=function(){return $("body").on("click","#worksheet_services input[id*='_cb_']",this.on_service_click),$("body").on("click","#worksheet_add_references .bika-listing-table tbody.item-listing-tbody tr",this.on_referencesample_row_click)},i.prototype.ajax_submit=function(t){var e,i;return null==t&&(t={}),null==t.type&&(t.type="POST"),null==t.url&&(t.url=this.get_base_url()),null==t.context&&(t.context=this),$(this).trigger("ajax:submit:start"),i=this,e=function(){return $(i).trigger("ajax:submit:end")},$.ajax(t).done(e)},i.prototype.get_base_url=function(){return window.location.href.split("?")[0]},i.prototype.get_authenticator=function(){return $("input[name='_authenticator']").val()},i.prototype.get_selected_services=function(){var t=$("table.bika-listing-table"),i=[];return $("input:checked",t).each(function(t,e){return i.push(e.value)}),i},i.prototype.get_control_type=function(){var t="b";return-1<window.location.href.search("add_control")&&(t="c"),t},i.prototype.get_postion=function(){return $("#position").val()||"new"},i.prototype.load_controls=function(){var e,t=this.get_base_url(),t=(t=t.replace("/add_blank","").replace("/add_control",""))+"/getWorksheetReferences";if(0!==(e=$("#worksheet_add_references")).length)return this.ajax_submit({url:t,data:{service_uids:this.get_selected_services().join(","),control_type:this.get_control_type(),_authenticator:this.get_authenticator()}}).done(function(t){return e.html(t)})},i.prototype.on_service_click=function(t){return this.load_controls()},i.prototype.on_referencesample_row_click=function(t){var e=$(t.currentTarget),i=e.attr("uid"),t=e.parents("form"),e="c"===this.get_control_type()?"add_control":"add_blank";return t.attr("action",e),e=this.get_selected_services().join(","),t.append("<input type='hidden' value='"+e+"' name='selected_service_uids'/>"),t.append("<input type='hidden' value='"+i+"' name='reference_uid'/>"),t.append("<input type='hidden' value='"+this.get_postion()+"' name='position'/>"),t.submit()},i),window.WorksheetAddDuplicateAnalysesView=(n.prototype.load=function(){return this.bind_eventhandler()},n.prototype.bind_eventhandler=function(){return $("body").on("click","#worksheet_add_duplicate_ars .bika-listing-table tbody.item-listing-tbody tr",this.on_duplicate_row_click)},n.prototype.get_postion=function(){return $("#position").val()||"new"},n.prototype.on_duplicate_row_click=function(t){var e=$(t.currentTarget),t=e.attr("uid"),e=e.parents("form");return e.attr("action","add_duplicate"),e.append("<input type='hidden' value='"+t+"' name='ar_uid'/>"),e.append("<input type='hidden' value='"+this.get_postion()+"' name='position'/>"),e.submit()},n),window.WorksheetManageResultsView=(a.prototype.load=function(){return this._=i18n.MessageFactory("senaite.core"),this._pmf=i18n.MessageFactory("plone"),this.bind_eventhandler(),this.constraints=null,this.init_instruments_and_methods(),window.ws=this},a.prototype.bind_eventhandler=function(){return $("body").on("change",".manage_results_header .analyst",this.on_analyst_change),$("body").on("change","#resultslayout_form #resultslayout",this.on_layout_change),$("body").on("change",".manage_results_header .instrument",this.on_instrument_change),$("body").on("change","table.bika-listing-table select.listing_select_entry[field='Method']",this.on_method_change),$("body").on("focus","table.bika-listing-table select.listing_select_entry[field='Instrument']",this.on_analysis_instrument_focus),$("body").on("change","table.bika-listing-table select.listing_select_entry[field='Instrument']",this.on_analysis_instrument_change),$("body").on("click","a.add-remark",this.on_remarks_balloon_clicked),$("body").on("change","#wideinterims_analyses",this.on_wideiterims_analyses_change),$("body").on("change","#wideinterims_interims",this.on_wideiterims_interims_change),$("body").on("click","#wideinterims_apply",this.on_wideinterims_apply_click),$("body").on("click","img.slot-remarks",this.on_slot_remarks_click),$(this).on("constraints:loaded",this.on_constraints_loaded)},a.prototype.init_instruments_and_methods=function(){var t=this.get_analysis_uids();return this.ajax_submit({url:this.get_portal_url()+"/get_method_instrument_constraints",data:{_authenticator:this.get_authenticator,uids:JSON.stringify(t)},dataType:"json"}).done(function(t){return this.constraints=t,$(this).trigger("constraints:loaded",t)})},a.prototype.ajax_submit=function(t){var e,i;return null==t&&(t={}),null==t.type&&(t.type="POST"),null==t.url&&(t.url=this.get_base_url()),null==t.context&&(t.context=this),$(this).trigger("ajax:submit:start"),i=this,e=function(){return $(i).trigger("ajax:submit:end")},$.ajax(t).done(e)},a.prototype.get_portal_url=function(){return $("input[name=portal_url]").val()||window.portal_url},a.prototype.get_base_url=function(){return window.location.href.split("?")[0]},a.prototype.get_authenticator=function(){return $("input[name='_authenticator']").val()},a.prototype.get_analysis_uids=function(){var i=[],t=$("#item_data").val();return t?(t=JSON.parse(t),$.each(t,function(t,e){return i.push(t)}),i):[]},a.prototype.get_method_by_analysis_uid=function(t){return $("select.listing_select_entry[field='Method'][uid='"+t+"']").val()||""},a.prototype.is_instrument_allowed=function(i){var t,n=!0;return"True"!==$("#instrument_multiple_use").attr("value")&&(t=$("select.listing_select_entry[field='Instrument']"),$.each(t,function(t,e){if(e.value===i)return n=!1})),n},a.prototype.load_analysis_method_constraint=function(t,e){var i,n,a,s,r=this;if(e=e||this.get_method_by_analysis_uid(t),i=this.constraints[t],i&&(s=i[e],s&&!(s.length<7)))return a=$("select.listing_select_entry[field='Method'][uid='"+t+"']"),n=$("select.listing_select_entry[field='Instrument'][uid='"+t+"']"),$(a).find('option[value=""]').remove(),1===s[1]&&$(a).prepend("<option value=''>"+_("Not defined")+"</option>"),$(a).val(e),$(a).prop("disabled",!1),$(".method-label[uid='"+t+"']").remove(),0===s[0]?$(a).hide():1===s[0]?$(a).show():2===s[0]?1<i.length&&($(a).hide(),e=$(a).find("option[value='"+e+"']").innerHtml(),$(a).after("<span class='method-label' uid='"+t+"' href='#'>"+e+"</span>")):3===s[0]&&$(a).show(),(a=$(n).val())&&""!==a&&$("table.bika-listing-table select.listing_select_entry[field='Instrument'][value!='"+a+"'] option[value='"+a+"']").prop("disabled",!1),$(n).find("option").remove(),s[7]&&$.each(s[7],function(t,e){return r.is_instrument_allowed(t)?$(n).append("<option value='"+t+"'>"+e+"</option>"):$(n).append("<option value='"+t+"' disabled='disabled'>"+e+"</option>")}),1===s[3]&&$(n).prepend("<option selected='selected' value=''>"+_("None")+"</option>"),r.is_instrument_allowed(s[4])&&($(n).val(s[4]),$("table.bika-listing-table select.listing_select_entry[field='Instrument'][value!='"+s[4]+"'] option[value='"+s[4]+"']").prop("disabled",!0)),0===s[2]?$(n).hide():1===s[2]&&$(n).show(),0===s[5]?($(".interim input[uid='"+t+"']").val(""),$("input[field='Result'][uid='"+t+"']").val(""),$(".interim input[uid='"+t+"']").prop("disabled",!0),$("input[field='Result'][uid='"+t+"']").prop("disabled",!0)):1===s[5]&&($(".interim input[uid='"+t+"']").prop("disabled",!1),$("input[field='Result'][uid='"+t+"']").prop("disabled",!1)),$(".alert-instruments-invalid[uid='"+t+"']").remove(),s[6]&&""!==s[6]&&$(n).after("<img uid='"+t+"' class='alert-instruments-invalid' src='"+this.get_portal_url()+"/++resource++bika.lims.images/warning.png' title='"+s[6]+"'>"),$(".amconstr[uid='"+t+"']").remove()},a.prototype.on_constraints_loaded=function(t){var i=this;return $.each(this.get_analysis_uids(),function(t,e){return i.load_analysis_method_constraint(e,null)})},a.prototype.on_analyst_change=function(t){var e=$(t.currentTarget).val();return""!==e&&(t=this.get_base_url().replace("/manage_results","")+"/set_analyst",this.ajax_submit({url:t,data:{value:e,_authenticator:this.get_authenticator()},dataType:"json"}).done(function(t){return bika.lims.SiteView.notify_in_panel(this._pmf("Changes saved."),"succeed")}).fail(function(){return bika.lims.SiteView.notify_in_panel(this._t("Could not set the selected analyst"),"error")}))},a.prototype.on_layout_change=function(t){return $(t.currentTarget)},a.prototype.on_instrument_change=function(t){var e=$(t.currentTarget).val();return""!==e&&(t=this.get_base_url().replace("/manage_results","")+"/set_instrument",this.ajax_submit({url:t,data:{value:e,_authenticator:this.get_authenticator()},dataType:"json"}).done(function(t){return bika.lims.SiteView.notify_in_panel(this._pmf("Changes saved."),"succeed"),$("select.listing_select_entry[field='Instrument'] option[value='"+e+"']").parent().find("option[value='"+e+"']").prop("selected",!1),$("select.listing_select_entry[field='Instrument'] option[value='"+e+"']").prop("selected",!0)}).fail(function(){return bika.lims.SiteView.notify_in_panel(this._t("Unable to apply the selected instrument"),"error")}))},a.prototype.on_method_change=function(t){var e=$(t.currentTarget),t=e.attr("uid"),e=e.val();return this.load_analysis_method_constraint(t,e)},a.prototype.on_analysis_instrument_focus=function(t){t=$(t.currentTarget);this.previous_instrument=t.val()},a.prototype.on_analysis_instrument_change=function(t){var t=$(t.currentTarget),t=(t.attr("uid"),t.val());return $("table.bika-listing-table select.listing_select_entry[field='Instrument'][value!='"+t+"'] option[value='"+t+"']").prop("disabled",!0),$("table.bika-listing-table select.listing_select_entry[field='Instrument'] option[value='"+this.previous_instrument+"']").prop("disabled",!1),$("table.bika-listing-table select.listing_select_entry[field='Instrument'] option[value='']").prop("disabled",!1)},a.prototype.on_remarks_balloon_clicked=function(t){var e=$(t.currentTarget);return t.preventDefault(),e=e.closest("tr").next("tr").find("td.remarks"),$(e).find("div.remarks-placeholder").toggle()},a.prototype.on_wideiterims_analyses_change=function(t){var t=$(t.currentTarget);return $("#wideinterims_interims").html(""),t=t.val(),$("input[id^='wideinterim_"+t+"']").each(function(t,e){var i=$(e).attr("name"),i="<option value='"+$(e).attr("keyword")+"'>"+i+"</option>";return $("#wideinterims_interims").append(i)})},a.prototype.on_wideiterims_interims_change=function(t){var t=$(t.currentTarget),t="#wideinterim_"+$("#wideinterims_analyses").val()+"_"+t.val();return $("#wideinterims_value").val($(t).val())},a.prototype.on_slot_remarks_click=function(t){t=t.currentTarget;return $(t).prepOverlay({subtype:"ajax",filter:"h1,div.remarks-widget",config:{closeOnClick:!0,closeOnEsc:!0,onBeforeLoad:function(t){var e=this.getOverlay();return $("div.pb-ajax>div",e).addClass("container-fluid"),$("h3",e).remove(),$("textarea",e).remove(),$("input",e).remove(),e.draggable()},onLoad:function(t){return $.mask.close()}}}),$(t).click()},a.prototype.on_wideinterims_apply_click=function(t){var i,n,a;return t.preventDefault(),$(t.currentTarget),$("#wideinterims_analyses").val(),t=$("#wideinterims_interims").val(),i=$("#wideinterims_empty").is(":checked"),a=$("#wideinterims_value").val(),n=function(t,e){return Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"value").set.call(t,e),e=new Event("input",{bubbles:!0}),t.dispatchEvent(e)},$("tr td input[column_key='"+t+"']").each(function(t,e){return i&&""!==$(this).val()&&"0"!==$(this).val().match(/\d+/)||n(e,a),!0})},a)}.call(this),window.bika=window.bika||{lims:{}},window.bika.lims.controllers={html:["CommonUtils"],".barcode, .qrcode":["BarcodeUtils"],".range-chart":["RangeGraph"],".attachments":["AttachmentsUtils"],body:["SiteView"],".portaltype-method.template-base_edit":["MethodEditView"],".portaltype-analysisprofile.template-base_edit":["AnalysisProfileEditView"],".portaltype-instrument.template-referenceanalyses":["InstrumentReferenceAnalysesView"],".portaltype-instrumentcertification.template-base_edit":["InstrumentCertificationEditView"],".portaltype-instrument.template-base_edit":["InstrumentEditView"],".portaltype-calculation":["CalculationEditView"],".portaltype-bikasetup.template-base_edit":["BikaSetupEditView"],".portaltype-client.template-base_edit":["ClientEditView"],"div.overlay #client-base-edit":["ClientOverlayHandler"],".portaltype-referencesample.template-analyses":["ReferenceSampleAnalysesView"],".portaltype-artemplate.template-base_edit":["ARTemplateEditView"],".portaltype-analysisrequest":["AnalysisRequestView"],".portaltype-analysisrequest:not(.template-ar_add)":["RejectionKickOff"],".portaltype-analysisrequest.template-base_view":["WorksheetManageResultsView","AnalysisRequestViewView","RejectionKickOff"],".portaltype-analysisrequest.template-analyses":["AnalysisRequestAnalysesView"],".portaltype-analysisrequest.template-ar_add":["AnalysisRequestAddView"],"#analysisrequest_add_form":["AnalysisRequestAdd"],".portaltype-supplyorder.template-base_edit":["SupplyOrderEditView"],".portaltype-plone-site.template-import":["InstrumentImportView"],".portaltype-batchfolder":["BatchFolderView"],".portaltype-worksheetfolder":["WorksheetFolderView"],".portaltype-worksheet.template-add_blank":["WorksheetAddQCAnalysesView"],".portaltype-worksheet.template-add_control":["WorksheetAddQCAnalysesView"],".portaltype-worksheet.template-add_duplicate":["WorksheetAddDuplicateAnalysesView"],".portaltype-worksheet.template-manage_results":["WorksheetManageResultsView"],".portaltype-worksheettemplate.template-base_edit":["WorksheetTemplateEdit"],"#worksheet-printview-wrapper":["WorksheetPrintView"],".portaltype-reflexrule.template-base_edit":["ReflexRuleEditView"],".template-labcontacts.portaltype-department":["DepartmentLabContactsView"],".portaltype-reportfolder":["ReportFolderView"],".ArchetypesRemarksWidget":["RemarksWidgetView"]},window.bika.lims.loadControllers=function(e,i){var n,t=window.bika.lims.controllers,a=new Array,s=a.length;for(n in t)($(n).length||0<=$.inArray(n,i))&&t[n].forEach(function(t){(1==e||0<=$.inArray(n,i)||$.inArray(t,a)<0)&&(obj=new window[t],obj.load(),window.bika.lims[t]=obj,a.push(t))});return a.length-s},document.addEventListener("DOMContentLoaded",function(t){window.bika.lims.loadControllers(!1,[])});