function AnalysisProfileEditView(){var e=$("#archetypes-fieldname-AnalysisProfilePrice"),t=$("#archetypes-fieldname-AnalysisProfilePrice #AnalysisProfilePrice"),i=$("#archetypes-fieldname-AnalysisProfileVAT"),n=$("#archetypes-fieldname-AnalysisProfileVAT #AnalysisProfileVAT"),a=$("#archetypes-fieldname-UseAnalysisProfilePrice #UseAnalysisProfilePrice");this.load=function(){$(a).change(function(){$(this).is(":checked")?($(e).show(),$(i).show()):($(e).hide(),$(i).hide(),$(t).val("0"),$(n).val("0"))}),$(a).change()}}function ARTemplateEditView(){var t=$("#archetypes-fieldname-SamplePoint #SamplePoint"),i=$("#archetypes-fieldname-SampleType #SampleType");function n(e){if($('[name^="uids\\:list"]').filter(":checked").length<1)return window.bika.lims.portalMessage("No analyses have been selected"),window.scroll(0,0),!1}this.load=function(){var e;$(".portaltype-artemplate input[name$='save']").addClass("allowMultiSubmit"),$(".portaltype-artemplate input[name$='save']").click(n),e={},e=0<document.location.href.search("/clients/")?{portal_type:"Client",id:document.location.href.split("clients")[1].split("/")[1],include_fields:["UID"]}:{portal_type:"BikaSetup",include_fields:["UID"]},window.bika.lims.jsonapi_read(e,function(e){e.objects&&e.objects.length<1||((e=e.objects[0]).UID,$(t).attr("search_query",JSON.stringify({getClientUID:e.UID})),referencewidget_lookups([$(t)]))}),$(t).bind("selected blur change",function(){var e=$(t).val()?$(t).attr("uid"):"";$(i).attr("search_query",JSON.stringify({getRawSamplePoints:e})),referencewidget_lookups([$(i)])}),$(i).bind("selected blur change",function(){var e=$(i).val()?$(i).attr("uid"):"";$(t).attr("search_query",JSON.stringify({getRawSampleTypes:e})),referencewidget_lookups([$(t)])})}}function BatchFolderView(){this.load=function(){$(".portaltype-batchfolder").append("<div id='batch-cancel-dialog' title='"+_t("Cancel batch/es?")+"'>    <p style='padding:10px'>        <span class='ui-icon ui-icon-alert' style=''float: left; margin: 0 7px 30px 0;'><br/></span>        "+_t("All linked Samples will be cancelled too.")+"    </p>    <p style='padding:0px 10px'>       "+_t("Are you sure?")+"    </p></div><input id='batch-cancel-resp' type='hidden' value='false'/>"),$("#batch-cancel-dialog").dialog({autoOpen:!1,resizable:!1,height:200,width:400,modal:!0,buttons:{"Cancel selected batches":function(){$(this).dialog("close"),$("#batch-cancel-resp").val("true"),$(".portaltype-batchfolder #cancel_transition").click()},Cancel:function(){$("#batch-cancel-resp").val("false"),$(this).dialog("close")}}}),$("#cancel_transition").click(function(e){return!!$(".bika-listing-table input[type='checkbox']:checked").length&&("true"==$("#batch-cancel-resp").val()||(e.preventDefault(),$("#batch-cancel-dialog").dialog("open"),!1))})}}function BikaSetupEditView(){var e=$("#archetypes-fieldname-RestrictWorksheetUsersAccess #RestrictWorksheetUsersAccess"),t=$("#archetypes-fieldname-RestrictWorksheetManagement #RestrictWorksheetManagement");this.load=function(){$('input[id^="Prefixes-separator-"]').each(function(){!function(e){var t=e.value,i=e.id,n=["","-","_"],a='<select id="'+i+'"></select>';$(e).after(a),$(e).hide();for(var s=0;s<n.length;s++){var o="selected";n[s]!=t&&(o="");o="<option "+o+" value="+n[s]+">"+n[s]+"</option>";$("select#"+i).append(o)}}(this)}),$('select[id^="Prefixes-separator-"]').bind("select change",function(){var e=$(this).val(),t=$(this).attr("id");$("input#"+t).val(e)}),$(e).change(function(){$(this).is(":checked")?($(t).prop("checked",!0),$(t).click(function(e){e.preventDefault()})):$(t).unbind("click")}),1==$("select[name=NumberOfRequiredVerifications] option:selected").val()&&(document.getElementById("archetypes-fieldname-TypeOfmultiVerification").style.display="none"),$("#NumberOfRequiredVerifications").change(function(){1<$(this).val()?document.getElementById("archetypes-fieldname-TypeOfmultiVerification").style.display="block":document.getElementById("archetypes-fieldname-TypeOfmultiVerification").style.display="none"}),$(e).change()}}function CalculationEditView(){this.load=function(){$("#TestParameters_more").hide(),$("#Formula").live("change",function(e){var s=[];$.each($("[id^=TestParameters-keyword]"),function(e,t){s.push($(t).val())});var t=$("#Formula").val().match(/\[[^\]]*\]/gi);$.each(t,function(e,t){var i,n,a;t=t.replace("[","").replace("]",""),-1==s.indexOf(t)&&(a=$(".records_row_TestParameters"),i=$(a[a.length-1]),n=a.length.toString(),a=$(i).clone(!0),$(a).find("[id^=TestParameters-keyword]").val(t),$(a).find("[id^=TestParameters-keyword]").attr("id","TestParameters-keyword-"+n),$(a).find("[id^=TestParameters-value]").attr("id","TestParameters-value-"+n),$(a).insertBefore(i))})})}}function ClientEditView(){var t="#archetypes-fieldname-DecimalMark",i="#DefaultDecimalMark";this.load=function(){function e(e){e.is(":checked")?$(t).fadeOut().hide():$(t).fadeIn()}e($(i)),$(i).click(function(){e($(this))})}}function ClientOverlayHandler(){this.load=function(){},this.onLoad=function(e){$.ajax({url:"bika_widgets/addresswidget.js",dataType:"script",async:!1})}}function CommonUtils(){this.load=function(){window.bika=window.bika||{lims:{}},window.bika.lims.AnalysisService=window.bika.lims.AnalysisService||{Dependants:function(e){var e={catalog_name:"bika_setup_catalog",UID:e,include_methods:"getServiceDependantsUIDs"},t={};return $.ajaxSetup({async:!1}),window.bika.lims.jsonapi_read(e,function(e){t=null!=e.objects&&0<e.objects.length?e.objects[0].getServiceDependantsUIDs:[]}),$.ajaxSetup({async:!0}),t},Dependencies:function(e){var e={catalog_name:"bika_setup_catalog",UID:e,include_methods:"getServiceDependenciesUIDs"},t={};return $.ajaxSetup({async:!1}),window.bika.lims.jsonapi_read(e,function(e){t=null!=e.objects&&0<e.objects.length?e.objects[0].getServiceDependenciesUIDs:[]}),$.ajaxSetup({async:!0}),t}},window.bika.lims.portalMessage=function(e){e="<dl class='portalMessage error alert alert-danger'><dt>"+_t("Error")+"</dt><dd><ul>"+e+"</ul></dd></dl>";$(".portalMessage").remove(),$(e).appendTo("#viewlet-above-content")},window.bika.lims.log=function(e){null!=window.location.url&&null!=window.location.url&&(e="("+window.location.url+"): "+e,$.ajax({type:"POST",url:"js_log",data:{message:e,_authenticator:$("input[name='_authenticator']").val()}}))},window.bika.lims.warning=function(e){e="("+window.location.href+"): "+e;$.ajax({type:"POST",url:"js_warn",data:{message:e,_authenticator:$("input[name='_authenticator']").val()}})},window.bika.lims.error=function(e){e="("+window.location.href+"): "+e;$.ajax({type:"POST",url:"js_err",data:{message:e,_authenticator:$("input[name='_authenticator']").val()}})},window.bika.lims.jsonapi_cache={},window.bika.lims.jsonapi_read=function(e,t){window.bika.lims.jsonapi_cache=window.bika.lims.jsonapi_cache||{},null==e.page_size&&(e.page_size=0);var i=$.param(e),n=t;void 0===window.bika.lims.jsonapi_cache[i]?$.ajax({type:"POST",dataType:"json",url:window.portal_url+"/@@API/read",data:e,success:function(e){window.bika.lims.jsonapi_cache[i]=e,n(e)}}):n(window.bika.lims.jsonapi_cache[i])},window.bika.lims.update_combogrid_query=function(e,t,i,n){var a,s;$(e).is(":visible")&&(n=n||"base_query",s=jQuery.parseJSON($(e).attr(n)),i&&(s[t]=i),""===i&&s[t]&&delete s[t],$(e).attr(n,JSON.stringify(s)),(a=jQuery.parseJSON($(e).attr("combogrid_options"))).url=window.portal_url+"/"+a.url,a.url=a.url+"?_authenticator="+$("input[name='_authenticator']").val(),a.url=a.url+"&catalog_name="+$(e).attr("catalog_name"),a.url=a.url+"&base_query="+encodeURIComponent($(e).attr("base_query")),a.url=a.url+"&search_query="+encodeURIComponent($.toJSON(s)),i=a.colModel,t=a.search_fields,n=a.discard_empty,s=a.minLength,a.url=a.url+"&colModel="+$.toJSON(i),a.url=a.url+"&search_fields="+$.toJSON(t),a.url=a.url+"&discard_empty="+$.toJSON(n),a.url=a.url+"&minLength="+$.toJSON(s),a.force_all="false",$(e).combogrid(a))},$(".ArchetypesPrioritySelectionWidget select").change(function(e){var t=$(this).find("option:selected").val();$(this).attr("value",t)}),$(".ArchetypesPrioritySelectionWidget select").change()},this.svgToImage=function(e){return'<img src="'+("data:image/svg+xml;base64,"+btoa(e))+'"/>'}}function DepartmentLabContactsView(){this.load=function(){$("table.bika-listing-table td input[type='checkbox']").not('[type="hidden"]').each(function(e){$(this).change(function(){var e,t,i,n;e=this,n={},t=$(e).prop("checked"),i=$(e).val(),url=window.location.href.replace("/labcontacts",""),e=url.replace(window.portal_url,""),n.contact_uid=i,n.checkbox_value=t,n.department=e,function(e){var t=$('tr[uid="'+e.contact_uid+'"] td.Fullname a').attr("href"),i=$('tr[uid="'+e.contact_uid+'"] td.Fullname a').text(),n="<a href='"+t+"'>"+i+"</a>";$.ajax({type:"POST",dataType:"json",url:window.location.href.replace("/labcontacts","")+"/labcontactupdate",data:{data:JSON.stringify(e)}}).done(function(e){null!==e&&!0===e.success?bika.lims.SiteView.notificationPanel(n+" updated successfully","succeed"):(bika.lims.SiteView.notificationPanel("Failure while updating "+n,"error"),e="[bika.lims.department.js in DepartmentLabContactsView] Failure while updating "+i+"in "+window.location.href,console.warn(e),window.bika.lims.error(e))}).fail(function(){bika.lims.SiteView.notificationPanel("Error while updating "+n,"error");var e="[bika.lims.department.js in DepartmentLabContactsView] Error while updating "+i+"in "+window.location.href;console.warn(e),window.bika.lims.error(e)})}(n)})})}}function ControlChart(){var p=this;this.setData=function(e){p.datasource=e},this.setXColumn=function(e){p.xcolumnkey=e},this.setYColumn=function(e){p.ycolumnkey=e},this.setYLabel=function(e){p.ylabel=e},this.setXLabel=function(e){p.xlabel=e},this.setUpperLimit=function(e){p.upperlimit=e},this.setLowerLimit=function(e){p.lowerlimit=e},this.setCenterLimit=function(e){p.centerlimit=e},this.setUpperLimitText=function(e){p.upperlimit_text=e},this.setLowerLimitText=function(e){p.lowerlimit_text=e},this.setCenterLimitText=function(e){p.centerlimit_text=e},this.setInterpolation=function(e){p.interpolation=e},this.setPointId=function(e){p.pointid=e},this.draw=function(e){var t=20,i=20,n=30,a=30,s=(s=$(e).innerWidth()-20)-a-i,r=(r=$(e).innerHeight()-20)-t-n,l=d3.time.scale().range([0,s]),c=d3.scale.linear().range([r,0]),d=d3.svg.axis().scale(l).orient("bottom").tickSize(0),u=d3.svg.axis().scale(c).orient("left").tickSize(0),h=d3.svg.line().interpolate(p.interpolation).x(function(e){return l(e.x_axis)}).y(function(e){return c(e.y_axis)}),_=d3.select(e).append("svg").attr("xmlns","http://www.w3.org/2000/svg").attr("width",s+a+i).attr("height",r+t+n).append("g").attr("transform","translate("+a+","+t+")");x_data_parse=d3.time.format("%Y-%m-%d %I:%M %p").parse,p.datasource.forEach(function(e){var t;e.x_axis=x_data_parse(e[p.xcolumnkey]),e.y_axis=(t=e[p.ycolumnkey])&&"string"==typeof o?+t:t,e.point_id=e[p.pointid]}),p.datasource.sort(function(e,t){return e.x_axis-t.x_axis}),l.domain(d3.extent(p.datasource,function(e){return e.x_axis}));a=d3.min(p.datasource,function(e){return e.y_axis});a>p.lowerlimit&&(a=p.lowerlimit);t=d3.max(p.datasource,function(e){return e.y_axis});t<p.upperlimit&&(t=p.upperlimit),c.domain([a,t]),_.append("g").attr("class","x axis").attr("transform","translate(0,"+r+")").call(d).style("font-size","11px").append("text").attr("x",s).attr("dy","-0.71em").attr("text-anchor","end").text(p.xlabel),_.append("g").attr("class","y axis").call(u).style("font-size","11px").append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text(p.ylabel),_.append("path").datum(p.datasource).attr("stroke","#4682b4").attr("stroke-width","1.5px").attr("fill","none").attr("class","line").attr("d",h),p.datasource.forEach(function(e){_.append("g").attr("fill","#2f2f2f").append("circle").attr("id",e.point_id).attr("r",3).attr("cx",l(e.x_axis)).attr("cy",c(e.y_axis)).on("mouseout",function(){d3.select(this).attr("fill","#2f2f2f").attr("r",3),d3.select(this.parentNode.children[1]).remove()}).on("mouseover",function(){d3.select(this).attr("fill","#4682b4").attr("r",6),d3.select(this.parentNode).append("text").attr("fill","#000000").style("font-size","10px").attr("x",l(e.x_axis)-10).attr("y",c(e.y_axis)-10).text(e.y_axis+p.ylabel)}).on("click",function(){d3.select(this).attr("fill","#4682b4").attr("r",6),d3.select(this.parentNode).append("text").attr("fill","#000000").style("font-size","10px").attr("x",l(e.x_axis)-10).attr("y",c(e.y_axis)-10).text(e.y_axis+p.ylabel)})}),_.append("line").attr("stroke","#8e0000").attr("stroke-width","1px").attr("stroke-dasharray","5, 5").attr({x1:0,y1:c(p.upperlimit),x2:s,y2:c(p.upperlimit)}),_.append("text").attr({x:30,y:c(p.upperlimit)-5}).style("font-size","11px").text(p.upperlimit_text),_.append("line").attr("stroke","#8e0000").attr("stroke-width","1px").attr("stroke-dasharray","5, 5").attr({x1:0,y1:c(p.lowerlimit),x2:s,y2:c(p.lowerlimit)}),_.append("text").attr({x:30,y:c(p.lowerlimit)-5}).style("font-size","11px").text(p.lowerlimit_text),_.append("line").attr("stroke","#598859").attr("stroke-width","1px").attr({x1:0,y1:c(p.centerlimit),x2:s,y2:c(p.centerlimit)}),_.append("text").attr({x:30,y:c(p.centerlimit)-5}).style("font-size","11px").text(p.centerlimit_text)}}function RangeGraph(){this.load=function(){$(".range-chart").each(function(e){var t,i,n,a,s,o,r,l,c,d,u,h,_,p,m,f,g=Number($(this).css("width").replace(/[^\d\.\-]/g,""));t=$(this).get(0),i=g,n=$.parseJSON($(this).attr("data-range")),a=$.parseJSON($(this).attr("data-result")),(f=function(e,t){if(!$.isNumeric(t))return null;t=parseFloat(t);if(!("min"in e&&"max"in e))return null;var i=$.isNumeric(e.min)?parseFloat(e.min):t,n=$.isNumeric(e.max)?parseFloat(e.max):t;if(i==n)return null;var a=i,s=n;"warn_min"in e&&$.isNumeric(e.warn_min)&&(a=(a=parseFloat(e.warn_min))<i?a:i);"warn_max"in e&&$.isNumeric(e.warn_max)&&(s=parseFloat(e.warn_max),s=n<s?s:n);return{result:t,min:i,max:n,warn_min:a,warn_max:s}}(n,a))&&(console.log($.toJSON(f)),i-=o=2*(s=.03*i),r=f.min,l=f.max,c=f.warn_min,d=f.warn_max,a=f.result,p="min_operator"in n?n.min_operator:"geq",_="max_operator"in n?n.max_operator:"leq",h=(d-c)/3,u=a<c?a:c-h,g=d<a?a:d+h,f="gt"==p?r<a:r<=a,n=!1,(f="lt"==_?f&&a<l:f&&a<=l)||(m=(m="lt"==_?l<=a:l<a)&&a<=d,n=("gt"==p?a<=r:a<r)&&c<=a||m),h=f||n?"#a8d6cf":"#cdcdcd",_=f?"#279989":n?"#ffae00":"#ff0000",p=f||n?"#d9e9e6":"#dcdcdc",m=d3.scale.linear().domain([u,g]).range([0,i]),f=d3.select(t).append("svg").attr("xmlns","http://www.w3.org/2000/svg").attr("width",i+2*s).attr("height",o).append("g").attr("transform","translate("+s+",0)"),t=o/2-(n=2*s*.8)/2,i=.9*s,f.append("rect").attr("x",m(u)).attr("y",t).attr("width",m(c)-m(u)+i).attr("height",n).attr("rx",i).attr("ry",i).style("fill","#e9e9e9"),f.append("rect").attr("x",m(c)).attr("y",t).attr("width",m(r)-m(c)).attr("height",n).style("fill",p),f.append("rect").attr("x",m(l)).attr("y",t).attr("width",m(d)-m(l)).attr("height",n).style("fill",p),f.append("rect").attr("x",m(d)-i).attr("y",t).attr("width",m(g)-m(d)+i).attr("height",n).attr("rx",i).attr("ry",i).style("fill","#e9e9e9"),f.append("rect").attr("x",m(r)).attr("y",t).attr("width",m(l)-m(r)).attr("height",n).style("fill",h),f.append("circle").attr("cx",m(a)).attr("cy",o/2).attr("r",s).style("fill","white"),f.append("circle").attr("cx",m(a)).attr("cy",o/2).attr("r",s-1).style("fill",_)),$(this).removeClass("range-chart")})}}function InstrumentImportView(){this.load=function(){$("#instrument_select").change(function(){$(".portalMessage").remove(),$("#import_form").empty(),$("#intermediate").toggle(!1),""==$(this).val()?$("#exim").empty():$.ajax({type:"POST",dataType:"json",url:window.location.href.replace("/import","/getImportInterfaces"),data:{_authenticator:$('input[name="_authenticator"]').val(),instrument_uid:$(this).val()},success:function(e){$("#exim").empty(),$("#exim").append($("<option>").text("Choose an Interface...").attr("value","").attr("selected","selected")),$("#exim").append($("<option>").text("Default").attr("value","default")),$.each(e,function(e,t){$("#exim").append($("<option>").text(t.title).attr("value",t.id))})}})}),$("#exim").change(function(){$(".portalMessage").remove(),$("#intermediate").toggle(!1),""==$(this).val()?$("#import_form").empty():$("#import_form").load(window.location.href.replace("/import","/getImportTemplate"),{_authenticator:$('input[name="_authenticator"]').val(),exim:$(this).val()})}),$("select#exim").change(function(){setTimeout(function(){$("select#analysis_service").bind("select change",function(){""!=$("select#analysis_service").val()?$("div#default_result").fadeIn():$("div#default_result").fadeOut()})},800)}),$("[name='firstsubmit']").live("click",function(e){return e.preventDefault(),$(".portalMessage").remove(),0==$("#intermediate").length&&$("#import_form").after("<div id='intermediate'></div>"),$("#intermediate").toggle(!1),form=$(this).parents("form"),options={target:$("#intermediate"),data:JSON.stringify(form.formToArray()),dataType:"json",processData:!1,success:function(e,t,i,n){$("#intermediate").empty(),0<e.log.length&&(str="<div class='alert alert-info'>",str+="<h3>"+_t("Log trace")+"</h3><ul>",$.each(e.log,function(e,t){str+="<li>"+t+"</li>"}),str+="</ul></div>",$("#intermediate").append(str).toggle(!0)),0<e.errors.length&&(str="<div class='alert alert-danger'>",str+="<h3>"+_t("Errors")+"</h3><ul>",$.each(e.errors,function(e,t){str+="<li><code>"+t+"</code></li>"}),str+="</ul></div>",$("#intermediate").append(str).toggle(!0)),0<e.warns.length&&(str="<div class='alert alert-warning'>",str+="<h3>"+_t("Warnings")+"</h3><ul>",$.each(e.warns,function(e,t){str+="<li>"+t+"</li>"}),str+="</ul></div>",$("#intermediate").append(str).toggle(!0))},error:function(e,t,i){$("#intermediate").empty(),str="<div class='alert alert-danger'>",str+="<h3>"+_t("Errors found")+"</h3><ul>",str+="<li>"+t,str+="<pre>"+i+"</pre></li></ul></div>",$("#intermediate").append(str).toggle(!0)}},form.ajaxSubmit(options),!1})}}function InstrumentCertificationEditView(){function e(){$("#Internal").is(":checked")?$("#archetypes-fieldname-Agency").hide():$("#archetypes-fieldname-Agency").fadeIn("slow")}this.load=function(){$("#Internal").live("change",function(){e()}),e()}}function InstrumentEditView(){this.load=function(){$("#ResultFilesFolder_more").remove();var e=$(".records_row_ResultFilesFolder");for(i=0;i<e.length;i++)(0<i&&i==e.length-1?e[i]:e[i].children[2]).remove()},$("#ImportDataInterface").change(function(){!function(){var e,t=$("#ResultFilesFolder_table"),n=$(".records_row_ResultFilesFolder"),a=$("#ImportDataInterface").val();if(n.remove(),null==a||1==a.length&&""==a[0]){var s=$(n[n.length-1]).clone();for(i=0;i<$(s).children().length;i++){var o=$(s).children()[i],o=$(o).children()[0];$(o).val("")}$(s).appendTo($(t))}else{for(i=0;i<a.length;i++)""!=a[i]&&(s=$(n[n.length-1]).clone(),e=$(s).children()[0],e=$(e).children()[0],$(e).val(a[i]),e=$(s).children()[1],e=$(e).children()[0],$(e).val(""),$(s).appendTo($(t)));!function(){$("#ResultFilesFolder_table");var e=$(".records_row_ResultFilesFolder");for(i=0;i<e.length;i++){var t=$(e[i]).find("input[id^='ResultFilesFolder']");for(j=0;j<t.length;j++){var n=t[j].id,n=n.split("-")[0]+"-"+n.split("-")[1];$(t[j]).attr("id",n+"-"+i)}}}()}}()})}function InstrumentReferenceAnalysesView(){function i(e){var n=$("#selqcsample").val();$("#selqcsample option").remove(),$.map(e,function(e,t){var i=t==n?" selected":"";$("#selqcsample").append('<option value="'+t+'"'+i+">"+t+"</option>")})}function n(){var t=(t=$("#selanalyses").val().split("("))[t.length-1].slice(0,-1).trim(),i=$("#selqcsample").val(),n=0;$("div.results-info").remove(),$(".item-listing-tbody tr").each(function(e){$(this).attr("keyword")!=t||$(this).find("td.Partition a").html()!=i?$(this).hide():($(this).fadeIn(),n+=1)}),$(".bika-listing-table").closest("div").before('<div class="results-info">'+n+" results found</div>")}function a(e,t){var i=$("#selanalyses").val(),n=$("#selqcsample").val(),a=$("#interpolation").val();null==e&&$("#chart").innerWidth(),null==t&&$("#chart").innerHeight();$("#chart").css("width",e),$("#chart").css("height",t),$("#chart").html(""),$("#chart").show();var s,o,r,l=(l=$.parseJSON($("#graphdata").val()))[i];n in l&&0!=l[n].length?(r=(l=l[n])[l.length-1].unit,s=l[l.length-1].upper,o=l[l.length-1].lower,e=l[l.length-1].target,t="Result",""==r||void 0===r?r="":t=r,i=$.trim("UCL ("+s+r+")"),n=$.trim("LCL ("+o+r+")"),r=$.trim("CL ("+e+r+")"),chart=new ControlChart,chart.setData(l),chart.setInterpolation(a),chart.setXColumn("date"),chart.setYColumn("result"),chart.setPointId("id"),chart.setYLabel(t),chart.setXLabel("Date"),chart.setUpperLimitText(i),chart.setLowerLimitText(n),chart.setCenterLimitText(r),chart.setCenterLimit(e),chart.setUpperLimit(s),chart.setLowerLimit(o),chart.draw("#chart")):$("#chart").hide()}this.load=function(){var t=$.parseJSON($("#graphdata").val());$.map(t,function(e,t){$("#selanalyses").append('<option value="'+t+'">'+t+"</option>")}),$("#selanalyses").val()&&(i(t[$("#selanalyses").val()]),n(),a(null,null)),$("#selanalyses").change(function(e){i(t[$("#selanalyses").val()]),a(null,null),n()}),$("#selqcsample").change(function(e){a(null,null),n()}),$("#interpolation").change(function(e){a(null,null)}),$(".item-listing-tbody tr").mouseover(function(e){var t;""!=$(this).attr("uid")&&($(this).addClass("selected"),t=$(this).attr("uid"),$("#chart svg g circle#"+t).trigger("__onmouseover"))}),$(".item-listing-tbody tr").mouseout(function(e){var t;$(this).removeClass("selected"),""!=$(this).attr("uid")&&(t=$(this).attr("uid"),$("#chart svg g circle#"+t).trigger("__onmouseout"))}),$("#printgraph").click(function(e){e.preventDefault();a(670,$("#chart").attr("height"));var t=window.open("","","left=0,top=0,width=800,height=900,toolbar=0,scrollbars=0,status=0"),i='<link href="'+window.portal_url+'/++resource++bika.lims.css/print-graph.css" type="text/css" rel="stylesheet">',n=$("span.documentFirstHeading").closest("h1").clone(),e=$("#content-core").clone();$(e).prepend(n),$(e).find("#selanalyses").after("<span class='bold'>"+$("#selanalyses").val()+"</span>"),$(e).find("#interpolation").after("<span class='bold'>"+$("#interpolation").val()+"</span>"),$(e).find("#selqcsample").after("<span class='bold'>"+$("#selqcsample").val()+"</span>"),$(e).find("#selanalyses").hide(),$(e).find("#interpolation").hide(),$(e).find("#selqcsample").hide(),t.document.write("<html><head>"+i+"</head><body>"+$(e).html()+"</body></html>"),t.document.close(),t.focus(),t.print(),$("#chart").css("width","100%"),$("#chart").removeAttr("height"),a(null,null),t.close()}),$("div.bika-listing-table-container").fadeIn()}}function MethodEditView(){this.load=function(){}}function ReferenceSampleAnalysesView(){function t(){var t=(t=$("#selanalyses").val().split("("))[t.length-1].slice(0,-1).trim(),i=0;$("div.results-info").remove(),$(".item-listing-tbody tr").each(function(e){$(this).attr("keyword")!=t?$(this).hide():($(this).fadeIn(),i+=1)}),$(".bika-listing-table").closest("div").before('<div class="results-info">'+i+" results found</div>")}function a(e,t){var i=$("#selanalyses").val(),n=$("#selqcsample").val(),a=$("#interpolation").val();null==e&&$("#chart").innerWidth(),null==t&&$("#chart").innerHeight();$("#chart").css("width",e),$("#chart").css("height",t),$("#chart").html(""),$("#chart").show();var s,o,r,l=(l=$.parseJSON($("#graphdata").val()))[i];n in l&&0!=l[n].length?(r=(l=l[n])[l.length-1].unit,s=l[l.length-1].upper,o=l[l.length-1].lower,e=l[l.length-1].target,t="Result",""==r||void 0===r?r="":t=r,i=$.trim("UCL ("+s+r+")"),n=$.trim("LCL ("+o+r+")"),r=$.trim("CL ("+e+r+")"),chart=new ControlChart,chart.setData(l),chart.setInterpolation(a),chart.setXColumn("date"),chart.setYColumn("result"),chart.setPointId("id"),chart.setYLabel(t),chart.setXLabel("Date"),chart.setUpperLimitText(i),chart.setLowerLimitText(n),chart.setCenterLimitText(r),chart.setCenterLimit(e),chart.setUpperLimit(s),chart.setLowerLimit(o),chart.draw("#chart")):$("#chart").hide()}this.load=function(){var e=$.parseJSON($("#graphdata").val()),i=!1;$.map(e,function(e,t){$("#selanalyses").append('<option value="'+t+'">'+t+"</option>"),0==i&&($.map(e,function(e,t){$("#selqcsample").val(t)}),i=!0)}),$("#selanalyses").val()&&(t(),a(null,null)),$("#selanalyses").change(function(e){a(null,null),t()}),$("#interpolation").change(function(e){a(null,null)}),$(".item-listing-tbody tr").mouseover(function(e){var t;""!=$(this).attr("uid")&&($(this).addClass("selected"),t=$(this).attr("uid"),$("#chart svg g circle#"+t).trigger("__onmouseover"))}),$(".item-listing-tbody tr").mouseout(function(e){var t;$(this).removeClass("selected"),""!=$(this).attr("uid")&&(t=$(this).attr("uid"),$("#chart svg g circle#"+t).trigger("__onmouseout"))}),$("#printgraph").click(function(e){e.preventDefault(),$("#selanalyses").find("option[selected]").remove(),$("#selanalyses").find('option[value="'+$(selanalyses).val()+'"]').prop("selected",!0);a(670,$("#chart").attr("height"));var t=window.open("","","left=0,top=0,width=800,height=900,toolbar=0,scrollbars=0,status=0"),i='<link href="'+window.portal_url+'/++resource++bika.lims.css/print-graph.css" type="text/css" rel="stylesheet">',n=$("span.documentFirstHeading").closest("h1").clone(),e=$("#content-core").clone();$(e).prepend(n),$(e).find("#selanalyses").after("<span class='bold'>"+$("#selanalyses").val()+"</span>"),$(e).find("#interpolation").after("<span class='bold'>"+$("#interpolation").val()+"</span>"),$(e).find("#selanalyses").hide(),$(e).find("#interpolation").hide(),t.document.write("<html><head>"+i+"</head><body>"+$(e).html()+"</body></html>"),t.document.close(),t.focus(),t.print(),t.close(),$("#chart").css("width","100%"),$("#chart").removeAttr("height"),a(null,null)}),$("div.bika-listing-table-container").fadeIn()}}function ReflexRuleEditView(){this.load=function(){}}function RejectionKickOff(){this.load=function(){window.bika.lims.jsonapi_read({catalog_name:"portal_catalog",portal_type:"BikaSetup",include_fields:["RejectionReasons"]},function(e){var t;e.success&&0<e.total_objects&&(0<(e=e.objects[0].RejectionReasons).length&&(t=e[0].checkbox),void 0!==t&&"on"==t||$("a#workflow-transition-reject").closest("li").hide())}),function(){"use strict";var e,t;0<$("div#archetypes-fieldname-RejectionWidget").length&&($("a#workflow-transition-reject").unbind(),$("a#workflow-transition-reject").bind("click",function(e){e.preventDefault(),$("#semioverlay").show(),$('input[id="RejectionReasons.checkbox"]').click().prop("disabled",!0)}),e=$("#archetypes-fieldname-RejectionWidget").parent("td"),t="<div class='semioverlay-head'>"+$(e).prev("td").html().trim()+"</div>",$("#content").prepend("<div id='semioverlay' style='display:none'> <div class='semioverlay-back'> </div> <div class='semioverlay-panel'> <div class='semioverlay-content'></div> <div class='semioverlay-buttons'> <input type='button' name='semioverlay.reject' value='reject'/> <input type='button' name='semioverlay.cancel' value='cancel'/></div></div></div>"),$("#archetypes-fieldname-RejectionWidget").detach().prependTo("#semioverlay .semioverlay-content"),$(e).hide(),$(t).detach().insertBefore(".semioverlay-content"),$("div#semioverlay input[name='semioverlay.cancel']").bind("click",function(){$("#semioverlay").hide(),$('input[id="RejectionReasons.checkbox"]').prop("checked",!1).prop("disabled",!1),$('input[id="RejectionReasons.checkbox.other"]').prop("checked",!1),$('input[id="RejectionReasons.textfield.other"]').val("");for(var e=$(".rejectionwidget-multiselect").find("option"),t=0;e.length>t;t++)$(e[t]).attr("selected",!1)}),$("div#semioverlay input[name='semioverlay.reject']").bind("click",function(){$("div#semioverlay .semioverlay-panel").fadeOut(),function(){var e={},t=window.location.href.replace("/base_view","").replace("/analyses","").replace("/manage_results","").replace("/not_requested","").replace("/log","").replace(window.portal_url,""),i=$("a#workflow-transition-reject").attr("href");e.obj_path=t,t=function(){var e,t=0,i=[],n=0,a="";if(t=$(".rejectionwidget-checkbox").prop("checked")){t=1;for(var s=$(".rejectionwidget-multiselect").find("option"),o=0;s.length>o;o++)(e=s[o]).selected&&i.push($(e).val());(n=$(".rejectionwidget-checkbox-other").prop("checked"))?(n=1,a=$(".rejectionwidget-input-other").val()):n=0}else t=0;a={checkbox:t,selected:i,checkbox_other:n,other:a};return $.toJSON(a)}(),e.RejectionReasons=t;var n="";$.ajax({type:"POST",url:window.portal_url+"/@@API/update",data:e}).done(function(e){var t;null!==e&&!0===e.success?(bika.lims.SiteView.notificationPanel("Rejecting","succeed"),$("body").hasClass("portaltype-sample")?(t=$('input[name="_authenticator"]').val(),$.ajax({url:window.location.href+"/doActionForSample?workflow_action=reject&_authenticator="+t,type:"POST",dataType:"json"}).done(function(e){null!==e&&"true"==e.success?window.location.href=window.location.href:(bika.lims.SiteView.notificationPanel("Error while updating object state","error"),e="[bika.lims.analysisrequest.js] Error while updating object state",console.warn(e),window.bika.lims.error(e),$('#semioverlay input[name="semioverlay.cancel"]').click())})):(bika.lims.SiteView.notificationPanel("Rejecting","succeed"),window.location.href=i)):(n=!1===e.success?(bika.lims.SiteView.notificationPanel("Error while rejecting the analysis request. Unsuccesful AJAX call.","error"),"[bika.lims.analysisrequest.js] Error while rejecting the analysis request. Unsuccesful AJAX call."):(bika.lims.SiteView.notificationPanel("Error while rejecting the analysis request. No data returned.","error"),"[bika.lims.analysisrequest.js] Error while rejecting the analysis request. No data returned."),console.warn(n),window.bika.lims.error(n),$('#semioverlay input[name="semioverlay.cancel"]').click())}).fail(function(){bika.lims.SiteView.notificationPanel("Error while rejection the analysis request. AJAX POST failed.","error");var e="[bika.lims.analysisrequest.js] Error while rejection the analysis request. AJAX POST failed.";console.warn(e),window.bika.lims.error(e),$('#semioverlay input[name="semioverlay.cancel"]').click()})}()}))}()}}function BarcodeUtils(){this.load=function(){$(".qrcode").each(function(e){var t=$(this).attr("data-code"),i=$(this).attr("data-size");$(this).qrcode({render:"image",size:i,color:"#3a3",text:t})}),$(".barcode").each(function(){var e=$(this).attr("data-id"),t=$(this).attr("data-code"),i=$(this).attr("data-barHeight"),n=$(this).attr("data-addQuietZone"),a=$(this).attr("data-showHRI");$(this).barcode(e,t,{barHeight:parseInt(i),addQuietZone:"true"==n,showHRI:"true"==a,output:"bmp"}),"true"==a&&($(this).find(".barcode-hri").remove(),e='<div class="barcode-hri">'+e+"</div>",$(this).append(e))})}}function WorksheetPrintView(){function a(){$(".barcode").each(function(){var e=$(this).attr("data-id"),t=$(this).attr("data-code"),i=$(this).attr("data-barHeight"),n=$(this).attr("data-addQuietZone"),a=$(this).attr("data-showHRI");$(this).barcode(e,t,{barHeight:parseInt(i),addQuietZone:Boolean(n),showHRI:Boolean(a)})})}this.load=function(){var t=document.referrer;t?bika.lims.SiteView.setCookie("ws.print.urlback",t):t=(t=bika.lims.SiteView.readCookie("ws.print.urlback"))||portal_url,a(),$("#print_button").click(function(e){e.preventDefault(),window.print()}),$("#cancel_button").click(function(e){e.preventDefault(),location.href=t}),$("#template").change(function(e){var t=window.location.href,i=$(this).val(),n=$("#numcols").val();$("#worksheet-printview").animate({opacity:.2},"slow"),$.ajax({url:t,type:"POST",data:{template:i,numcols:n}}).always(function(e){var t=e,e=$(t).find("#report-style").html();$("#report-style").html(e),t=$(t).find("#worksheet-printview").html(),$("#worksheet-printview").html(t),$("#worksheet-printview").animate({opacity:1},"slow"),a()})}),$("#numcols").change(function(e){var t=window.location.href,i=$(this).val(),n=$("#template").val();$("#worksheet-printview").animate({opacity:.2},"slow"),$.ajax({url:t,type:"POST",data:{template:n,numcols:i}}).always(function(e){var t=e,e=$(t).find("#report-style").html();$("#report-style").html(e),t=$(t).find("#worksheet-printview").html(),$("#worksheet-printview").html(t),$("#worksheet-printview").animate({opacity:1},"slow"),a()})})}}function WorksheetTemplateEdit(){this.load=function(){var e=$("#archetypes-fieldname-RestrictToMethod").find("select");$(e).bind("change",function(e,t){var i;i=this,i=$(i).val(),$.ajax({url:window.portal_url+"/ajaxgetworksheettemplateinstruments",type:"POST",data:{_authenticator:$('input[name="_authenticator"]').val(),method_uid:JSON.stringify(i)},dataType:"json"}).done(function(e){var t,i;if(null!==e&&$.isArray(e))for(t=$("#archetypes-fieldname-Instrument").find("select"),$(t).find("option").remove(),i=0;e.length>i;i++)$(t).append('<option value="'+e[i].uid+'">'+e[i].m_title+"</option>")}).fail(function(){window.bika.lims.log("bika.lims.worksheettemplate: Something went wrong while retrieving instrument list")})})}}(function(){window.AnalysisRequestView=function(){var e=function(e){var t;e.preventDefault(),t=e.currentTarget.href.replace("content_status_modify","workflow_action"),0<(e=$("#PublicationSpecification_uid")).length&&(t=t+"&PublicationSpecification="+$(e).val()),window.location.href=t},t=function(){var n,e=$("#workflow-transition-schedule_sampling").attr("href");e&&(n=e.replace("content_status_modify","workflow_action"),$("#workflow-transition-schedule_sampling").attr("href",n),$("#workflow-transition-schedule_sampling").click(function(){var e,t=$("#SamplingDate").val(),i=$("#ScheduledSamplingSampler").val();""!==t&&null!=t&&""!==i&&null!=i?window.location.href=n:((e="")!==t&&null!=t||(e+=PMF("${name} is required for this action, please correct.",{name:_("Sampling Date")})),""!==i&&null!=i||(""!==e&&(e+="<br/>"),e+=PMF("${name} is required, please correct.",{name:_("'Define the Sampler for the shceduled'")})),""!==e&&window.bika.lims.portalMessage(e))}))},i=function(){$("#interpretationtemplate-insert").click(function(e){var t,i;e.preventDefault(),(e=$("#interpretationtemplate").val())&&1===(t=$('div[id^="ResultsInterpretationDepts-"].active  textarea[id^="ResultsInterpretationDepts-richtext-"]')).length&&(i=t.attr("id"),e={catalog_name:"uid_catalog",UID:e,include_fields:["text"]},window.bika.lims.jsonapi_read(e,function(e){if(1===e.objects.length)return e=e.objects[0].text,tinymce.get(i).insertContent(e)}))})};this.load=function(){$("a[id^='workflow-transition']").not("#workflow-transition-schedule_sampling").not("#workflow-transition-sample").click(e),t(),i()}},window.AnalysisRequestViewView=function(){this.load=function(){}},window.AnalysisRequestAnalysesView=function(){this.load=function(){}}}).call(this),function(){function e(e,t){return function(){return e.apply(t,arguments)}}var o=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1};function t(){this.on_partition_required_volume_change=e(this.on_partition_required_volume_change,this),this.on_partition_container_change=e(this.on_partition_container_change,this),this.on_partition_separate_container_change=e(this.on_partition_separate_container_change,this),this.on_partition_sampletype_change=e(this.on_partition_sampletype_change,this),this.on_default_container_change=e(this.on_default_container_change,this),this.on_default_preservation_change=e(this.on_default_preservation_change,this),this.on_separate_container_change=e(this.on_separate_container_change,this),this.on_calculation_change=e(this.on_calculation_change,this),this.on_use_default_calculation_change=e(this.on_use_default_calculation_change,this),this.on_default_method_change=e(this.on_default_method_change,this),this.on_default_instrument_change=e(this.on_default_instrument_change,this),this.on_instruments_change=e(this.on_instruments_change,this),this.on_instrument_assignment_allowed_change=e(this.on_instrument_assignment_allowed_change,this),this.on_methods_change=e(this.on_methods_change,this),this.on_manual_entry_of_results_change=e(this.on_manual_entry_of_results_change,this),this.toggle_checkbox=e(this.toggle_checkbox,this),this.select_options=e(this.select_options,this),this.parse_select_option=e(this.parse_select_option,this),this.parse_select_options=e(this.parse_select_options,this),this.add_select_option=e(this.add_select_option,this),this.is_uid=e(this.is_uid,this),this.get_portal_url=e(this.get_portal_url,this),this.get_url=e(this.get_url,this),this.ajax_submit=e(this.ajax_submit,this),this.load_object_by_uid=e(this.load_object_by_uid,this),this.load_manual_interims=e(this.load_manual_interims,this),this.load_calculation=e(this.load_calculation,this),this.load_method_calculation=e(this.load_method_calculation,this),this.load_instrument_methods=e(this.load_instrument_methods,this),this.load_available_instruments=e(this.load_available_instruments,this),this.show_alert=e(this.show_alert,this),this.set_instrument_methods=e(this.set_instrument_methods,this),this.set_method_calculation=e(this.set_method_calculation,this),this.flush_interims=e(this.flush_interims,this),this.set_interims=e(this.set_interims,this),this.get_interims=e(this.get_interims,this),this.select_calculation=e(this.select_calculation,this),this.set_calculation=e(this.set_calculation,this),this.get_calculation=e(this.get_calculation,this),this.toggle_use_default_calculation_of_method=e(this.toggle_use_default_calculation_of_method,this),this.use_default_calculation_of_method=e(this.use_default_calculation_of_method,this),this.select_default_instrument=e(this.select_default_instrument,this),this.set_default_instrument=e(this.set_default_instrument,this),this.get_default_instrument=e(this.get_default_instrument,this),this.select_default_method=e(this.select_default_method,this),this.set_default_method=e(this.set_default_method,this),this.get_default_method=e(this.get_default_method,this),this.select_instruments=e(this.select_instruments,this),this.set_instruments=e(this.set_instruments,this),this.get_instruments=e(this.get_instruments,this),this.toggle_instrument_assignment_allowed=e(this.toggle_instrument_assignment_allowed,this),this.is_instrument_assignment_allowed=e(this.is_instrument_assignment_allowed,this),this.select_methods=e(this.select_methods,this),this.set_methods=e(this.set_methods,this),this.get_methods=e(this.get_methods,this),this.toggle_manual_entry_of_results_allowed=e(this.toggle_manual_entry_of_results_allowed,this),this.is_manual_entry_of_results_allowed=e(this.is_manual_entry_of_results_allowed,this),this.init=e(this.init,this),this.bind_eventhandler=e(this.bind_eventhandler,this),this.load=e(this.load,this)}window.AnalysisServiceEditView=(t.prototype.load=function(){var e,t;return console.debug("AnalysisServiceEditView::load"),this.all_instruments={},this.invalid_instruments={},e=this.load_available_instruments().done(function(e){var n=this;return $.each(e,function(e,t){var i=t.UID;if("1"!==(n.all_instruments[i]=t).Valid)return n.invalid_instruments[i]=t})}),this.manual_interims=[],t=this.load_manual_interims().done(function(e){return this.manual_interims=e}),this.selected_methods=this.get_methods(),this.selected_instruments=this.get_instruments(),this.selected_calculation=this.get_calculation(),this.selected_default_instrument=this.get_default_instrument(),this.selected_default_method=this.get_default_method(),this.methods=this.parse_select_options($("#archetypes-fieldname-Methods #Methods")),this.instruments=this.parse_select_options($("#archetypes-fieldname-Instruments #Instruments")),this.calculations=this.parse_select_options($("#archetypes-fieldname-Calculation #Calculation")),this.bind_eventhandler(),$.when(e,t).then(this.init),window.asv=this},t.prototype.bind_eventhandler=function(){return console.debug("AnalysisServiceEditView::bind_eventhandler"),$("body").on("change","#archetypes-fieldname-ManualEntryOfResults #ManualEntryOfResults",this.on_manual_entry_of_results_change),$("body").on("change","#archetypes-fieldname-Methods #Methods",this.on_methods_change),$("body").on("change","#archetypes-fieldname-InstrumentEntryOfResults #InstrumentEntryOfResults",this.on_instrument_assignment_allowed_change),$("body").on("change","#archetypes-fieldname-Instruments #Instruments",this.on_instruments_change),$("body").on("change","#archetypes-fieldname-Instrument #Instrument",this.on_default_instrument_change),$("body").on("change","#archetypes-fieldname-Method #Method",this.on_default_method_change),$("body").on("change","#archetypes-fieldname-UseDefaultCalculation #UseDefaultCalculation",this.on_use_default_calculation_change),$("body").on("change","#archetypes-fieldname-Calculation #Calculation",this.on_calculation_change),$("body").on("change","#archetypes-fieldname-Separate #Separate",this.on_separate_container_change),$("body").on("change","#archetypes-fieldname-Preservation #Preservation",this.on_default_preservation_change),$("body").on("selected","#archetypes-fieldname-Container #Container",this.on_default_container_change),$("body").on("change","#archetypes-fieldname-PartitionSetup [name^='PartitionSetup.sampletype']",this.on_partition_sampletype_change),$("body").on("change","#archetypes-fieldname-PartitionSetup [name^='PartitionSetup.separate']",this.on_partition_separate_container_change),$("body").on("change","#archetypes-fieldname-PartitionSetup [name^='PartitionSetup.container']",this.on_partition_container_change),$("body").on("change","#archetypes-fieldname-PartitionSetup [name^='PartitionSetup.vol']",this.on_partition_required_volume_change)},t.prototype.init=function(){return this.is_manual_entry_of_results_allowed()?(console.debug("--\x3e Manual Entry of Results is allowed"),this.set_methods(this.methods)):(console.debug("--\x3e Manual Entry of Results is **not** allowed"),this.set_methods(null)),this.is_instrument_assignment_allowed()?(console.debug("--\x3e Instrument assignment is allowed"),this.set_instruments(this.instruments)):(console.debug("--\x3e Instrument assignment is **not** allowed"),this.set_instruments(null)),this.use_default_calculation_of_method()?console.debug("--\x3e Use default calculation of method"):console.debug("--\x3e Use default calculation of instrument")},t.prototype.is_manual_entry_of_results_allowed=function(){return $("#archetypes-fieldname-ManualEntryOfResults #ManualEntryOfResults").is(":checked")},t.prototype.toggle_manual_entry_of_results_allowed=function(e,t){var i;return null==t&&(t=!0),i=$("#archetypes-fieldname-ManualEntryOfResults #ManualEntryOfResults"),this.toggle_checkbox(i,e,t)},t.prototype.get_methods=function(){var e=$("#archetypes-fieldname-Methods #Methods");return $.extend([],e.val())},t.prototype.set_methods=function(e,t){var n,a;return null==t&&(t=!0),n=$("#archetypes-fieldname-Methods #Methods"),e=$.extend([],e),t&&n.empty(),0===e.length?this.add_select_option(n,null):(a=this,$.each(e,function(e,t){var i;if(!1!==t.ManualEntryOfResults)return i=t.title||t.Title,t=t.uid||t.UID,a.add_select_option(n,i,t)})),this.select_methods(this.selected_methods)},t.prototype.select_methods=function(e){var i,n;if(this.is_manual_entry_of_results_allowed())return i=$("#archetypes-fieldname-Methods #Methods"),this.select_options(i,e),n=this,$.each(e,function(e,t){var e=0===e,t=i.find("option[value="+t+"]"),t={uid:t.val(),title:t.text()};return n.set_default_method(t,e)}),this.select_default_method(this.selected_default_method),this.use_default_calculation_of_method()?this.set_method_calculation(this.get_default_method()):void 0;console.debug("Manual entry of results is not allowed")},t.prototype.is_instrument_assignment_allowed=function(){return $("#archetypes-fieldname-InstrumentEntryOfResults #InstrumentEntryOfResults").is(":checked")},t.prototype.toggle_instrument_assignment_allowed=function(e,t){var i;return null==t&&(t=!0),i=$("#archetypes-fieldname-InstrumentEntryOfResults #InstrumentEntryOfResults"),this.toggle_checkbox(i,e,t)},t.prototype.get_instruments=function(){var e=$("#archetypes-fieldname-Instruments #Instruments");return $.extend([],e.val())},t.prototype.set_instruments=function(e,t){var n,a;return null==t&&(t=!0),n=$("#archetypes-fieldname-Instruments #Instruments"),e=$.extend([],e),t&&n.empty(),0===e.length?this.add_select_option(n,null):(a=this,$.each(e,function(e,t){var i=t.uid||t.UID,t=t.title||t.Title;return a.add_select_option(n,t,i)})),this.select_instruments(this.selected_instruments)},t.prototype.select_instruments=function(e){var t,n,a,i;return this.is_instrument_assignment_allowed()?(t=$("#archetypes-fieldname-Instruments #Instruments"),this.select_options(t,e),n=[],a=this,$.each(e,function(e,t){var i=0===e,e=a.all_instruments[t];return t in a.invalid_instruments&&(console.warn("Instrument '"+e.Title+"' is invalid"),n.push(e)),a.set_default_instrument(e,i)}),0<n.length?(i=$("<dl/>"),$.each(n,function(e,t){return i.append("<dd>âš  "+t.Title+"</dd>")}),e=_t("Some of the selected instruments are out-of-date, with failed calibration tests or under maintenance"),this.show_alert({title:e,message:i[0].outerHTML})):this.show_alert({message:""}),this.select_default_instrument(this.selected_default_instrument),this.set_instrument_methods(this.get_default_instrument())):(console.debug("Instrument assignment not allowed"),void this.set_default_instrument(null))},t.prototype.get_default_method=function(){return $("#archetypes-fieldname-Method #Method").val()},t.prototype.set_default_method=function(e,t){var i;return null==t&&(t=!0),i=$("#archetypes-fieldname-Method #Method"),e=$.extend({},e),t&&i.empty(),t=e.title||e.Title,e=e.uid||e.UID,t&&e?this.add_select_option(i,t,e):this.add_select_option(i,null)},t.prototype.select_default_method=function(e){var t=$("#archetypes-fieldname-Method #Method");return this.select_options(t,[e])},t.prototype.get_default_instrument=function(){return $("#archetypes-fieldname-Instrument #Instrument").val()},t.prototype.set_default_instrument=function(e,t){var i;return null==t&&(t=!0),i=$("#archetypes-fieldname-Instrument #Instrument"),e=$.extend({},e),t&&i.empty(),t=e.title||e.Title,e=e.uid||e.UID,t&&e?this.add_select_option(i,t,e):this.add_select_option(i,null)},t.prototype.select_default_instrument=function(e){var t=$("#archetypes-fieldname-Instrument #Instrument");return this.select_options(t,[e])},t.prototype.use_default_calculation_of_method=function(){return $("#archetypes-fieldname-UseDefaultCalculation #UseDefaultCalculation").is(":checked")},t.prototype.toggle_use_default_calculation_of_method=function(e,t){var i;return null==t&&(t=!0),i=$("#archetypes-fieldname-UseDefaultCalculation #UseDefaultCalculation"),this.toggle_checkbox(i,e,t)},t.prototype.get_calculation=function(){return $("#archetypes-fieldname-Calculation #Calculation").val()},t.prototype.set_calculation=function(e,t){var i;return null==t&&(t=!0),i=$("#archetypes-fieldname-Calculation #Calculation"),e=$.extend({},e),t&&i.empty(),t=e.title||e.Title,e=e.uid||e.UID,t&&e?this.add_select_option(i,t,e):this.add_select_option(i,null)},t.prototype.select_calculation=function(e){var t=$("#archetypes-fieldname-Calculation #Calculation");return this.select_options(t,[e]),this.load_calculation(e).done(function(e){return this.set_interims(e.InterimFields)})},t.prototype.get_interims=function(){var e=$("#archetypes-fieldname-InterimFields").find("tr.records_row_InterimFields"),i=[];return $.each(e,function(e,t){var a={},t=t.querySelectorAll("td input");return $.each(t,function(e,t){var i=this.name.split(":")[0].split(".")[1],n=t.value;return"checkbox"===t.type&&(n=t.checked),a[i]=n,!0}),""!==a.keyword&&i.push(a),!0}),i},t.prototype.set_interims=function(n,e){var i,a,s;return null==e&&(e=!0),n=$.extend([],n),i=$("#archetypes-fieldname-InterimFields"),s=i.find("#InterimFields_more"),e&&this.flush_interims(),a=n.map(function(e){return e.keyword}),$.each(this.manual_interims,function(e,t){var i=a.indexOf(t.keyword);return 0<=i?n[i]=t:n.push(t)}),$.each(n,function(e,n){var t=i.find("tr.records_row_InterimFields").last();return s.click(),t=t.find("input"),$.each(t,function(e,t){var i=this.name.split(":")[0].split(".")[1],i=n[i];return"checkbox"===t.type?(t.checked=i,t.value="on"):(i=i||"",t.value=i),!0})})},t.prototype.flush_interims=function(){var e=$("#archetypes-fieldname-InterimFields");return e.find("#InterimFields_more").click(),e.find("tr.records_row_InterimFields").not(":last").remove()},t.prototype.set_method_calculation=function(e){return this.is_uid(e)?this.load_method_calculation(e).done(function(e){return this.set_calculation(e),this.set_interims(e.InterimFields)}):(this.set_interims(null),this.set_calculation(null))},t.prototype.set_instrument_methods=function(e,i){var n;if(null==i&&(i=!0),(n=this).is_uid(e))return this.load_instrument_methods(e).done(function(e){if(e=$.extend([],e),$.each(e,function(e,t){return i=0===e,n.set_default_method(t,i)}),this.select_default_method(this.selected_default_method),this.use_default_calculation_of_method())return this.set_method_calculation(this.get_default_method())})},t.prototype.show_alert=function(e){var t=e.title||"",i=e.message||"",n=e.level||"warning",a=e.flush||!0,e=$("#viewlet-above-content #alerts");return 0===e.length&&$("#viewlet-above-content").append("<div id='alerts'></div>"),e=$("#viewlet-above-content #alerts"),a&&e.empty(),""===i&&e.remove(),i='<div class="alert alert-'+n+' errorbox" role="alert">\n  <h3>'+t+"</h3>\n  <div>"+i+"</div>\n</div>",e.append(i)},t.prototype.load_available_instruments=function(){var t=$.Deferred(),e={url:this.get_portal_url()+"/@@API/read",data:{catalog_name:"bika_setup_catalog",page_size:0,portal_type:"Instrument"}};return this.ajax_submit(e).done(function(e){return e.objects?t.resolveWith(this,[e.objects]):t.resolveWith(this,[[]])}),t.promise()},t.prototype.load_instrument_methods=function(e){var t=$.Deferred();return this.is_uid(e)?(e={url:this.get_portal_url()+"/get_instrument_methods",data:{uid:e}},this.ajax_submit(e).done(function(e){return e.methods||t.resolveWith(this,[[]]),t.resolveWith(this,[e.methods])})):t.resolveWith(this,[[]]),t.promise()},t.prototype.load_method_calculation=function(e){var t=$.Deferred();return this.is_uid(e)?(e={url:this.get_portal_url()+"/get_method_calculation",data:{uid:e}},this.ajax_submit(e).done(function(e){return this.is_uid(e.uid)?this.load_calculation(e.uid).done(function(e){return t.resolveWith(this,[e])}):t.resolveWith(this,[{}])})):t.resolveWith(this,[{}]),t.promise()},t.prototype.load_calculation=function(i){var e,n=$.Deferred();return this.is_uid(i)?(e={url:this.get_portal_url()+"/@@API/read",data:{catalog_name:"bika_setup_catalog",page_size:0,UID:i,is_active:!0,sort_on:"sortable_title"}},this.ajax_submit(e).done(function(e){var t={};return 1===e.objects.length?t=e.objects[0]:console.warn("Invalid data returned for calculation UID "+i+": ",e),n.resolveWith(this,[t])})):n.resolveWith(this,[{}]),n.promise()},t.prototype.load_manual_interims=function(){var t=$.Deferred();return this.load_calculation(this.get_calculation()).done(function(e){var n=$.extend([],e.InterimFields),a=n.map(function(e){return e.keyword}),s=[];return $.each(this.get_interims(),function(e,i){var t=i.keyword;return o.call(a,t)<0?s.push(i):(t=a.indexOf(i.keyword),t=n[t],$.each(t,function(e,t){if(t!==i[e])return s.push(i),!1}))}),t.resolveWith(this,[s])}),t.promise()},t.prototype.load_object_by_uid=function(e){var i=$.Deferred(),e={url:this.get_portal_url()+"/@@API/read",data:{catalog_name:"uid_catalog",page_size:0,UID:e}};return this.ajax_submit(e).done(function(e){var t={};return 1===e.objects.length&&(t=e.objects[0]),i.resolveWith(this,[t])}),i.promise()},t.prototype.ajax_submit=function(e){var t;return console.debug("Â°Â°Â° ajax_submit Â°Â°Â°"),null==e&&(e={}),null==e.type&&(e.type="POST"),null==e.url&&(e.url=this.get_portal_url()),null==e.context&&(e.context=this),null==e.dataType&&(e.dataType="json"),null==e.data&&(e.data={}),null==(t=e.data)._authenticator&&(t._authenticator=$("input[name='_authenticator']").val()),console.debug(">>> ajax_submit::options=",e),$(this).trigger("ajax:submit:start"),t=function(){return $(this).trigger("ajax:submit:end")},$.ajax(e).done(t)},t.prototype.get_url=function(){var e=window.location;return e.protocol+"//"+e.host+e.pathname},t.prototype.get_portal_url=function(){return window.portal_url},t.prototype.is_uid=function(e){return"string"==typeof e&&null!==e.match(/[a-z0-9]{32}/)},t.prototype.add_select_option=function(e,t,i){t=i?"<option value='"+i+"'>"+_t(t)+"</option>":"<option selected='selected' value=''>"+_t("None")+"</option>";return $(e).append(t)},t.prototype.parse_select_options=function(e){var n=[];return $.each($(e).children(),function(e,t){var i=t.value,t=t.innerText;if(i)return n.push({uid:i,title:t})}),n},t.prototype.parse_select_option=function(e,t){var i=field.find("option[value="+uid+"]");return{uid:i.val()||"",title:i.text()||""}},t.prototype.select_options=function(e,n){return $.each($(e).children(),function(e,t){var i=t.value;if(!(o.call(n,i)<0))return t.selected="selected"})},t.prototype.toggle_checkbox=function(e,t,i){if(null==i&&(i=!0),e=$(e),void 0===t&&(t=!e.is(":checked")),e.prop("checked",t),!i)return e.trigger("change")},t.prototype.on_manual_entry_of_results_change=function(e){return console.debug("Â°Â°Â° AnalysisServiceEditView::on_manual_entry_of_results_change Â°Â°Â°"),this.is_manual_entry_of_results_allowed()?(console.debug("Manual entry of results is allowed"),this.set_methods(this.methods)):(console.debug("Manual entry of results is **not** allowed"),this.set_methods(null))},t.prototype.on_methods_change=function(e){var t;return console.debug("Â°Â°Â° AnalysisServiceEditView::on_methods_change Â°Â°Â°"),0===(t=this.get_methods()).length&&console.warn("All methods deselected"),this.select_methods(t)},t.prototype.on_instrument_assignment_allowed_change=function(e){return console.debug("Â°Â°Â° AnalysisServiceEditView::on_instrument_assignment_allowed_change Â°Â°Â°"),this.is_instrument_assignment_allowed()?(console.debug("Instrument assignment is allowed"),this.set_instruments(this.instruments)):(console.debug("Instrument assignment is **not** allowed"),this.set_instruments(null))},t.prototype.on_instruments_change=function(e){var t;return console.debug("Â°Â°Â° AnalysisServiceEditView::on_instruments_change Â°Â°Â°"),0===(t=this.get_instruments()).length&&console.warn("All instruments deselected"),this.select_instruments(t)},t.prototype.on_default_instrument_change=function(e){return console.debug("Â°Â°Â° AnalysisServiceEditView::on_default_instrument_change Â°Â°Â°"),this.set_instrument_methods(this.get_default_instrument())},t.prototype.on_default_method_change=function(e){if(console.debug("Â°Â°Â° AnalysisServiceEditView::on_default_method_change Â°Â°Â°"),this.use_default_calculation_of_method())return this.set_method_calculation(this.get_default_method())},t.prototype.on_use_default_calculation_change=function(e){var i;return console.debug("Â°Â°Â° AnalysisServiceEditView::on_use_default_calculation_change Â°Â°Â°"),this.use_default_calculation_of_method()?(console.debug("Use default calculation"),this.set_method_calculation(this.get_default_method())):(i=this,$.each(this.calculations,function(e,t){e=0===e;return i.set_calculation(t,e)}),this.selected_calculation?this.select_calculation(this.selected_calculation):this.select_calculation(this.get_calculation()))},t.prototype.on_calculation_change=function(e){return console.debug("Â°Â°Â° AnalysisServiceEditView::on_calculation_change Â°Â°Â°"),this.select_calculation(this.get_calculation())},t.prototype.on_separate_container_change=function(e){return console.debug("Â°Â°Â° AnalysisServiceEditView::on_separate_container_change Â°Â°Â°"),e.currentTarget.checked},t.prototype.on_default_preservation_change=function(e){return console.debug("Â°Â°Â° AnalysisServiceEditView::on_default_preservation_change Â°Â°Â°")},t.prototype.on_default_container_change=function(e){var t;return console.debug("Â°Â°Â° AnalysisServiceEditView::on_default_container_change Â°Â°Â°"),e=e.currentTarget.getAttribute("uid"),t=$("#archetypes-fieldname-Preservation #Preservation"),this.load_object_by_uid(e).done(function(e){return e?(t.val(e.Preservation),t.prop("disabled",!0)):(t.val(""),t.prop("disabled",!1))})},t.prototype.on_partition_sampletype_change=function(e){var t;return console.debug("Â°Â°Â° AnalysisServiceEditView::on_partition_sampletype_change Â°Â°Â°"),e=(t=e.currentTarget).value,this.load_object_by_uid(e).done(function(e){e=e.MinimumVolume||"";return $(t).parents("tr").find("[name^='PartitionSetup.vol']").val(e)})},t.prototype.on_partition_separate_container_change=function(e){return console.debug("Â°Â°Â° AnalysisServiceEditView::on_partition_separate_container_change Â°Â°Â°")},t.prototype.on_partition_container_change=function(e){var t,i;return console.debug("Â°Â°Â° AnalysisServiceEditView::on_partition_container_change Â°Â°Â°"),e=(t=e.currentTarget).value,i=$(t).parents("tr").find("[name^='PartitionSetup.preservation']"),this.load_object_by_uid(e).done(function(e){return $.isEmptyObject(e)?$(i).prop("disabled",!1):($(t).val(e.UID),$(i).val(e.Preservation),$(i).prop("disabled",!0))})},t.prototype.on_partition_required_volume_change=function(e){return console.debug("Â°Â°Â° AnalysisServiceEditView::on_partition_required_volume_change Â°Â°Â°")},t)}.call(this),function(){function e(e,t){return function(){return e.apply(t,arguments)}}function t(){this.on_toggle_change=e(this.on_toggle_change,this),this.bind_eventhandler=e(this.bind_eventhandler,this),this.load=e(this.load,this)}window.ReportFolderView=(t.prototype.load=function(){return console.debug("ReportFolderView::load"),this.bind_eventhandler()},t.prototype.bind_eventhandler=function(){return console.debug("ReportFolderView::bind_eventhandler"),$("body").on("click","a[id$='_selector']",this.on_toggle_change)},t.prototype.on_toggle_change=function(e){return console.debug("Â°Â°Â° ReportFolderView::on_toggle_change Â°Â°Â°"),e.preventDefault(),$(".criteria").toggle(!1),e=e.currentTarget.id.split("_selector")[0],$("[id='"+e+"']").toggle(!0)},t)}.call(this),function(){function e(e,t){return function(){return e.apply(t,arguments)}}function t(){this.on_service_info_click=e(this.on_service_info_click,this),this.on_reference_definition_list_change=e(this.on_reference_definition_list_change,this),this.on_numeric_field_keypress=e(this.on_numeric_field_keypress,this),this.on_numeric_field_paste=e(this.on_numeric_field_paste,this),this.on_at_float_field_keyup=e(this.on_at_float_field_keyup,this),this.on_at_integer_field_keyup=e(this.on_at_integer_field_keyup,this),this.notify_in_panel=e(this.notify_in_panel,this),this.notificationPanel=e(this.notificationPanel,this),this.set_cookie=e(this.set_cookie,this),this.setCookie=e(this.setCookie,this),this.read_cookie=e(this.read_cookie,this),this.readCookie=e(this.readCookie,this),this.log=e(this.log,this),this.portal_alert=e(this.portal_alert,this),this.portalAlert=e(this.portalAlert,this),this.get_authenticator=e(this.get_authenticator,this),this.get_portal_url=e(this.get_portal_url,this),this.init_referencedefinition=e(this.init_referencedefinition,this),this.init_datepickers=e(this.init_datepickers,this),this.bind_eventhandler=e(this.bind_eventhandler,this),this.load=e(this.load,this)}window.SiteView=(t.prototype.load=function(){return console.debug("SiteView::load"),this.init_datepickers(),this.bind_eventhandler(),this.allowed_keys=[8,9,13,35,36,37,39,46,44,60,62,45,69,101,61]},t.prototype.bind_eventhandler=function(){return console.debug("SiteView::bind_eventhandler"),$("body").on("change","#ReferenceDefinition\\:list",this.on_reference_definition_list_change),$("body").on("keypress",".numeric",this.on_numeric_field_keypress),$("body").on("paste",".numeric",this.on_numeric_field_paste),$("body").on("keyup","input[name*='\\:int'], .ArchetypesIntegerWidget input",this.on_at_integer_field_keyup),$("body").on("keyup","input[name*='\\:float'], .ArchetypesDecimalWidget input",this.on_at_float_field_keyup),$("body").on("click","a.service_info",this.on_service_info_click),$(document).on({ajaxStart:function(){$("body").addClass("loading")},ajaxStop:function(){$("body").removeClass("loading")},ajaxError:function(){$("body").removeClass("loading")}})},t.prototype.init_datepickers=function(){var i,e,t,n,a;return console.debug("SiteView::init_datepickers"),a="1900:"+(e=new Date).getFullYear(),t=("undefined"!=typeof i18n&&null!==i18n?i18n.currentLanguage:void 0)||"en",n=$.datepicker.regional[t]||$.datepicker.regional[""],"date_format_short_datepicker"===(t=_t("date_format_short_datepicker"))&&(t="yy-mm-dd"),i=Object.assign(n,{dateFormat:t,timeFormat:"HH:mm",showOn:"focus",showAnim:"fadeIn",changeMonth:!0,changeYear:!0,showWeek:!0,yearRange:a,numberOfMonths:1}),a=function(e){var t;return void 0===e&&(e={}),t=Object.assign({},i),Object.assign(t,e)},$("input.datepicker_nofuture").datepicker(a({maxDate:e})),$("input.datepicker").datepicker(a()),$("input.datepicker_2months").datepicker(a({maxDate:e,numberOfMonths:2})),$("input.datetimepicker_nofuture").datetimepicker(a({maxDate:e}))},t.prototype.init_referencedefinition=function(){if(console.debug("SiteView::init_referencedefinition"),""!==$("#ReferenceDefinition:list").val())return console.warn("SiteView::init_referencedefinition: Refactor this method!"),$("#ReferenceDefinition:list").change()},t.prototype.get_portal_url=function(){return window.portal_url},t.prototype.get_authenticator=function(){return console.warn("SiteView::get_authenticator: Please use site.authenticator instead"),window.site.authenticator()},t.prototype.portalAlert=function(e){return console.warn("SiteView::portalAlert: Please use portal_alert method instead."),this.portal_alert(e)},t.prototype.portal_alert=function(e){var t;console.debug("SiteView::portal_alert"),0===(t=$("#portal-alert")).length?$("#portal-header").append("<div id='portal-alert' style='display:none'><div class='portal-alert-item'>"+e+"</div></div>"):t.append("<div class='portal-alert-item'>"+e+"</div>"),t.fadeIn()},t.prototype.log=function(e){return console.debug("SiteView::log: message="+e),window.bika.lims.log(e)},t.prototype.readCookie=function(e){return console.warn("SiteView::readCookie: Please use site.read_cookie instead"),window.site.read_cookie(e)},t.prototype.read_cookie=function(e){return console.warn("SiteView::read_cookie. Please use site.read_cookie instead"),window.site.read_cookie(e)},t.prototype.setCookie=function(e,t){return console.warn("SiteView::setCookie. Please use site.set_cookie instead"),window.site.set_cookie(e,t)},t.prototype.set_cookie=function(e,t){console.warn("SiteView::set_cookie. Please use site.set_cookie instead"),window.site.set_cookie(e,t)},t.prototype.notificationPanel=function(e,t){return console.warn("SiteView::notificationPanel: Please use notfiy_in_panel method instead."),this.notify_in_panel(e,t)},t.prototype.notify_in_panel=function(e,t){console.debug("SiteView::notify_in_panel:data="+e+", mode="+t),$("#panel-notification").remove(),e="<div id='panel-notification' style='display:none'><div class='"+t+"-notification-item'>"+e+"</div></div>",$("div#viewlet-above-content-title").append(e),$("#panel-notification").fadeIn("slow","linear",function(){setTimeout(function(){$("#panel-notification").fadeOut("slow","linear")},3e3)})},t.prototype.on_at_integer_field_keyup=function(e){console.debug("Â°Â°Â° SiteView::on_at_integer_field_keyup Â°Â°Â°"),e=e.currentTarget,e=$(e),/\D/g.test(e.val())&&e.val(e.val().replace(/\D/g,""))},t.prototype.on_at_float_field_keyup=function(e){console.debug("Â°Â°Â° SiteView::on_at_float_field_keyup Â°Â°Â°"),e=e.currentTarget,e=$(e),/[^-.\d]/g.test(e.val())&&e.val(e.val().replace(/[^.\d]/g,""))},t.prototype.on_numeric_field_paste=function(e){var t;console.debug("Â°Â°Â° SiteView::on_numeric_field_paste Â°Â°Â°"),e=e.currentTarget,t=$(e),window.setTimeout(function(){t.val(t.val().replace(",","."))},0)},t.prototype.on_numeric_field_keypress=function(e){var t,i,n;console.debug("Â°Â°Â° SiteView::on_numeric_field_keypress Â°Â°Â°"),i=e.currentTarget,t=$(i),n=e.which,i=this.allowed_keys.join(",").match(new RegExp(n)),!n||48<=n&&n<=57||i?window.setTimeout(function(){t.val(t.val().replace(",","."))},0):e.preventDefault()},t.prototype.on_reference_definition_list_change=function(e){var t,i;if(console.debug("Â°Â°Â° SiteView::on_reference_definition_list_change Â°Â°Â°"),i=e.currentTarget,t=$(i),e=this.get_authenticator(),i=t.val(),t=t.children(":selected").html(),""===i)return $("#Blank").prop("checked",!1),$("#Hazardous").prop("checked",!1),void $(".bika-listing-table").load("referenceresults",{_authenticator:e});-1<t.search(_t("(Blank)"))||-1<t.search("(Blank)")?$("#Blank").prop("checked",!0):$("#Blank").prop("checked",!1),-1<t.search(_t("(Hazardous)"))||-1<t.search("(Hazardous)")?$("#Hazardous").prop("checked",!0):$("#Hazardous").prop("checked",!1),$(".bika-listing-table").load("referenceresults",{_authenticator:e,uid:i})},t.prototype.on_service_info_click=function(e){return console.debug("Â°Â°Â° SiteView::on_service_info_click Â°Â°Â°"),e.preventDefault(),e=e.currentTarget,$(e).prepOverlay({subtype:"ajax",width:"80%",filter:"#content>*:not(div#portal-column-content)",config:{closeOnClick:!0,closeOnEsc:!0,onBeforeLoad:function(e){return this.getOverlay().draggable()},onLoad:function(e){return e=new Event("DOMContentLoaded",{}),window.document.dispatchEvent(e)}}}),$(e).click()},t)}.call(this),function(){window.AttachmentsUtils=function(){this.load=function(){$("#AttachFile,#Service,#Analysis").change(function(e){var t,i,n=$("#AttachFile").val();void 0===n&&(n=""),void 0===(i=$("#Service").val())&&(i=""),void 0===(t=$("#Analysis").val())&&(t=""),"Service"===this.id&&$("#Analysis").val(""),"Analysis"===this.id&&$("#Service").val(""),""===n||""===i&&""===t?$("#addButton").prop("disabled",!0):$("#addButton").removeAttr("disabled")}),$("#Analysis").combogrid({colModel:[{columnName:"analysis_uid",hidden:!0},{columnName:"slot",width:"10",label:_t("Slot")},{columnName:"service",width:"35",label:_t("Service")},{columnName:"parent",width:"35",label:_t("Parent")},{columnName:"type",width:"20",label:_t("Type")}],url:window.location.href.replace("/manage_results","")+"/attachAnalyses?_authenticator="+$('input[name="_authenticator"]').val(),showOn:!0,width:"650px",select:function(e,t){return $("#Analysis").val(t.item.service+(" (slot "+t.item.slot)+")"),$("#analysis_uid").val(t.item.analysis_uid),$(this).change(),!1}})}}}.call(this),$(document).ready(function(){window.bika=window.bika||{lims:{}},window.bika.lims.barcode_listener=new function(){this.load=function(){var t=!1,i="";$(window).keypress(function(e){"BODY"==e.target.tagName&&(t?i+=String.fromCharCode(e.which):(t=!0,i=String.fromCharCode(e.which),setTimeout(function(){var e;t=!1,2<i.length&&(e=i,authenticator=$('input[name="_authenticator"]').val(),$.ajax({type:"POST",url:"barcode_entry",data:{entry:e,_authenticator:authenticator},success:function(e,t,i,n){e.success&&(window.location.href=e.url)}}))},500)))})}},window.bika.lims.barcode_listener.load()}),function(){function e(e,t){return function(){return e.apply(t,arguments)}}function t(){this.on_instrument_change=e(this.on_instrument_change,this),this.on_template_change=e(this.on_template_change,this),this.select_instrument=e(this.select_instrument,this),this.get_template_instrument=e(this.get_template_instrument,this),this.bind_eventhandler=e(this.bind_eventhandler,this),this.load=e(this.load,this)}function i(){this.on_referencesample_row_click=e(this.on_referencesample_row_click,this),this.on_service_click=e(this.on_service_click,this),this.load_controls=e(this.load_controls,this),this.get_postion=e(this.get_postion,this),this.get_control_type=e(this.get_control_type,this),this.get_selected_services=e(this.get_selected_services,this),this.get_authenticator=e(this.get_authenticator,this),this.get_base_url=e(this.get_base_url,this),this.ajax_submit=e(this.ajax_submit,this),this.bind_eventhandler=e(this.bind_eventhandler,this),this.load=e(this.load,this)}function n(){this.on_duplicate_row_click=e(this.on_duplicate_row_click,this),this.get_postion=e(this.get_postion,this),this.bind_eventhandler=e(this.bind_eventhandler,this),this.load=e(this.load,this)}function a(){this.on_wideinterims_apply_click=e(this.on_wideinterims_apply_click,this),this.on_slot_remarks_click=e(this.on_slot_remarks_click,this),this.on_wideiterims_interims_change=e(this.on_wideiterims_interims_change,this),this.on_wideiterims_analyses_change=e(this.on_wideiterims_analyses_change,this),this.on_remarks_balloon_clicked=e(this.on_remarks_balloon_clicked,this),this.on_analysis_instrument_change=e(this.on_analysis_instrument_change,this),this.on_analysis_instrument_focus=e(this.on_analysis_instrument_focus,this),this.on_method_change=e(this.on_method_change,this),this.on_instrument_change=e(this.on_instrument_change,this),this.on_layout_change=e(this.on_layout_change,this),this.on_analyst_change=e(this.on_analyst_change,this),this.on_constraints_loaded=e(this.on_constraints_loaded,this),this.load_analysis_method_constraint=e(this.load_analysis_method_constraint,this),this.is_instrument_allowed=e(this.is_instrument_allowed,this),this.get_method_by_analysis_uid=e(this.get_method_by_analysis_uid,this),this.get_analysis_uids=e(this.get_analysis_uids,this),this.get_authenticator=e(this.get_authenticator,this),this.get_base_url=e(this.get_base_url,this),this.get_portal_url=e(this.get_portal_url,this),this.ajax_submit=e(this.ajax_submit,this),this.init_instruments_and_methods=e(this.init_instruments_and_methods,this),this.bind_eventhandler=e(this.bind_eventhandler,this),this.load=e(this.load,this)}window.WorksheetFolderView=(t.prototype.load=function(){return console.debug("WorksheetFolderView::load"),this.bind_eventhandler()},t.prototype.bind_eventhandler=function(){return console.debug("WorksheetFolderView::bind_eventhandler"),$("body").on("change","select.template",this.on_template_change),$("body").on("change","select.instrument",this.on_instrument_change)},t.prototype.get_template_instrument=function(){var e;return console.debug("WorksheetFolderView::get_template_instruments"),e=$("input.templateinstruments").val(),JSON.parse(e)},t.prototype.select_instrument=function(e){e=$(".instrument").find("option[value='"+e+"']");if(e)return e.prop("selected",!0)},t.prototype.on_template_change=function(e){return console.debug("Â°Â°Â° WorksheetFolderView::on_template_change Â°Â°Â°"),e=$(e.currentTarget).val(),e=this.get_template_instrument()[e],this.select_instrument(e)},t.prototype.on_instrument_change=function(e){if(console.debug("Â°Â°Â° WorksheetFolderView::on_instrument_change Â°Â°Â°"),$(e.currentTarget).val())return e=_t("Only the analyses for which the selected instrument is allowed will be added automatically."),bika.lims.SiteView.notify_in_panel(e,"error")},t),window.WorksheetAddQCAnalysesView=(i.prototype.load=function(){return console.debug("WorksheetAddQCAnalysesView::load"),this.bind_eventhandler(),this.load_controls()},i.prototype.bind_eventhandler=function(){return console.debug("WorksheetAddQCAnalysesView::bind_eventhandler"),$("body").on("click","#worksheet_services input[id*='_cb_']",this.on_service_click),$("body").on("click","#worksheet_add_references .bika-listing-table tbody.item-listing-tbody tr",this.on_referencesample_row_click)},i.prototype.ajax_submit=function(e){var t,i;return null==e&&(e={}),console.debug("Â°Â°Â° ajax_submit Â°Â°Â°"),null==e.type&&(e.type="POST"),null==e.url&&(e.url=this.get_base_url()),null==e.context&&(e.context=this),console.debug(">>> ajax_submit::options=",e),$(this).trigger("ajax:submit:start"),i=this,t=function(){return $(i).trigger("ajax:submit:end")},$.ajax(e).done(t)},i.prototype.get_base_url=function(){return window.location.href.split("?")[0]},i.prototype.get_authenticator=function(){return $("input[name='_authenticator']").val()},i.prototype.get_selected_services=function(){var e=$("table.bika-listing-table"),i=[];return $("input:checked",e).each(function(e,t){return i.push(t.value)}),i},i.prototype.get_control_type=function(){var e="b";return-1<window.location.href.search("add_control")&&(e="c"),e},i.prototype.get_postion=function(){return $("#position").val()||"new"},i.prototype.load_controls=function(){var e=this.get_base_url(),e=(e=e.replace("/add_blank","").replace("/add_control",""))+"/getWorksheetReferences",t=$("#worksheet_add_references");if(0!==t.length)return this.ajax_submit({url:e,data:{service_uids:this.get_selected_services().join(","),control_type:this.get_control_type(),_authenticator:this.get_authenticator()}}).done(function(e){return t.html(e)});console.warn("Element with id='#worksheet_add_references' missing!")},i.prototype.on_service_click=function(e){return console.debug("Â°Â°Â° WorksheetAddQCAnalysesView::on_category_change Â°Â°Â°"),this.load_controls()},i.prototype.on_referencesample_row_click=function(e){var t,i;return console.debug("Â°Â°Â° WorksheetAddQCAnalysesView::on_referencesample_row_click Â°Â°Â°"),i=(t=$(e.currentTarget)).attr("uid"),e=t.parents("form"),t="c"===this.get_control_type()?"add_control":"add_blank",e.attr("action",t),t=this.get_selected_services().join(","),e.append("<input type='hidden' value='"+t+"' name='selected_service_uids'/>"),e.append("<input type='hidden' value='"+i+"' name='reference_uid'/>"),e.append("<input type='hidden' value='"+this.get_postion()+"' name='position'/>"),e.submit()},i),window.WorksheetAddDuplicateAnalysesView=(n.prototype.load=function(){return console.debug("WorksheetAddDuplicateAnalysesView::load"),this.bind_eventhandler()},n.prototype.bind_eventhandler=function(){return console.debug("WorksheetAddDuplicateAnalysesView::bind_eventhandler"),$("body").on("click","#worksheet_add_duplicate_ars .bika-listing-table tbody.item-listing-tbody tr",this.on_duplicate_row_click)},n.prototype.get_postion=function(){return $("#position").val()||"new"},n.prototype.on_duplicate_row_click=function(e){var t;return console.debug("Â°Â°Â° WorksheetAddDuplicateAnalysesView::on_duplicate_row_click Â°Â°Â°"),e=(t=$(e.currentTarget)).attr("uid"),(t=t.parents("form")).attr("action","add_duplicate"),t.append("<input type='hidden' value='"+e+"' name='ar_uid'/>"),t.append("<input type='hidden' value='"+this.get_postion()+"' name='position'/>"),t.submit()},n),window.WorksheetManageResultsView=(a.prototype.load=function(){return console.debug("WorksheetManageResultsView::load"),this._=i18n.MessageFactory("senaite.core"),this._pmf=i18n.MessageFactory("plone"),this.bind_eventhandler(),this.constraints=null,this.init_instruments_and_methods(),window.ws=this},a.prototype.bind_eventhandler=function(){return console.debug("WorksheetManageResultsView::bind_eventhandler"),$("body").on("change",".manage_results_header .analyst",this.on_analyst_change),$("body").on("change","#resultslayout_form #resultslayout",this.on_layout_change),$("body").on("change",".manage_results_header .instrument",this.on_instrument_change),$("body").on("change","table.bika-listing-table select.listing_select_entry[field='Method']",this.on_method_change),$("body").on("focus","table.bika-listing-table select.listing_select_entry[field='Instrument']",this.on_analysis_instrument_focus),$("body").on("change","table.bika-listing-table select.listing_select_entry[field='Instrument']",this.on_analysis_instrument_change),$("body").on("click","a.add-remark",this.on_remarks_balloon_clicked),$("body").on("change","#wideinterims_analyses",this.on_wideiterims_analyses_change),$("body").on("change","#wideinterims_interims",this.on_wideiterims_interims_change),$("body").on("click","#wideinterims_apply",this.on_wideinterims_apply_click),$("body").on("click","img.slot-remarks",this.on_slot_remarks_click),$(this).on("constraints:loaded",this.on_constraints_loaded)},a.prototype.init_instruments_and_methods=function(){var e=this.get_analysis_uids();return this.ajax_submit({url:this.get_portal_url()+"/get_method_instrument_constraints",data:{_authenticator:this.get_authenticator,uids:JSON.stringify(e)},dataType:"json"}).done(function(e){return this.constraints=e,$(this).trigger("constraints:loaded",e)})},a.prototype.ajax_submit=function(e){var t,i;return null==e&&(e={}),console.debug("Â°Â°Â° ajax_submit Â°Â°Â°"),null==e.type&&(e.type="POST"),null==e.url&&(e.url=this.get_base_url()),null==e.context&&(e.context=this),console.debug(">>> ajax_submit::options=",e),$(this).trigger("ajax:submit:start"),i=this,t=function(){return $(i).trigger("ajax:submit:end")},$.ajax(e).done(t)},a.prototype.get_portal_url=function(){return $("input[name=portal_url]").val()||window.portal_url},a.prototype.get_base_url=function(){return window.location.href.split("?")[0]},a.prototype.get_authenticator=function(){return $("input[name='_authenticator']").val()},a.prototype.get_analysis_uids=function(){var i=[],e=$("#item_data").val();return e?(e=JSON.parse(e),$.each(e,function(e,t){return i.push(e)}),i):[]},a.prototype.get_method_by_analysis_uid=function(e){return $("select.listing_select_entry[field='Method'][uid='"+e+"']").val()||""},a.prototype.is_instrument_allowed=function(i){var e,n=!0;return"True"!==$("#instrument_multiple_use").attr("value")&&(e=$("select.listing_select_entry[field='Instrument']"),$.each(e,function(e,t){if(t.value===i)return n=!1})),n},a.prototype.load_analysis_method_constraint=function(e,t){var i,n,a,s,o;if(console.debug("WorksheetManageResultsView::load_analysis_method_constraint:analysis_uid="+e+" method_uid="+t),s=this,t=t||this.get_method_by_analysis_uid(e),i=this.constraints[e],i&&(o=i[t],o&&!(o.length<7)))return a=$("select.listing_select_entry[field='Method'][uid='"+e+"']"),n=$("select.listing_select_entry[field='Instrument'][uid='"+e+"']"),$(a).find('option[value=""]').remove(),1===o[1]&&$(a).prepend("<option value=''>"+_("Not defined")+"</option>"),$(a).val(t),$(a).prop("disabled",!1),$(".method-label[uid='"+e+"']").remove(),0===o[0]?$(a).hide():1===o[0]?$(a).show():2===o[0]?1<i.length&&($(a).hide(),t=$(a).find("option[value='"+t+"']").innerHtml(),$(a).after("<span class='method-label' uid='"+e+"' href='#'>"+t+"</span>")):3===o[0]&&$(a).show(),(a=$(n).val())&&""!==a&&$("table.bika-listing-table select.listing_select_entry[field='Instrument'][value!='"+a+"'] option[value='"+a+"']").prop("disabled",!1),$(n).find("option").remove(),o[7]&&$.each(o[7],function(e,t){return s.is_instrument_allowed(e)?$(n).append("<option value='"+e+"'>"+t+"</option>"):$(n).append("<option value='"+e+"' disabled='disabled'>"+t+"</option>")}),1===o[3]&&$(n).prepend("<option selected='selected' value=''>"+_("None")+"</option>"),s.is_instrument_allowed(o[4])&&($(n).val(o[4]),$("table.bika-listing-table select.listing_select_entry[field='Instrument'][value!='"+o[4]+"'] option[value='"+o[4]+"']").prop("disabled",!0)),0===o[2]?$(n).hide():1===o[2]&&$(n).show(),0===o[5]?($(".interim input[uid='"+e+"']").val(""),$("input[field='Result'][uid='"+e+"']").val(""),$(".interim input[uid='"+e+"']").prop("disabled",!0),$("input[field='Result'][uid='"+e+"']").prop("disabled",!0)):1===o[5]&&($(".interim input[uid='"+e+"']").prop("disabled",!1),$("input[field='Result'][uid='"+e+"']").prop("disabled",!1)),$(".alert-instruments-invalid[uid='"+e+"']").remove(),o[6]&&""!==o[6]&&$(n).after("<img uid='"+e+"' class='alert-instruments-invalid' src='"+this.get_portal_url()+"/++resource++bika.lims.images/warning.png' title='"+o[6]+"'>"),$(".amconstr[uid='"+e+"']").remove()},a.prototype.on_constraints_loaded=function(e){var i;return console.debug("Â°Â°Â° WorksheetManageResultsView::on_constraints_loaded Â°Â°Â°"),i=this,$.each(this.get_analysis_uids(),function(e,t){return i.load_analysis_method_constraint(t,null)})},a.prototype.on_analyst_change=function(e){var t;return console.debug("Â°Â°Â° WorksheetManageResultsView::on_analyst_change Â°Â°Â°"),""!==(t=$(e.currentTarget).val())&&(e=this.get_base_url().replace("/manage_results","")+"/set_analyst",this.ajax_submit({url:e,data:{value:t,_authenticator:this.get_authenticator()},dataType:"json"}).done(function(e){return bika.lims.SiteView.notify_in_panel(this._pmf("Changes saved."),"succeed")}).fail(function(){return bika.lims.SiteView.notify_in_panel(this._t("Could not set the selected analyst"),"error")}))},a.prototype.on_layout_change=function(e){return console.debug("Â°Â°Â° WorksheetManageResultsView::on_layout_change Â°Â°Â°"),$(e.currentTarget)},a.prototype.on_instrument_change=function(e){var t;return console.debug("Â°Â°Â° WorksheetManageResultsView::on_instrument_change Â°Â°Â°"),e=$(e.currentTarget),""!==(t=e.val())&&(e=this.get_base_url().replace("/manage_results","")+"/set_instrument",this.ajax_submit({url:e,data:{value:t,_authenticator:this.get_authenticator()},dataType:"json"}).done(function(e){return bika.lims.SiteView.notify_in_panel(this._pmf("Changes saved."),"succeed"),$("select.listing_select_entry[field='Instrument'] option[value='"+t+"']").parent().find("option[value='"+t+"']").prop("selected",!1),$("select.listing_select_entry[field='Instrument'] option[value='"+t+"']").prop("selected",!0)}).fail(function(){return bika.lims.SiteView.notify_in_panel(this._t("Unable to apply the selected instrument"),"error")}))},a.prototype.on_method_change=function(e){var t;return console.debug("Â°Â°Â° WorksheetManageResultsView::on_method_change Â°Â°Â°"),e=(t=$(e.currentTarget)).attr("uid"),t=t.val(),this.load_analysis_method_constraint(e,t)},a.prototype.on_analysis_instrument_focus=function(e){return console.debug("Â°Â°Â° WorksheetManageResultsView::on_analysis_instrument_focus Â°Â°Â°"),e=$(e.currentTarget),this.previous_instrument=e.val(),console.info(this.previous_instrument)},a.prototype.on_analysis_instrument_change=function(e){return console.debug("Â°Â°Â° WorksheetManageResultsView::on_analysis_instrument_change Â°Â°Â°"),(e=$(e.currentTarget)).attr("uid"),e=e.val(),$("table.bika-listing-table select.listing_select_entry[field='Instrument'][value!='"+e+"'] option[value='"+e+"']").prop("disabled",!0),$("table.bika-listing-table select.listing_select_entry[field='Instrument'] option[value='"+this.previous_instrument+"']").prop("disabled",!1),$("table.bika-listing-table select.listing_select_entry[field='Instrument'] option[value='']").prop("disabled",!1)},a.prototype.on_remarks_balloon_clicked=function(e){var t;return console.debug("Â°Â°Â° WorksheetManageResultsView::on_remarks_balloon_clicked Â°Â°Â°"),t=$(e.currentTarget),e.preventDefault(),t=t.closest("tr").next("tr").find("td.remarks"),$(t).find("div.remarks-placeholder").toggle()},a.prototype.on_wideiterims_analyses_change=function(e){return console.debug("Â°Â°Â° WorksheetManageResultsView::on_wideiterims_analyses_change Â°Â°Â°"),e=$(e.currentTarget),$("#wideinterims_interims").html(""),e=e.val(),$("input[id^='wideinterim_"+e+"']").each(function(e,t){var i=$(t).attr("name"),i="<option value='"+$(t).attr("keyword")+"'>"+i+"</option>";return $("#wideinterims_interims").append(i)})},a.prototype.on_wideiterims_interims_change=function(e){return console.debug("Â°Â°Â° WorksheetManageResultsView::on_wideiterims_interims_change Â°Â°Â°"),e=$(e.currentTarget),e="#wideinterim_"+$("#wideinterims_analyses").val()+"_"+e.val(),$("#wideinterims_value").val($(e).val())},a.prototype.on_slot_remarks_click=function(e){return console.debug("Â°Â°Â° WorksheetManageResultsView::on_slot_remarks_click Â°Â°Â°"),e=e.currentTarget,$(e).prepOverlay({subtype:"ajax",filter:"h1,div.remarks-widget",config:{closeOnClick:!0,closeOnEsc:!0,onBeforeLoad:function(e){var t=this.getOverlay();return $("div.pb-ajax>div",t).addClass("container-fluid"),$("h3",t).remove(),$("textarea",t).remove(),$("input",t).remove(),t.draggable()},onLoad:function(e){return $.mask.close()}}}),$(e).click()},a.prototype.on_wideinterims_apply_click=function(e){var i,n,a;return console.debug("Â°Â°Â° WorksheetManageResultsView::on_wideinterims_apply_click Â°Â°Â°"),e.preventDefault(),$(e.currentTarget),$("#wideinterims_analyses").val(),e=$("#wideinterims_interims").val(),i=$("#wideinterims_empty").is(":checked"),a=$("#wideinterims_value").val(),n=function(e,t){return Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"value").set.call(e,t),t=new Event("input",{bubbles:!0}),e.dispatchEvent(t)},$("tr td input[column_key='"+e+"']").each(function(e,t){return i&&""!==$(this).val()&&"0"!==$(this).val().match(/\d+/)||n(t,a),!0})},a)}.call(this),window.bika=window.bika||{lims:{}},window.bika.lims.controllers={html:["CommonUtils"],".barcode, .qrcode":["BarcodeUtils"],".range-chart":["RangeGraph"],".attachments":["AttachmentsUtils"],body:["SiteView"],".portaltype-method.template-base_edit":["MethodEditView"],".portaltype-analysisservice.template-base_edit":["AnalysisServiceEditView"],".portaltype-analysisprofile.template-base_edit":["AnalysisProfileEditView"],".portaltype-instrument.template-referenceanalyses":["InstrumentReferenceAnalysesView"],".portaltype-instrumentcertification.template-base_edit":["InstrumentCertificationEditView"],".portaltype-instrument.template-base_edit":["InstrumentEditView"],".portaltype-calculation":["CalculationEditView"],".portaltype-bikasetup.template-base_edit":["BikaSetupEditView"],".portaltype-client.template-base_edit":["ClientEditView"],"div.overlay #client-base-edit":["ClientOverlayHandler"],".portaltype-referencesample.template-analyses":["ReferenceSampleAnalysesView"],".portaltype-artemplate.template-base_edit":["ARTemplateEditView"],".portaltype-analysisrequest":["AnalysisRequestView"],".portaltype-analysisrequest:not(.template-ar_add)":["RejectionKickOff"],".portaltype-analysisrequest.template-base_view":["WorksheetManageResultsView","AnalysisRequestViewView","RejectionKickOff"],".portaltype-analysisrequest.template-analyses":["AnalysisRequestAnalysesView"],".portaltype-analysisrequest.template-ar_add":["AnalysisRequestAddView"],"#analysisrequest_add_form":["AnalysisRequestAdd"],".portaltype-supplyorder.template-base_edit":["SupplyOrderEditView"],".portaltype-plone-site.template-import":["InstrumentImportView"],".portaltype-batchfolder":["BatchFolderView"],".portaltype-worksheetfolder":["WorksheetFolderView"],".portaltype-worksheet.template-add_blank":["WorksheetAddQCAnalysesView"],".portaltype-worksheet.template-add_control":["WorksheetAddQCAnalysesView"],".portaltype-worksheet.template-add_duplicate":["WorksheetAddDuplicateAnalysesView"],".portaltype-worksheet.template-manage_results":["WorksheetManageResultsView"],".portaltype-worksheettemplate.template-base_edit":["WorksheetTemplateEdit"],"#worksheet-printview-wrapper":["WorksheetPrintView"],".portaltype-reflexrule.template-base_edit":["ReflexRuleEditView"],".template-labcontacts.portaltype-department":["DepartmentLabContactsView"],".portaltype-reportfolder":["ReportFolderView"],".ArchetypesRemarksWidget":["RemarksWidgetView"]},window.bika.lims.loadControllers=function(t,i){var n,e=window.bika.lims.controllers,a=new Array,s=a.length;for(n in e)($(n).length||0<=$.inArray(n,i))&&e[n].forEach(function(e){(1==t||0<=$.inArray(n,i)||$.inArray(e,a)<0)&&(console.debug("[bika.lims.loader] Loading "+e),obj=new window[e],obj.load(),window.bika.lims[e]=obj,a.push(e))});return a.length-s},document.addEventListener("DOMContentLoaded",function(e){window.bika.lims.loadControllers(!1,[]),console.debug("*** SENAITE LOADER INITIALIZED ***")});
//# sourceMappingURL=legacy.js.map