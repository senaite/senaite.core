function AnalysisProfileEditView(){var e=$("#archetypes-fieldname-AnalysisProfilePrice"),t=$("#archetypes-fieldname-AnalysisProfilePrice #AnalysisProfilePrice"),i=$("#archetypes-fieldname-AnalysisProfileVAT"),n=$("#archetypes-fieldname-AnalysisProfileVAT #AnalysisProfileVAT"),a=$("#archetypes-fieldname-UseAnalysisProfilePrice #UseAnalysisProfilePrice");this.load=function(){$(a).change((function(){$(this).is(":checked")?($(e).show(),$(i).show()):($(e).hide(),$(i).hide(),$(t).val("0"),$(n).val("0"))})),$(a).change()}}function ARTemplateEditView(){var e=$("#archetypes-fieldname-SamplePoint #SamplePoint"),t=$("#archetypes-fieldname-SampleType #SampleType");function i(e){if($('[name^="uids\\:list"]').filter(":checked").length<1)return window.bika.lims.portalMessage("No analyses have been selected"),window.scroll(0,0),!1}this.load=function(){$(".portaltype-artemplate input[name$='save']").addClass("allowMultiSubmit"),$(".portaltype-artemplate input[name$='save']").click(i),function(){var t;t=0<document.location.href.search("/clients/")?{portal_type:"Client",id:document.location.href.split("clients")[1].split("/")[1],include_fields:["UID"]}:{portal_type:"BikaSetup",include_fields:["UID"]},window.bika.lims.jsonapi_read(t,(function(t){t.objects&&t.objects.length<1||((t=t.objects[0]).UID,$(e).attr("search_query",JSON.stringify({getClientUID:t.UID})),referencewidget_lookups([$(e)]))}))}(),$(e).bind("selected blur change",(function(){var i=$(e).val()?$(e).attr("uid"):"";$(t).attr("search_query",JSON.stringify({getRawSamplePoints:i})),referencewidget_lookups([$(t)])})),$(t).bind("selected blur change",(function(){var i=$(t).val()?$(t).attr("uid"):"";$(e).attr("search_query",JSON.stringify({getRawSampleTypes:i})),referencewidget_lookups([$(e)])}))}}function BatchFolderView(){this.load=function(){$(".portaltype-batchfolder").append("<div id='batch-cancel-dialog' title='"+_t("Cancel batch/es?")+"'>    <p style='padding:10px'>        <span class='ui-icon ui-icon-alert' style=''float: left; margin: 0 7px 30px 0;'><br/></span>        "+_t("All linked Samples will be cancelled too.")+"    </p>    <p style='padding:0px 10px'>       "+_t("Are you sure?")+"    </p></div><input id='batch-cancel-resp' type='hidden' value='false'/>"),$("#batch-cancel-dialog").dialog({autoOpen:!1,resizable:!1,height:200,width:400,modal:!0,buttons:{"Cancel selected batches":function(){$(this).dialog("close"),$("#batch-cancel-resp").val("true"),$(".portaltype-batchfolder #cancel_transition").click()},Cancel:function(){$("#batch-cancel-resp").val("false"),$(this).dialog("close")}}}),$("#cancel_transition").click((function(e){return!(!$(".bika-listing-table input[type='checkbox']:checked").length||"true"!=$("#batch-cancel-resp").val()&&(e.preventDefault(),$("#batch-cancel-dialog").dialog("open"),1))}))}}function BikaSetupEditView(){var e=$("#archetypes-fieldname-RestrictWorksheetUsersAccess #RestrictWorksheetUsersAccess"),t=$("#archetypes-fieldname-RestrictWorksheetManagement #RestrictWorksheetManagement");this.load=function(){$('input[id^="Prefixes-separator-"]').each((function(){!function(e){var t=e.value,i=e.id,n=["","-","_"],a='<select id="'+i+'"></select>';$(e).after(a),$(e).hide();for(var r=0;r<n.length;r++){var o="selected";o="<option "+(o=n[r]!=t?"":o)+" value="+n[r]+">"+n[r]+"</option>",$("select#"+i).append(o)}}(this)})),$('select[id^="Prefixes-separator-"]').bind("select change",(function(){var e=$(this).val(),t=$(this).attr("id");$("input#"+t).val(e)})),$(e).change((function(){$(this).is(":checked")?($(t).prop("checked",!0),$(t).click((function(e){e.preventDefault()}))):$(t).unbind("click")})),1==$("select[name=NumberOfRequiredVerifications] option:selected").val()&&(document.getElementById("archetypes-fieldname-TypeOfmultiVerification").style.display="none"),$("#NumberOfRequiredVerifications").change((function(){1<$(this).val()?document.getElementById("archetypes-fieldname-TypeOfmultiVerification").style.display="block":document.getElementById("archetypes-fieldname-TypeOfmultiVerification").style.display="none"})),$(e).change()}}function CalculationEditView(){this.load=function(){$("#TestParameters_more").hide(),$("#Formula").live("change",(function(e){var t=[];$.each($("[id^=TestParameters-keyword]"),(function(e,i){t.push($(i).val())}));var i=$("#Formula").val().match(/\[[^\]]*\]/gi);$.each(i,(function(e,i){var n,a,r;i=i.replace("[","").replace("]",""),-1==t.indexOf(i)&&(r=$(".records_row_TestParameters"),n=$(r[r.length-1]),a=r.length.toString(),r=$(n).clone(!0),$(r).find("[id^=TestParameters-keyword]").val(i),$(r).find("[id^=TestParameters-keyword]").attr("id","TestParameters-keyword-"+a),$(r).find("[id^=TestParameters-value]").attr("id","TestParameters-value-"+a),$(r).insertBefore(n))}))}))}}function ClientEditView(){var e="#archetypes-fieldname-DecimalMark",t="#DefaultDecimalMark";this.load=function(){function i(t){t.is(":checked")?$(e).fadeOut().hide():$(e).fadeIn()}i($(t)),$(t).click((function(){i($(this))}))}}function ClientOverlayHandler(){this.load=function(){},this.onLoad=function(e){$.ajax({url:"bika_widgets/addresswidget.js",dataType:"script",async:!1})}}function CommonUtils(){this.load=function(){window.bika=window.bika||{lims:{}},window.bika.lims.AnalysisService=window.bika.lims.AnalysisService||{Dependants:function(e){e={catalog_name:"bika_setup_catalog",UID:e,include_methods:"getServiceDependantsUIDs"};var t={};return $.ajaxSetup({async:!1}),window.bika.lims.jsonapi_read(e,(function(e){t=null!=e.objects&&0<e.objects.length?e.objects[0].getServiceDependantsUIDs:[]})),$.ajaxSetup({async:!0}),t},Dependencies:function(e){e={catalog_name:"bika_setup_catalog",UID:e,include_methods:"getServiceDependenciesUIDs"};var t={};return $.ajaxSetup({async:!1}),window.bika.lims.jsonapi_read(e,(function(e){t=null!=e.objects&&0<e.objects.length?e.objects[0].getServiceDependenciesUIDs:[]})),$.ajaxSetup({async:!0}),t}},window.bika.lims.portalMessage=function(e){e="<dl class='portalMessage error alert alert-danger'><dt>"+_t("Error")+"</dt><dd><ul>"+e+"</ul></dd></dl>",$(".portalMessage").remove(),$(e).appendTo("#viewlet-above-content")},window.bika.lims.log=function(e){null!=window.location.url&&null!=window.location.url&&(e="("+window.location.url+"): "+e,$.ajax({type:"POST",url:"js_log",data:{message:e,_authenticator:$("input[name='_authenticator']").val()}}))},window.bika.lims.warning=function(e){e="("+window.location.href+"): "+e,$.ajax({type:"POST",url:"js_warn",data:{message:e,_authenticator:$("input[name='_authenticator']").val()}})},window.bika.lims.error=function(e){e="("+window.location.href+"): "+e,$.ajax({type:"POST",url:"js_err",data:{message:e,_authenticator:$("input[name='_authenticator']").val()}})},window.bika.lims.jsonapi_cache={},window.bika.lims.jsonapi_read=function(e,t){window.bika.lims.jsonapi_cache=window.bika.lims.jsonapi_cache||{},null==e.page_size&&(e.page_size=0);var i=$.param(e),n=t;void 0===window.bika.lims.jsonapi_cache[i]?$.ajax({type:"POST",dataType:"json",url:window.portal_url+"/@@API/read",data:e,success:function(e){window.bika.lims.jsonapi_cache[i]=e,n(e)}}):n(window.bika.lims.jsonapi_cache[i])},window.bika.lims.update_combogrid_query=function(e,t,i,n){var a,r;$(e).is(":visible")&&(n=n||"base_query",r=jQuery.parseJSON($(e).attr(n)),i&&(r[t]=i),""===i&&r[t]&&delete r[t],$(e).attr(n,JSON.stringify(r)),(a=jQuery.parseJSON($(e).attr("combogrid_options"))).url=window.portal_url+"/"+a.url,a.url=a.url+"?_authenticator="+$("input[name='_authenticator']").val(),a.url=a.url+"&catalog_name="+$(e).attr("catalog_name"),a.url=a.url+"&base_query="+encodeURIComponent($(e).attr("base_query")),a.url=a.url+"&search_query="+encodeURIComponent($.toJSON(r)),i=a.colModel,t=a.search_fields,n=a.discard_empty,r=a.minLength,a.url=a.url+"&colModel="+$.toJSON(i),a.url=a.url+"&search_fields="+$.toJSON(t),a.url=a.url+"&discard_empty="+$.toJSON(n),a.url=a.url+"&minLength="+$.toJSON(r),a.force_all="false",$(e).combogrid(a))},$(".ArchetypesPrioritySelectionWidget select").change((function(e){var t=$(this).find("option:selected").val();$(this).attr("value",t)})),$(".ArchetypesPrioritySelectionWidget select").change()},this.svgToImage=function(e){return'<img src="data:image/svg+xml;base64,'+btoa(e)+'"/>'}}function DepartmentLabContactsView(){this.load=function(){$("table.bika-listing-table td input[type='checkbox']").not('[type="hidden"]').each((function(e){$(this).change((function(){var e,t,i,n;e=this,n={},t=$(e).prop("checked"),i=$(e).val(),url=window.location.href.replace("/labcontacts",""),e=url.replace(window.portal_url,""),n.contact_uid=i,n.checkbox_value=t,n.department=e,function(e){var t=$('tr[uid="'+e.contact_uid+'"] td.Fullname a').attr("href"),i=$('tr[uid="'+e.contact_uid+'"] td.Fullname a').text(),n="<a href='"+t+"'>"+i+"</a>";$.ajax({type:"POST",dataType:"json",url:window.location.href.replace("/labcontacts","")+"/labcontactupdate",data:{data:JSON.stringify(e)}}).done((function(e){null!==e&&!0===e.success?bika.lims.SiteView.notificationPanel(n+" updated successfully","succeed"):(bika.lims.SiteView.notificationPanel("Failure while updating "+n,"error"),e="[bika.lims.department.js in DepartmentLabContactsView] Failure while updating "+i+"in "+window.location.href,window.bika.lims.error(e))})).fail((function(){bika.lims.SiteView.notificationPanel("Error while updating "+n,"error");var e="[bika.lims.department.js in DepartmentLabContactsView] Error while updating "+i+"in "+window.location.href;window.bika.lims.error(e)}))}(n)}))}))}}function ControlChart(){var e=this;this.setData=function(t){e.datasource=t},this.setXColumn=function(t){e.xcolumnkey=t},this.setYColumn=function(t){e.ycolumnkey=t},this.setYLabel=function(t){e.ylabel=t},this.setXLabel=function(t){e.xlabel=t},this.setUpperLimit=function(t){e.upperlimit=t},this.setLowerLimit=function(t){e.lowerlimit=t},this.setCenterLimit=function(t){e.centerlimit=t},this.setUpperLimitText=function(t){e.upperlimit_text=t},this.setLowerLimitText=function(t){e.lowerlimit_text=t},this.setCenterLimitText=function(t){e.centerlimit_text=t},this.setInterpolation=function(t){e.interpolation=t},this.setPointId=function(t){e.pointid=t},this.draw=function(t){var i=20,n=30,a=(a=$(t).innerWidth()-20)-n-20,r=(r=$(t).innerHeight()-20)-i-30,l=d3.time.scale().range([0,a]),s=d3.scale.linear().range([r,0]),c=d3.svg.axis().scale(l).orient("bottom").tickSize(0),d=d3.svg.axis().scale(s).orient("left").tickSize(0),u=d3.svg.line().interpolate(e.interpolation).x((function(e){return l(e.x_axis)})).y((function(e){return s(e.y_axis)})),h=d3.select(t).append("svg").attr("xmlns","http://www.w3.org/2000/svg").attr("width",a+n+20).attr("height",r+i+30).append("g").attr("transform","translate("+n+","+i+")");x_data_parse=d3.time.format("%Y-%m-%d %I:%M %p").parse,e.datasource.forEach((function(t){var i;t.x_axis=x_data_parse(t[e.xcolumnkey]),t.y_axis=(i=t[e.ycolumnkey])&&"string"==typeof o?+i:i,t.point_id=t[e.pointid]})),e.datasource.sort((function(e,t){return e.x_axis-t.x_axis})),l.domain(d3.extent(e.datasource,(function(e){return e.x_axis}))),(n=d3.min(e.datasource,(function(e){return e.y_axis})))>e.lowerlimit&&(n=e.lowerlimit),(i=d3.max(e.datasource,(function(e){return e.y_axis})))<e.upperlimit&&(i=e.upperlimit),s.domain([n,i]),h.append("g").attr("class","x axis").attr("transform","translate(0,"+r+")").call(c).style("font-size","11px").append("text").attr("x",a).attr("dy","-0.71em").attr("text-anchor","end").text(e.xlabel),h.append("g").attr("class","y axis").call(d).style("font-size","11px").append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text(e.ylabel),h.append("path").datum(e.datasource).attr("stroke","#4682b4").attr("stroke-width","1.5px").attr("fill","none").attr("class","line").attr("d",u),e.datasource.forEach((function(t){h.append("g").attr("fill","#2f2f2f").append("circle").attr("id",t.point_id).attr("r",3).attr("cx",l(t.x_axis)).attr("cy",s(t.y_axis)).on("mouseout",(function(){d3.select(this).attr("fill","#2f2f2f").attr("r",3),d3.select(this.parentNode.children[1]).remove()})).on("mouseover",(function(){d3.select(this).attr("fill","#4682b4").attr("r",6),d3.select(this.parentNode).append("text").attr("fill","#000000").style("font-size","10px").attr("x",l(t.x_axis)-10).attr("y",s(t.y_axis)-10).text(t.y_axis+e.ylabel)})).on("click",(function(){d3.select(this).attr("fill","#4682b4").attr("r",6),d3.select(this.parentNode).append("text").attr("fill","#000000").style("font-size","10px").attr("x",l(t.x_axis)-10).attr("y",s(t.y_axis)-10).text(t.y_axis+e.ylabel)}))})),h.append("line").attr("stroke","#8e0000").attr("stroke-width","1px").attr("stroke-dasharray","5, 5").attr({x1:0,y1:s(e.upperlimit),x2:a,y2:s(e.upperlimit)}),h.append("text").attr({x:30,y:s(e.upperlimit)-5}).style("font-size","11px").text(e.upperlimit_text),h.append("line").attr("stroke","#8e0000").attr("stroke-width","1px").attr("stroke-dasharray","5, 5").attr({x1:0,y1:s(e.lowerlimit),x2:a,y2:s(e.lowerlimit)}),h.append("text").attr({x:30,y:s(e.lowerlimit)-5}).style("font-size","11px").text(e.lowerlimit_text),h.append("line").attr("stroke","#598859").attr("stroke-width","1px").attr({x1:0,y1:s(e.centerlimit),x2:a,y2:s(e.centerlimit)}),h.append("text").attr({x:30,y:s(e.centerlimit)-5}).style("font-size","11px").text(e.centerlimit_text)}}function RangeGraph(){this.load=function(){$(".range-chart").each((function(e){var t,i,n,a,r,o,l,s,c,d,u,h,p,m,f,_,y=Number($(this).css("width").replace(/[^\d\.\-]/g,""));t=$(this).get(0),i=y,(_=function(e,t){if(!$.isNumeric(t))return null;if(t=parseFloat(t),!("min"in e)||!("max"in e))return null;var i=$.isNumeric(e.min)?parseFloat(e.min):t,n=$.isNumeric(e.max)?parseFloat(e.max):t;if(i==n)return null;var a=i,r=n;return"warn_min"in e&&$.isNumeric(e.warn_min)&&(a=(a=parseFloat(e.warn_min))<i?a:i),"warn_max"in e&&$.isNumeric(e.warn_max)&&(r=n<(r=parseFloat(e.warn_max))?r:n),{result:t,min:i,max:n,warn_min:a,warn_max:r}}(n=$.parseJSON($(this).attr("data-range")),a=$.parseJSON($(this).attr("data-result"))))&&(i-=o=2*(r=.03*i),l=_.min,s=_.max,c=_.warn_min,d=_.warn_max,a=_.result,m="min_operator"in n?n.min_operator:"geq",p="max_operator"in n?n.max_operator:"leq",h=(d-c)/3,u=a<c?a:c-h,y=d<a?a:d+h,_="gt"==m?l<a:l<=a,n=!1,(_="lt"==p?_&&a<s:_&&a<=s)||(f=(f="lt"==p?s<=a:s<a)&&a<=d,n=("gt"==m?a<=l:a<l)&&c<=a||f),h=_||n?"#a8d6cf":"#cdcdcd",p=_?"#279989":n?"#ffae00":"#ff0000",m=_||n?"#d9e9e6":"#dcdcdc",f=d3.scale.linear().domain([u,y]).range([0,i]),_=d3.select(t).append("svg").attr("xmlns","http://www.w3.org/2000/svg").attr("width",i+2*r).attr("height",o).append("g").attr("transform","translate("+r+",0)"),t=o/2-(n=2*r*.8)/2,i=.9*r,_.append("rect").attr("x",f(u)).attr("y",t).attr("width",f(c)-f(u)+i).attr("height",n).attr("rx",i).attr("ry",i).style("fill","#e9e9e9"),_.append("rect").attr("x",f(c)).attr("y",t).attr("width",f(l)-f(c)).attr("height",n).style("fill",m),_.append("rect").attr("x",f(s)).attr("y",t).attr("width",f(d)-f(s)).attr("height",n).style("fill",m),_.append("rect").attr("x",f(d)-i).attr("y",t).attr("width",f(y)-f(d)+i).attr("height",n).attr("rx",i).attr("ry",i).style("fill","#e9e9e9"),_.append("rect").attr("x",f(l)).attr("y",t).attr("width",f(s)-f(l)).attr("height",n).style("fill",h),_.append("circle").attr("cx",f(a)).attr("cy",o/2).attr("r",r).style("fill","white"),_.append("circle").attr("cx",f(a)).attr("cy",o/2).attr("r",r-1).style("fill",p)),$(this).removeClass("range-chart")}))}}function InstrumentCertificationEditView(){function e(){$("#Internal").is(":checked")?$("#archetypes-fieldname-Agency").hide():$("#archetypes-fieldname-Agency").fadeIn("slow")}this.load=function(){$("#Internal").live("change",(function(){e()})),e()}}function InstrumentEditView(){this.load=function(){$("#ResultFilesFolder_more").remove();var e=$(".records_row_ResultFilesFolder");for(i=0;i<e.length;i++)(0<i&&i==e.length-1?e[i]:e[i].children[2]).remove()},$("#ImportDataInterface").change((function(){!function(){var e=$("#ResultFilesFolder_table"),t=$(".records_row_ResultFilesFolder"),n=$("#ImportDataInterface").val();if(t.remove(),null==n||1==n.length&&""==n[0]){var a=$(t[t.length-1]).clone();for(i=0;i<$(a).children().length;i++){var r=$(a).children()[i];r=$(r).children()[0],$(r).val("")}$(a).appendTo($(e))}else{for(i=0;i<n.length;i++){var o;""!=n[i]&&(a=$(t[t.length-1]).clone(),o=$(a).children()[0],o=$(o).children()[0],$(o).val(n[i]),o=$(a).children()[1],o=$(o).children()[0],$(o).val(""),$(a).appendTo($(e)))}!function(){$("#ResultFilesFolder_table");var e=$(".records_row_ResultFilesFolder");for(i=0;i<e.length;i++){var t=$(e[i]).find("input[id^='ResultFilesFolder']");for(j=0;j<t.length;j++){var n=(n=t[j].id).split("-")[0]+"-"+n.split("-")[1];$(t[j]).attr("id",n+"-"+i)}}}()}}()}))}function InstrumentReferenceAnalysesView(){function e(e){var t=$("#selqcsample").val();$("#selqcsample option").remove(),$.map(e,(function(e,i){var n=i==t?" selected":"";$("#selqcsample").append('<option value="'+i+'"'+n+">"+i+"</option>")}))}function t(){var e=(e=$("#selanalyses").val().split("("))[e.length-1].slice(0,-1).trim(),t=$("#selqcsample").val(),i=0;$("div.results-info").remove(),$(".item-listing-tbody tr").each((function(n){$(this).attr("keyword")!=e||$(this).find("td.Partition a").html()!=t?$(this).hide():($(this).fadeIn(),i+=1)})),$(".bika-listing-table").closest("div").before('<div class="results-info">'+i+" results found</div>")}function i(e,t){var i=$("#selanalyses").val(),n=$("#selqcsample").val(),a=$("#interpolation").val();null==e&&$("#chart").innerWidth(),null==t&&$("#chart").innerHeight(),$("#chart").css("width",e),$("#chart").css("height",t),$("#chart").html(""),$("#chart").show();var r,o,l,s=$.parseJSON($("#graphdata").val());n in(s=s[i])&&0!=s[n].length?(l=(s=s[n])[s.length-1].unit,r=s[s.length-1].upper,o=s[s.length-1].lower,e=s[s.length-1].target,t="Result",""==l||void 0===l?l="":t=l,i=$.trim("UCL ("+r+l+")"),n=$.trim("LCL ("+o+l+")"),l=$.trim("CL ("+e+l+")"),chart=new ControlChart,chart.setData(s),chart.setInterpolation(a),chart.setXColumn("date"),chart.setYColumn("result"),chart.setPointId("id"),chart.setYLabel(t),chart.setXLabel("Date"),chart.setUpperLimitText(i),chart.setLowerLimitText(n),chart.setCenterLimitText(l),chart.setCenterLimit(e),chart.setUpperLimit(r),chart.setLowerLimit(o),chart.draw("#chart")):$("#chart").hide()}this.load=function(){var n=$.parseJSON($("#graphdata").val());$.map(n,(function(e,t){$("#selanalyses").append('<option value="'+t+'">'+t+"</option>")})),$("#selanalyses").val()&&(e(n[$("#selanalyses").val()]),t(),i(null,null)),$("#selanalyses").change((function(a){e(n[$("#selanalyses").val()]),i(null,null),t()})),$("#selqcsample").change((function(e){i(null,null),t()})),$("#interpolation").change((function(e){i(null,null)})),$(".item-listing-tbody tr").mouseover((function(e){var t;""!=$(this).attr("uid")&&($(this).addClass("selected"),t=$(this).attr("uid"),$("#chart svg g circle#"+t).trigger("__onmouseover"))})),$(".item-listing-tbody tr").mouseout((function(e){var t;$(this).removeClass("selected"),""!=$(this).attr("uid")&&(t=$(this).attr("uid"),$("#chart svg g circle#"+t).trigger("__onmouseout"))})),$("#printgraph").click((function(e){e.preventDefault(),i(670,$("#chart").attr("height"));var t=window.open("","","left=0,top=0,width=800,height=900,toolbar=0,scrollbars=0,status=0"),n='<link href="'+window.portal_url+'/++resource++bika.lims.css/print-graph.css" type="text/css" rel="stylesheet">',a=$("span.documentFirstHeading").closest("h1").clone();e=$("#content-core").clone(),$(e).prepend(a),$(e).find("#selanalyses").after("<span class='bold'>"+$("#selanalyses").val()+"</span>"),$(e).find("#interpolation").after("<span class='bold'>"+$("#interpolation").val()+"</span>"),$(e).find("#selqcsample").after("<span class='bold'>"+$("#selqcsample").val()+"</span>"),$(e).find("#selanalyses").hide(),$(e).find("#interpolation").hide(),$(e).find("#selqcsample").hide(),t.document.write("<html><head>"+n+"</head><body>"+$(e).html()+"</body></html>"),t.document.close(),t.focus(),t.print(),$("#chart").css("width","100%"),$("#chart").removeAttr("height"),i(null,null),t.close()})),$("div.bika-listing-table-container").fadeIn()}}function ReferenceSampleAnalysesView(){function e(){var e=(e=$("#selanalyses").val().split("("))[e.length-1].slice(0,-1).trim(),t=0;$("div.results-info").remove(),$(".item-listing-tbody tr").each((function(i){$(this).attr("keyword")!=e?$(this).hide():($(this).fadeIn(),t+=1)})),$(".bika-listing-table").closest("div").before('<div class="results-info">'+t+" results found</div>")}function t(e,t){var i=$("#selanalyses").val(),n=$("#selqcsample").val(),a=$("#interpolation").val();null==e&&$("#chart").innerWidth(),null==t&&$("#chart").innerHeight(),$("#chart").css("width",e),$("#chart").css("height",t),$("#chart").html(""),$("#chart").show();var r,o,l,s=$.parseJSON($("#graphdata").val());n in(s=s[i])&&0!=s[n].length?(l=(s=s[n])[s.length-1].unit,r=s[s.length-1].upper,o=s[s.length-1].lower,e=s[s.length-1].target,t="Result",""==l||void 0===l?l="":t=l,i=$.trim("UCL ("+r+l+")"),n=$.trim("LCL ("+o+l+")"),l=$.trim("CL ("+e+l+")"),chart=new ControlChart,chart.setData(s),chart.setInterpolation(a),chart.setXColumn("date"),chart.setYColumn("result"),chart.setPointId("id"),chart.setYLabel(t),chart.setXLabel("Date"),chart.setUpperLimitText(i),chart.setLowerLimitText(n),chart.setCenterLimitText(l),chart.setCenterLimit(e),chart.setUpperLimit(r),chart.setLowerLimit(o),chart.draw("#chart")):$("#chart").hide()}this.load=function(){var i=$.parseJSON($("#graphdata").val()),n=!1;$.map(i,(function(e,t){$("#selanalyses").append('<option value="'+t+'">'+t+"</option>"),0==n&&($.map(e,(function(e,t){$("#selqcsample").val(t)})),n=!0)})),$("#selanalyses").val()&&(e(),t(null,null)),$("#selanalyses").change((function(i){t(null,null),e()})),$("#interpolation").change((function(e){t(null,null)})),$(".item-listing-tbody tr").mouseover((function(e){var t;""!=$(this).attr("uid")&&($(this).addClass("selected"),t=$(this).attr("uid"),$("#chart svg g circle#"+t).trigger("__onmouseover"))})),$(".item-listing-tbody tr").mouseout((function(e){var t;$(this).removeClass("selected"),""!=$(this).attr("uid")&&(t=$(this).attr("uid"),$("#chart svg g circle#"+t).trigger("__onmouseout"))})),$("#printgraph").click((function(e){e.preventDefault(),$("#selanalyses").find("option[selected]").remove(),$("#selanalyses").find('option[value="'+$(selanalyses).val()+'"]').prop("selected",!0),t(670,$("#chart").attr("height"));var i=window.open("","","left=0,top=0,width=800,height=900,toolbar=0,scrollbars=0,status=0"),n='<link href="'+window.portal_url+'/++resource++bika.lims.css/print-graph.css" type="text/css" rel="stylesheet">',a=$("span.documentFirstHeading").closest("h1").clone();e=$("#content-core").clone(),$(e).prepend(a),$(e).find("#selanalyses").after("<span class='bold'>"+$("#selanalyses").val()+"</span>"),$(e).find("#interpolation").after("<span class='bold'>"+$("#interpolation").val()+"</span>"),$(e).find("#selanalyses").hide(),$(e).find("#interpolation").hide(),i.document.write("<html><head>"+n+"</head><body>"+$(e).html()+"</body></html>"),i.document.close(),i.focus(),i.print(),i.close(),$("#chart").css("width","100%"),$("#chart").removeAttr("height"),t(null,null)})),$("div.bika-listing-table-container").fadeIn()}}function RejectionKickOff(){this.load=function(){window.bika.lims.jsonapi_read({catalog_name:"portal_catalog",portal_type:"BikaSetup",include_fields:["RejectionReasons"]},(function(e){var t;e.success&&0<e.total_objects&&(void 0!==(t=0<(e=e.objects[0].RejectionReasons).length?e[0].checkbox:t)&&"on"==t||$("a#workflow-transition-reject").closest("li").hide())})),function(){"use strict";var e,t;0<$("div#archetypes-fieldname-RejectionWidget").length&&($("a#workflow-transition-reject").unbind(),$("a#workflow-transition-reject").bind("click",(function(e){e.preventDefault(),$("#semioverlay").show(),$('input[id="RejectionReasons.checkbox"]').click().prop("disabled",!0)})),e=$("#archetypes-fieldname-RejectionWidget").parent("td"),t="<div class='semioverlay-head'>"+$(e).prev("td").html().trim()+"</div>",$("#content").prepend("<div id='semioverlay' style='display:none'> <div class='semioverlay-back'> </div> <div class='semioverlay-panel'> <div class='semioverlay-content'></div> <div class='semioverlay-buttons'> <input type='button' name='semioverlay.reject' value='reject'/> <input type='button' name='semioverlay.cancel' value='cancel'/></div></div></div>"),$("#archetypes-fieldname-RejectionWidget").detach().prependTo("#semioverlay .semioverlay-content"),$(e).hide(),$(t).detach().insertBefore(".semioverlay-content"),$("div#semioverlay input[name='semioverlay.cancel']").bind("click",(function(){$("#semioverlay").hide(),$('input[id="RejectionReasons.checkbox"]').prop("checked",!1).prop("disabled",!1),$('input[id="RejectionReasons.checkbox.other"]').prop("checked",!1),$('input[id="RejectionReasons.textfield.other"]').val("");for(var e=$(".rejectionwidget-multiselect").find("option"),t=0;e.length>t;t++)$(e[t]).attr("selected",!1)})),$("div#semioverlay input[name='semioverlay.reject']").bind("click",(function(){$("div#semioverlay .semioverlay-panel").fadeOut(),function(){var e={},t=window.location.href.replace("/base_view","").replace("/analyses","").replace("/manage_results","").replace("/not_requested","").replace("/log","").replace(window.portal_url,""),i=$("a#workflow-transition-reject").attr("href");e.obj_path=t,t=function(){var e,t=0,i=[],n=0,a="";if(t=$(".rejectionwidget-checkbox").prop("checked")){t=1;for(var r=$(".rejectionwidget-multiselect").find("option"),o=0;r.length>o;o++)(e=r[o]).selected&&i.push($(e).val());(n=$(".rejectionwidget-checkbox-other").prop("checked"))?(n=1,a=$(".rejectionwidget-input-other").val()):n=0}else t=0;return a={checkbox:t,selected:i,checkbox_other:n,other:a},$.toJSON(a)}(),e.RejectionReasons=t;var n="";$.ajax({type:"POST",url:window.portal_url+"/@@API/update",data:e}).done((function(e){var t;null!==e&&!0===e.success?(bika.lims.SiteView.notificationPanel("Rejecting","succeed"),$("body").hasClass("portaltype-sample")?(t=$('input[name="_authenticator"]').val(),$.ajax({url:window.location.href+"/doActionForSample?workflow_action=reject&_authenticator="+t,type:"POST",dataType:"json"}).done((function(e){null!==e&&"true"==e.success?window.location.href=window.location.href:(bika.lims.SiteView.notificationPanel("Error while updating object state","error"),e="[bika.lims.analysisrequest.js] Error while updating object state",window.bika.lims.error(e),$('#semioverlay input[name="semioverlay.cancel"]').click())}))):(bika.lims.SiteView.notificationPanel("Rejecting","succeed"),window.location.href=i)):(n=!1===e.success?(bika.lims.SiteView.notificationPanel("Error while rejecting the analysis request. Unsuccesful AJAX call.","error"),"[bika.lims.analysisrequest.js] Error while rejecting the analysis request. Unsuccesful AJAX call."):(bika.lims.SiteView.notificationPanel("Error while rejecting the analysis request. No data returned.","error"),"[bika.lims.analysisrequest.js] Error while rejecting the analysis request. No data returned."),window.bika.lims.error(n),$('#semioverlay input[name="semioverlay.cancel"]').click())})).fail((function(){bika.lims.SiteView.notificationPanel("Error while rejection the analysis request. AJAX POST failed.","error"),window.bika.lims.error("[bika.lims.analysisrequest.js] Error while rejection the analysis request. AJAX POST failed."),$('#semioverlay input[name="semioverlay.cancel"]').click()}))}()})))}()}}function BarcodeUtils(){this.load=function(){$(".qrcode").each((function(e){var t=$(this).attr("data-code"),i=$(this).attr("data-size");$(this).qrcode({render:"image",size:i,color:"#3a3",text:t})})),$(".barcode").each((function(){var e=$(this).attr("data-id"),t=$(this).attr("data-code"),i=$(this).attr("data-barHeight"),n=$(this).attr("data-addQuietZone"),a=$(this).attr("data-showHRI");$(this).barcode(e,t,{barHeight:parseInt(i),addQuietZone:"true"==n,showHRI:"true"==a,output:"bmp"}),"true"==a&&($(this).find(".barcode-hri").remove(),e='<div class="barcode-hri">'+e+"</div>",$(this).append(e))}))}}function WorksheetPrintView(){function e(){$(".barcode").each((function(){var e=$(this).attr("data-id"),t=$(this).attr("data-code"),i=$(this).attr("data-barHeight"),n=$(this).attr("data-addQuietZone"),a=$(this).attr("data-showHRI");$(this).barcode(e,t,{barHeight:parseInt(i),addQuietZone:Boolean(n),showHRI:Boolean(a)})}))}this.load=function(){var t=document.referrer;t?bika.lims.SiteView.setCookie("ws.print.urlback",t):t=(t=bika.lims.SiteView.readCookie("ws.print.urlback"))||portal_url,e(),$("#print_button").click((function(e){e.preventDefault(),window.print()})),$("#cancel_button").click((function(e){e.preventDefault(),location.href=t})),$("#template").change((function(t){var i=window.location.href,n=$(this).val(),a=$("#numcols").val();$("#worksheet-printview").animate({opacity:.2},"slow"),$.ajax({url:i,type:"POST",data:{template:n,numcols:a}}).always((function(t){var i=t;t=$(i).find("#report-style").html(),$("#report-style").html(t),i=$(i).find("#worksheet-printview").html(),$("#worksheet-printview").html(i),$("#worksheet-printview").animate({opacity:1},"slow"),e()}))})),$("#numcols").change((function(t){var i=window.location.href,n=$(this).val(),a=$("#template").val();$("#worksheet-printview").animate({opacity:.2},"slow"),$.ajax({url:i,type:"POST",data:{template:a,numcols:n}}).always((function(t){var i=t;t=$(i).find("#report-style").html(),$("#report-style").html(t),i=$(i).find("#worksheet-printview").html(),$("#worksheet-printview").html(i),$("#worksheet-printview").animate({opacity:1},"slow"),e()}))}))}}function WorksheetTemplateEdit(){this.load=function(){var e=$("#archetypes-fieldname-RestrictToMethod").find("select");$(e).bind("change",(function(e,t){!function(e){e=$(e).val(),$.ajax({url:window.portal_url+"/ajaxgetworksheettemplateinstruments",type:"POST",data:{_authenticator:$('input[name="_authenticator"]').val(),method_uid:JSON.stringify(e)},dataType:"json"}).done((function(e){var t,i;if(null!==e&&$.isArray(e))for(t=$("#archetypes-fieldname-Instrument").find("select"),$(t).find("option").remove(),i=0;e.length>i;i++)$(t).append('<option value="'+e[i].uid+'">'+e[i].m_title+"</option>")})).fail((function(){window.bika.lims.log("bika.lims.worksheettemplate: Something went wrong while retrieving instrument list")}))}(this)}))}}(function(){window.AnalysisRequestView=function(){var e=function(e){var t;e.preventDefault(),t=e.currentTarget.href.replace("content_status_modify","workflow_action"),0<(e=$("#PublicationSpecification_uid")).length&&(t=t+"&PublicationSpecification="+$(e).val()),window.location.href=t};this.load=function(){$("a[id^='workflow-transition']").not("#workflow-transition-schedule_sampling").not("#workflow-transition-sample").click(e),function(){var e,t=$("#workflow-transition-schedule_sampling").attr("href");t&&(e=t.replace("content_status_modify","workflow_action"),$("#workflow-transition-schedule_sampling").attr("href",e),$("#workflow-transition-schedule_sampling").click((function(){var t,i=$("#SamplingDate").val(),n=$("#ScheduledSamplingSampler").val();""!==i&&null!=i&&""!==n&&null!=n?window.location.href=e:((t="")!==i&&null!=i||(t+=PMF("${name} is required for this action, please correct.",{name:_("Sampling Date")})),""!==n&&null!=n||(""!==t&&(t+="<br/>"),t+=PMF("${name} is required, please correct.",{name:_("'Define the Sampler for the shceduled'")})),""!==t&&window.bika.lims.portalMessage(t))})))}(),$("#interpretationtemplate-insert").click((function(e){var t,i;e.preventDefault(),(e=$("#interpretationtemplate").val())&&1===(t=$('div[id^="ResultsInterpretationDepts-"].active  textarea[id^="ResultsInterpretationDepts-richtext-"]')).length&&(i=t.attr("id"),window.bika.lims.jsonapi_read({catalog_name:"uid_catalog",UID:e,include_fields:["text"]},(function(e){if(1===e.objects.length)return e=e.objects[0].text,tinymce.get(i).insertContent(e)})))}))}},window.AnalysisRequestViewView=function(){this.load=function(){}},window.AnalysisRequestAnalysesView=function(){this.load=function(){}}}).call(this),function(){function e(e,t){return function(){return e.apply(t,arguments)}}function t(){this.on_toggle_change=e(this.on_toggle_change,this),this.bind_eventhandler=e(this.bind_eventhandler,this),this.load=e(this.load,this)}window.ReportFolderView=(t.prototype.load=function(){return this.bind_eventhandler()},t.prototype.bind_eventhandler=function(){return $("body").on("click","a[id$='_selector']",this.on_toggle_change)},t.prototype.on_toggle_change=function(e){return e.preventDefault(),$(".criteria").toggle(!1),e=e.currentTarget.id.split("_selector")[0],$("[id='"+e+"']").toggle(!0)},t)}.call(this),function(){function e(e,t){return function(){return e.apply(t,arguments)}}function t(){this.on_service_info_click=e(this.on_service_info_click,this),this.on_reference_definition_list_change=e(this.on_reference_definition_list_change,this),this.on_numeric_field_keypress=e(this.on_numeric_field_keypress,this),this.on_numeric_field_paste=e(this.on_numeric_field_paste,this),this.on_at_float_field_keyup=e(this.on_at_float_field_keyup,this),this.on_at_integer_field_keyup=e(this.on_at_integer_field_keyup,this),this.notify_in_panel=e(this.notify_in_panel,this),this.notificationPanel=e(this.notificationPanel,this),this.set_cookie=e(this.set_cookie,this),this.setCookie=e(this.setCookie,this),this.read_cookie=e(this.read_cookie,this),this.readCookie=e(this.readCookie,this),this.log=e(this.log,this),this.portal_alert=e(this.portal_alert,this),this.portalAlert=e(this.portalAlert,this),this.get_authenticator=e(this.get_authenticator,this),this.get_portal_url=e(this.get_portal_url,this),this.init_referencedefinition=e(this.init_referencedefinition,this),this.init_datepickers=e(this.init_datepickers,this),this.bind_eventhandler=e(this.bind_eventhandler,this),this.load=e(this.load,this)}window.SiteView=(t.prototype.load=function(){return this.init_datepickers(),this.bind_eventhandler(),this.allowed_keys=[8,9,13,35,36,37,39,46,44,60,62,45,69,101,61]},t.prototype.bind_eventhandler=function(){return $("body").on("change","#ReferenceDefinition\\:list",this.on_reference_definition_list_change),$("body").on("keypress",".numeric",this.on_numeric_field_keypress),$("body").on("paste",".numeric",this.on_numeric_field_paste),$("body").on("keyup","input[name*='\\:int'], .ArchetypesIntegerWidget input",this.on_at_integer_field_keyup),$("body").on("keyup","input[name*='\\:float'], .ArchetypesDecimalWidget input",this.on_at_float_field_keyup),$("body").on("click","a.service_info",this.on_service_info_click),$(document).on({ajaxStart:function(){$("body").addClass("loading")},ajaxStop:function(){$("body").removeClass("loading")},ajaxError:function(){$("body").removeClass("loading")}})},t.prototype.init_datepickers=function(){var e,t=new Date,i="1900:"+t.getFullYear(),n=("undefined"!=typeof i18n&&null!==i18n?i18n.currentLanguage:void 0)||"en",a=$.datepicker.regional[n]||$.datepicker.regional[""];return"date_format_short_datepicker"===(n=_t("date_format_short_datepicker"))&&(n="yy-mm-dd"),e=Object.assign(a,{dateFormat:n,timeFormat:"HH:mm",showOn:"focus",showAnim:"fadeIn",changeMonth:!0,changeYear:!0,showWeek:!0,yearRange:i,numberOfMonths:1}),i=function(t){var i;return void 0===t&&(t={}),i=Object.assign({},e),Object.assign(i,t)},$("input.datepicker_nofuture").datepicker(i({maxDate:t})),$("input.datepicker").datepicker(i()),$("input.datepicker_2months").datepicker(i({maxDate:t,numberOfMonths:2})),$("input.datetimepicker_nofuture").datetimepicker(i({maxDate:t}))},t.prototype.init_referencedefinition=function(){if(""!==$("#ReferenceDefinition:list").val())return $("#ReferenceDefinition:list").change()},t.prototype.get_portal_url=function(){return window.portal_url},t.prototype.get_authenticator=function(){return window.site.authenticator()},t.prototype.portalAlert=function(e){return this.portal_alert(e)},t.prototype.portal_alert=function(e){var t=$("#portal-alert");0===t.length?$("#portal-header").append("<div id='portal-alert' style='display:none'><div class='portal-alert-item'>"+e+"</div></div>"):t.append("<div class='portal-alert-item'>"+e+"</div>"),t.fadeIn()},t.prototype.log=function(e){return window.bika.lims.log(e)},t.prototype.readCookie=function(e){return window.site.read_cookie(e)},t.prototype.read_cookie=function(e){return window.site.read_cookie(e)},t.prototype.setCookie=function(e,t){return window.site.set_cookie(e,t)},t.prototype.set_cookie=function(e,t){window.site.set_cookie(e,t)},t.prototype.notificationPanel=function(e,t){return this.notify_in_panel(e,t)},t.prototype.notify_in_panel=function(e,t){$("#panel-notification").remove(),e="<div id='panel-notification' style='display:none'><div class='"+t+"-notification-item'>"+e+"</div></div>",$("div#viewlet-above-content-title").append(e),$("#panel-notification").fadeIn("slow","linear",(function(){setTimeout((function(){$("#panel-notification").fadeOut("slow","linear")}),3e3)}))},t.prototype.on_at_integer_field_keyup=function(e){e=e.currentTarget,e=$(e),/\D/g.test(e.val())&&e.val(e.val().replace(/\D/g,""))},t.prototype.on_at_float_field_keyup=function(e){e=e.currentTarget,e=$(e),/[^-.\d]/g.test(e.val())&&e.val(e.val().replace(/[^.\d]/g,""))},t.prototype.on_numeric_field_paste=function(e){e=e.currentTarget;var t=$(e);window.setTimeout((function(){t.val(t.val().replace(",","."))}),0)},t.prototype.on_numeric_field_keypress=function(e){var t=e.currentTarget,i=$(t),n=e.which;t=this.allowed_keys.join(",").match(new RegExp(n)),!n||48<=n&&n<=57||t?window.setTimeout((function(){i.val(i.val().replace(",","."))}),0):e.preventDefault()},t.prototype.on_reference_definition_list_change=function(e){var t=e.currentTarget,i=$(t);if(e=this.get_authenticator(),t=i.val(),i=i.children(":selected").html(),""===t)return $("#Blank").prop("checked",!1),$("#Hazardous").prop("checked",!1),void $(".bika-listing-table").load("referenceresults",{_authenticator:e});-1<i.search(_t("(Blank)"))||-1<i.search("(Blank)")?$("#Blank").prop("checked",!0):$("#Blank").prop("checked",!1),-1<i.search(_t("(Hazardous)"))||-1<i.search("(Hazardous)")?$("#Hazardous").prop("checked",!0):$("#Hazardous").prop("checked",!1),$(".bika-listing-table").load("referenceresults",{_authenticator:e,uid:t})},t.prototype.on_service_info_click=function(e){return e.preventDefault(),e=e.currentTarget,$(e).prepOverlay({subtype:"ajax",width:"80%",filter:"#content>*:not(div#portal-column-content)",config:{closeOnClick:!0,closeOnEsc:!0,onBeforeLoad:function(e){return this.getOverlay().draggable()},onLoad:function(e){return e=new Event("DOMContentLoaded",{}),window.document.dispatchEvent(e)}}}),$(e).click()},t)}.call(this),function(){window.AttachmentsUtils=function(){this.load=function(){$("#AttachFile,#Service,#Analysis").change((function(e){var t,i,n=$("#AttachFile").val();void 0===n&&(n=""),void 0===(i=$("#Service").val())&&(i=""),void 0===(t=$("#Analysis").val())&&(t=""),"Service"===this.id&&$("#Analysis").val(""),"Analysis"===this.id&&$("#Service").val(""),""===n||""===i&&""===t?$("#addButton").prop("disabled",!0):$("#addButton").removeAttr("disabled")})),$("#Analysis").combogrid({colModel:[{columnName:"analysis_uid",hidden:!0},{columnName:"slot",width:"10",label:_t("Slot")},{columnName:"service",width:"35",label:_t("Service")},{columnName:"parent",width:"35",label:_t("Parent")},{columnName:"type",width:"20",label:_t("Type")}],url:window.location.href.replace("/manage_results","")+"/attachAnalyses?_authenticator="+$('input[name="_authenticator"]').val(),showOn:!0,width:"650px",select:function(e,t){return $("#Analysis").val(t.item.service+" (slot "+t.item.slot+")"),$("#analysis_uid").val(t.item.analysis_uid),$(this).change(),!1}})}}}.call(this),$(document).ready((function(){window.bika=window.bika||{lims:{}},window.bika.lims.barcode_listener=new function(){this.load=function(){var e=!1,t="";$(window).keypress((function(i){"BODY"==i.target.tagName&&(e?t+=String.fromCharCode(i.which):(e=!0,t=String.fromCharCode(i.which),setTimeout((function(){var i;e=!1,2<t.length&&(i=t,authenticator=$('input[name="_authenticator"]').val(),$.ajax({type:"POST",url:"barcode_entry",data:{entry:i,_authenticator:authenticator},success:function(e,t,i,n){e.success&&(window.location.href=e.url)}}))}),500)))}))}},window.bika.lims.barcode_listener.load()})),function(){function e(e,t){return function(){return e.apply(t,arguments)}}function t(){this.on_instrument_change=e(this.on_instrument_change,this),this.on_template_change=e(this.on_template_change,this),this.select_instrument=e(this.select_instrument,this),this.get_template_instrument=e(this.get_template_instrument,this),this.bind_eventhandler=e(this.bind_eventhandler,this),this.load=e(this.load,this)}function i(){this.on_wideinterims_apply_click=e(this.on_wideinterims_apply_click,this),this.on_slot_remarks_click=e(this.on_slot_remarks_click,this),this.on_wideiterims_interims_change=e(this.on_wideiterims_interims_change,this),this.on_wideiterims_analyses_change=e(this.on_wideiterims_analyses_change,this),this.on_instrument_change=e(this.on_instrument_change,this),this.on_layout_change=e(this.on_layout_change,this),this.on_analyst_change=e(this.on_analyst_change,this),this.get_authenticator=e(this.get_authenticator,this),this.get_base_url=e(this.get_base_url,this),this.get_portal_url=e(this.get_portal_url,this),this.ajax_submit=e(this.ajax_submit,this),this.bind_eventhandler=e(this.bind_eventhandler,this),this.load=e(this.load,this)}window.WorksheetFolderView=(t.prototype.load=function(){return this.bind_eventhandler()},t.prototype.bind_eventhandler=function(){return $("body").on("change","select.template",this.on_template_change),$("body").on("change","select.instrument",this.on_instrument_change)},t.prototype.get_template_instrument=function(){var e=$("input.templateinstruments").val();return JSON.parse(e)},t.prototype.select_instrument=function(e){if(e=$(".instrument").find("option[value='"+e+"']"))return e.prop("selected",!0)},t.prototype.on_template_change=function(e){return e=$(e.currentTarget).val(),e=this.get_template_instrument()[e],this.select_instrument(e)},t.prototype.on_instrument_change=function(e){if($(e.currentTarget).val())return e=_t("Only the analyses for which the selected instrument is allowed will be added automatically."),bika.lims.SiteView.notify_in_panel(e,"error")},t),window.WorksheetManageResultsView=(i.prototype.load=function(){return this.bind_eventhandler()},i.prototype.bind_eventhandler=function(){return $("body").on("change",".manage_results_header .analyst",this.on_analyst_change),$("body").on("change","#resultslayout_form #resultslayout",this.on_layout_change),$("body").on("change",".manage_results_header .instrument",this.on_instrument_change),$("body").on("change","#wideinterims_analyses",this.on_wideiterims_analyses_change),$("body").on("change","#wideinterims_interims",this.on_wideiterims_interims_change),$("body").on("click","#wideinterims_apply",this.on_wideinterims_apply_click),$("body").on("click","img.slot-remarks",this.on_slot_remarks_click)},i.prototype.ajax_submit=function(e){var t,i;return null==(e=null==e?{}:e).type&&(e.type="POST"),null==e.url&&(e.url=this.get_base_url()),null==e.context&&(e.context=this),$(this).trigger("ajax:submit:start"),i=this,t=function(){return $(i).trigger("ajax:submit:end")},$.ajax(e).done(t)},i.prototype.get_portal_url=function(){return $("input[name=portal_url]").val()||window.portal_url},i.prototype.get_base_url=function(){return window.location.href.split("?")[0]},i.prototype.get_authenticator=function(){return $("input[name='_authenticator']").val()},i.prototype.on_analyst_change=function(e){var t=$(e.currentTarget).val();return""!==t&&(e=this.get_base_url().replace("/manage_results","")+"/set_analyst",this.ajax_submit({url:e,data:{value:t,_authenticator:this.get_authenticator()},dataType:"json"}).done((function(e){return bika.lims.SiteView.notify_in_panel(_p("Changes saved."),"succeed")})).fail((function(){return bika.lims.SiteView.notify_in_panel(_t("Could not set the selected analyst"),"error")})))},i.prototype.on_layout_change=function(e){return $(e.currentTarget)},i.prototype.on_instrument_change=function(e){var t=$(e.currentTarget).val();return""!==t&&(e=this.get_base_url().replace("/manage_results","")+"/set_instrument",this.ajax_submit({url:e,data:{value:t,_authenticator:this.get_authenticator()},dataType:"json"}).done((function(e){return bika.lims.SiteView.notify_in_panel(_t("Changes saved."),"succeed"),$("select[column_key='Instrument'] option[value='"+t+"']").parent().find("option[value='"+t+"']").prop("selected",!1),$("select[column_key='Instrument'] option[value='"+t+"']").prop("selected",!0)})).fail((function(){return bika.lims.SiteView.notify_in_panel(_t("Unable to apply the selected instrument"),"error")})))},i.prototype.on_wideiterims_analyses_change=function(e){return e=$(e.currentTarget),$("#wideinterims_interims").html(""),e=e.val(),$("input[id^='wideinterim_"+e+"']").each((function(e,t){var i=$(t).attr("name");return i="<option value='"+$(t).attr("keyword")+"'>"+i+"</option>",$("#wideinterims_interims").append(i)}))},i.prototype.on_wideiterims_interims_change=function(e){return e=$(e.currentTarget),e="#wideinterim_"+$("#wideinterims_analyses").val()+"_"+e.val(),$("#wideinterims_value").val($(e).val())},i.prototype.on_slot_remarks_click=function(e){return e=e.currentTarget,$(e).prepOverlay({subtype:"ajax",filter:"h1,div.remarks-widget",config:{closeOnClick:!0,closeOnEsc:!0,onBeforeLoad:function(e){var t=this.getOverlay();return $("div.pb-ajax>div",t).addClass("container-fluid"),$("h3",t).remove(),$("textarea",t).remove(),$("input",t).remove(),t.draggable()},onLoad:function(e){return $.mask.close()}}}),$(e).click()},i.prototype.on_wideinterims_apply_click=function(e){var t,i,n;return e.preventDefault(),$(e.currentTarget),$("#wideinterims_analyses").val(),e=$("#wideinterims_interims").val(),t=$("#wideinterims_empty").is(":checked"),n=$("#wideinterims_value").val(),i=function(e,t){return Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"value").set.call(e,t),t=new Event("input",{bubbles:!0}),e.dispatchEvent(t)},$("tr td input[column_key='"+e+"']").each((function(e,a){return t&&""!==$(this).val()&&"0"!==$(this).val().match(/\d+/)||i(a,n),!0}))},i)}.call(this),window.bika=window.bika||{lims:{}},window.bika.lims.controllers={html:["CommonUtils"],".barcode, .qrcode":["BarcodeUtils"],".range-chart":["RangeGraph"],".attachments":["AttachmentsUtils"],body:["SiteView"],".portaltype-analysisprofile.template-base_edit":["AnalysisProfileEditView"],".portaltype-instrument.template-referenceanalyses":["InstrumentReferenceAnalysesView"],".portaltype-instrumentcertification.template-base_edit":["InstrumentCertificationEditView"],".portaltype-instrument.template-base_edit":["InstrumentEditView"],".portaltype-calculation":["CalculationEditView"],".portaltype-bikasetup.template-base_edit":["BikaSetupEditView"],".portaltype-client.template-base_edit":["ClientEditView"],"div.overlay #client-base-edit":["ClientOverlayHandler"],".portaltype-referencesample.template-analyses":["ReferenceSampleAnalysesView"],".portaltype-artemplate.template-base_edit":["ARTemplateEditView"],".portaltype-analysisrequest":["AnalysisRequestView"],".portaltype-analysisrequest:not(.template-ar_add)":["RejectionKickOff"],".portaltype-analysisrequest.template-base_view":["WorksheetManageResultsView","AnalysisRequestViewView","RejectionKickOff"],".portaltype-analysisrequest.template-analyses":["AnalysisRequestAnalysesView"],".portaltype-analysisrequest.template-ar_add":["AnalysisRequestAddView"],"#analysisrequest_add_form":["AnalysisRequestAdd"],".portaltype-supplyorder.template-base_edit":["SupplyOrderEditView"],".portaltype-batchfolder":["BatchFolderView"],".portaltype-worksheetfolder":["WorksheetFolderView"],".portaltype-worksheet.template-manage_results":["WorksheetManageResultsView"],".portaltype-worksheettemplate.template-base_edit":["WorksheetTemplateEdit"],"#worksheet-printview-wrapper":["WorksheetPrintView"],".template-labcontacts.portaltype-department":["DepartmentLabContactsView"],".portaltype-reportfolder":["ReportFolderView"],".ArchetypesRemarksWidget":["RemarksWidgetView"]},window.bika.lims.loadControllers=function(e,t){var i,n=window.bika.lims.controllers,a=new Array,r=a.length;for(i in n)($(i).length||0<=$.inArray(i,t))&&n[i].forEach((function(n){(1==e||0<=$.inArray(i,t)||$.inArray(n,a)<0)&&(obj=new window[n],obj.load(),window.bika.lims[n]=obj,a.push(n))}));return a.length-r},document.addEventListener("DOMContentLoaded",(function(e){window.bika.lims.loadControllers(!1,[])}));