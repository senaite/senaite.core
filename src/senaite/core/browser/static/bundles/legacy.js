function AnalysisProfileEditView(){var e=$("#archetypes-fieldname-AnalysisProfilePrice"),t=$("#archetypes-fieldname-AnalysisProfilePrice #AnalysisProfilePrice"),i=$("#archetypes-fieldname-AnalysisProfileVAT"),a=$("#archetypes-fieldname-AnalysisProfileVAT #AnalysisProfileVAT"),n=$("#archetypes-fieldname-UseAnalysisProfilePrice #UseAnalysisProfilePrice");this.load=function(){$(n).change(function(){$(this).is(":checked")?($(e).show(),$(i).show()):($(e).hide(),$(i).hide(),$(t).val("0"),$(a).val("0"))}),$(n).change()}}function ARTemplateEditView(){var t=$("#archetypes-fieldname-SamplePoint #SamplePoint"),i=$("#archetypes-fieldname-SampleType #SampleType");function a(e){if($('[name^="uids\\:list"]').filter(":checked").length<1)return window.bika.lims.portalMessage("No analyses have been selected"),window.scroll(0,0),!1}this.load=function(){var e;$(".portaltype-artemplate input[name$='save']").addClass("allowMultiSubmit"),$(".portaltype-artemplate input[name$='save']").click(a),e={},e=0<document.location.href.search("/clients/")?{portal_type:"Client",id:document.location.href.split("clients")[1].split("/")[1],include_fields:["UID"]}:{portal_type:"BikaSetup",include_fields:["UID"]},window.bika.lims.jsonapi_read(e,function(e){e.objects&&e.objects.length<1||((e=e.objects[0]).UID,$(t).attr("search_query",JSON.stringify({getClientUID:e.UID})),referencewidget_lookups([$(t)]))}),$(t).bind("selected blur change",function(){var e=$(t).val()?$(t).attr("uid"):"";$(i).attr("search_query",JSON.stringify({getRawSamplePoints:e})),referencewidget_lookups([$(i)])}),$(i).bind("selected blur change",function(){var e=$(i).val()?$(i).attr("uid"):"";$(t).attr("search_query",JSON.stringify({getRawSampleTypes:e})),referencewidget_lookups([$(t)])})}}function BatchFolderView(){this.load=function(){$(".portaltype-batchfolder").append("<div id='batch-cancel-dialog' title='"+_t("Cancel batch/es?")+"'>    <p style='padding:10px'>        <span class='ui-icon ui-icon-alert' style=''float: left; margin: 0 7px 30px 0;'><br/></span>        "+_t("All linked Samples will be cancelled too.")+"    </p>    <p style='padding:0px 10px'>       "+_t("Are you sure?")+"    </p></div><input id='batch-cancel-resp' type='hidden' value='false'/>"),$("#batch-cancel-dialog").dialog({autoOpen:!1,resizable:!1,height:200,width:400,modal:!0,buttons:{"Cancel selected batches":function(){$(this).dialog("close"),$("#batch-cancel-resp").val("true"),$(".portaltype-batchfolder #cancel_transition").click()},Cancel:function(){$("#batch-cancel-resp").val("false"),$(this).dialog("close")}}}),$("#cancel_transition").click(function(e){return!!$(".bika-listing-table input[type='checkbox']:checked").length&&("true"==$("#batch-cancel-resp").val()||(e.preventDefault(),$("#batch-cancel-dialog").dialog("open"),!1))})}}function BikaSetupEditView(){var e=$("#archetypes-fieldname-RestrictWorksheetUsersAccess #RestrictWorksheetUsersAccess"),t=$("#archetypes-fieldname-RestrictWorksheetManagement #RestrictWorksheetManagement");this.load=function(){$('input[id^="Prefixes-separator-"]').each(function(){!function(e){var t=e.value,i=e.id,a=["","-","_"],n='<select id="'+i+'"></select>';$(e).after(n),$(e).hide();for(var r=0;r<a.length;r++){var o="selected";a[r]!=t&&(o="");o="<option "+o+" value="+a[r]+">"+a[r]+"</option>";$("select#"+i).append(o)}}(this)}),$('select[id^="Prefixes-separator-"]').bind("select change",function(){var e=$(this).val(),t=$(this).attr("id");$("input#"+t).val(e)}),$(e).change(function(){$(this).is(":checked")?($(t).prop("checked",!0),$(t).click(function(e){e.preventDefault()})):$(t).unbind("click")}),1==$("select[name=NumberOfRequiredVerifications] option:selected").val()&&(document.getElementById("archetypes-fieldname-TypeOfmultiVerification").style.display="none"),$("#NumberOfRequiredVerifications").change(function(){1<$(this).val()?document.getElementById("archetypes-fieldname-TypeOfmultiVerification").style.display="block":document.getElementById("archetypes-fieldname-TypeOfmultiVerification").style.display="none"}),$(e).change()}}function CalculationEditView(){this.load=function(){$("#TestParameters_more").hide(),$("#Formula").live("change",function(e){var r=[];$.each($("[id^=TestParameters-keyword]"),function(e,t){r.push($(t).val())});var t=$("#Formula").val().match(/\[[^\]]*\]/gi);$.each(t,function(e,t){var i,a,n;t=t.replace("[","").replace("]",""),-1==r.indexOf(t)&&(n=$(".records_row_TestParameters"),i=$(n[n.length-1]),a=n.length.toString(),n=$(i).clone(!0),$(n).find("[id^=TestParameters-keyword]").val(t),$(n).find("[id^=TestParameters-keyword]").attr("id","TestParameters-keyword-"+a),$(n).find("[id^=TestParameters-value]").attr("id","TestParameters-value-"+a),$(n).insertBefore(i))})})}}function ClientEditView(){var t="#archetypes-fieldname-DecimalMark",i="#DefaultDecimalMark";this.load=function(){function e(e){e.is(":checked")?$(t).fadeOut().hide():$(t).fadeIn()}e($(i)),$(i).click(function(){e($(this))})}}function ClientOverlayHandler(){this.load=function(){},this.onLoad=function(e){$.ajax({url:"bika_widgets/addresswidget.js",dataType:"script",async:!1})}}function CommonUtils(){this.load=function(){window.bika=window.bika||{lims:{}},window.bika.lims.AnalysisService=window.bika.lims.AnalysisService||{Dependants:function(e){var e={catalog_name:"bika_setup_catalog",UID:e,include_methods:"getServiceDependantsUIDs"},t={};return $.ajaxSetup({async:!1}),window.bika.lims.jsonapi_read(e,function(e){t=null!=e.objects&&0<e.objects.length?e.objects[0].getServiceDependantsUIDs:[]}),$.ajaxSetup({async:!0}),t},Dependencies:function(e){var e={catalog_name:"bika_setup_catalog",UID:e,include_methods:"getServiceDependenciesUIDs"},t={};return $.ajaxSetup({async:!1}),window.bika.lims.jsonapi_read(e,function(e){t=null!=e.objects&&0<e.objects.length?e.objects[0].getServiceDependenciesUIDs:[]}),$.ajaxSetup({async:!0}),t}},window.bika.lims.portalMessage=function(e){e="<dl class='portalMessage error alert alert-danger'><dt>"+_t("Error")+"</dt><dd><ul>"+e+"</ul></dd></dl>";$(".portalMessage").remove(),$(e).appendTo("#viewlet-above-content")},window.bika.lims.log=function(e){null!=window.location.url&&null!=window.location.url&&(e="("+window.location.url+"): "+e,$.ajax({type:"POST",url:"js_log",data:{message:e,_authenticator:$("input[name='_authenticator']").val()}}))},window.bika.lims.warning=function(e){e="("+window.location.href+"): "+e;$.ajax({type:"POST",url:"js_warn",data:{message:e,_authenticator:$("input[name='_authenticator']").val()}})},window.bika.lims.error=function(e){e="("+window.location.href+"): "+e;$.ajax({type:"POST",url:"js_err",data:{message:e,_authenticator:$("input[name='_authenticator']").val()}})},window.bika.lims.jsonapi_cache={},window.bika.lims.jsonapi_read=function(e,t){window.bika.lims.jsonapi_cache=window.bika.lims.jsonapi_cache||{},null==e.page_size&&(e.page_size=0);var i=$.param(e),a=t;void 0===window.bika.lims.jsonapi_cache[i]?$.ajax({type:"POST",dataType:"json",url:window.portal_url+"/@@API/read",data:e,success:function(e){window.bika.lims.jsonapi_cache[i]=e,a(e)}}):a(window.bika.lims.jsonapi_cache[i])},window.bika.lims.update_combogrid_query=function(e,t,i,a){var n,r;$(e).is(":visible")&&(a=a||"base_query",r=jQuery.parseJSON($(e).attr(a)),i&&(r[t]=i),""===i&&r[t]&&delete r[t],$(e).attr(a,JSON.stringify(r)),(n=jQuery.parseJSON($(e).attr("combogrid_options"))).url=window.portal_url+"/"+n.url,n.url=n.url+"?_authenticator="+$("input[name='_authenticator']").val(),n.url=n.url+"&catalog_name="+$(e).attr("catalog_name"),n.url=n.url+"&base_query="+encodeURIComponent($(e).attr("base_query")),n.url=n.url+"&search_query="+encodeURIComponent($.toJSON(r)),i=n.colModel,t=n.search_fields,a=n.discard_empty,r=n.minLength,n.url=n.url+"&colModel="+$.toJSON(i),n.url=n.url+"&search_fields="+$.toJSON(t),n.url=n.url+"&discard_empty="+$.toJSON(a),n.url=n.url+"&minLength="+$.toJSON(r),n.force_all="false",$(e).combogrid(n))},$(".ArchetypesPrioritySelectionWidget select").change(function(e){var t=$(this).find("option:selected").val();$(this).attr("value",t)}),$(".ArchetypesPrioritySelectionWidget select").change()},this.svgToImage=function(e){return'<img src="'+("data:image/svg+xml;base64,"+btoa(e))+'"/>'}}function DepartmentLabContactsView(){this.load=function(){$("table.bika-listing-table td input[type='checkbox']").not('[type="hidden"]').each(function(e){$(this).change(function(){var e,t,i,a;e=this,a={},t=$(e).prop("checked"),i=$(e).val(),url=window.location.href.replace("/labcontacts",""),e=url.replace(window.portal_url,""),a.contact_uid=i,a.checkbox_value=t,a.department=e,function(e){var t=$('tr[uid="'+e.contact_uid+'"] td.Fullname a').attr("href"),i=$('tr[uid="'+e.contact_uid+'"] td.Fullname a').text(),a="<a href='"+t+"'>"+i+"</a>";$.ajax({type:"POST",dataType:"json",url:window.location.href.replace("/labcontacts","")+"/labcontactupdate",data:{data:JSON.stringify(e)}}).done(function(e){null!==e&&!0===e.success?bika.lims.SiteView.notificationPanel(a+" updated successfully","succeed"):(bika.lims.SiteView.notificationPanel("Failure while updating "+a,"error"),e="[bika.lims.department.js in DepartmentLabContactsView] Failure while updating "+i+"in "+window.location.href,window.bika.lims.error(e))}).fail(function(){bika.lims.SiteView.notificationPanel("Error while updating "+a,"error");var e="[bika.lims.department.js in DepartmentLabContactsView] Error while updating "+i+"in "+window.location.href;window.bika.lims.error(e)})}(a)})})}}function ControlChart(){var m=this;this.setData=function(e){m.datasource=e},this.setXColumn=function(e){m.xcolumnkey=e},this.setYColumn=function(e){m.ycolumnkey=e},this.setYLabel=function(e){m.ylabel=e},this.setXLabel=function(e){m.xlabel=e},this.setUpperLimit=function(e){m.upperlimit=e},this.setLowerLimit=function(e){m.lowerlimit=e},this.setCenterLimit=function(e){m.centerlimit=e},this.setUpperLimitText=function(e){m.upperlimit_text=e},this.setLowerLimitText=function(e){m.lowerlimit_text=e},this.setCenterLimitText=function(e){m.centerlimit_text=e},this.setInterpolation=function(e){m.interpolation=e},this.setPointId=function(e){m.pointid=e},this.draw=function(e){var t=20,i=20,a=30,n=30,r=(r=$(e).innerWidth()-20)-n-i,l=(l=$(e).innerHeight()-20)-t-a,s=d3.time.scale().range([0,r]),c=d3.scale.linear().range([l,0]),d=d3.svg.axis().scale(s).orient("bottom").tickSize(0),u=d3.svg.axis().scale(c).orient("left").tickSize(0),p=d3.svg.line().interpolate(m.interpolation).x(function(e){return s(e.x_axis)}).y(function(e){return c(e.y_axis)}),h=d3.select(e).append("svg").attr("xmlns","http://www.w3.org/2000/svg").attr("width",r+n+i).attr("height",l+t+a).append("g").attr("transform","translate("+n+","+t+")");x_data_parse=d3.time.format("%Y-%m-%d %I:%M %p").parse,m.datasource.forEach(function(e){var t;e.x_axis=x_data_parse(e[m.xcolumnkey]),e.y_axis=(t=e[m.ycolumnkey])&&"string"==typeof o?+t:t,e.point_id=e[m.pointid]}),m.datasource.sort(function(e,t){return e.x_axis-t.x_axis}),s.domain(d3.extent(m.datasource,function(e){return e.x_axis}));n=d3.min(m.datasource,function(e){return e.y_axis});n>m.lowerlimit&&(n=m.lowerlimit);t=d3.max(m.datasource,function(e){return e.y_axis});t<m.upperlimit&&(t=m.upperlimit),c.domain([n,t]),h.append("g").attr("class","x axis").attr("transform","translate(0,"+l+")").call(d).style("font-size","11px").append("text").attr("x",r).attr("dy","-0.71em").attr("text-anchor","end").text(m.xlabel),h.append("g").attr("class","y axis").call(u).style("font-size","11px").append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text(m.ylabel),h.append("path").datum(m.datasource).attr("stroke","#4682b4").attr("stroke-width","1.5px").attr("fill","none").attr("class","line").attr("d",p),m.datasource.forEach(function(e){h.append("g").attr("fill","#2f2f2f").append("circle").attr("id",e.point_id).attr("r",3).attr("cx",s(e.x_axis)).attr("cy",c(e.y_axis)).on("mouseout",function(){d3.select(this).attr("fill","#2f2f2f").attr("r",3),d3.select(this.parentNode.children[1]).remove()}).on("mouseover",function(){d3.select(this).attr("fill","#4682b4").attr("r",6),d3.select(this.parentNode).append("text").attr("fill","#000000").style("font-size","10px").attr("x",s(e.x_axis)-10).attr("y",c(e.y_axis)-10).text(e.y_axis+m.ylabel)}).on("click",function(){d3.select(this).attr("fill","#4682b4").attr("r",6),d3.select(this.parentNode).append("text").attr("fill","#000000").style("font-size","10px").attr("x",s(e.x_axis)-10).attr("y",c(e.y_axis)-10).text(e.y_axis+m.ylabel)})}),h.append("line").attr("stroke","#8e0000").attr("stroke-width","1px").attr("stroke-dasharray","5, 5").attr({x1:0,y1:c(m.upperlimit),x2:r,y2:c(m.upperlimit)}),h.append("text").attr({x:30,y:c(m.upperlimit)-5}).style("font-size","11px").text(m.upperlimit_text),h.append("line").attr("stroke","#8e0000").attr("stroke-width","1px").attr("stroke-dasharray","5, 5").attr({x1:0,y1:c(m.lowerlimit),x2:r,y2:c(m.lowerlimit)}),h.append("text").attr({x:30,y:c(m.lowerlimit)-5}).style("font-size","11px").text(m.lowerlimit_text),h.append("line").attr("stroke","#598859").attr("stroke-width","1px").attr({x1:0,y1:c(m.centerlimit),x2:r,y2:c(m.centerlimit)}),h.append("text").attr({x:30,y:c(m.centerlimit)-5}).style("font-size","11px").text(m.centerlimit_text)}}function RangeGraph(){this.load=function(){$(".range-chart").each(function(e){var t,i,a,n,r,o,l,s,c,d,u,p,h,m,f,_,y=Number($(this).css("width").replace(/[^\d\.\-]/g,""));t=$(this).get(0),i=y,a=$.parseJSON($(this).attr("data-range")),n=$.parseJSON($(this).attr("data-result")),(_=function(e,t){if(!$.isNumeric(t))return null;t=parseFloat(t);if(!("min"in e&&"max"in e))return null;var i=$.isNumeric(e.min)?parseFloat(e.min):t,a=$.isNumeric(e.max)?parseFloat(e.max):t;if(i==a)return null;var n=i,r=a;"warn_min"in e&&$.isNumeric(e.warn_min)&&(n=(n=parseFloat(e.warn_min))<i?n:i);"warn_max"in e&&$.isNumeric(e.warn_max)&&(r=parseFloat(e.warn_max),r=a<r?r:a);return{result:t,min:i,max:a,warn_min:n,warn_max:r}}(a,n))&&(i-=o=2*(r=.03*i),l=_.min,s=_.max,c=_.warn_min,d=_.warn_max,n=_.result,m="min_operator"in a?a.min_operator:"geq",h="max_operator"in a?a.max_operator:"leq",p=(d-c)/3,u=n<c?n:c-p,y=d<n?n:d+p,_="gt"==m?l<n:l<=n,a=!1,(_="lt"==h?_&&n<s:_&&n<=s)||(f=(f="lt"==h?s<=n:s<n)&&n<=d,a=("gt"==m?n<=l:n<l)&&c<=n||f),p=_||a?"#a8d6cf":"#cdcdcd",h=_?"#279989":a?"#ffae00":"#ff0000",m=_||a?"#d9e9e6":"#dcdcdc",f=d3.scale.linear().domain([u,y]).range([0,i]),_=d3.select(t).append("svg").attr("xmlns","http://www.w3.org/2000/svg").attr("width",i+2*r).attr("height",o).append("g").attr("transform","translate("+r+",0)"),t=o/2-(a=2*r*.8)/2,i=.9*r,_.append("rect").attr("x",f(u)).attr("y",t).attr("width",f(c)-f(u)+i).attr("height",a).attr("rx",i).attr("ry",i).style("fill","#e9e9e9"),_.append("rect").attr("x",f(c)).attr("y",t).attr("width",f(l)-f(c)).attr("height",a).style("fill",m),_.append("rect").attr("x",f(s)).attr("y",t).attr("width",f(d)-f(s)).attr("height",a).style("fill",m),_.append("rect").attr("x",f(d)-i).attr("y",t).attr("width",f(y)-f(d)+i).attr("height",a).attr("rx",i).attr("ry",i).style("fill","#e9e9e9"),_.append("rect").attr("x",f(l)).attr("y",t).attr("width",f(s)-f(l)).attr("height",a).style("fill",p),_.append("circle").attr("cx",f(n)).attr("cy",o/2).attr("r",r).style("fill","white"),_.append("circle").attr("cx",f(n)).attr("cy",o/2).attr("r",r-1).style("fill",h)),$(this).removeClass("range-chart")})}}function InstrumentImportView(){this.load=function(){$("#instrument_select").change(function(){$(".portalMessage").remove(),$("#import_form").empty(),$("#intermediate").toggle(!1),""==$(this).val()?$("#exim").empty():$.ajax({type:"POST",dataType:"json",url:window.location.href.replace("/import","/getImportInterfaces"),data:{_authenticator:$('input[name="_authenticator"]').val(),instrument_uid:$(this).val()},success:function(e){$("#exim").empty(),$("#exim").append($("<option>").text("Choose an Interface...").attr("value","").attr("selected","selected")),$("#exim").append($("<option>").text("Default").attr("value","default")),$.each(e,function(e,t){$("#exim").append($("<option>").text(t.title).attr("value",t.id))})}})}),$("#exim").change(function(){$(".portalMessage").remove(),$("#intermediate").toggle(!1),""==$(this).val()?$("#import_form").empty():$("#import_form").load(window.location.href.replace("/import","/getImportTemplate"),{_authenticator:$('input[name="_authenticator"]').val(),exim:$(this).val()})}),$("select#exim").change(function(){setTimeout(function(){$("select#analysis_service").bind("select change",function(){""!=$("select#analysis_service").val()?$("div#default_result").fadeIn():$("div#default_result").fadeOut()})},800)}),$("[name='firstsubmit']").live("click",function(e){return e.preventDefault(),$(".portalMessage").remove(),0==$("#intermediate").length&&$("#import_form").after("<div id='intermediate'></div>"),$("#intermediate").toggle(!1),form=$(this).parents("form"),options={target:$("#intermediate"),data:JSON.stringify(form.formToArray()),dataType:"json",processData:!1,success:function(e,t,i,a){$("#intermediate").empty(),0<e.log.length&&(str="<div class='alert alert-info'>",str+="<h3>"+_t("Log trace")+"</h3><ul>",$.each(e.log,function(e,t){str+="<li>"+t+"</li>"}),str+="</ul></div>",$("#intermediate").append(str).toggle(!0)),0<e.errors.length&&(str="<div class='alert alert-danger'>",str+="<h3>"+_t("Errors")+"</h3><ul>",$.each(e.errors,function(e,t){str+="<li><code>"+t+"</code></li>"}),str+="</ul></div>",$("#intermediate").append(str).toggle(!0)),0<e.warns.length&&(str="<div class='alert alert-warning'>",str+="<h3>"+_t("Warnings")+"</h3><ul>",$.each(e.warns,function(e,t){str+="<li>"+t+"</li>"}),str+="</ul></div>",$("#intermediate").append(str).toggle(!0))},error:function(e,t,i){$("#intermediate").empty(),str="<div class='alert alert-danger'>",str+="<h3>"+_t("Errors found")+"</h3><ul>",str+="<li>"+t,str+="<pre>"+i+"</pre></li></ul></div>",$("#intermediate").append(str).toggle(!0)}},form.ajaxSubmit(options),!1})}}function InstrumentCertificationEditView(){function e(){$("#Internal").is(":checked")?$("#archetypes-fieldname-Agency").hide():$("#archetypes-fieldname-Agency").fadeIn("slow")}this.load=function(){$("#Internal").live("change",function(){e()}),e()}}function InstrumentEditView(){this.load=function(){$("#ResultFilesFolder_more").remove();var e=$(".records_row_ResultFilesFolder");for(i=0;i<e.length;i++)(0<i&&i==e.length-1?e[i]:e[i].children[2]).remove()},$("#ImportDataInterface").change(function(){!function(){var e,t=$("#ResultFilesFolder_table"),a=$(".records_row_ResultFilesFolder"),n=$("#ImportDataInterface").val();if(a.remove(),null==n||1==n.length&&""==n[0]){var r=$(a[a.length-1]).clone();for(i=0;i<$(r).children().length;i++){var o=$(r).children()[i],o=$(o).children()[0];$(o).val("")}$(r).appendTo($(t))}else{for(i=0;i<n.length;i++)""!=n[i]&&(r=$(a[a.length-1]).clone(),e=$(r).children()[0],e=$(e).children()[0],$(e).val(n[i]),e=$(r).children()[1],e=$(e).children()[0],$(e).val(""),$(r).appendTo($(t)));!function(){$("#ResultFilesFolder_table");var e=$(".records_row_ResultFilesFolder");for(i=0;i<e.length;i++){var t=$(e[i]).find("input[id^='ResultFilesFolder']");for(j=0;j<t.length;j++){var a=t[j].id,a=a.split("-")[0]+"-"+a.split("-")[1];$(t[j]).attr("id",a+"-"+i)}}}()}}()})}function InstrumentReferenceAnalysesView(){function i(e){var a=$("#selqcsample").val();$("#selqcsample option").remove(),$.map(e,function(e,t){var i=t==a?" selected":"";$("#selqcsample").append('<option value="'+t+'"'+i+">"+t+"</option>")})}function a(){var t=(t=$("#selanalyses").val().split("("))[t.length-1].slice(0,-1).trim(),i=$("#selqcsample").val(),a=0;$("div.results-info").remove(),$(".item-listing-tbody tr").each(function(e){$(this).attr("keyword")!=t||$(this).find("td.Partition a").html()!=i?$(this).hide():($(this).fadeIn(),a+=1)}),$(".bika-listing-table").closest("div").before('<div class="results-info">'+a+" results found</div>")}function n(e,t){var i=$("#selanalyses").val(),a=$("#selqcsample").val(),n=$("#interpolation").val();null==e&&$("#chart").innerWidth(),null==t&&$("#chart").innerHeight();$("#chart").css("width",e),$("#chart").css("height",t),$("#chart").html(""),$("#chart").show();var r,o,l,s=(s=$.parseJSON($("#graphdata").val()))[i];a in s&&0!=s[a].length?(l=(s=s[a])[s.length-1].unit,r=s[s.length-1].upper,o=s[s.length-1].lower,e=s[s.length-1].target,t="Result",""==l||void 0===l?l="":t=l,i=$.trim("UCL ("+r+l+")"),a=$.trim("LCL ("+o+l+")"),l=$.trim("CL ("+e+l+")"),chart=new ControlChart,chart.setData(s),chart.setInterpolation(n),chart.setXColumn("date"),chart.setYColumn("result"),chart.setPointId("id"),chart.setYLabel(t),chart.setXLabel("Date"),chart.setUpperLimitText(i),chart.setLowerLimitText(a),chart.setCenterLimitText(l),chart.setCenterLimit(e),chart.setUpperLimit(r),chart.setLowerLimit(o),chart.draw("#chart")):$("#chart").hide()}this.load=function(){var t=$.parseJSON($("#graphdata").val());$.map(t,function(e,t){$("#selanalyses").append('<option value="'+t+'">'+t+"</option>")}),$("#selanalyses").val()&&(i(t[$("#selanalyses").val()]),a(),n(null,null)),$("#selanalyses").change(function(e){i(t[$("#selanalyses").val()]),n(null,null),a()}),$("#selqcsample").change(function(e){n(null,null),a()}),$("#interpolation").change(function(e){n(null,null)}),$(".item-listing-tbody tr").mouseover(function(e){var t;""!=$(this).attr("uid")&&($(this).addClass("selected"),t=$(this).attr("uid"),$("#chart svg g circle#"+t).trigger("__onmouseover"))}),$(".item-listing-tbody tr").mouseout(function(e){var t;$(this).removeClass("selected"),""!=$(this).attr("uid")&&(t=$(this).attr("uid"),$("#chart svg g circle#"+t).trigger("__onmouseout"))}),$("#printgraph").click(function(e){e.preventDefault();n(670,$("#chart").attr("height"));var t=window.open("","","left=0,top=0,width=800,height=900,toolbar=0,scrollbars=0,status=0"),i='<link href="'+window.portal_url+'/++resource++bika.lims.css/print-graph.css" type="text/css" rel="stylesheet">',a=$("span.documentFirstHeading").closest("h1").clone(),e=$("#content-core").clone();$(e).prepend(a),$(e).find("#selanalyses").after("<span class='bold'>"+$("#selanalyses").val()+"</span>"),$(e).find("#interpolation").after("<span class='bold'>"+$("#interpolation").val()+"</span>"),$(e).find("#selqcsample").after("<span class='bold'>"+$("#selqcsample").val()+"</span>"),$(e).find("#selanalyses").hide(),$(e).find("#interpolation").hide(),$(e).find("#selqcsample").hide(),t.document.write("<html><head>"+i+"</head><body>"+$(e).html()+"</body></html>"),t.document.close(),t.focus(),t.print(),$("#chart").css("width","100%"),$("#chart").removeAttr("height"),n(null,null),t.close()}),$("div.bika-listing-table-container").fadeIn()}}function ReferenceSampleAnalysesView(){function t(){var t=(t=$("#selanalyses").val().split("("))[t.length-1].slice(0,-1).trim(),i=0;$("div.results-info").remove(),$(".item-listing-tbody tr").each(function(e){$(this).attr("keyword")!=t?$(this).hide():($(this).fadeIn(),i+=1)}),$(".bika-listing-table").closest("div").before('<div class="results-info">'+i+" results found</div>")}function n(e,t){var i=$("#selanalyses").val(),a=$("#selqcsample").val(),n=$("#interpolation").val();null==e&&$("#chart").innerWidth(),null==t&&$("#chart").innerHeight();$("#chart").css("width",e),$("#chart").css("height",t),$("#chart").html(""),$("#chart").show();var r,o,l,s=(s=$.parseJSON($("#graphdata").val()))[i];a in s&&0!=s[a].length?(l=(s=s[a])[s.length-1].unit,r=s[s.length-1].upper,o=s[s.length-1].lower,e=s[s.length-1].target,t="Result",""==l||void 0===l?l="":t=l,i=$.trim("UCL ("+r+l+")"),a=$.trim("LCL ("+o+l+")"),l=$.trim("CL ("+e+l+")"),chart=new ControlChart,chart.setData(s),chart.setInterpolation(n),chart.setXColumn("date"),chart.setYColumn("result"),chart.setPointId("id"),chart.setYLabel(t),chart.setXLabel("Date"),chart.setUpperLimitText(i),chart.setLowerLimitText(a),chart.setCenterLimitText(l),chart.setCenterLimit(e),chart.setUpperLimit(r),chart.setLowerLimit(o),chart.draw("#chart")):$("#chart").hide()}this.load=function(){var e=$.parseJSON($("#graphdata").val()),i=!1;$.map(e,function(e,t){$("#selanalyses").append('<option value="'+t+'">'+t+"</option>"),0==i&&($.map(e,function(e,t){$("#selqcsample").val(t)}),i=!0)}),$("#selanalyses").val()&&(t(),n(null,null)),$("#selanalyses").change(function(e){n(null,null),t()}),$("#interpolation").change(function(e){n(null,null)}),$(".item-listing-tbody tr").mouseover(function(e){var t;""!=$(this).attr("uid")&&($(this).addClass("selected"),t=$(this).attr("uid"),$("#chart svg g circle#"+t).trigger("__onmouseover"))}),$(".item-listing-tbody tr").mouseout(function(e){var t;$(this).removeClass("selected"),""!=$(this).attr("uid")&&(t=$(this).attr("uid"),$("#chart svg g circle#"+t).trigger("__onmouseout"))}),$("#printgraph").click(function(e){e.preventDefault(),$("#selanalyses").find("option[selected]").remove(),$("#selanalyses").find('option[value="'+$(selanalyses).val()+'"]').prop("selected",!0);n(670,$("#chart").attr("height"));var t=window.open("","","left=0,top=0,width=800,height=900,toolbar=0,scrollbars=0,status=0"),i='<link href="'+window.portal_url+'/++resource++bika.lims.css/print-graph.css" type="text/css" rel="stylesheet">',a=$("span.documentFirstHeading").closest("h1").clone(),e=$("#content-core").clone();$(e).prepend(a),$(e).find("#selanalyses").after("<span class='bold'>"+$("#selanalyses").val()+"</span>"),$(e).find("#interpolation").after("<span class='bold'>"+$("#interpolation").val()+"</span>"),$(e).find("#selanalyses").hide(),$(e).find("#interpolation").hide(),t.document.write("<html><head>"+i+"</head><body>"+$(e).html()+"</body></html>"),t.document.close(),t.focus(),t.print(),t.close(),$("#chart").css("width","100%"),$("#chart").removeAttr("height"),n(null,null)}),$("div.bika-listing-table-container").fadeIn()}}function RejectionKickOff(){this.load=function(){window.bika.lims.jsonapi_read({catalog_name:"portal_catalog",portal_type:"BikaSetup",include_fields:["RejectionReasons"]},function(e){var t;e.success&&0<e.total_objects&&(0<(e=e.objects[0].RejectionReasons).length&&(t=e[0].checkbox),void 0!==t&&"on"==t||$("a#workflow-transition-reject").closest("li").hide())}),function(){"use strict";var e,t;0<$("div#archetypes-fieldname-RejectionWidget").length&&($("a#workflow-transition-reject").unbind(),$("a#workflow-transition-reject").bind("click",function(e){e.preventDefault(),$("#semioverlay").show(),$('input[id="RejectionReasons.checkbox"]').click().prop("disabled",!0)}),e=$("#archetypes-fieldname-RejectionWidget").parent("td"),t="<div class='semioverlay-head'>"+$(e).prev("td").html().trim()+"</div>",$("#content").prepend("<div id='semioverlay' style='display:none'> <div class='semioverlay-back'> </div> <div class='semioverlay-panel'> <div class='semioverlay-content'></div> <div class='semioverlay-buttons'> <input type='button' name='semioverlay.reject' value='reject'/> <input type='button' name='semioverlay.cancel' value='cancel'/></div></div></div>"),$("#archetypes-fieldname-RejectionWidget").detach().prependTo("#semioverlay .semioverlay-content"),$(e).hide(),$(t).detach().insertBefore(".semioverlay-content"),$("div#semioverlay input[name='semioverlay.cancel']").bind("click",function(){$("#semioverlay").hide(),$('input[id="RejectionReasons.checkbox"]').prop("checked",!1).prop("disabled",!1),$('input[id="RejectionReasons.checkbox.other"]').prop("checked",!1),$('input[id="RejectionReasons.textfield.other"]').val("");for(var e=$(".rejectionwidget-multiselect").find("option"),t=0;e.length>t;t++)$(e[t]).attr("selected",!1)}),$("div#semioverlay input[name='semioverlay.reject']").bind("click",function(){$("div#semioverlay .semioverlay-panel").fadeOut(),function(){var e={},t=window.location.href.replace("/base_view","").replace("/analyses","").replace("/manage_results","").replace("/not_requested","").replace("/log","").replace(window.portal_url,""),i=$("a#workflow-transition-reject").attr("href");e.obj_path=t,t=function(){var e,t=0,i=[],a=0,n="";if(t=$(".rejectionwidget-checkbox").prop("checked")){t=1;for(var r=$(".rejectionwidget-multiselect").find("option"),o=0;r.length>o;o++)(e=r[o]).selected&&i.push($(e).val());(a=$(".rejectionwidget-checkbox-other").prop("checked"))?(a=1,n=$(".rejectionwidget-input-other").val()):a=0}else t=0;n={checkbox:t,selected:i,checkbox_other:a,other:n};return $.toJSON(n)}(),e.RejectionReasons=t;var a="";$.ajax({type:"POST",url:window.portal_url+"/@@API/update",data:e}).done(function(e){var t;null!==e&&!0===e.success?(bika.lims.SiteView.notificationPanel("Rejecting","succeed"),$("body").hasClass("portaltype-sample")?(t=$('input[name="_authenticator"]').val(),$.ajax({url:window.location.href+"/doActionForSample?workflow_action=reject&_authenticator="+t,type:"POST",dataType:"json"}).done(function(e){null!==e&&"true"==e.success?window.location.href=window.location.href:(bika.lims.SiteView.notificationPanel("Error while updating object state","error"),e="[bika.lims.analysisrequest.js] Error while updating object state",window.bika.lims.error(e),$('#semioverlay input[name="semioverlay.cancel"]').click())})):(bika.lims.SiteView.notificationPanel("Rejecting","succeed"),window.location.href=i)):(a=!1===e.success?(bika.lims.SiteView.notificationPanel("Error while rejecting the analysis request. Unsuccesful AJAX call.","error"),"[bika.lims.analysisrequest.js] Error while rejecting the analysis request. Unsuccesful AJAX call."):(bika.lims.SiteView.notificationPanel("Error while rejecting the analysis request. No data returned.","error"),"[bika.lims.analysisrequest.js] Error while rejecting the analysis request. No data returned."),window.bika.lims.error(a),$('#semioverlay input[name="semioverlay.cancel"]').click())}).fail(function(){bika.lims.SiteView.notificationPanel("Error while rejection the analysis request. AJAX POST failed.","error");var e="[bika.lims.analysisrequest.js] Error while rejection the analysis request. AJAX POST failed.";window.bika.lims.error(e),$('#semioverlay input[name="semioverlay.cancel"]').click()})}()}))}()}}function BarcodeUtils(){this.load=function(){$(".qrcode").each(function(e){var t=$(this).attr("data-code"),i=$(this).attr("data-size");$(this).qrcode({render:"image",size:i,color:"#3a3",text:t})}),$(".barcode").each(function(){var e=$(this).attr("data-id"),t=$(this).attr("data-code"),i=$(this).attr("data-barHeight"),a=$(this).attr("data-addQuietZone"),n=$(this).attr("data-showHRI");$(this).barcode(e,t,{barHeight:parseInt(i),addQuietZone:"true"==a,showHRI:"true"==n,output:"bmp"}),"true"==n&&($(this).find(".barcode-hri").remove(),e='<div class="barcode-hri">'+e+"</div>",$(this).append(e))})}}function WorksheetPrintView(){function n(){$(".barcode").each(function(){var e=$(this).attr("data-id"),t=$(this).attr("data-code"),i=$(this).attr("data-barHeight"),a=$(this).attr("data-addQuietZone"),n=$(this).attr("data-showHRI");$(this).barcode(e,t,{barHeight:parseInt(i),addQuietZone:Boolean(a),showHRI:Boolean(n)})})}this.load=function(){var t=document.referrer;t?bika.lims.SiteView.setCookie("ws.print.urlback",t):t=(t=bika.lims.SiteView.readCookie("ws.print.urlback"))||portal_url,n(),$("#print_button").click(function(e){e.preventDefault(),window.print()}),$("#cancel_button").click(function(e){e.preventDefault(),location.href=t}),$("#template").change(function(e){var t=window.location.href,i=$(this).val(),a=$("#numcols").val();$("#worksheet-printview").animate({opacity:.2},"slow"),$.ajax({url:t,type:"POST",data:{template:i,numcols:a}}).always(function(e){var t=e,e=$(t).find("#report-style").html();$("#report-style").html(e),t=$(t).find("#worksheet-printview").html(),$("#worksheet-printview").html(t),$("#worksheet-printview").animate({opacity:1},"slow"),n()})}),$("#numcols").change(function(e){var t=window.location.href,i=$(this).val(),a=$("#template").val();$("#worksheet-printview").animate({opacity:.2},"slow"),$.ajax({url:t,type:"POST",data:{template:a,numcols:i}}).always(function(e){var t=e,e=$(t).find("#report-style").html();$("#report-style").html(e),t=$(t).find("#worksheet-printview").html(),$("#worksheet-printview").html(t),$("#worksheet-printview").animate({opacity:1},"slow"),n()})})}}function WorksheetTemplateEdit(){this.load=function(){var e=$("#archetypes-fieldname-RestrictToMethod").find("select");$(e).bind("change",function(e,t){var i;i=this,i=$(i).val(),$.ajax({url:window.portal_url+"/ajaxgetworksheettemplateinstruments",type:"POST",data:{_authenticator:$('input[name="_authenticator"]').val(),method_uid:JSON.stringify(i)},dataType:"json"}).done(function(e){var t,i;if(null!==e&&$.isArray(e))for(t=$("#archetypes-fieldname-Instrument").find("select"),$(t).find("option").remove(),i=0;e.length>i;i++)$(t).append('<option value="'+e[i].uid+'">'+e[i].m_title+"</option>")}).fail(function(){window.bika.lims.log("bika.lims.worksheettemplate: Something went wrong while retrieving instrument list")})})}}(function(){window.AnalysisRequestView=function(){var e=function(e){var t;e.preventDefault(),t=e.currentTarget.href.replace("content_status_modify","workflow_action"),0<(e=$("#PublicationSpecification_uid")).length&&(t=t+"&PublicationSpecification="+$(e).val()),window.location.href=t},t=function(){var a,e=$("#workflow-transition-schedule_sampling").attr("href");e&&(a=e.replace("content_status_modify","workflow_action"),$("#workflow-transition-schedule_sampling").attr("href",a),$("#workflow-transition-schedule_sampling").click(function(){var e,t=$("#SamplingDate").val(),i=$("#ScheduledSamplingSampler").val();""!==t&&null!=t&&""!==i&&null!=i?window.location.href=a:((e="")!==t&&null!=t||(e+=PMF("${name} is required for this action, please correct.",{name:_("Sampling Date")})),""!==i&&null!=i||(""!==e&&(e+="<br/>"),e+=PMF("${name} is required, please correct.",{name:_("'Define the Sampler for the shceduled'")})),""!==e&&window.bika.lims.portalMessage(e))}))},i=function(){$("#interpretationtemplate-insert").click(function(e){var t,i;e.preventDefault(),(e=$("#interpretationtemplate").val())&&1===(t=$('div[id^="ResultsInterpretationDepts-"].active  textarea[id^="ResultsInterpretationDepts-richtext-"]')).length&&(i=t.attr("id"),e={catalog_name:"uid_catalog",UID:e,include_fields:["text"]},window.bika.lims.jsonapi_read(e,function(e){if(1===e.objects.length)return e=e.objects[0].text,tinymce.get(i).insertContent(e)}))})};this.load=function(){$("a[id^='workflow-transition']").not("#workflow-transition-schedule_sampling").not("#workflow-transition-sample").click(e),t(),i()}},window.AnalysisRequestViewView=function(){this.load=function(){}},window.AnalysisRequestAnalysesView=function(){this.load=function(){}}}).call(this),function(){function e(e,t){return function(){return e.apply(t,arguments)}}function t(){this.on_toggle_change=e(this.on_toggle_change,this),this.bind_eventhandler=e(this.bind_eventhandler,this),this.load=e(this.load,this)}window.ReportFolderView=(t.prototype.load=function(){return this.bind_eventhandler()},t.prototype.bind_eventhandler=function(){return $("body").on("click","a[id$='_selector']",this.on_toggle_change)},t.prototype.on_toggle_change=function(e){return e.preventDefault(),$(".criteria").toggle(!1),e=e.currentTarget.id.split("_selector")[0],$("[id='"+e+"']").toggle(!0)},t)}.call(this),function(){function e(e,t){return function(){return e.apply(t,arguments)}}function t(){this.on_service_info_click=e(this.on_service_info_click,this),this.on_reference_definition_list_change=e(this.on_reference_definition_list_change,this),this.on_numeric_field_keypress=e(this.on_numeric_field_keypress,this),this.on_numeric_field_paste=e(this.on_numeric_field_paste,this),this.on_at_float_field_keyup=e(this.on_at_float_field_keyup,this),this.on_at_integer_field_keyup=e(this.on_at_integer_field_keyup,this),this.notify_in_panel=e(this.notify_in_panel,this),this.notificationPanel=e(this.notificationPanel,this),this.set_cookie=e(this.set_cookie,this),this.setCookie=e(this.setCookie,this),this.read_cookie=e(this.read_cookie,this),this.readCookie=e(this.readCookie,this),this.log=e(this.log,this),this.portal_alert=e(this.portal_alert,this),this.portalAlert=e(this.portalAlert,this),this.get_authenticator=e(this.get_authenticator,this),this.get_portal_url=e(this.get_portal_url,this),this.init_referencedefinition=e(this.init_referencedefinition,this),this.init_datepickers=e(this.init_datepickers,this),this.bind_eventhandler=e(this.bind_eventhandler,this),this.load=e(this.load,this)}window.SiteView=(t.prototype.load=function(){return this.init_datepickers(),this.bind_eventhandler(),this.allowed_keys=[8,9,13,35,36,37,39,46,44,60,62,45,69,101,61]},t.prototype.bind_eventhandler=function(){return $("body").on("change","#ReferenceDefinition\\:list",this.on_reference_definition_list_change),$("body").on("keypress",".numeric",this.on_numeric_field_keypress),$("body").on("paste",".numeric",this.on_numeric_field_paste),$("body").on("keyup","input[name*='\\:int'], .ArchetypesIntegerWidget input",this.on_at_integer_field_keyup),$("body").on("keyup","input[name*='\\:float'], .ArchetypesDecimalWidget input",this.on_at_float_field_keyup),$("body").on("click","a.service_info",this.on_service_info_click),$(document).on({ajaxStart:function(){$("body").addClass("loading")},ajaxStop:function(){$("body").removeClass("loading")},ajaxError:function(){$("body").removeClass("loading")}})},t.prototype.init_datepickers=function(){var i,e=new Date,t="1900:"+e.getFullYear(),a=("undefined"!=typeof i18n&&null!==i18n?i18n.currentLanguage:void 0)||"en",n=$.datepicker.regional[a]||$.datepicker.regional[""],a=_t("date_format_short_datepicker");return"date_format_short_datepicker"===a&&(a="yy-mm-dd"),i=Object.assign(n,{dateFormat:a,timeFormat:"HH:mm",showOn:"focus",showAnim:"fadeIn",changeMonth:!0,changeYear:!0,showWeek:!0,yearRange:t,numberOfMonths:1}),t=function(e){var t;return void 0===e&&(e={}),t=Object.assign({},i),Object.assign(t,e)},$("input.datepicker_nofuture").datepicker(t({maxDate:e})),$("input.datepicker").datepicker(t()),$("input.datepicker_2months").datepicker(t({maxDate:e,numberOfMonths:2})),$("input.datetimepicker_nofuture").datetimepicker(t({maxDate:e}))},t.prototype.init_referencedefinition=function(){if(""!==$("#ReferenceDefinition:list").val())return $("#ReferenceDefinition:list").change()},t.prototype.get_portal_url=function(){return window.portal_url},t.prototype.get_authenticator=function(){return window.site.authenticator()},t.prototype.portalAlert=function(e){return this.portal_alert(e)},t.prototype.portal_alert=function(e){var t=$("#portal-alert");0===t.length?$("#portal-header").append("<div id='portal-alert' style='display:none'><div class='portal-alert-item'>"+e+"</div></div>"):t.append("<div class='portal-alert-item'>"+e+"</div>"),t.fadeIn()},t.prototype.log=function(e){return window.bika.lims.log(e)},t.prototype.readCookie=function(e){return window.site.read_cookie(e)},t.prototype.read_cookie=function(e){return window.site.read_cookie(e)},t.prototype.setCookie=function(e,t){return window.site.set_cookie(e,t)},t.prototype.set_cookie=function(e,t){window.site.set_cookie(e,t)},t.prototype.notificationPanel=function(e,t){return this.notify_in_panel(e,t)},t.prototype.notify_in_panel=function(e,t){$("#panel-notification").remove(),e="<div id='panel-notification' style='display:none'><div class='"+t+"-notification-item'>"+e+"</div></div>",$("div#viewlet-above-content-title").append(e),$("#panel-notification").fadeIn("slow","linear",function(){setTimeout(function(){$("#panel-notification").fadeOut("slow","linear")},3e3)})},t.prototype.on_at_integer_field_keyup=function(e){var e=e.currentTarget,e=$(e);/\D/g.test(e.val())&&e.val(e.val().replace(/\D/g,""))},t.prototype.on_at_float_field_keyup=function(e){var e=e.currentTarget,e=$(e);/[^-.\d]/g.test(e.val())&&e.val(e.val().replace(/[^.\d]/g,""))},t.prototype.on_numeric_field_paste=function(e){var e=e.currentTarget,t=$(e);window.setTimeout(function(){t.val(t.val().replace(",","."))},0)},t.prototype.on_numeric_field_keypress=function(e){var t=e.currentTarget,i=$(t),a=e.which,t=this.allowed_keys.join(",").match(new RegExp(a));!a||48<=a&&a<=57||t?window.setTimeout(function(){i.val(i.val().replace(",","."))},0):e.preventDefault()},t.prototype.on_reference_definition_list_change=function(e){var t=e.currentTarget,i=$(t),e=this.get_authenticator(),t=i.val(),i=i.children(":selected").html();if(""===t)return $("#Blank").prop("checked",!1),$("#Hazardous").prop("checked",!1),void $(".bika-listing-table").load("referenceresults",{_authenticator:e});-1<i.search(_t("(Blank)"))||-1<i.search("(Blank)")?$("#Blank").prop("checked",!0):$("#Blank").prop("checked",!1),-1<i.search(_t("(Hazardous)"))||-1<i.search("(Hazardous)")?$("#Hazardous").prop("checked",!0):$("#Hazardous").prop("checked",!1),$(".bika-listing-table").load("referenceresults",{_authenticator:e,uid:t})},t.prototype.on_service_info_click=function(e){return e.preventDefault(),e=e.currentTarget,$(e).prepOverlay({subtype:"ajax",width:"80%",filter:"#content>*:not(div#portal-column-content)",config:{closeOnClick:!0,closeOnEsc:!0,onBeforeLoad:function(e){return this.getOverlay().draggable()},onLoad:function(e){return e=new Event("DOMContentLoaded",{}),window.document.dispatchEvent(e)}}}),$(e).click()},t)}.call(this),function(){window.AttachmentsUtils=function(){this.load=function(){$("#AttachFile,#Service,#Analysis").change(function(e){var t,i,a=$("#AttachFile").val();void 0===a&&(a=""),void 0===(i=$("#Service").val())&&(i=""),void 0===(t=$("#Analysis").val())&&(t=""),"Service"===this.id&&$("#Analysis").val(""),"Analysis"===this.id&&$("#Service").val(""),""===a||""===i&&""===t?$("#addButton").prop("disabled",!0):$("#addButton").removeAttr("disabled")}),$("#Analysis").combogrid({colModel:[{columnName:"analysis_uid",hidden:!0},{columnName:"slot",width:"10",label:_t("Slot")},{columnName:"service",width:"35",label:_t("Service")},{columnName:"parent",width:"35",label:_t("Parent")},{columnName:"type",width:"20",label:_t("Type")}],url:window.location.href.replace("/manage_results","")+"/attachAnalyses?_authenticator="+$('input[name="_authenticator"]').val(),showOn:!0,width:"650px",select:function(e,t){return $("#Analysis").val(t.item.service+(" (slot "+t.item.slot)+")"),$("#analysis_uid").val(t.item.analysis_uid),$(this).change(),!1}})}}}.call(this),$(document).ready(function(){window.bika=window.bika||{lims:{}},window.bika.lims.barcode_listener=new function(){this.load=function(){var t=!1,i="";$(window).keypress(function(e){"BODY"==e.target.tagName&&(t?i+=String.fromCharCode(e.which):(t=!0,i=String.fromCharCode(e.which),setTimeout(function(){var e;t=!1,2<i.length&&(e=i,authenticator=$('input[name="_authenticator"]').val(),$.ajax({type:"POST",url:"barcode_entry",data:{entry:e,_authenticator:authenticator},success:function(e,t,i,a){e.success&&(window.location.href=e.url)}}))},500)))})}},window.bika.lims.barcode_listener.load()}),function(){function e(e,t){return function(){return e.apply(t,arguments)}}function t(){this.on_instrument_change=e(this.on_instrument_change,this),this.on_template_change=e(this.on_template_change,this),this.select_instrument=e(this.select_instrument,this),this.get_template_instrument=e(this.get_template_instrument,this),this.bind_eventhandler=e(this.bind_eventhandler,this),this.load=e(this.load,this)}function i(){this.on_wideinterims_apply_click=e(this.on_wideinterims_apply_click,this),this.on_slot_remarks_click=e(this.on_slot_remarks_click,this),this.on_wideiterims_interims_change=e(this.on_wideiterims_interims_change,this),this.on_wideiterims_analyses_change=e(this.on_wideiterims_analyses_change,this),this.on_instrument_change=e(this.on_instrument_change,this),this.on_layout_change=e(this.on_layout_change,this),this.on_analyst_change=e(this.on_analyst_change,this),this.get_authenticator=e(this.get_authenticator,this),this.get_base_url=e(this.get_base_url,this),this.get_portal_url=e(this.get_portal_url,this),this.ajax_submit=e(this.ajax_submit,this),this.bind_eventhandler=e(this.bind_eventhandler,this),this.load=e(this.load,this)}window.WorksheetFolderView=(t.prototype.load=function(){return this.bind_eventhandler()},t.prototype.bind_eventhandler=function(){return $("body").on("change","select.template",this.on_template_change),$("body").on("change","select.instrument",this.on_instrument_change)},t.prototype.get_template_instrument=function(){var e=$("input.templateinstruments").val();return JSON.parse(e)},t.prototype.select_instrument=function(e){e=$(".instrument").find("option[value='"+e+"']");if(e)return e.prop("selected",!0)},t.prototype.on_template_change=function(e){var e=$(e.currentTarget).val(),e=this.get_template_instrument()[e];return this.select_instrument(e)},t.prototype.on_instrument_change=function(e){if($(e.currentTarget).val())return e=_t("Only the analyses for which the selected instrument is allowed will be added automatically."),bika.lims.SiteView.notify_in_panel(e,"error")},t),window.WorksheetManageResultsView=(i.prototype.load=function(){return this.bind_eventhandler()},i.prototype.bind_eventhandler=function(){return $("body").on("change",".manage_results_header .analyst",this.on_analyst_change),$("body").on("change","#resultslayout_form #resultslayout",this.on_layout_change),$("body").on("change",".manage_results_header .instrument",this.on_instrument_change),$("body").on("change","#wideinterims_analyses",this.on_wideiterims_analyses_change),$("body").on("change","#wideinterims_interims",this.on_wideiterims_interims_change),$("body").on("click","#wideinterims_apply",this.on_wideinterims_apply_click),$("body").on("click","img.slot-remarks",this.on_slot_remarks_click)},i.prototype.ajax_submit=function(e){var t,i;return null==e&&(e={}),null==e.type&&(e.type="POST"),null==e.url&&(e.url=this.get_base_url()),null==e.context&&(e.context=this),$(this).trigger("ajax:submit:start"),i=this,t=function(){return $(i).trigger("ajax:submit:end")},$.ajax(e).done(t)},i.prototype.get_portal_url=function(){return $("input[name=portal_url]").val()||window.portal_url},i.prototype.get_base_url=function(){return window.location.href.split("?")[0]},i.prototype.get_authenticator=function(){return $("input[name='_authenticator']").val()},i.prototype.on_analyst_change=function(e){var t=$(e.currentTarget).val();return""!==t&&(e=this.get_base_url().replace("/manage_results","")+"/set_analyst",this.ajax_submit({url:e,data:{value:t,_authenticator:this.get_authenticator()},dataType:"json"}).done(function(e){return bika.lims.SiteView.notify_in_panel(_p("Changes saved."),"succeed")}).fail(function(){return bika.lims.SiteView.notify_in_panel(_t("Could not set the selected analyst"),"error")}))},i.prototype.on_layout_change=function(e){return $(e.currentTarget)},i.prototype.on_instrument_change=function(e){var t=$(e.currentTarget).val();return""!==t&&(e=this.get_base_url().replace("/manage_results","")+"/set_instrument",this.ajax_submit({url:e,data:{value:t,_authenticator:this.get_authenticator()},dataType:"json"}).done(function(e){return bika.lims.SiteView.notify_in_panel(_t("Changes saved."),"succeed"),$("select[column_key='Instrument'] option[value='"+t+"']").parent().find("option[value='"+t+"']").prop("selected",!1),$("select[column_key='Instrument'] option[value='"+t+"']").prop("selected",!0)}).fail(function(){return bika.lims.SiteView.notify_in_panel(_t("Unable to apply the selected instrument"),"error")}))},i.prototype.on_wideiterims_analyses_change=function(e){var e=$(e.currentTarget);return $("#wideinterims_interims").html(""),e=e.val(),$("input[id^='wideinterim_"+e+"']").each(function(e,t){var i=$(t).attr("name"),i="<option value='"+$(t).attr("keyword")+"'>"+i+"</option>";return $("#wideinterims_interims").append(i)})},i.prototype.on_wideiterims_interims_change=function(e){var e=$(e.currentTarget),e="#wideinterim_"+$("#wideinterims_analyses").val()+"_"+e.val();return $("#wideinterims_value").val($(e).val())},i.prototype.on_slot_remarks_click=function(e){e=e.currentTarget;return $(e).prepOverlay({subtype:"ajax",filter:"h1,div.remarks-widget",config:{closeOnClick:!0,closeOnEsc:!0,onBeforeLoad:function(e){var t=this.getOverlay();return $("div.pb-ajax>div",t).addClass("container-fluid"),$("h3",t).remove(),$("textarea",t).remove(),$("input",t).remove(),t.draggable()},onLoad:function(e){return $.mask.close()}}}),$(e).click()},i.prototype.on_wideinterims_apply_click=function(e){var i,a,n;return e.preventDefault(),$(e.currentTarget),$("#wideinterims_analyses").val(),e=$("#wideinterims_interims").val(),i=$("#wideinterims_empty").is(":checked"),n=$("#wideinterims_value").val(),a=function(e,t){return Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"value").set.call(e,t),t=new Event("input",{bubbles:!0}),e.dispatchEvent(t)},$("tr td input[column_key='"+e+"']").each(function(e,t){return i&&""!==$(this).val()&&"0"!==$(this).val().match(/\d+/)||a(t,n),!0})},i)}.call(this),window.bika=window.bika||{lims:{}},window.bika.lims.controllers={html:["CommonUtils"],".barcode, .qrcode":["BarcodeUtils"],".range-chart":["RangeGraph"],".attachments":["AttachmentsUtils"],body:["SiteView"],".portaltype-analysisprofile.template-base_edit":["AnalysisProfileEditView"],".portaltype-instrument.template-referenceanalyses":["InstrumentReferenceAnalysesView"],".portaltype-instrumentcertification.template-base_edit":["InstrumentCertificationEditView"],".portaltype-instrument.template-base_edit":["InstrumentEditView"],".portaltype-calculation":["CalculationEditView"],".portaltype-bikasetup.template-base_edit":["BikaSetupEditView"],".portaltype-client.template-base_edit":["ClientEditView"],"div.overlay #client-base-edit":["ClientOverlayHandler"],".portaltype-referencesample.template-analyses":["ReferenceSampleAnalysesView"],".portaltype-artemplate.template-base_edit":["ARTemplateEditView"],".portaltype-analysisrequest":["AnalysisRequestView"],".portaltype-analysisrequest:not(.template-ar_add)":["RejectionKickOff"],".portaltype-analysisrequest.template-base_view":["WorksheetManageResultsView","AnalysisRequestViewView","RejectionKickOff"],".portaltype-analysisrequest.template-analyses":["AnalysisRequestAnalysesView"],".portaltype-analysisrequest.template-ar_add":["AnalysisRequestAddView"],"#analysisrequest_add_form":["AnalysisRequestAdd"],".portaltype-supplyorder.template-base_edit":["SupplyOrderEditView"],".portaltype-plone-site.template-import":["InstrumentImportView"],".portaltype-batchfolder":["BatchFolderView"],".portaltype-worksheetfolder":["WorksheetFolderView"],".portaltype-worksheet.template-manage_results":["WorksheetManageResultsView"],".portaltype-worksheettemplate.template-base_edit":["WorksheetTemplateEdit"],"#worksheet-printview-wrapper":["WorksheetPrintView"],".template-labcontacts.portaltype-department":["DepartmentLabContactsView"],".portaltype-reportfolder":["ReportFolderView"],".ArchetypesRemarksWidget":["RemarksWidgetView"]},window.bika.lims.loadControllers=function(t,i){var a,e=window.bika.lims.controllers,n=new Array,r=n.length;for(a in e)($(a).length||0<=$.inArray(a,i))&&e[a].forEach(function(e){(1==t||0<=$.inArray(a,i)||$.inArray(e,n)<0)&&(obj=new window[e],obj.load(),window.bika.lims[e]=obj,n.push(e))});return n.length-r},document.addEventListener("DOMContentLoaded",function(e){window.bika.lims.loadControllers(!1,[])});