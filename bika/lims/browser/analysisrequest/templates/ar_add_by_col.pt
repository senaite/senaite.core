<div metal:define-macro="ar_add_by_col"
     style="padding-bottom:10px;">
    <script type="text/javascript" src="++resource++bika.lims.js/bika.lims.analysisrequest.add_by_col.js"></script>
    <table summary="Add analysis requests"
           class="listing analysisrequest add nosort"
           cellpadding="0" cellspacing="0">
        <thead>
        <thead class="analysisrequest_add_by_col">
            <!-- All edit fields with fields with add=visible -->
            <tr tal:repeat="field python:view.get_fields_with_visibility('edit')">
                <tal:def define="
                    fieldName python:field.getName();
                    field_macro here/widgets/field/macros/edit;
                    accessor python:field.getAccessor(context);
                    widget python:field.widget;
                    errors python:{};
                    mode string:edit;">
                    <th colspan="2" style="white-space:nowrap">
                        <label class="formQuestion">
                            <span tal:replace="python:view.context.translate(widget.Label(here))"/>
                        <span class="fieldRequired"
                                tal:condition="field/required"
                              title="Required"
                                i18n:attributes="title title_required;">&nbsp;</span>
                            <em style="display:block"
                                class="discreet"
                                    tal:define="description python:view.context.translate(widget.Description(here))"
                                    tal:content="structure description"
                                    tal:attributes="id string:${fieldName}_help">Help </em>
                        </label>

                    </th>
                    <td>
                        <img tal:condition="python:view.ar_count > 1"
                                tal:attributes="name fieldName;
                                        class string:copyButton ${fieldName}CopyButton;
                                src string:${portal/absolute_url}/++resource++bika.lims.images/copy.png;"/>
                    </td>
                    <tal:columns tal:repeat="arnum python:range(view.ar_count)">
                        <td tal:attributes="arnum arnum;
                                ar_add_ar_widget string:1">

                            <metal:field
                                    use-macro="python:context.widget(fieldName, mode='edit')"/>

                        </td>
                    </tal:columns>
                </tal:def>
            </tr>

            <tal:hidden
                    tal:repeat="field python:view.get_fields_with_visibility('hidden')">
                <tal:columns tal:repeat="arnum python:range(view.ar_count)"
                        tal:define="val python:field.getAccessor(context)()">
                    <input
                            type="hidden"
                            tal:attributes="
                                    name string:ar.${arnum}.${field/getName}:record;
                            id string:ar_${arnum}_${field/getName};
                            value val/Title|nothing;"/>
                    <input
                            type="hidden"
                            tal:attributes="
                                    name string:ar.${arnum}.${field/getName}_uid:record;
                            id string:ar_${arnum}_${field/getName}_uid;
                            value val/UID|nothing;">
                </tal:columns>
            </tal:hidden>

        </thead>

        <tfoot tal:condition="ShowPrices">
            <tr tal:condition="python:view.getMemberDiscountApplies() and ShowPrices">
                <th class="topborder" colspan="2">
                    <b i18n:translate="">Discount</b>
                    <span class="discreet">(<tal:i content="here/bika_setup/getMemberDiscount"/>%)</span>
                </th>
                <td class="topborder noleftborder" style="text-align:center">
                    <span tal:replace="python:currencies[currency].symbol"/>
                </td>
                <tal:block repeat="arnum python:range(view.ar_count)">
                    <td class="topborder" tal:define="input_id string:ar_${arnum}_discount;">
                        <input class="price noborder" size="10" disabled="disabled" value="0.00" tal:attributes="id input_id"/>
                    </td>
                </tal:block>
            </tr>
            <tr>
                <th colspan="2" class="topborder"><b i18n:translate="">Subtotal</b></th>
                <td class="topborder noleftborder" style="text-align:center">
                    <span tal:replace="python:currencies[currency].symbol"/>
                </td>
                <tal:block repeat="arnum python:range(view.ar_count)">
                    <td class="topborder"
                            tal:define="input_id string:ar_${arnum}_subtotal;
                                        input_name string:ar.${arnum}.subtotal">
                        <input class="price noborder" size="10" disabled="disabled" value="0.00"
                                tal:attributes="id string:${input_id}_display"/>
                        <input type="hidden"
                                tal:attributes="
                                        id input_id;
                                        name string:${input_name}:record:ignore_empty"/>
                    </td>
                </tal:block>
            </tr>
            <tr>
                <th colspan="2" class="topborder"><b i18n:translate="">VAT</b></th>
                <td class="topborder noleftborder" style="text-align:center">
                    <span tal:replace="python:currencies[currency].symbol"/>
                </td>
                <tal:block repeat="arnum python:range(view.ar_count)">
                    <td class="topborder" tal:define="input_id string:ar_${arnum}_vat;
                            input_name string:ar.${arnum}.vat">
                        <input class="price noborder" size="10" disabled="disabled" value="0.00"
                                tal:attributes="id string:${input_id}_display;"/>
                        <input type="hidden"
                                tal:attributes="
                                        id input_id;
                                        name string:${input_name}:record:ignore_empty;"/>
                    </td>
                </tal:block>
            </tr>
            <tr>
                <th class="topborder" colspan="2"><b i18n:translate="">Total</b></th>
                <td class="topborder noleftborder" style="text-align:center">
                    <span tal:replace="python:currencies[currency].symbol"/>
                </td>
                <tal:block repeat="arnum python:range(view.ar_count)">
                    <td class="topborder" tal:define="
                            input_id string:ar_${arnum}_total;
                            input_name string:ar.${arnum}.total">
                        <input class="price noborder" size="10" disabled="disabled" value="0.00"
                                tal:attributes="id string:${input_id}_display;"/>
                        <input type="hidden"
                                tal:attributes="
                                        id input_id;
                                        name string:${input_name}:record:ignore_empty;"/>
                    </td>
                </tal:block>
            </tr>
            <tr>
                <th colspan="3" style="background-color: #FFF">
                </th>
                <tal:block repeat="arnum python:range(view.ar_count)">
                    <td>
                        <input type="button" value="Create Profile"
                                tal:attributes="
                                        class string:ar_${arnum}_save_profile;
                                name string:save_profile;
                                id string:ar_${arnum}_save_profile;
                                " />
                    </td>
                </tal:block>
            </tr>
        </tfoot>
    </table>

    <!-- Analyses -->
    <div style="text-align:left;padding-bottom:10px;">
        <input i18n:attributes="value"
                class="context button allowMultiSubmit"
                type="submit"
                name="save_button"
                value="Save"/>
    </div>

    <span tal:define="services python:view.services_widget_content('field')">
        <h3 tal:condition="services" i18n:translate="">Field Analyses</h3>
        <span tal:replace="structure services"></span>
    </span>

    <span tal:define="services python:view.services_widget_content('lab')">
        <h3 tal:condition="services" i18n:translate="">Lab Analyses</h3>
        <span tal:replace="structure services"></span>
    </span>

</div>





































